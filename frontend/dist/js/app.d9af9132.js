(function(){"use strict";var e={6530:function(e,t,s){var o=s(3751),r=s(641),a=s(33);const n={id:"app",class:"min-h-screen bg-light-background dark:bg-dark-background text-light-title dark:text-dark-title font-sans antialiased"},i={key:0,class:"offline-indicator"};function l(e,t,s,o,l,d){const u=(0,r.g2)("Menu"),c=(0,r.g2)("router-view");return(0,r.uX)(),(0,r.CE)("div",n,[l.isOnline?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",i," Vous êtes hors ligne. Certaines fonctionnalités peuvent être limitées. ")),(0,r.bF)(u),(0,r.Lk)("div",{class:(0,a.C4)({"overflow-hidden max-h-screen":l.isModalOpen})},[(0,r.bF)(c)],2)])}s(4114);const d={class:"navbar bg-light-menu dark:bg-dark-menu p-4 shadow-md flex items-center justify-between"},u={class:"left-section flex items-center"},c={key:0,class:"mr-6"},m={key:1,class:"mr-6"},h={key:2,class:"mr-6"},p={key:3,class:"mr-6"},g={key:4,class:"mr-6"},f={key:0,class:"tournament-name text-lg font-bold absolute left-1/2 transform -translate-x-1/2 text-light-profileText dark:text-dark-profileText hidden sm:block"},y={key:0,class:"hidden lg:inline"},v={class:"right-section flex items-center"},b={key:0,class:"profile-section flex items-center"},k={class:"username text-light-menuText dark:text-dark-menuText font-bold mr-4"},T={key:1,class:"ml-4"};function C(e,t,s,o,n,i){const l=(0,r.g2)("router-link"),C=(0,r.g2)("font-awesome-icon");return(0,r.uX)(),(0,r.CE)("nav",d,[(0,r.Lk)("ul",u,[e.isAdmin?((0,r.uX)(),(0,r.CE)("li",c,[(0,r.bF)(l,{to:"/admin/tourneys",class:(0,a.C4)(i.getLinkClass("/admin/tourneys"))},{default:(0,r.k6)((()=>t[2]||(t[2]=[(0,r.eW)(" Tournois ")]))),_:1},8,["class"])])):(0,r.Q3)("",!0),e.isAuthenticated&&!e.isAdmin?((0,r.uX)(),(0,r.CE)("li",m,[(0,r.bF)(l,{to:"/tourneys",class:(0,a.C4)(i.getLinkClass("/tourneys"))},{default:(0,r.k6)((()=>t[3]||(t[3]=[(0,r.eW)(" Mes tournois ")]))),_:1},8,["class"])])):(0,r.Q3)("",!0),e.isAdmin?((0,r.uX)(),(0,r.CE)("li",h,[(0,r.bF)(l,{to:"/admin/sports",class:(0,a.C4)(i.getLinkClass("/admin/sports"))},{default:(0,r.k6)((()=>t[4]||(t[4]=[(0,r.eW)(" Sports ")]))),_:1},8,["class"])])):(0,r.Q3)("",!0),e.isAdmin?((0,r.uX)(),(0,r.CE)("li",p,[(0,r.bF)(l,{to:"/admin/users",class:(0,a.C4)(i.getLinkClass("/admin/users"))},{default:(0,r.k6)((()=>t[5]||(t[5]=[(0,r.eW)(" Users ")]))),_:1},8,["class"])])):(0,r.Q3)("",!0),e.isAdmin?((0,r.uX)(),(0,r.CE)("li",g,[(0,r.bF)(l,{to:"/tourneys",class:(0,a.C4)(i.getLinkClass("/tourneys"))},{default:(0,r.k6)((()=>t[6]||(t[6]=[(0,r.eW)(" Public ")]))),_:1},8,["class"])])):(0,r.Q3)("",!0)]),i.showTournamentName?((0,r.uX)(),(0,r.CE)("div",f,[(0,r.eW)((0,a.v_)(this.tournamentName)+" ",1),e.tournamentDate?((0,r.uX)(),(0,r.CE)("span",y," - "+(0,a.v_)(i.formatDate(e.tournamentDate)),1)):(0,r.Q3)("",!0)])):(0,r.Q3)("",!0),(0,r.Lk)("ul",v,[(0,r.Lk)("li",null,[(0,r.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>i.toggleDarkMode&&i.toggleDarkMode(...e)),class:"mr-2 p-2 rounded text-blue-200 dark:text-yellow-300 hover:text-blue-300 dark:hover:text-yellow-500"},[n.isDarkMode?((0,r.uX)(),(0,r.Wv)(C,{key:0,icon:["fas","sun"]})):((0,r.uX)(),(0,r.Wv)(C,{key:1,icon:["fas","moon"]}))])]),e.isAuthenticated?((0,r.uX)(),(0,r.CE)("li",b,[(0,r.bF)(l,{to:"/profile",class:"profile-link text-light-profileText dark:text-dark-profileText mr-4 hover:text-light-profileHoverText dark:hover:text-dark-profileHoverText"},{default:(0,r.k6)((()=>[(0,r.Lk)("span",k,(0,a.v_)(e.userName),1),(0,r.bF)(C,{icon:["fas","user"]})])),_:1}),(0,r.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>i.logout&&i.logout(...e)),class:"text-light-logoutButton-default dark:text-dark-logoutButton-default text-xl hover:text-light-logoutButton-hover dark:hover:text-dark-logoutButton-hover"},[(0,r.bF)(C,{icon:["fas","power-off"]})])])):(0,r.Q3)("",!0),e.isAuthenticated?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("li",T,[(0,r.bF)(l,{to:"/login",class:"text-light-profileText dark:text-dark-profileText font-bold text-lg flex items-center"},{default:(0,r.k6)((()=>[(0,r.bF)(C,{icon:["fas","sign-in-alt"],class:"mr-2"}),t[7]||(t[7]=(0,r.eW)("Se connecter "))])),_:1})]))])])}var x=s(6278),w={data(){return{isDarkMode:!1}},computed:{...(0,x.aH)({isAuthenticated:e=>e.isAuthenticated,isAdmin:e=>1===e.user?.roleId,userName:e=>e.user?.name,...(0,x.aH)("tourney",{tournamentName:e=>e.currentTournamentName,tournamentDate:e=>e.dateTourney})}),showTournamentName(){return(this.$route.path.startsWith("/tourneys/")||this.$route.path.startsWith("/admin/tourneys/"))&&this.$route.params.tourneyId}},methods:{logout(){localStorage.removeItem("token"),this.$store.dispatch("logout"),this.$router.push("/login")},formatDate(e){const t={year:"numeric",month:"long",day:"numeric"};return new Date(e).toLocaleDateString(void 0,t)},toggleDarkMode(){this.isDarkMode=!this.isDarkMode,this.isDarkMode?(document.documentElement.classList.add("dark"),localStorage.setItem("theme","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("theme","light"))},getLinkClass(e){const t=this.$route.path===e;return["font-semibold","hover:text-light-menuHoverText","dark:hover:text-dark-menuHoverText",t?"text-light-menuActive dark:text-dark-menuActive":"text-light-menuText dark:text-dark-menuText"]}},mounted(){const e="dark"===localStorage.getItem("theme")||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches;this.isDarkMode=e,e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}},E=s(6262);const I=(0,E.A)(w,[["render",C],["__scopeId","data-v-7c6b824a"]]);var S=I;const F={ADMIN:1,USER:2},P={[F.ADMIN]:["viewAdminPage","manageUsers","viewUserPage","viewDashboard","viewAssistantPage"],[F.USER]:["viewUserPage","viewDashboard"]};var A=s(4335);const L="http://localhost:3000/api",D="http://localhost:8080",M=A.A.create({baseURL:L});M.interceptors.request.use((e=>{const t=localStorage.getItem("token");return t&&(e.headers["Authorization"]=`Bearer ${t}`),e}));var $=M,U=s(5537),R={namespaced:!0,state:{currentTournamentName:"",tourneyType:"",dateTourney:"",statuses:{status:"draft",fieldAssignmentStatus:"notStarted",sportAssignmentStatus:"notStarted",registrationStatus:"notStarted",poolStatus:"notStarted",planningStatus:"notStarted"}},mutations:{SET_TOURNAMENT_NAME(e,t){e.currentTournamentName=t},SET_TOURNAMENT_TYPE(e,t){e.tourneyType=t},SET_TOURNAMENT_DATE(e,t){e.dateTourney=t},CLEAR_TOURNAMENT_NAME(e){e.currentTournamentName="",e.currentTournamentDate=""},SET_STATUSES(e,t){e.statuses={...e.statuses,...t}},UPDATE_STATUS(e,{key:t,value:s}){e.statuses[t]=s},RESET_TOURNEY_STATE(e){e.currentTournamentName="",e.dateTourney="",e.statuses={status:null,fieldAssignmentStatus:null,sportAssignmentStatus:null,registrationStatus:null,planningStatus:null}}},actions:{async fetchTourneyStatuses({commit:e},t){try{const s=await $.get(`/tourneys/${t}/statuses`),{name:o,tourneyType:r,dateTourney:a,status:n,registrationStatus:i,...l}=s.data;e("SET_TOURNAMENT_NAME",o),e("SET_TOURNAMENT_TYPE",r),e("SET_TOURNAMENT_DATE",a),e("SET_STATUSES",{...l,status:n,registrationStatus:i})}catch(s){throw console.error("Erreur lors de la récupération des statuts:",s),s}},async updateStatus({commit:e},{tourneyId:t,key:s,value:o}){try{await $.put(`/tourneys/${t}`,{[s]:o}),e("UPDATE_STATUS",{key:s,value:o})}catch(r){console.error("Erreur lors de la mise à jour du statut:",r)}},setTournamentName({commit:e},t){e("SET_TOURNAMENT_NAME",t)},clearTournamentName({commit:e}){e("CLEAR_TOURNAMENT_NAME")}}},V={namespaced:!0,state:{activeTourney:null,selectedTourney:{},tourneyRole:null,selectedPoolId:null,selectedFieldId:null,selectedGameId:null},mutations:{SET_ACTIVE_TOURNEY(e,t){e.activeTourney=t},SET_SELECTED_TOURNEY(e,t){e.selectedTourney[t.id]=t},SET_TOURNEY_ROLE(e,t){e.tourneyRole=t},SET_SELECTED_POOL(e,t){e.selectedPoolId=t},SET_SELECTED_FIELD(e,t){e.selectedFieldId=t},SET_SELECTED_GAME(e,t){e.selectedGameId=t},RESET_FILTERS(e){e.selectedPoolId=null,e.selectedFieldId=null,e.selectedGameId=null}},actions:{async fetchTourneyById({state:e,commit:t},s){if(e.selectedTourney[s])return e.selectedTourney[s];try{const e=await $.get(`/tourneys/${s}`),o=e.data;return t("SET_SELECTED_TOURNEY",o),o}catch(o){throw console.error("Erreur lors de la récupération du tournoi :",o),o}},async fetchActiveTourney({commit:e,dispatch:t}){try{const s=await $.get("/users/active-tourney"),o=s.data;if(o&&"active"===o.status){e("SET_ACTIVE_TOURNEY",o);const s=o.id;s&&await t("fetchTourneyRole",s)}else e("SET_ACTIVE_TOURNEY",null),e("SET_TOURNEY_ROLE",null)}catch(s){console.error("Erreur lors de la récupération du tournoi actif :",s)}},async fetchTourneyRole({commit:e},t){try{const s=await $.get(`/users/me/tourneys/${t}/role`);e("SET_TOURNEY_ROLE",s.data.tourneyRole)}catch(s){console.error("Erreur lors de la récupération du rôle dans le tournoi :",s)}},setSelectedPool({commit:e},t){e("SET_SELECTED_POOL",t)},setSelectedField({commit:e},t){e("SET_SELECTED_FIELD",t)},setSelectedGame({commit:e},t){e("SET_SELECTED_GAME",t)},resetFilters({commit:e}){e("RESET_FILTERS")}},getters:{isAssistant(e){return"assistant"===e.tourneyRole},getTourneyById:e=>t=>e.selectedTourney[t],selectedPoolId:e=>e.selectedPoolId,selectedFieldId:e=>e.selectedFieldId,selectedGameId:e=>e.selectedGameId}},_=s(4787);let X=null;function q(){if(!X){const e=localStorage.getItem("token");if(!e)return null;X=(0,_.io)("http://localhost:3000",{auth:{token:e},reconnectionAttempts:5,reconnectionDelay:5e3}),X.on("connect_error",(e=>{console.error("Erreur de connexion Socket.IO :",e.message)})),X.on("disconnect",(e=>{console.warn("Socket déconnecté :",e)}))}return X}var N=(0,x.y$)({modules:{tourney:R,userTourney:V},state:{isAuthenticated:!!localStorage.getItem("token"),user:null,tokenExpiration:null,inviteToken:localStorage.getItem("inviteToken")||null},mutations:{SET_AUTH(e,t){e.isAuthenticated=t.isAuthenticated,e.user=t.user,e.tokenExpiration=t.tokenExpiration},LOGOUT(e){e.isAuthenticated=!1,e.user=null,e.tokenExpiration=null,e.inviteToken=null,localStorage.removeItem("inviteToken"),this.commit("tourney/RESET_TOURNEY_STATE")},SET_ALERT_MESSAGE(e,t){e.alertMessage=t},CLEAR_ALERT_MESSAGE(e){e.alertMessage=null},UPDATE_USER_NAME(e,t){e.user&&(e.user.name=t)},SET_INVITE_TOKEN(e,t){e.inviteToken=t,localStorage.setItem("inviteToken",t)},CLEAR_INVITE_TOKEN(e){e.inviteToken=null,localStorage.removeItem("inviteToken")}},actions:{async login({commit:e},{email:t,password:s}){try{const o=await $.post("/auth/login",{email:t,password:s}),{token:r,expiresIn:a}=o.data;localStorage.setItem("token",r),$.defaults.headers.common["Authorization"]=`Bearer ${r}`;const n=await $.get("/users/me"),i=n.data;e("SET_AUTH",{isAuthenticated:!0,user:i,expiresIn:a})}catch(o){throw console.error("Erreur de connexion:",o),o}},logout({commit:e}){localStorage.removeItem("token");let t=q();t&&(t.disconnect(),t=null),delete $.defaults.headers.common["Authorization"],e("LOGOUT")},saveInviteToken({commit:e},t){e("SET_INVITE_TOKEN",t)},clearInviteToken({commit:e}){e("CLEAR_INVITE_TOKEN")},async initializeAuth({commit:e}){const t=localStorage.getItem("token");if(t)try{const s=(0,U.s)(t),o=Math.floor(Date.now()/1e3);if(s.exp&&o<s.exp){$.defaults.headers.common["Authorization"]=`Bearer ${t}`;const o=await $.get("/users/me"),r=o.data;e("SET_AUTH",{isAuthenticated:!0,user:r,tokenExpiration:s.exp})}else e("LOGOUT"),localStorage.removeItem("token")}catch(s){console.error("Erreur lors du décodage du token:",s),e("LOGOUT"),localStorage.removeItem("token")}}}});function B(e,t){const s=Object.entries(F).find((([,t])=>t===e))?.[0];if(!s)return!1;const o=P[F[s]]?.includes(t)??!1;return o}const W=()=>{localStorage.removeItem("token"),N.commit("LOGOUT")},j=()=>{const e=localStorage.getItem("token");if(!e)return!0;try{const t=(0,U.s)(e),s=Date.now()/1e3;return t.exp<s}catch(t){return!0}},Q=()=>{j()&&W()};function O(){return N.state.user?.roleId===F.ADMIN}async function G(){try{const e=localStorage.getItem("token");if(!e)throw new Error("Pas de token disponible pour le rafraîchissement.");const t=await $.post("/auth/refresh-token"),s=t.data.token;if(!s)throw new Error("Erreur lors de l'obtention du nouveau token.");return localStorage.setItem("token",s),$.defaults.headers.common["Authorization"]=`Bearer ${s}`,s}catch(e){throw console.error("Erreur lors du rafraîchissement du token :",e),e}}var z={name:"App",components:{Menu:S},data(){return{isModalOpen:!1,isOnline:navigator.onLine}},methods:{...(0,x.i0)(["logout"]),startTokenExpirationWatcher(){this.tokenWatcher&&clearInterval(this.tokenWatcher),this.checkTokenExpiration(),this.tokenWatcher=setInterval((()=>{this.checkTokenExpiration()}),this.getCheckInterval())},updateOnlineStatus(){this.isOnline=navigator.onLine},checkTokenExpiration(){j()&&(this.logout(),"/login"!==this.$route.path&&this.$router.push("/login"),clearInterval(this.tokenWatcher))},getCheckInterval(){const e=this.$store.state.tokenExpiration,t=Math.floor(Date.now()/1e3);if(e){const s=e-t;return s>10?s/2*1e3:5e3}return 5e3},handleModalOpen(){document.body.classList.add("modal-open")},handleModalClose(){document.body.classList.remove("modal-open")}},mounted(){const e=localStorage.getItem("token"),t=!!e;t&&!j()&&this.startTokenExpirationWatcher(),this.$watch((()=>this.$store.state.isAuthenticated),(e=>{e?this.startTokenExpirationWatcher():clearInterval(this.tokenWatcher)})),window.addEventListener("modal-open",this.handleModalOpen),window.addEventListener("modal-close",this.handleModalClose),window.addEventListener("online",this.updateOnlineStatus),window.addEventListener("offline",this.updateOnlineStatus)},beforeUnmount(){clearInterval(this.tokenWatcher),window.removeEventListener("modal-open",this.handleModalOpen),window.removeEventListener("modal-close",this.handleModalClose),window.removeEventListener("online",this.updateOnlineStatus),window.removeEventListener("offline",this.updateOnlineStatus)}};const H=(0,E.A)(z,[["render",l]]);var K=H,J=s(5220);function Y(e,t,s,o,a,n){const i=(0,r.g2)("AuthComponentForm");return(0,r.uX)(),(0,r.Wv)(i,{mode:"login",error:a.error,isSubmitting:a.isSubmitting,onSubmit:n.handleLogin},null,8,["error","isSubmitting","onSubmit"])}const Z={class:"flex justify-center items-center h-full bg-light-background dark:bg-dark-background p-8"},ee={class:"bg-light-card dark:bg-dark-card p-10 rounded-lg shadow-md w-full max-w-sm"},te={class:"text-2xl font-bold text-center mb-8 text-light-title dark:text-dark-title"},se={key:0,class:"mb-6"},oe={key:0,class:"text-light-form-error dark:text-dark-form-error text-sm mt-1"},re={key:1,class:"mb-6"},ae={key:0,class:"text-light-form-error dark:text-dark-form-error text-sm mt-1"},ne={key:2,class:"mb-6"},ie={key:0,class:"text-light-form-error dark:text-dark-form-error text-sm mt-1"},le={key:3,class:"mb-6"},de={key:0,class:"text-red-500 text-sm mt-1"},ue={key:0,class:"text-light-form-error dark:text-dark-form-error mt-4 text-center font-semibold"},ce={class:"text-center mt-6 text-light-form-text dark:text-dark-form-text"};function me(e,t,s,n,i,l){const d=(0,r.g2)("ButtonComponent"),u=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",Z,[(0,r.Lk)("div",ee,[(0,r.Lk)("h1",te,(0,a.v_)(l.title),1),(0,r.Lk)("form",{onSubmit:t[4]||(t[4]=(0,o.D$)(((...e)=>l.handleSubmit&&l.handleSubmit(...e)),["prevent"]))},["register"===s.mode?((0,r.uX)(),(0,r.CE)("div",se,[t[5]||(t[5]=(0,r.Lk)("label",{for:"name",class:"block text-light-form-text dark:text-dark-form-text font-semibold mb-2"}," Nom ",-1)),(0,r.bo)((0,r.Lk)("input",{id:"name",name:"name","onUpdate:modelValue":t[0]||(t[0]=e=>i.formData.name=e),type:"text",placeholder:"Entrer votre nom",class:(0,a.C4)(["w-full p-3 border rounded-md bg-light-form-background dark:bg-dark-form-background text-light-form-text dark:text-dark-form-text",{"border-light-form-error dark:border-dark-form-error":i.errors.name,"border-light-form-border-default dark:border-dark-form-border-default":!i.errors.name}])},null,2),[[o.Jo,i.formData.name]]),i.errors.name?((0,r.uX)(),(0,r.CE)("p",oe,(0,a.v_)(i.errors.name),1)):(0,r.Q3)("",!0)])):(0,r.Q3)("",!0),l.showEmailField?((0,r.uX)(),(0,r.CE)("div",re,[t[6]||(t[6]=(0,r.Lk)("label",{for:"email",class:"block text-light-form-text dark:text-dark-form-text font-semibold mb-2"}," Email ",-1)),(0,r.bo)((0,r.Lk)("input",{id:"email",name:"email","onUpdate:modelValue":t[1]||(t[1]=e=>i.formData.email=e),type:"email",placeholder:"Entrer votre email",autocomplete:"email",class:(0,a.C4)(["w-full p-3 border rounded-md bg-light-form-background dark:bg-dark-form-background text-light-form-text dark:text-dark-form-text",{"border-light-form-error dark:border-dark-form-error":i.errors.email,"border-light-form-border-default dark:border-dark-form-border-default":!i.errors.email}])},null,2),[[o.Jo,i.formData.email]]),i.errors.email?((0,r.uX)(),(0,r.CE)("p",ae,(0,a.v_)(i.errors.email),1)):(0,r.Q3)("",!0)])):(0,r.Q3)("",!0),l.showPasswordFields?((0,r.uX)(),(0,r.CE)("div",ne,[t[7]||(t[7]=(0,r.Lk)("label",{for:"password",class:"block text-light-form-text dark:text-dark-form-text font-semibold mb-2"}," Mot de passe ",-1)),(0,r.bo)((0,r.Lk)("input",{id:"password",name:"password","onUpdate:modelValue":t[2]||(t[2]=e=>i.formData.password=e),type:"password",placeholder:"Entrer votre mot de passe",autocomplete:"new-password",class:(0,a.C4)(["w-full p-3 border rounded-md bg-light-form-background dark:bg-dark-form-background text-light-form-text dark:text-dark-form-text",{"border-light-form-error dark:border-dark-form-error":i.errors.password,"border-light-form-border-default dark:border-dark-form-border-default":!i.errors.password}])},null,2),[[o.Jo,i.formData.password]]),i.errors.password?((0,r.uX)(),(0,r.CE)("p",ie,(0,a.v_)(i.errors.password),1)):(0,r.Q3)("",!0)])):(0,r.Q3)("",!0),l.showConfirmPasswordField?((0,r.uX)(),(0,r.CE)("div",le,[t[8]||(t[8]=(0,r.Lk)("label",{for:"confirmPassword",class:"block text-light-form-text dark:text-dark-form-text font-semibold mb-2"}," Confirmer le mot de passe ",-1)),(0,r.bo)((0,r.Lk)("input",{id:"confirmPassword",name:"confirmPassword","onUpdate:modelValue":t[3]||(t[3]=e=>i.formData.confirmPassword=e),type:"password",placeholder:"Confirmer votre mot de passe",autocomplete:"new-password",class:(0,a.C4)(["w-full p-3 border rounded-md bg-light-form-background dark:bg-dark-form-background text-light-form-text dark:text-dark-form-text",{"border-light-form-error dark:border-dark-form-error":i.errors.confirmPassword,"border-light-form-border-default dark:border-dark-form-border-default":!i.errors.confirmPassword}])},null,2),[[o.Jo,i.formData.confirmPassword]]),i.errors.confirmPassword?((0,r.uX)(),(0,r.CE)("p",de,(0,a.v_)(i.errors.confirmPassword),1)):(0,r.Q3)("",!0)])):(0,r.Q3)("",!0),(0,r.bF)(d,{variant:"primary",nativeType:"submit",class:"w-full ml-0 mr-0 sm:ml-0 sm:mr-0 px-2 sm:px-0 mx-0",disabled:s.isSubmitting},{default:(0,r.k6)((()=>[(0,r.eW)((0,a.v_)(l.submitButtonText),1)])),_:1},8,["disabled"])],32),s.error?((0,r.uX)(),(0,r.CE)("p",ue,(0,a.v_)(s.error),1)):(0,r.Q3)("",!0),(0,r.Lk)("div",ce,["login"===s.mode?((0,r.uX)(),(0,r.CE)(r.FK,{key:0},[t[11]||(t[11]=(0,r.eW)(" Pas de compte ? ")),(0,r.bF)(u,{to:"/register",class:"text-light-menuHoverText dark:text-dark-menuHoverText font-semibold"},{default:(0,r.k6)((()=>t[9]||(t[9]=[(0,r.eW)("Créer un compte")]))),_:1}),t[12]||(t[12]=(0,r.Lk)("br",null,null,-1)),(0,r.bF)(u,{to:"/forgot-password",class:"text-light-menuHoverText dark:text-dark-menuHoverText font-semibold block"},{default:(0,r.k6)((()=>t[10]||(t[10]=[(0,r.eW)("Mot de passe oublié ?")]))),_:1})],64)):"register"===s.mode?((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[t[14]||(t[14]=(0,r.eW)(" Déjà un compte ? ")),(0,r.bF)(u,{to:"/login",class:"text-light-menuHoverText dark:text-dark-menuHoverText font-semibold"},{default:(0,r.k6)((()=>t[13]||(t[13]=[(0,r.eW)("Se connecter")]))),_:1})],64)):"forgot-password"===s.mode?((0,r.uX)(),(0,r.Wv)(u,{key:2,to:"/login",class:"text-light-menuHoverText dark:text-dark-menuHoverText font-semibold"},{default:(0,r.k6)((()=>t[15]||(t[15]=[(0,r.eW)("Retour à la connexion")]))),_:1})):"reset-password"===s.mode?((0,r.uX)(),(0,r.Wv)(u,{key:3,to:"/login",class:"text-light-menuHoverText dark:text-dark-menuHoverText font-semibold"},{default:(0,r.k6)((()=>t[16]||(t[16]=[(0,r.eW)("Retour à la connexion")]))),_:1})):(0,r.Q3)("",!0)])])])}const he=["type","disabled"];function pe(e,t,s,o,n,i){const l=(0,r.g2)("font-awesome-icon");return(0,r.uX)(),(0,r.CE)("button",{type:s.nativeType,class:(0,a.C4)(["ml-1 mr-1 sm:ml-4 sm:mr-2 px-2 sm:px-4 py-2 font-semibold rounded-md shadow-md transition-all",i.variantClasses,s.disabled?"opacity-50 cursor-not-allowed":""]),disabled:s.disabled},[s.fontAwesomeIcon?((0,r.uX)(),(0,r.Wv)(l,{key:0,icon:["fas",s.fontAwesomeIcon],class:"w-5 h-5 mr-1 inline-block"},null,8,["icon"])):(0,r.Q3)("",!0),s.heroIcon?((0,r.uX)(),(0,r.Wv)((0,r.$y)(n.icons[s.heroIcon]),{key:1,class:"w-5 h-5 mr-1 inline-block"})):(0,r.Q3)("",!0),(0,r.RG)(e.$slots,"default")],10,he)}var ge=s(1758),fe=s(9357),ye=s(5428),ve={props:{variant:{type:String,default:"primary"},heroIcon:{type:String,default:null},fontAwesomeIcon:{type:String,default:null},nativeType:{type:String,default:"button"},disabled:{type:Boolean,default:!1}},computed:{variantClasses(){const e={primary:"bg-light-buttonVariants-primary-default dark:bg-dark-buttonVariants-primary-default text-white hover:bg-light-buttonVariants-primary-hover dark:hover:bg-dark-buttonVariants-primary-hover",secondary:"bg-light-buttonVariants-secondary-default dark:bg-dark-buttonVariants-secondary-default text-white hover:bg-light-buttonVariants-secondary-hover dark:hover:bg-dark-buttonVariants-secondary-hover",danger:"bg-light-buttonVariants-danger-default dark:bg-dark-buttonVariants-danger-default text-white hover:bg-light-buttonVariants-danger-hover dark:hover:bg-dark-buttonVariants-danger-hover",warning:"bg-light-buttonVariants-warning-default dark:bg-dark-buttonVariants-warning-default text-white hover:bg-light-buttonVariants-warning-hover dark:hover:bg-dark-buttonVariants-warning-hover",gray:"bg-light-buttonVariants-disabled-default dark:bg-dark-buttonVariants-disabled-default text-white",info:"bg-light-buttonVariants-info-default dark:bg-dark-buttonVariants-info-default text-white hover:bg-light-buttonVariants-info-hover dark:hover:bg-dark-buttonVariants-info-hover",algo:"bg-light-buttonVariants-algo-default dark:bg-dark-buttonVariants-algo-default text-white hover:bg-light-buttonVariants-algo-hover dark:hover:bg-dark-buttonVariants-algo-hover"};return e[this.variant]||e.primary}},data(){return{icons:{TrashIcon:ge.A,PencilIcon:fe.A,PlusIcon:ye.A}}}};const be=(0,E.A)(ve,[["render",pe]]);var ke=be,Te={name:"AuthComponentForm",components:{ButtonComponent:ke},props:{mode:{type:String,default:"login"},error:{type:String,default:""},isSubmitting:{type:Boolean,default:!1}},emits:["submit"],data(){return{formData:{name:"",email:"",password:"",confirmPassword:""},errors:{}}},computed:{showEmailField(){return"reset-password"!==this.mode},showPasswordFields(){return"login"===this.mode||"register"===this.mode||"reset-password"===this.mode},showConfirmPasswordField(){return"register"===this.mode||"reset-password"===this.mode},title(){switch(this.mode){case"login":return"Connexion";case"register":return"Inscription";case"forgot-password":return"Mot de passe oublié";case"reset-password":return"Réinitialiser le mot de passe";default:return"Authentification"}},submitButtonText(){switch(this.mode){case"login":return"Se connecter";case"register":return"S'inscrire";case"forgot-password":return"Envoyer le lien";case"reset-password":return"Réinitialiser le mot de passe";default:return"Soumettre"}}},methods:{handleSubmit(){if(this.errors={},"register"===this.mode?this.validateRegister():"login"===this.mode?this.validateLogin():"forgot-password"===this.mode?this.validateForgotPassword():"reset-password"===this.mode&&this.validateResetPassword(),0===Object.keys(this.errors).length){let e={};"login"===this.mode||"register"===this.mode?e={...this.formData}:"forgot-password"===this.mode?e={email:this.formData.email}:"reset-password"===this.mode&&(e={password:this.formData.password,confirmPassword:this.formData.confirmPassword}),this.$emit("submit",e)}},validateRegister(){if(this.formData.name||(this.errors.name="Le nom est obligatoire."),this.formData.email?this.validateEmail(this.formData.email)||(this.errors.email="Veuillez entrer un email valide."):this.errors.email="L'email est obligatoire.",this.formData.password){const e=/^(?=.*[A-Z]).{8,}$/;e.test(this.formData.password)||(this.errors.password="Le mot de passe doit contenir au moins 8 caractères et une majuscule.")}else this.errors.password="Le mot de passe est obligatoire.";this.formData.confirmPassword?this.formData.password!==this.formData.confirmPassword&&(this.errors.confirmPassword="Les mots de passe ne correspondent pas."):this.errors.confirmPassword="Veuillez confirmer votre mot de passe."},validateLogin(){this.formData.email?this.validateEmail(this.formData.email)||(this.errors.email="Veuillez entrer un email valide."):this.errors.email="L'email est obligatoire.",this.formData.password||(this.errors.password="Le mot de passe est obligatoire.")},validateForgotPassword(){this.formData.email?this.validateEmail(this.formData.email)||(this.errors.email="Veuillez entrer un email valide."):this.errors.email="L'email est obligatoire."},validateResetPassword(){if(this.formData.password){const e=/^(?=.*[A-Z]).{8,}$/;e.test(this.formData.password)||(this.errors.password="Le mot de passe doit contenir au moins 8 caractères et une majuscule.")}else this.errors.password="Le mot de passe est obligatoire.";this.formData.confirmPassword?this.formData.password!==this.formData.confirmPassword&&(this.errors.confirmPassword="Les mots de passe ne correspondent pas."):this.errors.confirmPassword="Veuillez confirmer votre mot de passe."},validateEmail(e){const t=/\S+@\S+\.\S+/;return t.test(e)}},watch:{mode(){this.formData={name:"",email:"",password:"",confirmPassword:""},this.errors={}}}};const Ce=(0,E.A)(Te,[["render",me],["__scopeId","data-v-68b1f88e"]]);var xe=Ce,we=s(7695),Ee={name:"LoginPage",components:{AuthComponentForm:xe},data(){return{error:"",isSubmitting:!1}},methods:{async handleLogin(e){this.error="",this.toastSuccess=null,this.toastError=null,this.isSubmitting=!0;try{const s=await $.post("/auth/login",{email:e.email,password:e.password}),o=s.data.token;localStorage.setItem("token",o),$.defaults.headers.common["Authorization"]=`Bearer ${o}`;const r=await $.get("/users/me"),a=r.data;this.$store.commit("SET_AUTH",{isAuthenticated:!0,user:a});const n=this.$store.state.inviteToken;if(n)try{await $.post("/tourneys/join",{token:n})}catch(t){console.error("Erreur lors de la jonction au tournoi:",t),t.response&&400===t.response.status?we.oR.error(t.response.data.message||"Impossible de rejoindre le tournoi."):we.oR.error("Erreur lors de la jonction au tournoi.")}finally{this.$store.dispatch("clearInviteToken")}const i=a.roleId;if(i===F.ADMIN)this.$router.replace("/admin/tourneys");else{const e=n?(0,U.s)(n).tourneyId:null;e?this.$router.replace(`/tourneys/${e}/join-team`):this.$router.replace("/tourneys")}}catch(t){console.error("Erreur lors de la connexion:",t),"ERR_NETWORK"!==t.code&&t.response?t.response&&401===t.response.status?this.error="Identifiant ou mot de passe incorrect.":this.error="Une erreur est survenue. Veuillez réessayer.":this.error="Le serveur de connexion est injoignable. Veuillez ressayer plus tard."}finally{this.isSubmitting=!1}}}};const Ie=(0,E.A)(Ee,[["render",Y],["__scopeId","data-v-2536af73"]]);var Se=Ie;function Fe(e,t,s,o,a,n){const i=(0,r.g2)("AuthComponentForm");return(0,r.uX)(),(0,r.Wv)(i,{mode:"register",error:a.error,isSubmitting:a.isSubmitting,onSubmit:n.handleRegister},null,8,["error","isSubmitting","onSubmit"])}var Pe={name:"RegisterPage",components:{AuthComponentForm:xe},data(){return{error:"",isSubmitting:!1}},methods:{async handleRegister(e){this.error="",this.isSubmitting=!0;try{const s=await $.post("/auth/register",{name:e.name,email:e.email,password:e.password,confirmPassword:e.confirmPassword}),o=s.data.token;localStorage.setItem("token",o),$.defaults.headers.common["Authorization"]=`Bearer ${o}`;const r=await $.get("/users/me"),a=r.data;this.$store.commit("SET_AUTH",{isAuthenticated:!0,user:a});const n=this.$store.state.inviteToken;if(n)try{await $.post("/tourneys/join",{token:n}),we.oR.success("Vous avez rejoint le tournoi avec succès.")}catch(t){console.error("Erreur lors de la jonction au tournoi:",t),t.response&&400===t.response.status?we.oR.error(t.response.data.message||"Impossible de rejoindre le tournoi."):we.oR.error("Erreur lors de la jonction au tournoi.")}finally{this.$store.dispatch("clearInviteToken")}const i=a.roleId;if(i===F.ADMIN)this.$router.replace("/tourneys");else{const e=n?(0,U.s)(n).tourneyId:null;e?this.$router.replace(`/tourneys/${e}/join-team`):this.$router.replace("/profile")}}catch(t){console.error("Erreur lors de l'inscription:",t),t.response&&t.response.data&&t.response.data.message?this.error=t.response.data.message:this.error="Erreur lors de l'inscription. Veuillez vérifier vos informations."}finally{this.isSubmitting=!1}}}};const Ae=(0,E.A)(Pe,[["render",Fe],["__scopeId","data-v-73ffed18"]]);var Le=Ae;const De={class:"flex h-dvh bg-gray-100"};function Me(e,t,s,o,a,n){return(0,r.uX)(),(0,r.CE)("div",De,t[0]||(t[0]=[(0,r.Fv)('<div class="w-1/2 flex flex-col justify-center items-center"><h1 class="text-6xl font-extrabold text-green-400 mb-6"> 403 Access Denied </h1><p class="text-2xl text-gray-700 text-center px-8"> Sorry, you don’t have the necessary permissions to view this page. </p></div><div class="w-1/2 flex justify-center items-center bg-gray-700"><p class="text-4xl text-white text-center"> Please contact your administrator if you think this is a mistake. </p></div>',2)]))}var $e={name:"AccessDeniedPage"};const Ue=(0,E.A)($e,[["render",Me]]);var Re=Ue;const Ve={class:"flex h-dvh bg-gray-100"};function _e(e,t,s,o,a,n){return(0,r.uX)(),(0,r.CE)("div",Ve,t[0]||(t[0]=[(0,r.Fv)('<div class="w-1/2 flex flex-col justify-center items-center"><h1 class="text-6xl font-extrabold text-green-400 mb-6">404 Not Found</h1><p class="text-2xl text-gray-700 text-center px-8"> Oops! The page you&#39;re looking for doesn&#39;t exist. </p></div><div class="w-1/2 flex justify-center items-center bg-gray-700"><p class="text-4xl text-white text-center"> Try returning to the homepage or check the URL. </p></div>',2)]))}var Xe={name:"NotFoundPage"};const qe=(0,E.A)(Xe,[["render",_e]]);var Ne=qe;function Be(e,t,s,o,a,n){const i=(0,r.g2)("AuthComponentForm");return(0,r.uX)(),(0,r.Wv)(i,{mode:"forgot-password",error:a.error,isSubmitting:a.isSubmitting,onSubmit:n.handleForgotPassword},null,8,["error","isSubmitting","onSubmit"])}var We={name:"ForgotPassword",components:{AuthComponentForm:xe},data(){return{error:"",isSubmitting:!1}},methods:{async handleForgotPassword(e){this.error="",this.isSubmitting=!0;try{await $.post("/auth/forgot-password",{email:e.email}),we.oR.success("Un lien de réinitialisation a été envoyé à votre adresse email.")}catch(t){console.error("Erreur lors de la demande de réinitialisation du mot de passe:",t),this.error=t.response?.data?.message||"Une erreur est survenue. Veuillez réessayer."}finally{this.isSubmitting=!1}}}};const je=(0,E.A)(We,[["render",Be],["__scopeId","data-v-8601a102"]]);var Qe=je;function Oe(e,t,s,o,a,n){const i=(0,r.g2)("AuthComponentForm");return(0,r.uX)(),(0,r.Wv)(i,{mode:"reset-password",error:a.error,isSubmitting:a.isSubmitting,onSubmit:n.handleResetPassword},null,8,["error","isSubmitting","onSubmit"])}var Ge={name:"ResetPassword",components:{AuthComponentForm:xe},data(){return{error:"",isSubmitting:!1}},methods:{async handleResetPassword(e){this.error="",this.isSubmitting=!0;try{const t=this.$route.params.token;await $.post("/auth/reset-password",{token:t,password:e.password,confirmPassword:e.confirmPassword}),this.$router.push({name:"LoginPage"})}catch(t){console.error("Erreur lors de la réinitialisation du mot de passe:",t),this.error=t.response?.data?.message||"Une erreur est survenue. Veuillez réessayer."}finally{this.isSubmitting=!1}}}};const ze=(0,E.A)(Ge,[["render",Oe],["__scopeId","data-v-0c3a4579"]]);var He=ze,Ke=[{path:"/:pathMatch(.*)*",redirect:"/404"},{path:"/access-denied",name:"AccessDenied",component:Re},{path:"/404",name:"NotFoundPage",component:Ne},{path:"/",redirect:"/login"},{path:"/login",name:"LoginPage",component:Se,meta:{requiresAuth:!1}},{path:"/register",name:"RegisterPage",component:Le,meta:{requiresAuth:!1}},{path:"/forgot-password",name:"ForgotPassword",component:Qe,meta:{requiresAuth:!1}},{path:"/reset-password/:token",name:"ResetPassword",component:He,meta:{requiresAuth:!1}}];function Je(e,t,s,o,a,n){return(0,r.uX)(),(0,r.CE)("div",null,t[0]||(t[0]=[(0,r.Lk)("h1",null,"Bienvenue Admin",-1),(0,r.Lk)("p",null,"Gestion des tournois et des utilisateurs.",-1)]))}var Ye={name:"AdminPage"};const Ze=(0,E.A)(Ye,[["render",Je],["__scopeId","data-v-19a8e682"]]);var et=Ze;const tt={class:"p-6"},st={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-8"},ot={class:"flex flex-wrap items-center gap-4 sm:gap-8 mt-4 sm:mt-0"},rt={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"};function at(e,t,s,o,a,n){const i=(0,r.g2)("TitleComponent"),l=(0,r.g2)("FilterComponent"),d=(0,r.g2)("CardAddComponent"),u=(0,r.g2)("CardEditComponent"),c=(0,r.g2)("FormComponent"),m=(0,r.g2)("ModalComponent"),h=(0,r.g2)("DeleteConfirmationModal");return(0,r.uX)(),(0,r.CE)("div",tt,[(0,r.Lk)("div",st,[(0,r.bF)(i,{title:"Gestion des Tournois"}),(0,r.Lk)("div",ot,[(0,r.bF)(l,{filters:a.filters,onFilterChange:n.handleFilterChange},null,8,["filters","onFilterChange"])])]),(0,r.Lk)("div",rt,[(0,r.bF)(d,{title:"Tournoi",onOpenAddElementModal:n.openAddTourneyModal},null,8,["onOpenAddElementModal"]),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.filteredTourneys,(e=>((0,r.uX)(),(0,r.Wv)(u,{key:e.id,title:e.name,location:e.location,date:e.dateTourney,status:e.status,showDeleteButton:!0,showEditButton:!0,onClick:t=>n.viewTourneyDetails(e.id),onDelete:t=>n.confirmDeleteTourney(e.id),onEdit:t=>n.editTourney(e)},null,8,["title","location","date","status","onClick","onDelete","onEdit"])))),128))]),(0,r.bF)(m,{isVisible:a.showModal,title:a.editingTourneyId?"Modifier le Tournoi":"Ajouter un Nouveau Tournoi",onClose:n.closeModal},{content:(0,r.k6)((()=>[(0,r.bF)(c,{modelValue:a.newTourney,"onUpdate:modelValue":t[0]||(t[0]=e=>a.newTourney=e),fields:n.formFields,isEditing:!!a.editingTourneyId,minDate:"1900-01-01",maxDate:"2200-01-01",onFormSubmit:n.handleFormSubmit,onFormCancel:n.closeModal,customValidation:n.validateForm},null,8,["modelValue","fields","isEditing","onFormSubmit","onFormCancel","customValidation"])])),_:1},8,["isVisible","title","onClose"]),(0,r.bF)(h,{isVisible:a.showDeleteConfirmation,onFormCancel:n.closeDeleteConfirmation,onConfirm:t[1]||(t[1]=e=>n.deleteTourney(a.confirmedDeleteTourneyId))},null,8,["isVisible","onFormCancel"])])}const nt={key:0,class:"fixed inset-0 bg-light-modal-background dark:bg-dark-modal-background flex items-center justify-center z-50"},it={class:"bg-light-modal-content dark:bg-dark-modal-content p-8 rounded-lg w-full max-w-md max-h-screen overflow-y-auto"},lt={class:"text-2xl font-bold mb-4 text-light-title dark:text-dark-title"};function dt(e,t,s,o,n,i){return s.isVisible?((0,r.uX)(),(0,r.CE)("div",nt,[(0,r.Lk)("div",it,[(0,r.RG)(e.$slots,"header",{},(()=>[(0,r.Lk)("h2",lt,(0,a.v_)(s.title),1)]),!0),(0,r.RG)(e.$slots,"content",{},void 0,!0),(0,r.RG)(e.$slots,"footer",{},void 0,!0)])])):(0,r.Q3)("",!0)}var ut={props:{isVisible:{type:Boolean,required:!0},title:{type:String,default:""}},watch:{isVisible(e){e?window.dispatchEvent(new Event("modal-open")):window.dispatchEvent(new Event("modal-close"))}},methods:{close(){this.$emit("close")}}};const ct=(0,E.A)(ut,[["render",dt],["__scopeId","data-v-134d36a0"]]);var mt=ct;const ht={class:"bg-light-modal-content dark:bg-dark-modal-content p-8 rounded-lg w-full max-w-md"},pt={class:"text-2xl font-bold mb-4 text-light-title dark:text-dark-title"},gt={class:"mb-6 text-light-form-text dark:text-dark-form-text"},ft={key:0,class:"mb-4 text-light-form-error dark:text-dark-form-error"},yt={class:"flex justify-end space-x-4"},vt={key:2,class:"flex justify-end space-x-4"};function bt(e,t,s,n,i,l){const d=(0,r.g2)("ButtonComponent"),u=(0,r.g2)("FormComponent");return s.isVisible?((0,r.uX)(),(0,r.CE)("div",{key:0,ref:"modalContainer",class:"fixed inset-0 bg-light-modal-background z-50 dark:bg-dark-modal-background flex items-center justify-center",tabindex:"0","aria-modal":"true","aria-labelledby":"modal-title",onKeydown:t[1]||(t[1]=(0,o.jR)(((...e)=>n.handleConfirm&&n.handleConfirm(...e)),["enter"]))},[(0,r.Lk)("div",ht,[(0,r.Lk)("h2",pt,(0,a.v_)(s.title),1),(0,r.Lk)("p",gt,(0,a.v_)(s.message),1),s.isHardDelete&&s.hardDeleteMessage?((0,r.uX)(),(0,r.CE)("p",ft,(0,a.v_)(s.hardDeleteMessage),1)):(0,r.Q3)("",!0),s.isHardDelete?((0,r.uX)(),(0,r.Wv)(u,{key:1,modelValue:n.formData,"onUpdate:modelValue":t[0]||(t[0]=e=>n.formData=e),fields:n.formFields,isEditing:!1,onFormSubmit:n.handleConfirm,onFormCancel:n.handleCancel},{buttons:(0,r.k6)((()=>[(0,r.Lk)("div",yt,[(0,r.bF)(d,{variant:"secondary",nativeType:"button",onClick:n.handleCancel},{default:(0,r.k6)((()=>t[2]||(t[2]=[(0,r.eW)(" Annuler ")]))),_:1},8,["onClick"]),(0,r.bF)(d,{variant:"CONFIRM"===n.formData.confirmationText?"danger":"gray",nativeType:"submit",disabled:"CONFIRM"!==n.formData.confirmationText},{default:(0,r.k6)((()=>[(0,r.eW)((0,a.v_)(s.textButton),1)])),_:1},8,["variant","disabled"])])])),_:1},8,["modelValue","fields","onFormSubmit","onFormCancel"])):((0,r.uX)(),(0,r.CE)("div",vt,[(0,r.bF)(d,{variant:"secondary",onClick:n.handleCancel},{default:(0,r.k6)((()=>t[3]||(t[3]=[(0,r.eW)(" Annuler ")]))),_:1},8,["onClick"]),(0,r.bF)(d,{variant:"danger",onClick:n.handleConfirm},{default:(0,r.k6)((()=>[(0,r.eW)((0,a.v_)(s.textButton),1)])),_:1},8,["onClick"])]))])],544)):(0,r.Q3)("",!0)}var kt=s(953);const Tt=["for"],Ct={key:0,class:"text-light-form-error dark:text-dark-form-error"},xt=["onClick"],wt={key:0,class:"absolute bottom-full mb-2 w-64 bg-gray-700 dark:bg-gray-600 text-white text-base rounded py-1 px-2 z-10 text-left",style:{left:"50%",transform:"translateX(-50%)"}},Et=["type","id","disabled","onUpdate:modelValue","onInput","placeholder"],It=["id","disabled","onUpdate:modelValue","onInput"],St=["id","disabled","onUpdate:modelValue","onChange"],Ft=["value"],Pt=["id","disabled"],At={key:5,class:"flex items-center"},Lt=["disabled","id","onUpdate:modelValue","onInput"],Dt={key:6,class:"text-light-form-error dark:text-dark-form-error text-sm mt-1"},Mt={class:"flex justify-between mt-4"};function $t(e,t,s,n,i,l){const d=(0,r.g2)("font-awesome-icon"),u=(0,r.g2)("AutocompleteAddress"),c=(0,r.g2)("ButtonComponent");return(0,r.uX)(),(0,r.CE)("form",{onSubmit:t[3]||(t[3]=(0,o.D$)(((...e)=>l.handleSubmit&&l.handleSubmit(...e)),["prevent"]))},[(0,r.Lk)("div",{class:(0,a.C4)(l.gridClass)},[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.fields,(n=>((0,r.uX)(),(0,r.CE)("div",{key:n.name,class:"mb-4"},[((0,r.uX)(),(0,r.Wv)((0,r.$y)(e.$slots[n.name]?"slot":"div"),{name:n.name},{default:(0,r.k6)((()=>[e.$slots[n.name]?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)(r.FK,{key:0},[(0,r.Lk)("label",{for:n.name,class:"block text-light-form-text dark:text-dark-form-text font-semibold mb-2 flex items-center"},[(0,r.eW)((0,a.v_)(n.label)+" ",1),n.required?((0,r.uX)(),(0,r.CE)("span",Ct,"*")):(0,r.Q3)("",!0),n.tooltip?((0,r.uX)(),(0,r.CE)("button",{key:1,type:"button",onClick:e=>l.toggleTooltip(n.name),class:"ml-2 relative focus:outline-none"},[(0,r.bF)(d,{icon:"question-circle",class:"text-light-form-iconQuestion dark:text-dark-form-iconQuestion cursor-pointer"}),i.visibleTooltip===n.name?((0,r.uX)(),(0,r.CE)("div",wt,(0,a.v_)(n.tooltip),1)):(0,r.Q3)("",!0)],8,xt)):(0,r.Q3)("",!0)],8,Tt),"location"===n.name?((0,r.uX)(),(0,r.Wv)(u,{key:0,modelValue:l.formData.location,"onUpdate:modelValue":t[0]||(t[0]=e=>l.formData.location=e),disabled:!s.isEditable,placeholder:n.placeholder,onInput:e=>l.validateField(n)},null,8,["modelValue","disabled","placeholder","onInput"])):(0,r.Q3)("",!0),"textarea"!==n.type&&"select"!==n.type&&"file"!==n.type&&"radio"!==n.type&&"color"!==n.type&&"location"!==n.name?(0,r.bo)(((0,r.uX)(),(0,r.CE)("input",{key:1,type:n.type,id:n.name,disabled:!s.isEditable,"onUpdate:modelValue":e=>l.formData[n.name]=e,class:(0,a.C4)(["w-full p-2 rounded-md border","bg-light-form-background dark:bg-dark-form-background","text-light-form-text dark:text-dark-form-text",i.errors[n.name]?"border-light-form-error dark:border-dark-form-error":"border-light-form-border-default dark:border-dark-form-border-default"]),onInput:e=>l.validateField(n),placeholder:n.placeholder},null,42,Et)),[[o.hp,l.formData[n.name]]]):(0,r.Q3)("",!0),"textarea"===n.type?(0,r.bo)(((0,r.uX)(),(0,r.CE)("textarea",{key:2,id:n.name,disabled:!s.isEditable,"onUpdate:modelValue":e=>l.formData[n.name]=e,class:(0,a.C4)(["w-full p-2 rounded-md border","bg-light-form-background dark:bg-dark-form-background","text-light-form-text dark:text-dark-form-text",i.errors[n.name]?"border-light-form-error dark:border-dark-form-error":"border-light-form-border-default dark:border-dark-form-border-default"]),onInput:e=>l.validateField(n)},null,42,It)),[[o.Jo,l.formData[n.name]]]):(0,r.Q3)("",!0),"select"===n.type?(0,r.bo)(((0,r.uX)(),(0,r.CE)("select",{key:3,id:n.name,disabled:!s.isEditable,"onUpdate:modelValue":e=>l.formData[n.name]=e,class:"w-full p-2 rounded-md bg-light-form-background dark:bg-dark-form-background border border-light-form-border-default dark:border-dark-form-border-default text-light-form-text dark:text-dark-form-text",onChange:e=>l.validateField(n)},[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.options,(e=>((0,r.uX)(),(0,r.CE)("option",{key:e.value,value:e.value},(0,a.v_)(e.label),9,Ft)))),128))],40,St)),[[o.u1,l.formData[n.name]]]):(0,r.Q3)("",!0),"file"===n.type?((0,r.uX)(),(0,r.CE)("input",{key:4,type:"file",id:n.name,disabled:!s.isEditable,onChange:t[1]||(t[1]=(...e)=>l.handleFileChange&&l.handleFileChange(...e)),onClick:t[2]||(t[2]=(0,o.D$)((()=>{}),["stop"])),accept:"image/*",class:"w-full p-2 rounded-md bg-light-form-background dark:bg-dark-form-background border border-light-form-border-default dark:border-dark-form-border-default text-light-form-text dark:text-dark-form-text"},null,40,Pt)):(0,r.Q3)("",!0),"color"===n.type?((0,r.uX)(),(0,r.CE)("div",At,[(0,r.bo)((0,r.Lk)("input",{type:"color",disabled:!s.isEditable,id:n.name,"onUpdate:modelValue":e=>l.formData[n.name]=e,class:"w-16 h-16 p-0 border-none rounded-md",onInput:e=>l.validateField(n)},null,40,Lt),[[o.Jo,l.formData[n.name]]]),(0,r.Lk)("div",{class:"w-8 h-8 ml-4 border border-light-form-border-default dark:border-dark-form-border-default rounded-md",style:(0,a.Tr)({backgroundColor:l.formData[n.name]})},null,4)])):(0,r.Q3)("",!0),i.errors[n.name]?((0,r.uX)(),(0,r.CE)("p",Dt,(0,a.v_)(i.errors[n.name]),1)):(0,r.Q3)("",!0)],64))])),_:2},1032,["name"]))])))),128))],2),(0,r.RG)(e.$slots,"buttons",{},(()=>[(0,r.Lk)("div",Mt,[(0,r.bF)(c,{variant:"secondary",nativeType:"button",onClick:l.handleCancel},{default:(0,r.k6)((()=>t[4]||(t[4]=[(0,r.eW)(" Annuler ")]))),_:1},8,["onClick"]),s.isEditable?((0,r.uX)(),(0,r.Wv)(c,{key:0,variant:l.isFormValid?"primary":"disabled",nativeType:"submit",disabled:!l.isFormValid},{default:(0,r.k6)((()=>[(0,r.eW)((0,a.v_)(s.isEditing?"Modifier":"Ajouter"),1)])),_:1},8,["variant","disabled"])):(0,r.Q3)("",!0)])]),!0)],32)}const Ut=["placeholder","disabled"],Rt={key:0,class:"border border-light-form-border-default dark:border-dark-form-border-default bg-light-card dark:bg-dark-card rounded-md mt-2 max-h-40 overflow-auto"},Vt=["onClick"];function _t(e,t,s,n,i,l){return(0,r.uX)(),(0,r.CE)("div",null,[(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>i.inputValue=e),onInput:t[1]||(t[1]=(...e)=>l.onInput&&l.onInput(...e)),placeholder:s.placeholder,disabled:s.disabled,class:"w-full p-2 rounded-md border bg-light-form-background dark:bg-dark-form-background text-light-form-text dark:text-dark-form-text border-light-form-border-default dark:border-dark-form-border-default"},null,40,Ut),[[o.Jo,i.inputValue]]),i.suggestions.length>0?((0,r.uX)(),(0,r.CE)("ul",Rt,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.suggestions,((e,t)=>((0,r.uX)(),(0,r.CE)("li",{key:t,onClick:t=>l.selectSuggestion(e),class:"p-2 cursor-pointer hover:bg-gray-200 dark:hover:bg-gray-700"},(0,a.v_)(e.display_name),9,Vt)))),128))])):(0,r.Q3)("",!0)])}var Xt={name:"AutocompleteAddress",props:{modelValue:{type:Object,default:()=>({address:"",latitude:null,longitude:null})},placeholder:{type:String,default:"Entrez une adresse"},disabled:{type:Boolean,default:!1}},data(){return{inputValue:this.modelValue.address||"",suggestions:[],query:"",timeout:null}},watch:{modelValue:{handler(e){e.address!==this.inputValue&&(this.inputValue=e.address||"")},deep:!0}},methods:{onInput(e){const t=e.target.value;this.inputValue=t,this.query=t,this.timeout&&clearTimeout(this.timeout),t.length>2?this.timeout=setTimeout((()=>{this.fetchSuggestions()}),300):this.suggestions=[],this.$emit("update:modelValue",{address:t,latitude:null,longitude:null})},async fetchSuggestions(){try{const e=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(this.query)}&addressdetails=1&limit=5`,{headers:{"User-Agent":"EasyTourney/1.0 (julienrichoz@outlook.com)"}}),t=await e.json();this.suggestions=t}catch(e){console.error("Erreur lors de la récupération des suggestions:",e)}},selectSuggestion(e){const t={address:e.display_name,latitude:parseFloat(e.lat),longitude:parseFloat(e.lon)};this.inputValue=t.address,this.$emit("update:modelValue",t),this.suggestions=[]}}};const qt=(0,E.A)(Xt,[["render",_t],["__scopeId","data-v-7d057fdd"]]);var Nt=qt,Bt={components:{ButtonComponent:ke,AutocompleteAddress:Nt},props:{fields:{type:Array,required:!0},modelValue:{type:Object,required:!0},isEditing:{type:Boolean,default:!1},minDate:{type:String,required:!1},maxDate:{type:String,required:!1},customValidation:{type:Function,required:!1,default:null},isEditable:{type:Boolean,default:!0},columns:{type:Number,default:1}},data(){return{errors:{},visibleTooltip:null}},computed:{formData:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},gridClass(){return`grid grid-cols-1 sm:grid-cols-${this.columns} gap-4`},isFormValid(){return 0===Object.keys(this.errors).length&&this.fields.every((e=>!e.required||null!==this.formData[e.name]&&void 0!==this.formData[e.name]&&""!==this.formData[e.name]))}},watch:{isFormValid(e){this.$emit("update-validation",e)}},methods:{validateField(e){if("location"===e.name&&e.required&&(this.formData.location&&this.formData.location.address&&this.formData.location.latitude&&this.formData.location.longitude?delete this.errors.location:this.errors.location="Veuillez sélectionner une adresse valide."),!e.required||null!==this.formData[e.name]&&void 0!==this.formData[e.name]&&""!==this.formData[e.name])if("date"===e.type){const t=new Date(this.formData[e.name]),s=this.minDate?new Date(this.minDate):null,o=this.maxDate?new Date(this.maxDate):null;s&&t<s?this.errors[e.name]=`La date doit être après le ${this.minDate}`:o&&t>o?this.errors[e.name]=`La date doit être avant le ${this.maxDate}`:delete this.errors[e.name]}else delete this.errors[e.name];else this.errors[e.name]="Ce champ est obligatoire";this.$emit("update-validation",this.isFormValid)},toggleTooltip(e){this.visibleTooltip=this.visibleTooltip===e?null:e},handleFileChange(e){const t=e.target.files[0]||null;if(t){const e=10485760;if(t.size>e)return void(this.errors.image="La taille de l'image ne doit pas dépasser 10MB");delete this.errors.image,this.formData.image=t,this.$emit("file-selected",t)}else this.formData.image=null,this.$emit("file-selected",null);e.stopPropagation()},handleSubmit(){if(this.isEditable){if(this.errors={},this.fields.forEach((e=>{this.validateField(e)})),this.customValidation){const e=this.customValidation()||{};this.errors={...this.errors,...e}}this.isFormValid&&this.$emit("form-submit",this.formData)}},handleCancel(){this.$emit("form-cancel")}}};const Wt=(0,E.A)(Bt,[["render",$t],["__scopeId","data-v-69f566fe"]]);var jt=Wt,Qt={components:{ButtonComponent:ke,FormComponent:jt},props:{isVisible:{type:Boolean,required:!0},title:{type:String,default:"Confirmation de suppression"},message:{type:String,default:"Êtes-vous sûr de vouloir supprimer cet élément ?"},isHardDelete:{type:Boolean,default:!1},hardDeleteMessage:{type:String,default:"Cette action est irréversible et entraîne des suppressions en cascade. Risque de pertes de données annexes."},textButton:{type:String,default:"Supprimer"}},setup(e,{emit:t}){const s=(0,kt.KR)(null),o=(0,kt.KR)({confirmationText:""}),a=[{name:"confirmationText",label:'Tapez "CONFIRM" pour confirmer',type:"text",required:!0}],n=()=>{t("form-cancel")},i=()=>{e.isHardDelete&&"CONFIRM"!==o.value.confirmationText||(t("confirm"),o.value.confirmationText="")};return(0,r.wB)((()=>e.isVisible),(e=>{e?(0,r.dY)((()=>{s.value&&s.value.focus()})):o.value.confirmationText=""})),{modalContainer:s,formData:o,formFields:a,handleCancel:n,handleConfirm:i}}};const Ot=(0,E.A)(Qt,[["render",bt],["__scopeId","data-v-62a69ed2"]]);var Gt=Ot;const zt={class:"text-md font-semibold mt-2 text-light-title dark:text-dark-title"};function Ht(e,t,s,o,n,i){const l=(0,r.g2)("PlusIcon");return(0,r.uX)(),(0,r.CE)("div",{onClick:t[0]||(t[0]=(...e)=>i.openAddElementModal&&i.openAddElementModal(...e)),class:"cursor-pointer bg-light-card dark:bg-dark-card p-4 rounded-lg shadow-md flex flex-col items-center justify-center hover:bg-light-subMenu-hoverBackground dark:hover:bg-dark-subMenu-hoverBackground transition-transform transform hover:scale-105 min-h-[150px]"},[(0,r.bF)(l,{class:"w-12 h-12 text-light-profileText dark:text-dark-profileText"}),(0,r.Lk)("h2",zt," Ajouter "+(0,a.v_)(s.title),1)])}var Kt={components:{PlusIcon:ye.A},props:{title:{type:String,required:!0}},methods:{openAddElementModal(){this.$emit("openAddElementModal")}}};const Jt=(0,E.A)(Kt,[["render",Ht]]);var Yt=Jt;const Zt={key:0,class:"absolute top-2 right-2 text-xs font-semibold text-gray-500"},es=["src"],ts={class:"flex items-center mb-4"},ss={class:"text-2xl font-semibold truncate text-light-title dark:text-dark-title text-ellipsis overflow-hidden ..."},os={key:2,class:"mb-4"},rs={class:"text-base font-medium text-light-form-text dark:text-dark-form-text"},as={key:3},ns={key:4,class:"text-base text-light-form-text dark:text-dark-form-text mb-2 text-ellipsis overflow-hidden ..."},is={class:"space-y-2"},ls={key:0,class:"flex items-center"},ds={class:"text-light-form-text dark:text-dark-form-text truncate ..."},us={key:1,class:"flex items-center"},cs={class:"text-light-form-text dark:text-dark-form-text"},ms={key:2,class:"flex items-center"},hs={class:"flex justify-between mt-4 w-full"},ps={class:"flex justify-center mt-4 w-full"};function gs(e,t,s,n,i,l){const d=(0,r.g2)("font-awesome-icon"),u=(0,r.g2)("ButtonComponent");return(0,r.uX)(),(0,r.CE)("div",{class:"cursor-pointer bg-light-card dark:bg-dark-card p-4 rounded-lg shadow-md hover:bg-light-subMenu-hoverBackground dark:hover:bg-dark-subMenu-hoverBackground transition-transform transform hover:scale-105 flex flex-col justify-between h-auto min-h-[200px]",onClick:t[0]||(t[0]=t=>e.$emit("click"))},[s.cornerCount?((0,r.uX)(),(0,r.CE)("div",Zt,(0,a.v_)(s.cornerCount),1)):(0,r.Q3)("",!0),s.image?((0,r.uX)(),(0,r.CE)("img",{key:1,src:s.image,class:"w-full h-28 object-cover mb-4 rounded-lg"},null,8,es)):(0,r.Q3)("",!0),(0,r.Lk)("div",ts,[s.titleColor?((0,r.uX)(),(0,r.CE)("span",{key:0,class:"w-4 h-4 rounded-full mr-2",style:(0,a.Tr)({backgroundColor:s.titleColor})},null,4)):(0,r.Q3)("",!0),(0,r.Lk)("h2",ss,(0,a.v_)(s.title),1)]),s.registrationStatus?((0,r.uX)(),(0,r.CE)("div",os,[(0,r.Lk)("span",rs,(0,a.v_)(l.statusText),1)])):(0,r.Q3)("",!0),e.$slots["user-list"]?((0,r.uX)(),(0,r.CE)("div",as,[(0,r.RG)(e.$slots,"user-list",{},void 0,!0)])):(0,r.Q3)("",!0),s.description?((0,r.uX)(),(0,r.CE)("div",ns,(0,a.v_)(s.description),1)):(0,r.Q3)("",!0),(0,r.Lk)("div",is,[s.location?((0,r.uX)(),(0,r.CE)("div",ls,[(0,r.bF)(d,{icon:"map-marker-alt",class:"mr-2 text-light-form-text dark:text-dark-form-text"}),(0,r.Lk)("span",ds,(0,a.v_)(s.location),1)])):(0,r.Q3)("",!0),s.date?((0,r.uX)(),(0,r.CE)("div",us,[(0,r.bF)(d,{icon:"calendar-alt",class:"mr-2 text-light-form-text dark:text-dark-form-text"}),(0,r.Lk)("span",cs,(0,a.v_)(l.formattedDate),1)])):(0,r.Q3)("",!0),s.status?((0,r.uX)(),(0,r.CE)("div",ms,[(0,r.Lk)("span",{class:(0,a.C4)([l.getStatusClass(s.status),"px-2 py-1 rounded-full text-sm font-semibold"])},(0,a.v_)(l.getStatusLabel(s.status)),3)])):(0,r.Q3)("",!0),(0,r.RG)(e.$slots,"additional-content",{},void 0,!0)]),(0,r.Lk)("div",hs,[s.showDeleteButton&&s.isEditable?((0,r.uX)(),(0,r.Wv)(u,{key:0,variant:"danger",fontAwesomeIcon:"trash",onClick:(0,o.D$)(l.onDelete,["stop"])},null,8,["onClick"])):(0,r.Q3)("",!0),(0,r.Lk)("div",ps,[(0,r.RG)(e.$slots,"button-actions",{},void 0,!0)]),s.showEditButton?((0,r.uX)(),(0,r.Wv)(u,{key:1,variant:"warning",fontAwesomeIcon:"pen",onClick:(0,o.D$)(l.onEdit,["stop"])},null,8,["onClick"])):(0,r.Q3)("",!0)])])}var fs={components:{ButtonComponent:ke},props:{title:{type:String,required:!0},description:{type:String,default:""},image:{type:String,default:""},titleColor:{type:String,default:""},showDeleteButton:{type:Boolean,default:!1},showEditButton:{type:Boolean,default:!1},location:{type:String,default:""},date:{type:[String,Date],default:""},status:{type:String,default:""},registrationStatus:{type:String,required:!1,default:null},isEditable:{type:Boolean,default:!0},cornerCount:String},computed:{formattedDate(){return this.date?new Date(this.date).toLocaleDateString():""},statusText(){return"active"===this.status?"Tournoi en cours":"completed"===this.status?"Tournoi terminé":"active"===this.registrationStatus?"Inscriptions ouvertes":"notStarted"===this.registrationStatus?"Inscriptions fermées":"completed"===this.registrationStatus?"Inscriptions terminées":"ready"===this.status?"Tournoi prêt":"draft"===this.status?"Tournoi en édition":"Statut inconnu"}},methods:{onDelete(){this.$emit("delete")},onEdit(){this.$emit("edit")},getStatusClass(e){switch(e){case"draft":return"bg-light-form-border-default dark:bg-dark-form-border-default text-light-form-text dark:text-dark-form-text";case"ready":return"bg-blue-200 dark:bg-blue-600 text-blue-800 dark:text-blue-200";case"active":return"bg-light-buttonVariants-primary-default dark:bg-dark-buttonVariants-primary-default text-white";case"completed":return"bg-yellow-200 dark:bg-yellow-600 text-yellow-800 dark:text-yellow-200";default:return"bg-light-form-border-default dark:bg-dark-form-border-default text-light-form-text dark:text-dark-form-text"}},getStatusLabel(e){switch(e){case"draft":return"Brouillon";case"ready":return"Prêt";case"active":return"En cours";case"completed":return"Terminé";default:return e}}}};const ys=(0,E.A)(fs,[["render",gs],["__scopeId","data-v-3c58d9e2"]]);var vs=ys;const bs={class:"flex flex-wrap items-center gap-4"},ks={class:"hidden sm:inline text-light-form-text dark:text-dark-form-text font-semibold mr-2"},Ts={class:"relative inline-block"},Cs=["onUpdate:modelValue","onChange"],xs=["value"];function ws(e,t,s,n,i,l){const d=(0,r.g2)("font-awesome-icon");return(0,r.uX)(),(0,r.CE)("div",bs,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.filters,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.label,class:"flex items-center"},["Filtrer par statut"===e.label?((0,r.uX)(),(0,r.Wv)(d,{key:0,icon:["fas","filter"],class:"block sm:hidden mr-2"})):(0,r.Q3)("",!0),"Filtrer par date"===e.label?((0,r.uX)(),(0,r.Wv)(d,{key:1,icon:["fas","calendar"],class:"block sm:hidden mr-2"})):(0,r.Q3)("",!0),(0,r.Lk)("span",ks,(0,a.v_)(e.label)+": ",1),(0,r.Lk)("div",Ts,[(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":t=>e.value=t,onChange:t=>l.onFilterChange(e),class:"bg-light-form-background dark:bg-dark-form-background p-2 pr-8 border border-light-form-border-default dark:border-dark-form-border-default rounded-md shadow-sm hover:bg-light-subMenu-hoverBackground dark:hover:bg-dark-subMenu-hoverBackground appearance-none focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-light-form-text dark:text-dark-form-text"},[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.options,(e=>((0,r.uX)(),(0,r.CE)("option",{key:e.value,value:e.value},(0,a.v_)(e.label),9,xs)))),128))],40,Cs),[[o.u1,e.value]]),t[0]||(t[0]=(0,r.Lk)("div",{class:"absolute inset-y-0 right-0 flex items-center pointer-events-none"},[(0,r.Lk)("svg",{class:"w-4 h-4 text-light-form-iconQuestion dark:text-dark-form-iconQuestion mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[(0,r.Lk)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"})])],-1))])])))),128))])}var Es={props:{filters:{type:Array,required:!0}},methods:{onFilterChange(e){this.$emit("filter-change",e)}}};const Is=(0,E.A)(Es,[["render",ws],["__scopeId","data-v-58f96d40"]]);var Ss=Is;function Fs(e,t,s,o,n,i){return(0,r.uX)(),(0,r.CE)("h1",{class:(0,a.C4)(s.titleClass)},(0,a.v_)(s.title),3)}var Ps={props:{title:{type:String,required:!0},titleClass:{type:String,default:"text-2xl font-bold dark:bg-custom_light_1"}}};const As=(0,E.A)(Ps,[["render",Fs]]);var Ls=As,Ds={components:{ModalComponent:mt,DeleteConfirmationModal:Gt,CardAddComponent:Yt,CardEditComponent:vs,FormComponent:jt,FilterComponent:Ss,TitleComponent:Ls},data(){return{tourneys:[],showModal:!1,showDeleteConfirmation:!1,confirmedDeleteTourneyId:null,newTourney:{name:"",location:{address:"",latitude:null,longitude:null},dateTourney:"",domain:"",emergencyDetails:"",status:"draft"},editingTourneyId:null,isFormValid:!1,isSaving:!1,filterStatus:"",filterDate:"",filters:[{label:"Filtrer par statut",value:this.filterStatus||"",placeholder:"Tous les status",options:[{label:"Tous les statuts",value:""},{label:"Brouillon",value:"draft"},{label:"Prêt",value:"ready"},{label:"En cours",value:"active"},{label:"Terminé",value:"completed"}]},{label:"Filtrer par date",value:this.filterDate||"",options:[{label:"Toutes les dates",value:""},{label:"À venir",value:"upcoming"},{label:"Passés",value:"past"}]}],formErrors:{}}},computed:{filteredTourneys(){return this.tourneys.filter((e=>{const t=!this.filterStatus||e.status===this.filterStatus,s="upcoming"===this.filterDate?new Date(e.dateTourney)>=new Date:"past"!==this.filterDate||new Date(e.dateTourney)<new Date;return t&&s}))},formFields(){return[{name:"name",label:"Nom du tournoi",type:"text",required:!0},{name:"location",label:"Lieu",type:"location",required:!0},{name:"dateTourney",label:"Date du Tournoi",type:"date",required:!0},{name:"domain",label:"Domaine",type:"text",required:!1},{name:"emergencyDetails",label:"Détails d'urgence",type:"textarea",required:!1},{name:"status",label:"Statut",type:"select",options:[{value:"draft",label:"Brouillon"},{value:"ready",label:"Prêt"},{value:"active",label:"En cours"},{value:"completed",label:"Terminé"}],required:!0}]}},methods:{async fetchTourneys(){try{const e=await $.get("/tourneys");this.tourneys=e.data}catch(e){console.error("Erreur lors de la récupération des tournois:",e),we.oR.error("Erreur lors de la récupération des tournois!")}},handleFilterChange(e){"Filtrer par statut"===e.label?this.filterStatus=e.value:"Filtrer par date"===e.label&&(this.filterDate=e.value)},openAddTourneyModal(){this.editingTourneyId=null,this.newTourney={name:"",location:{address:"",latitude:null,longitude:null},dateTourney:"",domain:"",emergencyDetails:"",status:"draft",latitude:null,longitude:null},this.isFormValid=!1,this.formErrors={},this.showModal=!0},editTourney(e){this.editingTourneyId=e.id,this.newTourney={...e,location:{address:e.location,latitude:e.latitude,longitude:e.longitude}},this.isFormValid=!1,this.formErrors={},this.showModal=!0},async handleFormSubmit(e){this.isSaving=!0;try{const t={...e,location:e.location.address,latitude:e.location.latitude,longitude:e.location.longitude};this.editingTourneyId?(await $.put(`/tourneys/${this.editingTourneyId}`,t),we.oR.success("Tournoi modifié avec succès!")):(await $.post("/tourneys",t),we.oR.success("Nouveau tournoi ajouté avec succès!")),this.closeModal(),this.fetchTourneys()}catch(t){console.error("Erreur lors de l'enregistrement du tournoi:",t),we.oR.error("Erreur lors de l'enregistrement du tournoi!")}finally{this.isSaving=!1}},validateForm(){const{name:e,location:t,dateTourney:s}=this.newTourney,o=e.trim(),r={};if(o){const e=this.tourneys.some((e=>e.name.trim().toLowerCase()===o.toLowerCase()&&e.id!==this.editingTourneyId));e&&(r.name="Un tournoi avec ce nom existe déjà.")}else r.name="Le nom du tournoi est obligatoire.";return t&&t.address?null!==t.latitude&&null!==t.longitude||(r.location="Veuillez sélectionner une adresse valide."):r.location="Le lieu du tournoi est obligatoire.",s||(r.dateTourney="La date du tournoi est obligatoire."),this.formErrors=r,this.isFormValid=0===Object.keys(r).length,r},confirmDeleteTourney(e){this.confirmedDeleteTourneyId=e,this.showDeleteConfirmation=!0},async deleteTourney(e){try{await $.delete(`/tourneys/${e}`),we.oR.success("Tournoi supprimé avec succès!"),this.closeDeleteConfirmation(),this.fetchTourneys()}catch(t){we.oR.error("Erreur lors de la suppression du tournoi!")}},viewTourneyDetails(e){this.$router.push(`/admin/tourneys/${e}`)},closeModal(){this.showModal=!1,this.isSaving=!1},closeDeleteConfirmation(){this.showDeleteConfirmation=!1,this.confirmedDeleteTourneyId=null}},watch:{newTourney:{handler(){this.validateForm()},deep:!0}},mounted(){this.fetchTourneys()}};const Ms=(0,E.A)(Ds,[["render",at]]);var $s=Ms;const Us={class:"flex items-center gap-y-4 gap-x-2 sm:gap-y-6 sm:gap-x-4 max-w-screen-lg mx-auto px-4 font-sans mt-8 overflow-x-auto flex-nowrap"},Rs={class:"mt-1 sm:mt-2 mr-2 sm:mr-4 flex items-center"},Vs={class:"ml-1 sm:ml-2"},_s={class:"grid grid-cols-1 gap-8 p-8 md:grid-cols-2 md:items-start"},Xs={class:"bg-light-card dark:bg-dark-card rounded-lg shadow-lg p-8"},qs={class:"flex items-center justify-between mb-4"},Ns={class:"text-3xl font-bold text-light-subMenu-activeText dark:text-dark-subMenu-activeText"},Bs={class:"text-base text-light-form-text dark:text-dark-form-text mb-2"},Ws={class:"text-base text-light-form-text dark:text-dark-form-text mb-2"},js={class:"mt-6"},Qs={class:"grid grid-cols-1 gap-4 sm:grid-cols-2"},Os={class:"text-base text-light-form-text dark:text-dark-form-text"},Gs={class:"text-base text-light-form-text dark:text-dark-form-text"},zs={class:"text-base text-light-form-text dark:text-dark-form-text"},Hs={class:"text-base text-light-form-text dark:text-dark-form-text"},Ks={class:"text-base text-light-form-text dark:text-dark-form-text"},Js={class:"mt-6"},Ys={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},Zs={class:"text-base text-light-form-text dark:text-dark-form-text"},eo={class:"rounded-lg shadow-lg p-4 sm:h-[50vh] h-[300px] mt-8 md:mt-0"},to={key:0,class:"text-sm text-red-500 mt-2 text-center"},so={class:"mt-4 flex justify-end relative z-30"},oo={class:"bg-light-card dark:bg-dark-card rounded-lg shadow-lg p-8 mt-8 relative"},ro={key:0},ao={key:1};function no(e,t,s,o,n,i){const l=(0,r.g2)("TourneySubMenu"),d=(0,r.g2)("StatusSelectorComponent"),u=(0,r.g2)("l-tile-layer"),c=(0,r.g2)("l-popup"),m=(0,r.g2)("l-marker"),h=(0,r.g2)("l-map"),p=(0,r.g2)("ButtonComponent");return(0,r.uX)(),(0,r.CE)("div",null,[(0,r.bF)(l,{tourneyId:n.tourneyId,onSelectTab:i.selectTab},null,8,["tourneyId","onSelectTab"]),(0,r.Lk)("div",Us,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.statusSteps,((e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:t,class:"flex-1"},[(0,r.Lk)("div",{class:(0,a.C4)(["w-full","rounded","h-0.5 sm:h-1",i.progressBarClass(e.status)])},null,2),(0,r.Lk)("div",Rs,[((0,r.uX)(),(0,r.Wv)((0,r.$y)(i.stepIconComponent(e.status)),{class:"shrink-0 w-3 h-3 sm:w-4 sm:h-4 md:w-6 md:h-6"})),(0,r.Lk)("div",Vs,[(0,r.Lk)("h6",{class:(0,a.C4)(["text-sm sm:text-lg font-bold",i.stepTextClass(e.status)])},(0,a.v_)(e.label),3),(0,r.Lk)("p",{class:(0,a.C4)(["text-xs sm:text-base",i.stepTextClass(e.status)])},(0,a.v_)(i.stepStatusText(e.status,e.label)),3)])])])))),128))]),(0,r.Lk)("div",_s,[(0,r.Lk)("div",Xs,[(0,r.Lk)("div",qs,[(0,r.Lk)("h2",Ns,(0,a.v_)(n.tourney.name),1),(0,r.bF)(d,{tourneyId:n.tourneyId,statusKey:"status",statusOptions:[{value:"draft",label:"Brouillon"},{value:"ready",label:"Prêt"},{value:"active",label:"En cours"},{value:"completed",label:"Terminé"}],modelValue:n.tourney.status,"onUpdate:modelValue":t[0]||(t[0]=e=>n.tourney.status=e)},null,8,["tourneyId","modelValue"])]),(0,r.Lk)("p",Bs,[t[3]||(t[3]=(0,r.Lk)("strong",null,"Lieu :",-1)),(0,r.eW)(" "+(0,a.v_)(n.tourney.location),1)]),(0,r.Lk)("p",Ws,[t[4]||(t[4]=(0,r.Lk)("strong",null,"Date :",-1)),(0,r.eW)(" "+(0,a.v_)(i.formatDate(n.tourney.dateTourney)),1)]),(0,r.Lk)("div",js,[(0,r.Lk)("div",Qs,[(0,r.Lk)("div",null,[(0,r.Lk)("p",Os,[t[5]||(t[5]=(0,r.Lk)("strong",null,"Utilisateurs Inscrits :",-1)),(0,r.eW)(" "+(0,a.v_)(n.counts.users),1)]),(0,r.Lk)("p",Gs,[t[6]||(t[6]=(0,r.Lk)("strong",null,"Terrains :",-1)),(0,r.eW)(" "+(0,a.v_)(n.counts.fields),1)]),(0,r.Lk)("p",zs,[t[7]||(t[7]=(0,r.Lk)("strong",null,"Sports :",-1)),(0,r.eW)(" "+(0,a.v_)(n.counts.sports),1)])]),(0,r.Lk)("div",null,[(0,r.Lk)("p",Hs,[t[8]||(t[8]=(0,r.Lk)("strong",null,"Équipes :",-1)),(0,r.eW)(" "+(0,a.v_)(n.counts.teams),1)]),(0,r.Lk)("p",Ks,[t[9]||(t[9]=(0,r.Lk)("strong",null,"Pools :",-1)),(0,r.eW)(" "+(0,a.v_)(n.counts.pools),1)])])])]),(0,r.Lk)("div",Js,[t[10]||(t[10]=(0,r.Lk)("h3",{class:"text-2xl font-semibold mb-2 text-light-form-text dark:text-dark-form-text"}," Liste des Sports ",-1)),(0,r.Lk)("div",Ys,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.sports,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"flex items-center"},[(0,r.Lk)("span",{class:"w-4 h-4 rounded-full mr-2",style:(0,a.Tr)({backgroundColor:e.color})},null,4),(0,r.Lk)("span",Zs,(0,a.v_)(e.name),1)])))),128))])])]),(0,r.Lk)("div",eo,[i.coordinatesAreValid?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",to," Les coordonnées ne sont pas valides, la carte affiche un lieu par défaut (FR) . ")),n.mapIsReady?((0,r.uX)(),(0,r.Wv)(h,{key:1,ref:"map",zoom:12,center:[i.mapLatitude,i.mapLongitude],class:"h-full w-full"},{default:(0,r.k6)((()=>[(0,r.bF)(u,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png","layer-type":"base",name:"OpenStreetMap"}),(0,r.bF)(m,{"lat-lng":[i.mapLatitude,i.mapLongitude]},{default:(0,r.k6)((()=>[(0,r.bF)(c,null,{default:(0,r.k6)((()=>[(0,r.eW)((0,a.v_)(n.tourney.location||"Fribourg, Suisse"),1)])),_:1})])),_:1},8,["lat-lng"])])),_:1},8,["center"])):(0,r.Q3)("",!0),(0,r.Lk)("div",so,["draft"!==n.tourney.status?((0,r.uX)(),(0,r.Wv)(p,{key:0,onClick:i.downloadExcel,variant:"success",fontAwesomeIcon:"file-excel",class:"flex items-center space-x-1"},{default:(0,r.k6)((()=>t[11]||(t[11]=[(0,r.Lk)("span",null,"Télécharger Planning",-1)]))),_:1},8,["onClick"])):(0,r.Q3)("",!0),(0,r.bF)(p,{variant:"info",fontAwesomeIcon:"map-marker-alt",onClick:i.openGoogleMaps},{default:(0,r.k6)((()=>t[12]||(t[12]=[(0,r.eW)(" Itinéraire "),(0,r.Lk)("span",{class:"hidden sm:inline"}," Avec Google Maps",-1)]))),_:1},8,["onClick"])])])]),(0,r.Lk)("div",oo,[t[17]||(t[17]=(0,r.Lk)("h3",{class:"text-2xl font-bold mb-4 text-light-subMenu-activeText dark:text-dark-subMenu-activeText"}," Guide de configuration du tournoi ",-1)),t[18]||(t[18]=(0,r.Lk)("p",{class:"text-base text-light-form-text dark:text-dark-form-text mb-4"}," Une bonne pratique pour une configuration fluide : Si N terrains, créez N*4 Teams et N Pools afin d'avoir un bon tournus. Variez la taille des équipes pour accueillir plus de monde. ",-1)),n.showExample?((0,r.uX)(),(0,r.CE)("div",ao,[t[16]||(t[16]=(0,r.Fv)('<h4 class="font-semibold text-light-form-text dark:text-dark-form-text mt-4" data-v-53b6aa43> Exemple Pratique : </h4><p class="text-base text-light-form-text dark:text-dark-form-text mb-4" data-v-53b6aa43> Imaginons que vous avez 6 terrains disponibles : </p><ol class="list-decimal list-inside mb-4 space-y-2 text-light-form-text dark:text-dark-form-text" data-v-53b6aa43><li data-v-53b6aa43> Allez dans l&#39;onglet <strong data-v-53b6aa43>Terrains</strong> et créez vos 6 terrains. </li><li data-v-53b6aa43> Allez dans l&#39;onglet <strong data-v-53b6aa43>Assignation</strong> et associez les sports aux terrains pour un planning de base. </li><li data-v-53b6aa43> Dans l&#39;onglet <strong data-v-53b6aa43>Inscriptions</strong> : <ul class="list-disc list-inside ml-6" data-v-53b6aa43><li data-v-53b6aa43> Configurez vos équipes via <strong data-v-53b6aa43>Config Équipe</strong>. Avec 6 terrains, vous pouvez créer environ 24 équipes (4 par terrain, 2 en repos). </li><li data-v-53b6aa43> Définissez la taille des équipes entre 3 à 6 joueurs, soit un total max de 24 * 6 = 144 joueurs. </li><li data-v-53b6aa43> Utilisez le groupe assistant pour gérer les inscriptions supplémentaires. </li><li data-v-53b6aa43> Générez les équipes manuellement ou automatiquement avec <strong data-v-53b6aa43>Générer équipes</strong>. </li><li data-v-53b6aa43>Activez les inscriptions et générez un lien d’invitation.</li></ul></li><li data-v-53b6aa43> En mode <strong data-v-53b6aa43>Custom Round Robin</strong>, créez 6 pools (1 par terrain). Configurez chaque pool pour contenir entre 3 et 4 équipes pour un roulement fluide. </li><li data-v-53b6aa43> Une fois les pools créés, passez à l’onglet <strong data-v-53b6aa43>Planning</strong> pour générer le planning des matchs, et utilisez les outils de générations pour créer un planning équilibré. </li></ol>',3)),(0,r.Lk)("button",{onClick:t[2]||(t[2]=e=>n.showExample=!1),class:"text-blue-500 mt-4 flex items-center space-x-2"},t[15]||(t[15]=[(0,r.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",width:"20",height:"20"},[(0,r.Lk)("path",{d:"M15 18l-6-6 6-6"})],-1),(0,r.Lk)("span",null,"Retourner au guide",-1)]))])):((0,r.uX)(),(0,r.CE)("div",ro,[t[14]||(t[14]=(0,r.Fv)('<p class="text-base text-light-form-text dark:text-dark-form-text mb-4" data-v-53b6aa43> Pour configurer votre tournoi, suivez ces étapes clés : </p><ol class="list-decimal list-inside mb-4 space-y-2 text-light-form-text dark:text-dark-form-text" data-v-53b6aa43><li data-v-53b6aa43><strong data-v-53b6aa43>Terrains</strong> : Ajoutez vos terrains dans l&#39;onglet Terrains. </li><li data-v-53b6aa43><strong data-v-53b6aa43>Sports</strong> : Assignez les sports aux terrains dans l&#39;onglet Assignation. </li><li data-v-53b6aa43><strong data-v-53b6aa43>Inscriptions</strong> : Configurez les équipes et ouvrez les inscriptions. </li><li data-v-53b6aa43><strong data-v-53b6aa43>Pools</strong> : Créez les pools et assignez les équipes. </li><li data-v-53b6aa43><strong data-v-53b6aa43>Planning</strong> : Générez le planning des matchs.</li></ol>',2)),(0,r.Lk)("button",{onClick:t[1]||(t[1]=e=>n.showExample=!0),class:"text-blue-500 mt-4 flex items-center space-x-2"},t[13]||(t[13]=[(0,r.Lk)("span",null,"Voir un exemple pratique",-1),(0,r.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",viewBox:"0 0 24 24",width:"20",height:"20"},[(0,r.Lk)("path",{d:"M9 18l6-6-6-6"})],-1)]))]))])])}s(4603),s(7566),s(8721);var io=s(8061);function lo(e,t,s,o,n,i){const l=(0,r.g2)("font-awesome-icon"),d=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",{class:(0,a.C4)([["tourney-nav",n.isNavVisible?"visible":"hidden"],"tourney-nav w-full z-50 bg-light-subMenu-background dark:bg-dark-subMenu-background shadow-lg border-b border-light-subMenu-border dark:border-dark-subMenu-border"])},[(0,r.bF)(d,{to:`/admin/tourneys/${s.tourneyId}`,class:(0,a.C4)(["tourney-nav-item text-light-subMenu-text dark:text-dark-subMenu-text hover:bg-light-subMenu-hoverBackground dark:hover:bg-dark-subMenu-hoverBackground hover:text-light-subMenu-hoverText dark:hover:text-dark-subMenu-hoverText",{active:"AdminTourneyDetails"===e.$route.name}])},{default:(0,r.k6)((()=>[(0,r.bF)(l,{icon:["fas","info-circle"]}),t[0]||(t[0]=(0,r.Lk)("span",{class:"hidden sm:inline"}," Détails",-1))])),_:1},8,["to","class"]),(0,r.bF)(d,{to:`/admin/tourneys/${s.tourneyId}/fields`,class:(0,a.C4)(["tourney-nav-item text-light-subMenu-text dark:text-dark-subMenu-text hover:bg-light-subMenu-hoverBackground dark:hover:bg-dark-subMenu-hoverBackground hover:text-light-subMenu-hoverText dark:hover:text-dark-subMenu-hoverText",{active:"AdminTourneyFieldsManagement"===e.$route.name}])},{default:(0,r.k6)((()=>[(0,r.bF)(l,{icon:["fas","map"]}),t[1]||(t[1]=(0,r.Lk)("span",{class:"hidden sm:inline"}," Terrains",-1))])),_:1},8,["to","class"]),(0,r.bF)(d,{to:`/admin/tourneys/${s.tourneyId}/sports-fields`,class:(0,a.C4)(["tourney-nav-item text-light-subMenu-text dark:text-dark-subMenu-text hover:bg-light-subMenu-hoverBackground dark:hover:bg-dark-subMenu-hoverBackground hover:text-light-subMenu-hoverText dark:hover:text-dark-subMenu-hoverText",{active:"AdminTourneySportsFields"===e.$route.name}])},{default:(0,r.k6)((()=>[(0,r.bF)(l,{icon:["fas","futbol"]}),t[2]||(t[2]=(0,r.Lk)("span",{class:"hidden sm:inline"}," Sport",-1))])),_:1},8,["to","class"]),(0,r.bF)(d,{to:`/admin/tourneys/${s.tourneyId}/teams`,class:(0,a.C4)(["tourney-nav-item text-light-subMenu-text dark:text-dark-subMenu-text hover:bg-light-subMenu-hoverBackground dark:hover:bg-dark-subMenu-hoverBackground hover:text-light-subMenu-hoverText dark:hover:text-dark-subMenu-hoverText",{active:"AdminTourneyTeams"===e.$route.name}])},{default:(0,r.k6)((()=>[(0,r.bF)(l,{icon:["fas","user"]}),t[3]||(t[3]=(0,r.Lk)("span",{class:"hidden sm:inline"}," Inscriptions",-1))])),_:1},8,["to","class"]),(0,r.bF)(d,{to:`/admin/tourneys/${s.tourneyId}/pools`,class:(0,a.C4)(["tourney-nav-item text-light-subMenu-text dark:text-dark-subMenu-text hover:bg-light-subMenu-hoverBackground dark:hover:bg-dark-subMenu-hoverBackground hover:text-light-subMenu-hoverText dark:hover:text-dark-subMenu-hoverText",{active:"AdminTourneyPools"===e.$route.name}])},{default:(0,r.k6)((()=>[(0,r.bF)(l,{icon:["fas","users"]}),t[4]||(t[4]=(0,r.Lk)("span",{class:"hidden sm:inline"}," Pools",-1))])),_:1},8,["to","class"]),(0,r.bF)(d,{to:`/admin/tourneys/${s.tourneyId}/planning/pools`,class:(0,a.C4)(["tourney-nav-item text-light-subMenu-text dark:text-dark-subMenu-text hover:bg-light-subMenu-hoverBackground dark:hover:bg-dark-subMenu-hoverBackground hover:text-light-subMenu-hoverText dark:hover:text-dark-subMenu-hoverText",{active:"AdminTourneyPlanningPools"===e.$route.name||"AdminTourneyPlanningGames"===e.$route.name||"AdminTourneyPlanningCompleted"===e.$route.name}])},{default:(0,r.k6)((()=>[(0,r.bF)(l,{icon:["fas","calendar-alt"]}),t[5]||(t[5]=(0,r.Lk)("span",{class:"hidden sm:inline"}," Planning",-1))])),_:1},8,["to","class"])],2)}var uo={data(){return{activeTab:"details",isNavVisible:!0}},methods:{selectTab(e){this.activeTab=e}},props:{tourneyId:{type:String,required:!0}}};const co=(0,E.A)(uo,[["render",lo],["__scopeId","data-v-2263a89a"]]);var mo=co;const ho={key:0,class:"flex items-center ml-4 sm:ml-8 w-1/2 sm:w-auto"},po=["for"],go=["id"],fo=["value"];function yo(e,t,s,n,i,l){return l.shouldShow?((0,r.uX)(),(0,r.CE)("div",ho,[(0,r.Lk)("label",{for:s.statusKey,class:"hidden sm:block mr-2 text-light-title dark:text-dark-title"},(0,a.v_)(s.label),9,po),(0,r.bo)((0,r.Lk)("select",{id:s.statusKey,"onUpdate:modelValue":t[0]||(t[0]=e=>l.selectedStatus=e),class:"bg-light-form-background dark:bg-dark-form-background text-light-form-text dark:text-dark-form-text border border-light-form-border-default dark:border-dark-form-border-default rounded-md px-2 py-1"},[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.statusOptions,(e=>((0,r.uX)(),(0,r.CE)("option",{key:e.value,value:e.value},(0,a.v_)(e.label),9,fo)))),128))],8,go),[[o.u1,l.selectedStatus]])])):(0,r.Q3)("",!0)}var vo={props:{tourneyId:{type:[Number,String],required:!0},statusKey:{type:String,required:!0},statusOptions:{type:Array,required:!0},label:{type:String,default:"État :"},hideWhenNotStarted:{type:Boolean,default:!0},modelValue:{type:String,default:""},onStatusChange:{type:Function,required:!1}},computed:{currentStatus(){return this.$store.state.tourney.statuses[this.statusKey]},shouldShow(){return!this.hideWhenNotStarted||"notStarted"!==this.currentStatus},selectedStatus:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e),this.onStatusChange?this.onStatusChange(e):this.$store.dispatch("tourney/updateStatus",{tourneyId:this.tourneyId,key:this.statusKey,value:e})}}}};const bo=(0,E.A)(vo,[["render",yo]]);var ko=bo;const To={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",class:"fill-current text-green-500",viewBox:"0 0 24 24"};function Co(e,t){return(0,r.uX)(),(0,r.CE)("svg",To,t[0]||(t[0]=[(0,r.Lk)("path",{d:"M9.7 11.3c-.4-.4-1-.4-1.4 0s-.4 1 0 1.4l3 3c.2.2.4.3.7.3s.5-.1.7-.3l7-8c.3-.5.3-1.1-.2-1.4-.4-.3-1-.3-1.3.1L12 13.5z"},null,-1),(0,r.Lk)("path",{d:"M21 11c-.6 0-1 .4-1 1 0 4.4-3.6 8-8 8s-8-3.6-8-8c0-2.1.8-4.1 2.3-5.6C7.8 4.8 9.8 4 12 4c.6 0 1.3.1 1.9.2.5.2 1.1-.1 1.3-.7s-.2-1-.7-1.2h-.1c-.8-.2-1.6-.3-2.4-.3C6.5 2 2 6.5 2 12.1c0 2.6 1.1 5.2 2.9 7 1.9 1.9 4.4 2.9 7 2.9 5.5 0 10-4.5 10-10 .1-.6-.4-1-.9-1z"},null,-1)]))}const xo={},wo=(0,E.A)(xo,[["render",Co]]);var Eo=wo;const Io={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",class:"fill-current text-gray-300",viewBox:"0 0 24 24"};function So(e,t){return(0,r.uX)(),(0,r.CE)("svg",Io,t[0]||(t[0]=[(0,r.Lk)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"},null,-1),(0,r.Lk)("path",{d:"M7 13.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm5 0a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm5 0a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"},null,-1)]))}const Fo={},Po=(0,E.A)(Fo,[["render",So]]);var Ao=Po;const Lo={xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 fill-current text-light-details-active dark:text-dark-details-active",viewBox:"0 0 24 24"};function Do(e,t,s,o,a,n){return(0,r.uX)(),(0,r.CE)("svg",Lo,t[0]||(t[0]=[(0,r.Lk)("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"2",fill:"none"},null,-1),(0,r.Lk)("path",{d:"M12 8v4l3 3",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",fill:"none"},null,-1)]))}var Mo={name:"ActiveIcon"};const $o=(0,E.A)(Mo,[["render",Do],["__scopeId","data-v-9061817e"]]);var Uo=$o;const Ro={xmlns:"http://www.w3.org/2000/svg",class:"h-8 w-8 fill-current text-light-details-inProgress dark:text-dark-details-inProgress",viewBox:"0 0 24 24"};function Vo(e,t,s,o,a,n){return(0,r.uX)(),(0,r.CE)("svg",Ro,t[0]||(t[0]=[(0,r.Lk)("path",{d:"M12 20h9",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",fill:"none"},null,-1),(0,r.Lk)("path",{d:"M16.5 3.5a2.121 2.121 0 1 1 3 3L7 19l-4 1 1-4L16.5 3.5z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",fill:"none"},null,-1)]))}var _o={name:"DraftIcon"};const Xo=(0,E.A)(_o,[["render",Vo],["__scopeId","data-v-cb1374f2"]]);var qo=Xo,No={components:{LMap:io.Do,LTileLayer:io.a,LMarker:io.li,LPopup:io.nA,TourneySubMenu:mo,CompletedIcon:Eo,PendingIcon:Ao,ActiveIcon:Uo,DraftIcon:qo,ButtonComponent:ke,StatusSelectorComponent:ko},data(){return{tourneyId:this.$route.params.tourneyId,tourney:{},currentStepNumber:1,mapIsReady:!1,showExample:!1,statusSteps:[{label:"Terrains",status:""},{label:"Sports",status:""},{label:"Inscriptions",status:""},{label:"Pools",status:""},{label:"Planning",status:""}],sports:[],counts:{users:0,fields:0,sports:0,teams:0,pools:0}}},async mounted(){await this.fetchTourneyDetails(),this.mapIsReady=!0},methods:{...(0,x.i0)("tourney",["fetchTourneyStatuses","setTournamentName"]),async fetchTourneyDetails(){try{await this.fetchTourneyStatuses(this.tourneyId);const e=await $.get(`/tourneys/${this.tourneyId}/details`);this.tourney=e.data.tourney,this.counts=e.data.counts,this.sports=e.data.sports,this.updateStatusSteps()}catch(e){console.error("Erreur lors de la récupération des détails du tournoi:",e)}},formatDate(e){const t={year:"numeric",month:"long",day:"numeric"};return new Date(e).toLocaleDateString(void 0,t)},selectTab(e){this.activeTab=e},updateStatusSteps(){const{fieldAssignmentStatus:e,sportAssignmentStatus:t,registrationStatus:s,poolStatus:o,planningStatus:r}=this.tourney;this.statusSteps=[{label:"Terrains",status:e},{label:"Sports",status:t},{label:"Inscriptions",status:s},{label:"Pools",status:o},{label:"Planning",status:r}]},progressBarClass(e){switch(e){case"completed":return"bg-light-details-completed dark:bg-dark-details-completed";case"active":return"bg-light-details-active dark:bg-dark-details-active";case"draft":return"bg-light-details-inProgress dark:bg-dark-details-inProgress";default:return"bg-light-details-notStarted dark:bg-dark-details-notStarted"}},stepTextClass(e){return"completed"===e?"text-light-details-completed dark:text-dark-details-completed":"active"===e?"text-light-details-active dark:text-dark-details-active":"draft"===e?"text-light-details-inProgress dark:text-dark-details-inProgress":"text-light-details-notStarted dark:text-dark-details-notStarted"},stepStatusText(e,t){return"completed"===e?"Complété":"active"===e?"En cours":"draft"===e?"Inscriptions"===t?"Fermées":"Brouillon":"En attente"},stepIconComponent(e){return"completed"===e?"CompletedIcon":"active"===e?"ActiveIcon":"draft"===e?"DraftIcon":"PendingIcon"},openGoogleMaps(){const e=this.googleMapsLink;window.open(e,"_blank")},async downloadExcel(){let e;try{e=we.oR.info("Téléchargement du fichier en cours...",{autoClose:!1});const t=await $.get(`/tourneys/${this.tourneyId}/export-data/excel`,{responseType:"blob"}),s=t.data,o=window.URL.createObjectURL(s),r=document.createElement("a");r.href=o,r.download=`tournament_${this.tourneyId}.xlsx`,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(o),we.oR.update(e,{render:"Téléchargement terminé avec succès !",type:"success",autoClose:2e3})}catch(t){we.oR.update(e,{render:t.message||"Une erreur s'est produite lors du téléchargement.",type:"error",autoClose:2e3}),console.error("Erreur lors du téléchargement Excel :",t)}}},computed:{...(0,x.aH)("tourney",{statuses:e=>e.statuses}),coordinatesAreValid(){const e=this.tourney.latitude,t=this.tourney.longitude;return null!==e&&null!==t&&!isNaN(e)&&!isNaN(t)&&e>=-90&&e<=90&&t>=-180&&t<=180},mapLatitude(){return this.coordinatesAreValid?this.tourney.latitude:46.8065},mapLongitude(){return this.coordinatesAreValid?this.tourney.longitude:7.1619},googleMapsLink(){if(this.coordinatesAreValid){const e=this.tourney.latitude,t=this.tourney.longitude;return`https://www.google.com/maps/dir/?api=1&destination=${e},${t}`}return"https://www.google.com/maps/dir/?api=1&destination=46.8065,7.1619"},allStepsCompleted(){return this.statusSteps.every((e=>"completed"===e.status))}}};const Bo=(0,E.A)(No,[["render",no],["__scopeId","data-v-53b6aa43"]]);var Wo=Bo;const jo={class:"p-6"},Qo={class:"flex items-center mb-8"},Oo={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6"};function Go(e,t,s,o,a,n){const i=(0,r.g2)("TitleComponent"),l=(0,r.g2)("CardAddComponent"),d=(0,r.g2)("CardEditComponent"),u=(0,r.g2)("FormComponent"),c=(0,r.g2)("ModalComponent"),m=(0,r.g2)("DeleteConfirmationModal");return(0,r.uX)(),(0,r.CE)("div",jo,[(0,r.Lk)("div",Qo,[(0,r.bF)(i,{title:"Gestion des Sports"})]),(0,r.Lk)("div",Oo,[(0,r.bF)(l,{title:"Sport",onOpenAddElementModal:n.openAddSportModal},null,8,["onOpenAddElementModal"]),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.sports,(e=>((0,r.uX)(),(0,r.Wv)(d,{key:e.id,title:e.name,image:n.getImageUrl(e.image),showEditButton:!0,showDeleteButton:!0,titleColor:e.color,onClick:t=>n.editSport(e),onDelete:t=>n.confirmDeleteSport(e.id),onEdit:t=>n.editSport(e)},null,8,["title","image","titleColor","onClick","onDelete","onEdit"])))),128))]),(0,r.bF)(c,{isVisible:a.showModal,title:a.editingSportId?"Modifier le Sport":"Ajouter un Nouveau Sport",onClose:n.closeModal},{content:(0,r.k6)((()=>[(0,r.bF)(u,{modelValue:a.newSport,"onUpdate:modelValue":t[0]||(t[0]=e=>a.newSport=e),fields:n.formFields,isEditing:!!a.editingSportId,onFileSelected:n.handleFileUpload,onFormSubmit:n.handleFormSubmit,onFormCancel:n.closeModal,customValidation:n.validateForm},null,8,["modelValue","fields","isEditing","onFileSelected","onFormSubmit","onFormCancel","customValidation"])])),_:1},8,["isVisible","title","onClose"]),(0,r.bF)(m,{isVisible:a.showDeleteConfirmation,isHardDelete:!0,onFormCancel:n.closeDeleteConfirmation,onConfirm:t[1]||(t[1]=e=>n.deleteSport(a.confirmedDeleteSportId))},null,8,["isVisible","onFormCancel"])])}var zo={components:{ModalComponent:mt,DeleteConfirmationModal:Gt,CardAddComponent:Yt,CardEditComponent:vs,FormComponent:jt,TitleComponent:Ls},data(){return{sports:[],showModal:!1,showDeleteConfirmation:!1,confirmedDeleteSportId:null,newSport:{name:"",rule:"",scoreSystem:"DESC",color:"#000000",image:null},editingSportId:null,selectedFile:null,isFormValid:!1,formErrors:{}}},computed:{formFields(){return[{name:"name",label:"Nom du sport",type:"text",required:!0},{name:"rule",label:"Règles du sport",type:"textarea",required:!0},{name:"scoreSystem",label:"Système de score",type:"select",options:[{value:"ASC",label:"ASC"},{value:"DESC",label:"DESC"}],tooltip:"'ASC': Un score faible est le meilleur (temps). 'DESC': Un score élevé est le meilleur (nombre de points).",required:!0},{name:"image",label:"Image du sport",type:"file",required:!1},{name:"color",label:"Couleur (Hexadecimal)",type:"color",required:!1}]}},methods:{validateForm(){const{name:e,rule:t}=this.newSport,s=e.trim(),o={};if(s){const e=this.sports.some((e=>e.name.trim().toLowerCase()===s.toLowerCase()&&e.id!==this.editingSportId));e&&(o.name="Un sport avec ce nom existe déjà.")}else o.name="Le nom du sport est obligatoire.";return t||(o.rule="Les règles du sport sont obligatoires."),this.formErrors=o,this.isFormValid=0===Object.keys(o).length,o},getImageUrl(e){const t="http://localhost:3000";return`${t}${e}`},getFileName(e){if(!e)return"";const t=e.split("/");return t[t.length-1]},async fetchSports(){try{const e=await $.get("/sports");this.sports=e.data}catch(e){console.error("Erreur lors de la récupération des sports:",e)}},handleFileUpload(e){if(null!==e){if(e){const t=10,s=1024*t*1024;e.size>s?(alert(`L'image dépasse la taille maximale autorisée de ${t} Mo.`),this.selectedFile=null):this.selectedFile=e}else this.selectedFile=null;this.validateForm()}else this.selectedFile=null},openAddSportModal(){this.editingSportId=null,this.newSport={name:"",rule:"",scoreSystem:"DESC",color:"#000000",image:null},this.selectedFile=null,this.isFormValid=!1,this.formErrors={},this.showModal=!0},editSport(e){this.editingSportId=e.id,this.newSport={...e},this.selectedFile=null,this.isFormValid=!0,this.formErrors={},this.showModal=!0},async handleFormSubmit(){if(this.validateForm(),!this.isFormValid)return;const e=new FormData;e.append("name",this.newSport.name),e.append("rule",this.newSport.rule),e.append("scoreSystem",this.newSport.scoreSystem),e.append("color",this.newSport.color),this.newSport.image instanceof File?e.append("image",this.newSport.image):this.newSport.image&&e.append("image",this.getFileName(this.newSport.image));try{this.editingSportId?(await $.put(`/sports/${this.editingSportId}`,e,{headers:{"Content-Type":"multipart/form-data"}}),we.oR.success("Sport modifié avec succès!")):(await $.post("/sports",e,{headers:{"Content-Type":"multipart/form-data"}}),we.oR.success("Nouveau sport ajouté avec succès!")),this.closeModal(),this.fetchSports()}catch(t){console.error("Erreur lors de l'enregistrement du sport :",t),we.oR.error("Erreur lors de l'enregistrement du sport!")}},confirmDeleteSport(e){this.confirmedDeleteSportId=e,this.showDeleteConfirmation=!0},async deleteSport(e){try{await $.delete(`/sports/${e}`),we.oR.success("Sport supprimé avec succès!"),this.closeDeleteConfirmation(),this.fetchSports()}catch(t){we.oR.error("Erreur lors de la suppression du sport!")}},closeModal(){this.showModal=!1},closeDeleteConfirmation(){this.showDeleteConfirmation=!1,this.confirmedDeleteSportId=null}},watch:{newSport:{handler(){this.validateForm()},deep:!0}},mounted(){this.fetchSports()}};const Ho=(0,E.A)(zo,[["render",Go],["__scopeId","data-v-6e071f83"]]);var Ko=Ho;const Jo={class:"mx-auto p-4"},Yo={key:0,class:"flex justify-center items-center h-64"};function Zo(e,t,s,o,a,n){const i=(0,r.g2)("ListUsersTable"),l=(0,r.g2)("FormComponent"),d=(0,r.g2)("ModalComponent");return(0,r.uX)(),(0,r.CE)("div",Jo,[(0,r.bF)(i,{users:a.users,enableAddUser:!0,enableEditUser:!0,enableAssignTourney:!0,enableRemoveUserFromTourney:!0,tournaments:a.tournaments,showTourney:!0,showAssignTourney:!0,enableAssignTeam:!1,showEmailButton:!1,showBackButton:!1,showPhone:!1,showFilters:!0,editUserFunction:n.editUser,addUserFunction:n.addUser,onAssignTourney:n.handleAssignTourney,onRemoveUserFromTourney:n.handleRemoveUserFromTourney,onDeleteUser:n.handleDeleteUser,onUserUpdated:n.fetchData},null,8,["users","tournaments","editUserFunction","addUserFunction","onAssignTourney","onRemoveUserFromTourney","onDeleteUser","onUserUpdated"]),a.isLoading?((0,r.uX)(),(0,r.CE)("div",Yo,t[2]||(t[2]=[(0,r.Lk)("i",{class:"fas fa-spinner fa-spin fa-3x text-light-menuActive dark:text-light-menuActive"},null,-1),(0,r.Lk)("span",{class:"ml-4 text-light-profileText dark:text-light-profileText text-lg"},"Chargement...",-1)]))):(0,r.Q3)("",!0),(0,r.bF)(d,{isVisible:a.showEditUserModal,title:"Modifier l'utilisateur",onClose:n.closeEditUserModal},{content:(0,r.k6)((()=>[(0,r.bF)(l,{modelValue:a.newUser,"onUpdate:modelValue":t[0]||(t[0]=e=>a.newUser=e),fields:n.userFormFields,isEditing:!0,onFormSubmit:n.handleUserFormSubmit,onFormCancel:n.closeEditUserModal,customValidation:n.validateUserForm},null,8,["modelValue","fields","onFormSubmit","onFormCancel","customValidation"])])),_:1},8,["isVisible","onClose"]),(0,r.bF)(d,{isVisible:a.showAddUserModal,title:"Ajouter un utilisateur",onClose:n.closeAddUserModal},{content:(0,r.k6)((()=>[(0,r.bF)(l,{modelValue:a.newUser,"onUpdate:modelValue":t[1]||(t[1]=e=>a.newUser=e),fields:n.userFormFields,isEditing:!1,onFormSubmit:n.handleAddUserSubmit,onFormCancel:n.closeAddUserModal,customValidation:n.validateUserForm},null,8,["modelValue","fields","onFormSubmit","onFormCancel","customValidation"])])),_:1},8,["isVisible","onClose"])])}const er={class:"p-4 bg-light-background dark:bg-dark-background rounded-md shadow-lg"},tr={class:"flex items-center justify-between mb-4"},sr={class:"flex items-center space-x-2"},or={class:"hidden sm:inline"},rr={key:0,class:"flex items-center space-x-4 mb-4"},ar={class:"mt-2"},nr={class:"inline-flex items-center"},ir={key:1,class:"text-light-errorMessage dark:text-dark-errorMessage mb-4 font-bold"},lr={class:"overflow-x-auto overflow-y-auto max-h-[70vh] mt-4"},dr={class:"min-w-full bg-light-card dark:bg-dark-card shadow rounded-lg"},ur={key:0,class:"px-4 py-2 text-left text-light-title dark:text-dark-title hidden md:table-cell border-b border-light-subMenu-border dark:border-dark-subMenu-border"},cr={key:1,class:"px-4 py-2 text-left text-light-title dark:text-dark-title border-b border-light-subMenu-border dark:border-dark-subMenu-border"},mr={key:2,class:"px-4 py-2 text-left text-light-title dark:text-dark-title border-b border-light-subMenu-border dark:border-dark-subMenu-border"},hr={key:3,class:"px-4 py-2 text-center text-light-title dark:text-dark-title border-b border-light-subMenu-border dark:border-dark-subMenu-border"},pr={class:"px-2 py-2 text-center"},gr={class:"px-4 py-2"},fr={key:0,class:"mr-1 px-2 py-1 text-xs font-semibold text-white bg-light-buttonVariants-info-default dark:bg-dark-buttonVariants-info-default rounded-full"},yr={class:"px-4 py-2 truncate"},vr=["href"],br={key:0,class:"px-4 py-2 max-h-24 overflow-y-auto"},kr={key:1,class:"px-4 py-2 flex items-center space-x-2"},Tr={key:2,class:"px-4 py-2 hidden md:table-cell"},Cr={key:3,class:"px-4 py-2 flex items-center justify-center space-x-2"},xr={class:"px-2 py-2 text-center"};function wr(e,t,s,n,i,l){const d=(0,r.g2)("TitleComponent"),u=(0,r.g2)("ButtonComponent"),c=(0,r.g2)("v-select"),m=(0,r.g2)("SoftButtonComponent"),h=(0,r.g2)("router-link"),p=(0,r.g2)("DeleteConfirmationModal");return(0,r.uX)(),(0,r.CE)("div",er,[(0,r.Lk)("div",tr,[(0,r.Lk)("div",sr,[(0,r.bF)(d,{title:s.title},null,8,["title"]),s.enableAddUser?((0,r.uX)(),(0,r.Wv)(u,{key:0,variant:"primary",fontAwesomeIcon:"fa-user",onClick:l.handleAddUserClick},{default:(0,r.k6)((()=>t[3]||(t[3]=[(0,r.Lk)("span",{class:"hidden sm:inline"}," Nouvel utilisateur",-1)]))),_:1},8,["onClick"])):(0,r.Q3)("",!0),s.showEmailButton?((0,r.uX)(),(0,r.Wv)(u,{key:1,variant:"info",fontAwesomeIcon:"envelope",onClick:l.sendEmailToAll,disabled:0===s.users.length},{default:(0,r.k6)((()=>t[4]||(t[4]=[(0,r.Lk)("span",{class:"hidden sm:inline"},"Envoyer Email",-1)]))),_:1},8,["onClick","disabled"])):(0,r.Q3)("",!0),(0,r.RG)(e.$slots,"header-buttons",{},void 0,!0)]),s.showBackButton?((0,r.uX)(),(0,r.Wv)(u,{key:0,variant:"secondary",fontAwesomeIcon:"arrow-left",onClick:l.goBack},{default:(0,r.k6)((()=>[(0,r.Lk)("span",or,(0,a.v_)(s.backButtonText),1)])),_:1},8,["onClick"])):(0,r.Q3)("",!0)]),s.showFilters?((0,r.uX)(),(0,r.CE)("div",rr,[(0,r.Lk)("div",null,[(0,r.bF)(c,{modelValue:i.selectedTournamentFilter,"onUpdate:modelValue":t[0]||(t[0]=e=>i.selectedTournamentFilter=e),options:i.tournamentOptions,placeholder:"Filtrer par tournoi",label:"name",reduce:e=>e.id,appendToBody:"",clearable:"",class:"w-full sm:w-64"},null,8,["modelValue","options","reduce"])]),(0,r.Lk)("div",null,[(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>i.searchQuery=e),type:"text",placeholder:"Rechercher par nom ou email",class:"border border-light-form-border dark:border-dark-form-border rounded-md p-2 w-full sm:w-64 bg-light-form-background dark:bg-dark-form-background text-light-form-text dark:text-dark-form-text"},null,512),[[o.Jo,i.searchQuery]])]),(0,r.Lk)("div",ar,[(0,r.Lk)("label",nr,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=e=>i.filterNoTournament=e),class:"form-checkbox h-5 w-5 text-indigo-600"},null,512),[[o.lH,i.filterNoTournament]]),t[5]||(t[5]=(0,r.Lk)("span",{class:"ml-2 text-light-form-text dark:text-dark-form-text"}," Sans tournoi ",-1))])])])):(0,r.Q3)("",!0),!l.hasAvailableTeams&&s.enableAssignTeam?((0,r.uX)(),(0,r.CE)("p",ir," Pas d'équipe disponible. Veuillez en créer de nouvelles ou réassigner des utilisateurs. ")):(0,r.Q3)("",!0),(0,r.Lk)("div",lr,[(0,r.Lk)("table",dr,[(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[t[6]||(t[6]=(0,r.Lk)("th",{class:"px-2 py-2 text-center text-light-title dark:text-dark-title border-b border-light-subMenu-border dark:border-dark-subMenu-border"}," Edit ",-1)),t[7]||(t[7]=(0,r.Lk)("th",{class:"px-4 py-2 text-left text-light-title dark:text-dark-title border-b border-light-subMenu-border dark:border-dark-subMenu-border"}," Nom ",-1)),t[8]||(t[8]=(0,r.Lk)("th",{class:"px-4 py-2 text-left text-light-title dark:text-dark-title border-b border-light-subMenu-border dark:border-dark-subMenu-border"}," Email ",-1)),s.showPhone?((0,r.uX)(),(0,r.CE)("th",ur," Téléphone ")):(0,r.Q3)("",!0),s.showTourney?((0,r.uX)(),(0,r.CE)("th",cr," Tournois ")):(0,r.Q3)("",!0),s.showAssignTourney?((0,r.uX)(),(0,r.CE)("th",mr," Ajouter au Tournoi ")):(0,r.Q3)("",!0),s.enableAssignTeam?((0,r.uX)(),(0,r.CE)("th",hr," Équipe ")):(0,r.Q3)("",!0),t[9]||(t[9]=(0,r.Lk)("th",{class:"px-2 py-2 text-center text-light-title dark:text-dark-title border-b border-light-subMenu-border dark:border-dark-subMenu-border"}," Del ",-1))])]),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.displayedUsers,(e=>((0,r.uX)(),(0,r.CE)("tr",{key:e.id,class:"hover:bg-light-subMenu-hoverBackground dark:hover:bg-dark-subMenu-hoverBackground"},[(0,r.Lk)("td",pr,[(0,r.bF)(m,{fontAwesomeIcon:"pen",iconClass:"w-5 h-5 text-light-buttonVariants-warning-default hover:text-light-buttonVariants-warning-hover dark:text-dark-buttonVariants-warning-default hover:dark:text-dark-buttonVariants-warning-hover","aria-label":"Éditer l'utilisateur",onClick:t=>l.handleEditClick(e)},null,8,["onClick"])]),(0,r.Lk)("td",gr,[1===e.role.id?((0,r.uX)(),(0,r.CE)("span",fr," Admin ")):(0,r.Q3)("",!0),(0,r.bF)(h,{to:`/admin/users/${e.id}`,class:"text-blue-600 dark:text-blue-400 hover:underline"},{default:(0,r.k6)((()=>[(0,r.eW)((0,a.v_)(e.name||"N/A"),1)])),_:2},1032,["to"])]),(0,r.Lk)("td",yr,[(0,r.Lk)("a",{href:`mailto:${e.email}`,class:"text-blue-500 dark:text-blue-400 hover:underline"},(0,a.v_)(e.email||"-"),9,vr)]),s.showTourney?((0,r.uX)(),(0,r.CE)("td",br,[(0,r.Lk)("ul",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.usersTourneys||[],(t=>((0,r.uX)(),(0,r.CE)("li",{key:t.tourney.id,class:"flex items-center space-x-2"},[(0,r.Lk)("span",null,(0,a.v_)(t.tourney.name),1),(0,r.bF)(m,{fontAwesomeIcon:"fa-times",iconClass:"w-4 h-4 text-light-logoutButton-default hover:text-light-logoutButton-hover dark:text-dark-logoutButton-default hover:dark:text-dark-logoutButton-hover","aria-label":"Retirer du tournoi",onClick:s=>l.confirmRemoveFromTourney(e.id,t.tourney.id)},null,8,["onClick"])])))),128))])])):(0,r.Q3)("",!0),s.showAssignTourney?((0,r.uX)(),(0,r.CE)("td",kr,[(0,r.bF)(c,{modelValue:i.selectedTourneyIds[e.id],"onUpdate:modelValue":t=>i.selectedTourneyIds[e.id]=t,options:i.availableTourneys[e.id],placeholder:"Tournoi",label:"name",reduce:e=>e.id,appendToBody:"",clearable:"",class:"w-full sm:w-48"},null,8,["modelValue","onUpdate:modelValue","options","reduce"]),(0,r.bF)(u,{variant:"primary",size:"sm",heroIcon:"PlusIcon",onClick:t=>l.assignTourney(e.id),disabled:!i.selectedTourneyIds[e.id]},null,8,["onClick","disabled"])])):(0,r.Q3)("",!0),s.showPhone?((0,r.uX)(),(0,r.CE)("td",Tr,(0,a.v_)(e.phone||"-"),1)):(0,r.Q3)("",!0),s.enableAssignTeam?((0,r.uX)(),(0,r.CE)("td",Cr,[l.availableTeams.length>0&&s.teamSetup&&s.allowAssignToOtherTeams?((0,r.uX)(),(0,r.Wv)(c,{key:0,modelValue:i.localSelectedTeamIds[e.id],"onUpdate:modelValue":[t=>i.localSelectedTeamIds[e.id]=t,t=>l.onTeamSelectionChange(e.id,t)],options:l.teamOptions,placeholder:"Select Team",appendToBody:"",reduce:e=>e.id,label:"teamName",styles:{dropdown:{"max-height":"200px","overflow-y":"auto"}},class:(0,a.C4)(["border border-light-form-border dark:border-dark-form-border rounded-md p-1 w-48 sm:w-56","bg-light-form-background dark:bg-dark-form-background text-light-form-text dark:text-dark-form-text ring-indigo-500","cursor-pointer"])},null,8,["modelValue","onUpdate:modelValue","options","reduce"])):(0,r.Q3)("",!0),l.availableTeams.length>0&&s.allowAssignToOtherTeams?((0,r.uX)(),(0,r.Wv)(u,{key:1,fontAwesomeIcon:"add",variant:"primary",onClick:t=>l.assignTeam(e.id),disabled:i.localSelectedTeamIds[e.id]===e.teamId},{default:(0,r.k6)((()=>t[10]||(t[10]=[(0,r.Lk)("span",{class:"hidden md:inline"},"Assigner",-1)]))),_:2},1032,["onClick","disabled"])):((0,r.uX)(),(0,r.Wv)(u,{key:2,fontAwesomeIcon:"ban",variant:"gray",disabled:!0},{default:(0,r.k6)((()=>t[11]||(t[11]=[(0,r.Lk)("span",{class:"hidden sm:inline"},"Aucune équipe",-1)]))),_:1}))])):(0,r.Q3)("",!0),(0,r.Lk)("td",xr,[s.enableRemoveUser?((0,r.uX)(),(0,r.Wv)(m,{key:0,fontAwesomeIcon:"trash",iconClass:"w-5 h-5 text-light-buttonVariants-danger-default hover:text-light-buttonVariants-danger-hover dark:text-dark-buttonVariants-danger-default hover:dark:text-dark-buttonVariants-danger-hover","aria-label":"Supprimer l'utilisateur",onClick:t=>l.confirmDelete(e.id)},null,8,["onClick"])):(0,r.Q3)("",!0)])])))),128))])])]),(0,r.bF)(p,{isVisible:i.showDeleteModal,title:s.deleteModalTitle,message:s.deleteModalMessage,onConfirm:l.deleteUser,onFormCancel:l.closeDeleteModal},null,8,["isVisible","title","message","onConfirm","onFormCancel"]),(0,r.bF)(p,{isVisible:i.showRemoveFromTourneyModal,title:"Confirmer le retrait",message:"Êtes-vous sûr de vouloir retirer cet utilisateur du tournoi?",onConfirm:l.removeUserFromTourney,onFormCancel:l.closeRemoveFromTourneyModal},null,8,["isVisible","onConfirm","onFormCancel"])])}const Er=["aria-label"];function Ir(e,t,s,o,n,i){const l=(0,r.g2)("font-awesome-icon");return(0,r.uX)(),(0,r.CE)("span",{class:(0,a.C4)(["inline-flex items-center justify-center cursor-pointer transition-opacity",s.disabled?"opacity-50 cursor-not-allowed":""]),style:(0,a.Tr)({color:s.iconColor,fontSize:s.iconSize}),onClick:t[0]||(t[0]=e=>!s.disabled&&i.handleClick),role:"button","aria-label":s.ariaLabel},[s.fontAwesomeIcon?((0,r.uX)(),(0,r.Wv)(l,{key:0,icon:["fas",s.fontAwesomeIcon],class:(0,a.C4)(s.iconClass)},null,8,["icon","class"])):(0,r.Q3)("",!0),s.heroIcon?((0,r.uX)(),(0,r.Wv)((0,r.$y)(n.icons[s.heroIcon]),{key:1,class:(0,a.C4)(s.iconClass)},null,8,["class"])):(0,r.Q3)("",!0)],14,Er)}var Sr={props:{heroIcon:{type:String,default:null},fontAwesomeIcon:{type:String,default:null},iconColor:{type:String,default:"currentColor"},iconSize:{type:String,default:"1em"},iconClass:{type:String,default:"w-5 h-5"},ariaLabel:{type:String,default:""},disabled:{type:Boolean,default:!1}},data(){return{icons:{TrashIcon:ge.A,PencilIcon:fe.A}}},methods:{handleClick(){this.$emit("click")}}};const Fr=(0,E.A)(Sr,[["render",Ir]]);var Pr=Fr,Ar={components:{TitleComponent:Ls,ButtonComponent:ke,SoftButtonComponent:Pr,DeleteConfirmationModal:Gt},props:{title:{type:String,default:"Liste des utilisateurs"},users:{type:Array,required:!0,default:()=>[]},teams:{type:Array,required:!1,default:()=>[]},teamSetup:{type:Object,required:!1,default:null},enableAssignTeam:{type:Boolean,default:!0},allowAssignToOtherTeams:{type:Boolean,default:!0},enableRemoveUser:{type:Boolean,default:!0},backButtonText:{type:String,default:"Retour"},deleteModalTitle:{type:String,default:"Confirmer la suppression"},deleteModalMessage:{type:String,default:"Êtes-vous sûr de vouloir supprimer cet utilisateur?"},showEmailButton:{type:Boolean,default:!0},showBackButton:{type:Boolean,default:!0},showPhone:{type:Boolean,default:!0},showFilters:{type:Boolean,default:!1},showTourney:{type:Boolean,default:!1},showAssignTourney:{type:Boolean,default:!1},tournaments:{type:Array,required:!1,default:()=>[]},editUserFunction:{type:Function,default:null},addUserFunction:{type:Function,default:null},enableAddUser:{type:Boolean,default:!1},selectedTeamIds:{type:Object,default:()=>({})}},emits:["go-back","assign-team","delete-user","validate-assignments","assign-tourney","remove-user-from-tourney","user-updated","update:selectedTeamIds"],data(){return{showDeleteModal:!1,userIdToDelete:null,isAutoFilled:!1,initialSelectedTeamIds:{},selectedTournamentFilter:null,searchQuery:"",filterNoTournament:!1,tournamentOptions:[],selectedTourneyIds:{},localSelectedTeamIds:{},availableTourneys:{},showRemoveFromTourneyModal:!1,userIdToRemoveFromTourney:null,tourneyIdToRemove:null,showEditUserModal:!1,editingUser:null,newUser:{name:"",email:"",phone:"",password:"",roleId:""},formErrors:{},isFormValid:!1}},computed:{availableTeams(){if(!this.teamSetup)return[];const e=this.users.map((e=>e.teamId)).filter((e=>null!=e));return this.teams.filter((t=>{const s=e.includes(t.id),o=(t.usersTourneys?t.usersTourneys.length:0)<this.getTeamCapacity(t);return s||o}))},teamOptions(){return this.availableTeams.map((e=>{const t=this.getTeamCapacity(e);return{id:e.id,teamName:`${e.teamName} (${e.usersTourneys.length}/${t})`}}))},hasAvailableTeams(){return this.availableTeams.length>0},displayedUsers(){return this.showFilters?this.filteredUsers:this.users},filteredUsers(){let e=this.users;if(this.selectedTournamentFilter&&(e=e.filter((e=>e.usersTourneys?.some((e=>e.tourney.id===this.selectedTournamentFilter))))),this.filterNoTournament&&(e=e.filter((e=>!e.usersTourneys||0===e.usersTourneys.length))),this.searchQuery){const t=this.searchQuery.toLowerCase();e=e.filter((e=>e.name&&e.name.toLowerCase().includes(t)||e.email&&e.email.toLowerCase().includes(t)))}return e},userFormFields(){return[{name:"name",label:"Nom",type:"text",required:!0},{name:"email",label:"Email",type:"email",required:!0},{name:"phone",label:"Téléphone",type:"text",required:!1},{name:"password",label:"Mot de passe",type:"password",required:!1},{name:"roleId",label:"Rôle",type:"select",required:!0,options:[{value:1,label:"Admin"},{value:2,label:"Utilisateur"}]}]}},methods:{getTeamCapacity(e){return"assistant"===e.type?this.teamSetup.playerPerTeam*this.teamSetup.maxTeamNumber:this.teamSetup.playerPerTeam},goBack(){this.$emit("go-back")},assignTeam(e){const t=this.localSelectedTeamIds[e];if(t){this.$emit("assign-team",{userId:e,teamId:t});const s={...this.localSelectedTeamIds};delete s[e],this.localSelectedTeamIds=s,this.$emit("update:selectedTeamIds",this.localSelectedTeamIds)}else we.oR.info("Veuillez sélectionner une équipe pour cet utilisateur.")},confirmDelete(e){const t=this.users.find((t=>t.id==e)),s=this.$store.state.user.id;t&&1===t.role.id&&1!==s?we.oR.error("Seul le super admin peut supprimer un autre administrateur."):(this.userIdToDelete=e,this.showDeleteModal=!0)},onTeamSelectionChange(e,t){this.localSelectedTeamIds[e]=t,this.$emit("update:selectedTeamIds",{...this.localSelectedTeamIds})},deleteUser(){null!==this.userIdToDelete&&(this.$emit("delete-user",this.userIdToDelete),this.closeDeleteModal())},closeDeleteModal(){this.showDeleteModal=!1,this.userIdToDelete=null},sendEmailToAll(){const e=this.users.map((e=>e.email)).filter((e=>e));if(0===e.length)return void we.oR.error("Il n'y a aucun utilisateur pour envoyer un email.");const t=`mailto:${e.join(",")}`;window.location.href=t},handleEditClick(e){this.editUserFunction?this.editUserFunction(e):this.navigateToEdit(e.id)},handleAddUserClick(){this.addUserFunction&&this.addUserFunction()},navigateToEdit(e){this.$router.push(`/admin/users/${e}`)},validateAssignments(){const e=Object.entries(this.selectedTeamIds).filter((([e])=>null!==e&&void 0!==e)).map((([e,t])=>({userId:Number(e),teamId:t})));this.$emit("validate-assignments",e),this.isAutoFilled=!1,this.initialSelectedTeamIds={}},updateSelectedTeamId(e,t){this.localSelectedTeamIds={...this.localSelectedTeamIds,[e]:t},this.$emit("update:selectedTeamIds",this.localSelectedTeamIds)},async loadAvailableTourneys(){const e=this.tournaments;this.users.forEach((t=>{const s=(t.usersTourneys||[]).map((e=>e.tourney.id));this.availableTourneys[t.id]=e.filter((e=>!s.includes(e.id)))}))},assignTourney(e){const t=this.selectedTourneyIds[e];t?(this.$emit("assign-tourney",{userId:e,tourneyId:t}),this.selectedTourneyIds[e]=null,this.loadAvailableTourneys()):we.oR.info("Veuillez sélectionner un tournoi.")},confirmRemoveFromTourney(e,t){this.userIdToRemoveFromTourney=e,this.tourneyIdToRemove=t,this.showRemoveFromTourneyModal=!0},removeUserFromTourney(){null!==this.userIdToRemoveFromTourney&&null!==this.tourneyIdToRemove&&(this.$emit("remove-user-from-tourney",{userId:this.userIdToRemoveFromTourney,tourneyId:this.tourneyIdToRemove}),this.closeRemoveFromTourneyModal(),this.loadAvailableTourneys())},closeRemoveFromTourneyModal(){this.showRemoveFromTourneyModal=!1,this.userIdToRemoveFromTourney=null,this.tourneyIdToRemove=null},editUser(e){this.editingUser=e,this.newUser={...e},this.showEditUserModal=!0,this.formErrors={},this.isFormValid=!0},closeEditUserModal(){this.showEditUserModal=!1,this.editingUser=null,this.newUser={name:"",email:"",phone:""}},validateUserForm(){const e={};return this.newUser.name||(e.name="Le nom est obligatoire."),this.newUser.email||(e.email="L'email est obligatoire."),this.formErrors=e,this.isFormValid=0===Object.keys(e).length,e},async handleUserFormSubmit(){if(this.validateUserForm(),this.isFormValid)try{await $.put(`/users/${this.editingUser.id}`,this.newUser),we.oR.success("Utilisateur mis à jour avec succès!"),this.closeEditUserModal(),this.$emit("user-updated")}catch(e){console.error("Erreur lors de la mise à jour de l'utilisateur :",e),we.oR.error("Erreur lors de la mise à jour de l'utilisateur!")}}},watch:{users:{handler(){this.showAssignTourney&&this.loadAvailableTourneys()},immediate:!0},tournaments:{handler(e){this.tournamentOptions=e},immediate:!0},selectedTeamIds:{handler(e){this.localSelectedTeamIds={...e}},deep:!0}}};const Lr=(0,E.A)(Ar,[["render",wr],["__scopeId","data-v-3762bf68"]]);var Dr=Lr,Mr={components:{ListUsersTable:Dr,ModalComponent:mt,FormComponent:jt},data(){return{users:[],tournaments:[],showEditUserModal:!1,showAddUserModal:!1,editingUser:null,newUser:{name:"",email:"",phone:"",password:"",roleId:2},formErrors:{},isFormValid:!1,isLoading:!1}},async created(){await this.fetchData()},methods:{async fetchData(){this.isLoading=!0;try{const[e,t]=await Promise.all([$.get("/users/all/details"),$.get("/tourneys")]);this.users=e.data,this.tournaments=t.data}catch(e){console.error("Erreur lors de la récupération des utilisateurs:",e),we.oR.error("Une erreur est survenue lors de la récupération des données.")}finally{this.isLoading=!1}},editUser(e){this.editingUser=e,this.newUser={name:e.name||"",email:e.email||"",phone:e.phone||"",password:"",roleId:Number(e.roleId||e.role?.id||2)},this.showEditUserModal=!0,this.formErrors={},this.isFormValid=!0},closeEditUserModal(){this.showEditUserModal=!1,this.editingUser=null,this.resetNewUser()},addUser(){this.resetNewUser(),this.showAddUserModal=!0,this.formErrors={},this.isFormValid=!0},closeAddUserModal(){this.showAddUserModal=!1,this.resetNewUser()},resetNewUser(){this.newUser={name:"",email:"",phone:"",password:"",roleId:2}},validateUserForm(){const e={};return this.newUser.name||(e.name="Le nom est obligatoire."),this.newUser.email||(e.email="L'email est obligatoire."),this.newUser.password||this.editingUser||(e.password="Le mot de passe est obligatoire."),this.formErrors=e,this.isFormValid=0===Object.keys(e).length,e},async handleUserFormSubmit(){if(this.validateUserForm(),this.isFormValid)try{await $.put(`/users/${this.editingUser.id}`,this.newUser),we.oR.success("Utilisateur mis à jour avec succès!"),this.closeEditUserModal(),await this.fetchData()}catch(e){console.error("Erreur lors de la mise à jour de l'utilisateur:",e),we.oR.error("Erreur lors de la mise à jour de l'utilisateur!")}},async handleAddUserSubmit(){if(this.validateUserForm(),this.isFormValid)try{await $.post("/users",this.newUser),we.oR.success("Utilisateur créé avec succès!"),this.closeAddUserModal(),await this.fetchData()}catch(e){console.error("Erreur lors de la création de l'utilisateur:",e),we.oR.error("Erreur lors de la création de l'utilisateur!")}},async handleAssignTourney({userId:e,tourneyId:t}){try{await $.post(`/users/${e}/tourneys/${t}`),await this.fetchData(),we.oR.success("Utilisateur assigné au tournoi avec succès.")}catch(s){console.error("Erreur lors de l'assignation au tournoi:",s),we.oR.error("Une erreur est survenue lors de l'assignation au tournoi.")}},async handleRemoveUserFromTourney({userId:e,tourneyId:t}){try{await $.delete(`/users/${e}/tourneys/${t}`),await this.fetchData(),we.oR.success("Utilisateur retiré du tournoi avec succès.")}catch(s){console.error("Erreur lors du retrait du tournoi:",s),we.oR.error("Une erreur est survenue lors du retrait de l'utilisateur du tournoi.")}},async handleDeleteUser(e){try{await $.delete(`/users/${e}`),we.oR.success("Utilisateur supprimé avec succès."),e===this.$store.state.user.id?(this.$store.dispatch("logout"),this.$router.push("/login")):await this.fetchData()}catch(t){console.error("Erreur lors de la suppression de l'utilisateur:",t),we.oR.error("Une erreur est survenue lors de la suppression de l'utilisateur.")}}},computed:{userFormFields(){return[{name:"name",label:"Nom",type:"text",required:!0},{name:"email",label:"Email",type:"email",required:!0},{name:"phone",label:"Téléphone",type:"text",required:!1},{name:"password",label:"Mot de passe",type:"password",required:!this.editingUser},{name:"roleId",label:"Rôle",type:"select",required:!0,options:[{value:1,label:"Administrateur"},{value:2,label:"Utilisateur"}]}]}}};const $r=(0,E.A)(Mr,[["render",Zo]]);var Ur=$r;const Rr={key:0},Vr={key:1};function _r(e,t,s,o,a,n){const i=(0,r.g2)("ProfilePageComponent");return null!==n.userId?((0,r.uX)(),(0,r.CE)("div",Rr,[(0,r.bF)(i,{userId:n.userId,isAdmin:!0},null,8,["userId"])])):((0,r.uX)(),(0,r.CE)("div",Vr,t[0]||(t[0]=[(0,r.Lk)("p",null,"Vous avez été déconnecté.",-1)])))}const Xr={class:"max-w-5xl mx-auto p-4"},qr={class:"text-3xl font-bold mb-6"},Nr={class:"flex flex-col md:flex-row"},Br={class:"w-full md:w-1/2 md:pr-4"},Wr={class:"space-y-6"},jr={class:"flex items-center"},Qr={class:"flex items-center"},Or={key:1,class:"flex items-center w-full"},Gr={class:"flex items-center"},zr={class:"flex items-center"},Hr={key:1,class:"flex items-center w-full"},Kr=["disabled"],Jr={class:"flex items-center"},Yr={class:"flex items-center"},Zr={key:1,class:"flex items-center w-full"},ea={class:"flex items-center"},ta={class:"flex items-center"},sa={key:1,class:"w-full"},oa={class:"flex space-x-2 mt-2"},ra={key:0},aa={class:"flex items-center"},na={class:"flex items-center"},ia={key:1,class:"flex items-center w-full"},la=["value"],da={class:"w-full md:w-1/2 md:pl-4 mt-8 md:mt-0"},ua={key:0},ca={key:1},ma={class:"mb-4"},ha={class:"flex items-center"},pa={key:0,class:"mt-8"};function ga(e,t,s,n,i,l){const d=(0,r.g2)("SoftButtonComponent"),u=(0,r.g2)("v-select"),c=(0,r.g2)("ButtonComponent"),m=(0,r.g2)("DeleteConfirmationModal");return(0,r.uX)(),(0,r.CE)("div",Xr,[(0,r.Lk)("h1",qr,(0,a.v_)(l.pageTitle),1),(0,r.Lk)("div",Nr,[(0,r.Lk)("div",Br,[t[32]||(t[32]=(0,r.Lk)("h2",{class:"text-2xl font-semibold mb-4"},"Informations",-1)),(0,r.Lk)("div",Wr,[(0,r.Lk)("div",null,[(0,r.Lk)("div",jr,[t[27]||(t[27]=(0,r.Lk)("label",{class:"block text-lg font-medium"},"Nom",-1)),i.editingField.name?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.Wv)(d,{key:0,fontAwesomeIcon:"fa-pen-alt",iconClass:"w-4 h-4 ml-2",onClick:t[0]||(t[0]=e=>l.toggleEdit("name"))}))]),(0,r.Lk)("div",Qr,[i.editingField.name?((0,r.uX)(),(0,r.CE)("div",Or,[(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>i.userData.name=e),type:"text",class:"form-input mt-1 block w-full"},null,512),[[o.Jo,i.userData.name]]),(0,r.bF)(d,{fontAwesomeIcon:"fa-check",iconClass:"w-5 h-5 text-green-500 ml-2",onClick:t[3]||(t[3]=e=>l.saveField("name"))}),(0,r.bF)(d,{fontAwesomeIcon:"times",iconClass:"w-5 h-5 text-red-500 ml-2",onClick:t[4]||(t[4]=e=>l.cancelEdit("name"))})])):((0,r.uX)(),(0,r.CE)("span",{key:0,onClick:t[1]||(t[1]=e=>l.toggleEdit("name"))},(0,a.v_)(i.userData.name),1))])]),(0,r.Lk)("div",null,[(0,r.Lk)("div",Gr,[t[28]||(t[28]=(0,r.Lk)("label",{class:"block text-lg font-medium"},"Email",-1)),l.canEditEmail&&!i.editingField.email?((0,r.uX)(),(0,r.Wv)(d,{key:0,fontAwesomeIcon:"fa-pen-alt",iconClass:"w-4 h-4 ml-2",onClick:t[5]||(t[5]=e=>l.toggleEdit("email"))})):(0,r.Q3)("",!0)]),(0,r.Lk)("div",zr,[i.editingField.email?((0,r.uX)(),(0,r.CE)("div",Hr,[(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>i.userData.email=e),type:"email",class:"form-input mt-1 block w-full",disabled:!l.canEditEmail},null,8,Kr),[[o.Jo,i.userData.email]]),(0,r.bF)(d,{fontAwesomeIcon:"check",iconClass:"w-5 h-5 text-green-500 ml-2",onClick:t[8]||(t[8]=e=>l.saveField("email"))}),(0,r.bF)(d,{fontAwesomeIcon:"times",iconClass:"w-5 h-5 text-red-500 ml-2",onClick:t[9]||(t[9]=e=>l.cancelEdit("email"))})])):((0,r.uX)(),(0,r.CE)("span",{key:0,onClick:t[6]||(t[6]=e=>l.canEditEmail?l.toggleEdit("email"):null)},(0,a.v_)(i.userData.email),1))])]),(0,r.Lk)("div",null,[(0,r.Lk)("div",Jr,[t[29]||(t[29]=(0,r.Lk)("label",{class:"block text-lg font-medium"},"Téléphone",-1)),i.editingField.phone?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.Wv)(d,{key:0,fontAwesomeIcon:"fa-pen-alt",iconClass:"w-4 h-4 ml-2 cursor-pointer",onClick:t[10]||(t[10]=e=>l.toggleEdit("phone"))}))]),(0,r.Lk)("div",Yr,[i.editingField.phone?((0,r.uX)(),(0,r.CE)("div",Zr,[(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[12]||(t[12]=e=>i.userData.phone=e),type:"text",class:"form-input mt-1 block w-full"},null,512),[[o.Jo,i.userData.phone]]),(0,r.bF)(d,{fontAwesomeIcon:"check",iconClass:"w-5 h-5 text-green-500 ml-2",onClick:t[13]||(t[13]=e=>l.saveField("phone"))}),(0,r.bF)(d,{fontAwesomeIcon:"times",iconClass:"w-5 h-5 text-red-500 ml-2",onClick:t[14]||(t[14]=e=>l.cancelEdit("phone"))})])):((0,r.uX)(),(0,r.CE)("span",{key:0,onClick:t[11]||(t[11]=e=>l.toggleEdit("phone"))},(0,a.v_)(i.userData.phone||"Non renseigné"),1))])]),(0,r.Lk)("div",null,[(0,r.Lk)("div",ea,[t[30]||(t[30]=(0,r.Lk)("label",{class:"block text-lg font-medium"},"Mot de passe",-1)),i.editingField.password?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.Wv)(d,{key:0,fontAwesomeIcon:"fa-pen-alt",iconClass:"w-4 h-4 ml-2",onClick:t[15]||(t[15]=e=>l.toggleEdit("password"))}))]),(0,r.Lk)("div",ta,[i.editingField.password?((0,r.uX)(),(0,r.CE)("div",sa,[s.isAdmin?(0,r.Q3)("",!0):(0,r.bo)(((0,r.uX)(),(0,r.CE)("input",{key:0,"onUpdate:modelValue":t[17]||(t[17]=e=>i.passwordData.oldPassword=e),type:"password",placeholder:"Ancien mot de passe",class:"form-input block w-full mt-1"},null,512)),[[o.Jo,i.passwordData.oldPassword]]),(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[18]||(t[18]=e=>i.passwordData.newPassword=e),type:"password",placeholder:"Nouveau mot de passe",class:"form-input block w-full mt-1"},null,512),[[o.Jo,i.passwordData.newPassword]]),(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[19]||(t[19]=e=>i.passwordData.confirmPassword=e),type:"password",placeholder:"Confirmer le nouveau mot de passe",class:"form-input block w-full mt-1"},null,512),[[o.Jo,i.passwordData.confirmPassword]]),(0,r.Lk)("div",oa,[(0,r.bF)(d,{fontAwesomeIcon:"check",iconClass:"w-5 h-5 text-green-500",onClick:l.updatePassword},null,8,["onClick"]),(0,r.bF)(d,{fontAwesomeIcon:"times",iconClass:"w-5 h-5 text-red-500",onClick:t[20]||(t[20]=e=>l.cancelEdit("password"))})])])):((0,r.uX)(),(0,r.CE)("span",{key:0,onClick:t[16]||(t[16]=e=>l.toggleEdit("password"))}," •••••••• "))])]),s.isAdmin?((0,r.uX)(),(0,r.CE)("div",ra,[(0,r.Lk)("div",aa,[t[31]||(t[31]=(0,r.Lk)("label",{class:"block text-lg font-medium text-light-form-text dark:text-dark-form-text"},"Rôle",-1)),i.editingField.role?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.Wv)(d,{key:0,fontAwesomeIcon:"fa-pen-alt",iconClass:"w-4 h-4 ml-2 cursor-pointer",onClick:t[21]||(t[21]=e=>l.toggleEdit("role"))}))]),(0,r.Lk)("div",na,[i.editingField.role?((0,r.uX)(),(0,r.CE)("div",ia,[(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":t[23]||(t[23]=e=>i.userData.roleId=e),class:"form-select mt-1 block w-full"},[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.roles,(e=>((0,r.uX)(),(0,r.CE)("option",{key:e.id,value:e.id},(0,a.v_)(e.name),9,la)))),128))],512),[[o.u1,i.userData.roleId]]),(0,r.bF)(d,{fontAwesomeIcon:"check",iconClass:"w-5 h-5 text-green-500 ml-2 cursor-pointer",onClick:t[24]||(t[24]=e=>l.saveField("roleId"))}),(0,r.bF)(d,{fontAwesomeIcon:"times",iconClass:"w-5 h-5 text-red-500 ml-2 cursor-pointer",onClick:t[25]||(t[25]=e=>l.cancelEdit("role"))})])):((0,r.uX)(),(0,r.CE)("span",{key:0,class:"text-gray-900 dark:text-gray-100",onClick:t[22]||(t[22]=e=>l.toggleEdit("role"))},(0,a.v_)(i.userData.roleName),1))])])):(0,r.Q3)("",!0)])]),(0,r.Lk)("div",da,[t[35]||(t[35]=(0,r.Lk)("h2",{class:"text-2xl font-semibold mb-4"},"Tournois Inscrits",-1)),s.isAdmin?((0,r.uX)(),(0,r.CE)("div",ca,[(0,r.Lk)("div",ma,[t[34]||(t[34]=(0,r.Lk)("label",{class:"block text-lg font-medium text-light-form-text dark:text-dark-form-text"},"Ajouter au tournoi",-1)),(0,r.Lk)("div",ha,[(0,r.bF)(u,{modelValue:i.selectedTourneyId,"onUpdate:modelValue":t[26]||(t[26]=e=>i.selectedTourneyId=e),options:i.availableTourneys,placeholder:"Sélectionnez un tournoi",label:"name",reduce:e=>e.id,clearable:"",class:"w-full sm:w-64"},null,8,["modelValue","options","reduce"]),(0,r.bF)(c,{class:"ml-2",variant:"success",size:"sm",onClick:l.assignTourney,disabled:!i.selectedTourneyId},{default:(0,r.k6)((()=>t[33]||(t[33]=[(0,r.eW)(" Ajouter ")]))),_:1},8,["onClick","disabled"])])]),(0,r.Lk)("ul",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.userTournaments,(e=>((0,r.uX)(),(0,r.CE)("li",{key:e.id,class:"border-b py-2 flex justify-between items-center"},[(0,r.Lk)("span",null,(0,a.v_)(e.name),1),(0,r.bF)(d,{fontAwesomeIcon:"trash",iconClass:"w-5 h-5 text-red-500 hover:text-red-700","aria-label":"Retirer du tournoi",onClick:t=>l.confirmRemoveFromTourney(e.id)},null,8,["onClick"])])))),128))])])):((0,r.uX)(),(0,r.CE)("div",ua,[(0,r.Lk)("ul",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.userTournaments,(e=>((0,r.uX)(),(0,r.CE)("li",{key:e.id,class:"border-b border-gray-300 py-2"},(0,a.v_)(e.name),1)))),128))])]))])]),s.isAdmin&&s.userId!==l.currentUserId?((0,r.uX)(),(0,r.CE)("div",pa,[t[37]||(t[37]=(0,r.Lk)("h2",{class:"text-2xl font-semibold mb-4"},"Actions administrateur",-1)),(0,r.bF)(c,{variant:"danger",size:"sm",onClick:l.confirmDeleteUser},{default:(0,r.k6)((()=>t[36]||(t[36]=[(0,r.eW)(" Supprimer l'utilisateur ")]))),_:1},8,["onClick"])])):(0,r.Q3)("",!0),(0,r.bF)(m,{isVisible:i.showDeleteModal,title:"Confirmer la suppression",message:"Êtes-vous sûr de vouloir supprimer cet utilisateur ?",onConfirm:l.deleteUser,onFormCancel:l.closeDeleteModal},null,8,["isVisible","onConfirm","onFormCancel"]),(0,r.bF)(m,{isVisible:i.showRemoveFromTourneyModal,title:"Confirmer le retrait",message:"Êtes-vous sûr de vouloir retirer l'utilisateur de ce tournoi ?",onConfirm:l.removeUserFromTourney,onFormCancel:l.closeRemoveFromTourneyModal},null,8,["isVisible","onConfirm","onFormCancel"])])}var fa={components:{DeleteConfirmationModal:Gt,ButtonComponent:ke,SoftButtonComponent:Pr},props:{userId:{type:Number,required:!0},isAdmin:{type:Boolean,default:!1}},data(){return{userData:{name:"",email:"",phone:"",roleId:null,roleName:""},originalUserData:{},passwordData:{oldPassword:"",newPassword:"",confirmPassword:""},userTournaments:[],availableTourneys:[],selectedTourneyId:null,roles:[],editingField:{name:!1,email:!1,phone:!1,password:!1,role:!1},showDeleteModal:!1,showRemoveFromTourneyModal:!1,tourneyIdToRemove:null}},computed:{pageTitle(){return this.isAdmin?"Profil de l'utilisateur":"Mon Profil"},canEditEmail(){return this.isAdmin},currentUserId(){return this.$store.state.user?this.$store.state.user.id:null}},async created(){await this.fetchUserData(),this.userNotFound||this.isAdmin&&(await this.fetchAvailableTourneys(),await this.fetchRoles())},methods:{async fetchUserData(){try{const e=await $.get(`/users/${this.userId}`),t=e.data;this.userData={name:t.name||"",email:t.email||"",phone:t.phone||"",roleId:t.roleId,roleName:t.role?t.role.name:""},this.userTournaments=t.usersTourneys?t.usersTourneys.map((e=>e.tourney)):[],this.originalUserData={...this.userData}}catch(e){console.error("Erreur lors de la récupération des données utilisateur:",e),e.response&&404===e.response.status?this.$router.push("/404"):we.oR.error("Une erreur est survenue lors de la récupération des données.")}},async fetchAvailableTourneys(){try{const e=await $.get("/tourneys"),t=this.userTournaments.map((e=>e.id));this.availableTourneys=e.data.filter((e=>!t.includes(e.id)))}catch(e){console.error("Erreur lors de la récupération des tournois disponibles:",e)}},async fetchRoles(){try{const e=await $.get("/roles");this.roles=e.data}catch(e){console.error("Erreur lors de la récupération des rôles:",e)}},toggleEdit(e){this.editingField[e]=!0},async saveField(e){await this.updateField(e),this.editingField[e]=!1},cancelEdit(e){this.userData[e]=this.originalUserData[e],this.editingField[e]=!1},async updateField(e){try{const t={[e]:this.userData[e]};if(await $.put(`/users/${this.userId}`,t),we.oR.success("Informations mises à jour avec succès!"),"name"===e&&this.$store.state.user.id===this.userId&&this.$store.commit("UPDATE_USER_NAME",this.userData.name),"roleId"===e){const e=this.roles.find((e=>e.id===this.userData.roleId));this.userData.roleName=e?e.name:""}this.originalUserData[e]=this.userData[e]}catch(t){console.error("Erreur lors de la mise à jour des informations:",t),we.oR.error("Une erreur est survenue lors de la mise à jour."),this.userData[e]=this.originalUserData[e]}},async updatePassword(){if(this.passwordData.newPassword===this.passwordData.confirmPassword)try{const e={password:this.passwordData.newPassword};this.isAdmin||(e.oldPassword=this.passwordData.oldPassword),await $.put(`/users/${this.userId}`,e),we.oR.success("Mot de passe mis à jour avec succès!"),this.passwordData.oldPassword="",this.passwordData.newPassword="",this.passwordData.confirmPassword="",this.editingField.password=!1}catch(e){console.error("Erreur lors de la mise à jour du mot de passe:",e),e.response&&e.response.data&&e.response.data.message?we.oR.error(e.response.data.message):we.oR.error("Une erreur est survenue lors de la mise à jour du mot de passe.")}else we.oR.error("Les mots de passe ne correspondent pas.")},confirmDeleteUser(){this.showDeleteModal=!0},async deleteUser(){try{await $.delete(`/users/${this.userId}`),we.oR.success("Utilisateur supprimé avec succès."),this.$router.push("/admin/users")}catch(e){console.error("Erreur lors de la suppression de l'utilisateur:",e),we.oR.error("Une erreur est survenue lors de la suppression de l'utilisateur.")}},closeDeleteModal(){this.showDeleteModal=!1},async assignTourney(){try{await $.post(`/users/${this.userId}/tourneys/${this.selectedTourneyId}`),we.oR.success("Utilisateur assigné au tournoi avec succès."),await this.fetchUserData(),await this.fetchAvailableTourneys(),this.selectedTourneyId=null}catch(e){console.error("Erreur lors de l'assignation au tournoi:",e),we.oR.error("Une erreur est survenue lors de l'assignation au tournoi.")}},confirmRemoveFromTourney(e){this.tourneyIdToRemove=e,this.showRemoveFromTourneyModal=!0},async removeUserFromTourney(){try{await $.delete(`/users/${this.userId}/tourneys/${this.tourneyIdToRemove}`),we.oR.success("Utilisateur retiré du tournoi avec succès."),await this.fetchUserData(),await this.fetchAvailableTourneys(),this.showRemoveFromTourneyModal=!1,this.tourneyIdToRemove=null}catch(e){console.error("Erreur lors du retrait du tournoi:",e),we.oR.error("Une erreur est survenue lors du retrait du tournoi.")}},closeRemoveFromTourneyModal(){this.showRemoveFromTourneyModal=!1,this.tourneyIdToRemove=null}}};const ya=(0,E.A)(fa,[["render",ga],["__scopeId","data-v-e2acaaaa"]]);var va=ya,ba={components:{ProfilePageComponent:va},computed:{userId(){const e=this.$route.params.userId,t=e?Number(e):null;return isNaN(t)?null:t}}};const ka=(0,E.A)(ba,[["render",_r]]);var Ta=ka;const Ca={class:"p-4 sm:p-6"},xa={class:"flex items-center justify-between mb-4 sm:mb-8"},wa={class:"flex items-center space-x-2 sm:space-x-4 mr-auto"},Ea={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6"};function Ia(e,t,s,o,a,n){const i=(0,r.g2)("TourneySubMenu"),l=(0,r.g2)("TitleComponent"),d=(0,r.g2)("ButtonComponent"),u=(0,r.g2)("StatusSelectorComponent"),c=(0,r.g2)("CardAddComponent"),m=(0,r.g2)("CardEditComponent"),h=(0,r.g2)("FormComponent"),p=(0,r.g2)("ModalComponent"),g=(0,r.g2)("DeleteConfirmationModal");return(0,r.uX)(),(0,r.CE)("div",null,[(0,r.bF)(i,{tourneyId:a.tourneyId},null,8,["tourneyId"]),(0,r.Lk)("div",Ca,[(0,r.Lk)("div",xa,[(0,r.bF)(l,{title:"Gestion Terrains"}),(0,r.Lk)("div",wa,[n.isEditable?((0,r.uX)(),(0,r.Wv)(d,{key:0,fontAwesomeIcon:"cog",onClick:n.openAddMultipleFieldsModal,variant:"algo"},{default:(0,r.k6)((()=>t[4]||(t[4]=[(0,r.Lk)("span",{class:"hidden sm:inline"},"Générer terrains",-1)]))),_:1},8,["onClick"])):(0,r.Q3)("",!0),n.isEditable&&a.fields.length>0?((0,r.uX)(),(0,r.Wv)(d,{key:1,onClick:n.openDeleteAllFieldsModal,variant:"danger",fontAwesomeIcon:"trash"},{default:(0,r.k6)((()=>t[5]||(t[5]=[(0,r.Lk)("span",{class:"hidden sm:inline"},"Tous les terrains",-1)]))),_:1},8,["onClick"])):(0,r.Q3)("",!0)]),(0,r.bF)(u,{tourneyId:a.tourneyId,statusKey:"fieldAssignmentStatus",statusOptions:a.fieldAssignmentStatusOptions,modelValue:n.currentStatus,"onUpdate:modelValue":t[0]||(t[0]=e=>n.currentStatus=e)},null,8,["tourneyId","statusOptions","modelValue"])]),(0,r.Lk)("div",Ea,[n.isEditable?((0,r.uX)(),(0,r.Wv)(c,{key:0,title:"Terrain",onOpenAddElementModal:n.openAddFieldModal},null,8,["onOpenAddElementModal"])):(0,r.Q3)("",!0),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(a.fields,(e=>((0,r.uX)(),(0,r.Wv)(m,{key:e.id,title:e.name,description:e.description,showDeleteButton:n.isEditable,showEditButton:!0,isEditable:n.isEditable,onDelete:t=>n.confirmDeleteField(e.id),onEdit:t=>n.editField(e),onClick:t=>n.editField(e)},null,8,["title","description","showDeleteButton","isEditable","onDelete","onEdit","onClick"])))),128))]),(0,r.bF)(p,{isVisible:a.showModal,title:a.editingFieldId?"Modifier le Terrain":"Ajouter un Nouveau Terrain",onClose:n.closeModal},{content:(0,r.k6)((()=>[(0,r.bF)(h,{modelValue:a.newField,"onUpdate:modelValue":t[1]||(t[1]=e=>a.newField=e),fields:n.formFields,isEditing:!!a.editingFieldId,isEditable:n.isEditable,onFormSubmit:n.handleFormSubmit,onFormCancel:n.closeModal},null,8,["modelValue","fields","isEditing","isEditable","onFormSubmit","onFormCancel"])])),_:1},8,["isVisible","title","onClose"]),(0,r.bF)(p,{isVisible:a.showMultipleFieldsModal,title:"Ajouter plusieurs terrains",onClose:n.closeMultipleFieldsModal},{content:(0,r.k6)((()=>[(0,r.bF)(h,{modelValue:a.multipleFieldsData,"onUpdate:modelValue":t[2]||(t[2]=e=>a.multipleFieldsData=e),fields:n.multipleFieldsFormFields,isFormValid:a.multipleFieldsData.numberOfFields>0,isEditing:!!a.editingFieldId,isEditable:n.isEditable,onFormSubmit:n.handleMultipleFieldsSubmit,onFormCancel:n.closeMultipleFieldsModal},null,8,["modelValue","fields","isFormValid","isEditing","isEditable","onFormSubmit","onFormCancel"])])),_:1},8,["isVisible","onClose"]),n.isEditable?((0,r.uX)(),(0,r.Wv)(g,{key:0,isVisible:a.showDeleteAllFieldsModal,onFormCancel:n.closeDeleteAllFieldsModal,onConfirm:n.handleDeleteAllFieldsSubmit,isHardDelete:!0,hardDeleteMessage:"Cette action supprimera définitivement tous les terrains et les sports associés."},null,8,["isVisible","onFormCancel","onConfirm"])):(0,r.Q3)("",!0),n.isEditable?((0,r.uX)(),(0,r.Wv)(g,{key:1,isVisible:a.showDeleteConfirmation,onFormCancel:n.closeDeleteConfirmation,onConfirm:t[3]||(t[3]=e=>n.deleteField(a.confirmedDeleteFieldId))},null,8,["isVisible","onFormCancel"])):(0,r.Q3)("",!0)])])}var Sa={components:{ModalComponent:mt,ButtonComponent:ke,DeleteConfirmationModal:Gt,TourneySubMenu:mo,CardAddComponent:Yt,CardEditComponent:vs,FormComponent:jt,TitleComponent:Ls,StatusSelectorComponent:ko},data(){return{tourneyId:this.$route.params.tourneyId,fields:[],showModal:!1,showMultipleFieldsModal:!1,showDeleteConfirmation:!1,confirmedDeleteFieldId:null,showDeleteAllFieldsModal:!1,deleteAllConfirmation:"",newField:{name:"",description:"",tourneyId:this.tourneyId},multipleFieldsData:{numberOfFields:1},editingFieldId:null,isSubmitting:!1,isDeleting:!1,isFormValid:!1,fieldAssignmentStatusOptions:[{value:"draft",label:"Edition"},{value:"completed",label:"Terminé"}]}},computed:{formFields(){return[{name:"name",label:"Nom du terrain",type:"text",required:!0},{name:"description",label:"Description du terrain",type:"textarea",required:!1}]},multipleFieldsFormFields(){return[{name:"numberOfFields",label:"Nombre de terrains",type:"number",required:!0,min:1}]},...(0,x.aH)("tourney",{currentTournamentName:e=>e.currentTournamentName,statuses:e=>e.statuses}),shouldShowStatusSelector(){return"notStarted"!==this.statuses.fieldAssignmentStatus},isEditable(){return"completed"!==this.statuses.fieldAssignmentStatus},currentStatus:{get(){return this.statuses.fieldAssignmentStatus},set(e){this.$store.dispatch("tourney/updateStatus",{tourneyId:this.tourneyId,key:"fieldAssignmentStatus",value:e})}}},methods:{...(0,x.i0)("tourney",["fetchTourneyStatuses","setTournamentName","clearTournamentName"]),async fetchFieldDetails(){try{await this.fetchTourneyStatuses(this.tourneyId);const e=await $.get(`/tourneys/${this.tourneyId}/fields`);this.fields=e.data||[]}catch(e){console.error("Erreur lors de la récupération des détails du terrain:",e)}},openDeleteAllFieldsModal(){this.showDeleteAllFieldsModal=!0},closeDeleteAllFieldsModal(){this.showDeleteAllFieldsModal=!1},async handleDeleteAllFieldsSubmit(){if(!this.isDeleting){this.isDeleting=!0;try{await $.delete(`/tourneys/${this.tourneyId}/fields`),we.oR.success("Tous les terrains ont été supprimés avec succès!"),this.fetchFieldDetails(),this.closeDeleteAllFieldsModal()}catch(e){we.oR.error("Erreur lors de la suppression de tous les terrains."),console.error("Erreur lors de la suppression de tous les terrains:",e)}finally{this.isDeleting=!1}}},confirmDeleteField(e){this.confirmedDeleteFieldId=e,this.showDeleteConfirmation=!0},closeDeleteConfirmation(){this.showDeleteConfirmation=!1,this.confirmedDeleteFieldId=null},async deleteField(e){if(!this.isDeleting){this.isDeleting=!0;try{await $.delete(`/tourneys/${this.tourneyId}/fields/${e}`),we.oR.success("Terrain supprimé avec succès!"),this.fetchFieldDetails(),this.closeDeleteConfirmation()}catch(t){we.oR.error("Erreur lors de la suppression du terrain!"),console.error("Erreur lors de la suppression du terrain:",t)}finally{this.isDeleting=!1}}},openAddMultipleFieldsModal(){this.multipleFieldsData.numberOfFields=1,this.showMultipleFieldsModal=!0},closeMultipleFieldsModal(){this.showMultipleFieldsModal=!1},async handleMultipleFieldsSubmit(){if(!this.isSubmitting){this.isSubmitting=!0;try{const e=this.multipleFieldsData.numberOfFields;if(e<1)return void we.oR.error("Veuillez entrer un nombre valide de terrains à ajouter.");await $.post(`/tourneys/${this.tourneyId}/fields/multiple`,{numberOfFields:e}),we.oR.success(`${e} terrains créés avec succès !`),this.fetchFieldDetails(),this.closeMultipleFieldsModal()}catch(e){console.error("Erreur lors de la création des terrains:",e),we.oR.error("Erreur lors de la création des terrains.")}finally{this.isSubmitting=!1}}},openAddFieldModal(){this.editingFieldId=null,this.newField={name:"",description:"",tourneyId:this.tourneyId},this.isFormValid=!1,this.showModal=!0},editField(e){this.editingFieldId=e.id,this.newField={...e},this.isFormValid=!0,this.showModal=!0},validateForm(){this.isFormValid=!!this.newField.name},handleFormSubmit(){this.validateForm(),this.isFormValid&&(this.isSubmitting=!0,this.saveField())},async saveField(){try{this.editingFieldId?(await $.put(`/tourneys/${this.tourneyId}/fields/${this.editingFieldId}`,this.newField),we.oR.success("Terrain modifié avec succès!")):(await $.post(`/tourneys/${this.tourneyId}/fields`,this.newField),we.oR.success("Nouveau terrain ajouté avec succès!")),this.closeModal(),this.fetchFieldDetails()}catch(e){we.oR.error("Erreur lors de l'enregistrement du terrain!"),console.error("Erreur lors de l'enregistrement du terrain:",e)}finally{this.isSubmitting=!1}},closeModal(){this.showModal=!1,this.isSubmitting=!1}},watch:{newField:{handler(){this.validateForm()},deep:!0}},mounted(){this.fetchFieldDetails()}};const Fa=(0,E.A)(Sa,[["render",Ia]]);var Pa=Fa;const Aa={id:"external-events",class:"p-2 rounded-lg shadow-lg sticky top-0 z-50 overflow-x-auto flex items-center justify-between bg-white dark:bg-dark-background"},La={class:"flex space-x-4"},Da=["data-id"],Ma={key:0},$a={class:"flex items-center justify-between gap-4 my-2 px-4"},Ua={class:"flex items-center gap-2 mx-auto"},Ra=["value"],Va={class:"ml-auto"},_a={key:1};function Xa(e,t,s,n,i,l){const d=(0,r.g2)("TourneySubMenu"),u=(0,r.g2)("ErrorMessageComponent"),c=(0,r.g2)("StatusSelectorComponent"),m=(0,r.g2)("FullCalendar");return(0,r.uX)(),(0,r.CE)("div",null,[(0,r.bF)(d,{tourneyId:i.tourneyId},null,8,["tourneyId"]),(0,r.Lk)("div",Aa,[(0,r.Lk)("div",La,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.sports,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,"data-id":e.id,style:(0,a.Tr)({backgroundColor:e.color}),class:(0,a.C4)(["sport-item","p-3","mb-3","rounded-lg","text-center","text-light-menuText","dark:text-dark-menuText","font-semibold","transform","transition","duration-100","w-28","shadow-md","flex","items-center","justify-center",l.isEditable?"cursor-pointer external-event hover:scale-110 active:scale-95":"opacity-50"])},(0,a.v_)(e.name),15,Da)))),128))])]),i.fields.length?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",Ma,[(0,r.bF)(u,{message:"Aucun terrain trouvé. Veuillez créer des terrains avant d'assigner des sports."})])),(0,r.Lk)("div",$a,[(0,r.Lk)("div",Ua,[i.currentPage>1?((0,r.uX)(),(0,r.CE)("button",{key:0,onClick:t[0]||(t[0]=e=>i.currentPage--),class:"text-2xl px-2 py-1 rounded navigation-button"}," < ")):(0,r.Q3)("",!0),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>i.currentPage=e),class:"bg-light-form-background dark:bg-dark-form-background text-light-form-text dark:text-dark-form-text border border-light-form-border-default dark:border-dark-form-border-default rounded-md px-2 py-1"},[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.totalPages,(e=>((0,r.uX)(),(0,r.CE)("option",{key:e,value:e}," Page "+(0,a.v_)(e)+" / "+(0,a.v_)(l.totalPages),9,Ra)))),128))],512),[[o.u1,i.currentPage]]),i.currentPage<l.totalPages?((0,r.uX)(),(0,r.CE)("button",{key:1,onClick:t[2]||(t[2]=e=>i.currentPage++),class:"text-2xl px-2 py-1 rounded navigation-button"}," > ")):(0,r.Q3)("",!0),(0,r.Lk)("button",{onClick:t[3]||(t[3]=e=>{i.showAllTerrains=!i.showAllTerrains,i.currentPage=1}),class:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600"},(0,a.v_)(i.showAllTerrains?"Reduce":"All Fields"),1)]),(0,r.Lk)("div",Va,[(0,r.bF)(c,{tourneyId:i.tourneyId,statusKey:"sportAssignmentStatus",statusOptions:i.sportAssignmentStatusOptions,modelValue:l.currentStatus,"onUpdate:modelValue":t[4]||(t[4]=e=>l.currentStatus=e)},null,8,["tourneyId","statusOptions","modelValue"])])]),i.tourney.dateTourney&&i.fields.length?((0,r.uX)(),(0,r.CE)("div",_a,[((0,r.uX)(),(0,r.Wv)(m,{ref:"fullCalendar",options:l.calendarOptions,key:i.tourney.dateTourney},null,8,["options"]))])):(0,r.Q3)("",!0)])}var qa=s(661),Na=s(8109),Ba=s(8680),Wa=s(4599);function ja(e,t,s,o,n,i){return s.message?((0,r.uX)(),(0,r.CE)("div",{key:0,class:(0,a.C4)(s.errorClass)},[(0,r.Lk)("span",null,(0,a.v_)(s.message),1)],2)):(0,r.Q3)("",!0)}var Qa={props:{message:{type:String,required:!0},errorClass:{type:String,default:"p-2 text-center text-xl rounded-lg font-semibold text-light-errorMessage dark:text-errorMessage"}}};const Oa=(0,E.A)(Qa,[["render",ja]]);var Ga=Oa,za={components:{FullCalendar:qa.A,TourneySubMenu:mo,ErrorMessageComponent:Ga,StatusSelectorComponent:ko},data(){return{tourneyId:this.$route.params.tourneyId,tourney:{},fields:[],sports:[],sportAssignmentStatusOptions:[{value:"draft",label:"Edition"},{value:"completed",label:"Terminé"}],externalDraggableInstance:null,currentPage:1,terrainsPerPage:10,showAllTerrains:!1}},computed:{...(0,x.aH)("tourney",{statuses:e=>e.statuses}),isEditable(){return"completed"!==this.statuses.sportAssignmentStatus},currentStatus:{get(){return this.statuses.sportAssignmentStatus},set(e){this.$store.dispatch("tourney/updateStatus",{tourneyId:this.tourneyId,key:"sportAssignmentStatus",value:e})}},totalPages(){return this.showAllTerrains?1:Math.ceil(this.fields.length/this.terrainsPerPage)},paginatedFields(){if(this.showAllTerrains)return this.fields;const e=(this.currentPage-1)*this.terrainsPerPage,t=e+this.terrainsPerPage;return this.fields.slice(e,t)},calendarOptions(){if(!this.tourney.dateTourney)return console.error("La date du tournoi n’est pas disponible"),{};const e=[];return this.fields.forEach((t=>{t.sportsFields&&t.sportsFields.length>0&&t.sportsFields.forEach((s=>{e.push({id:s.id.toString(),title:s.sport.name,start:`${this.tourney.dateTourney}T${s.startTime}`,end:`${this.tourney.dateTourney}T${s.endTime}`,resourceId:t.id.toString(),backgroundColor:s.sport.color||"#cccccc",extendedProps:{fieldId:t.id,sportId:s.sport.id}})}))})),{plugins:[Na.A,Ba.Ay,Wa.A],schedulerLicenseKey:"CC-Attribution-NonCommercial-NoDerivatives",initialView:"resourceTimeGridDay",timeZone:"local",initialDate:this.tourney.dateTourney,editable:this.isEditable,droppable:!0,headerToolbar:!1,height:"600px",defaultTimedEventDuration:"04:00",slotMinTime:"00:00:00",slotMaxTime:"24:00:00",slotLabelFormat:{hour:"2-digit",minute:"2-digit",hour12:!1},allDaySlot:!1,resources:this.paginatedFields.map((e=>({id:e.id.toString(),title:e.name}))),events:e,eventReceive:this.handleEventReceive,eventDrop:this.handleEventDrop,eventResize:this.handleEventResize,eventContent:this.renderEventContent}}},watch:{currentPage(){if(this.$refs.fullCalendar){const e=this.$refs.fullCalendar.getApi();e.refetchResources()}}},beforeUnmount(){this.externalDraggableInstance&&this.externalDraggableInstance.destroy()},methods:{...(0,x.i0)("tourney",["fetchTourneyStatuses","setTournamentName","clearTournamentName"]),async fetchTourneySportsFields(){try{await this.fetchTourneyStatuses(this.tourneyId);const e=await $.get(`/tourneys/${this.tourneyId}/sports-fields`);this.fields=e.data;const t=await $.get(`/tourneys/${this.tourneyId}`);this.tourney=t.data,this.fields.length||console.warn("Aucun terrain trouvé")}catch(e){console.error("Erreur lors de la récupération des détails du tournoi:",e)}},async fetchSports(){try{const e=await $.get("/sports");this.sports=e.data,this.sports.length||console.warn("Aucun sport trouvé")}catch(e){console.error("Erreur lors de la récupération des sports:",e)}},initializeExternalEvents(){if(!this.isEditable)return;this.externalDraggableInstance&&(this.externalDraggableInstance.destroy(),this.externalDraggableInstance=null);const e=document.getElementById("external-events");this.externalDraggableInstance=new Ba.sx(e,{itemSelector:".external-event",eventData(e){return{title:e.innerText.trim(),backgroundColor:e.style.backgroundColor,duration:"04:00",extendedProps:{sportId:e.getAttribute("data-id")}}}})},renderEventContent(e){const t=document.createElement("div");t.classList.add("flex","flex-col","space-y-1");const s=document.createElement("div");s.classList.add("flex","justify-between","items-center");const o=document.createElement("span");if(o.innerText=e.event.title,o.classList.add("font-semibold","text-white"),s.appendChild(o),this.isEditable){const t=document.createElement("span");let o;t.innerHTML="&#10060;",t.classList.add("delete-icon"),t.style.float="right",t.style.color="white",t.style.cursor="pointer",t.style.padding="0 5px",t.addEventListener("dblclick",(t=>{t.stopPropagation(),this.deleteEvent(e.event)})),t.addEventListener("touchstart",(t=>{t.stopPropagation(),o=setTimeout((()=>{this.deleteEvent(e.event)}),600)})),t.addEventListener("touchend",(()=>{clearTimeout(o)})),s.appendChild(t)}const r=this.formatDisplayTime(e.event.start),a=this.formatDisplayTime(e.event.end),n=document.createElement("div");return n.innerText=`${r} - ${a}`,n.classList.add("text-sm","text-white"),t.appendChild(s),t.appendChild(n),{domNodes:[t]}},async handleEventReceive(e){if(!this.isEditable)return void e.revert();const t=e.event;try{const s=t.extendedProps.sportId,o=t.getResources()[0]?.id;if(!o)return console.error("Problème d'ID : Terrain mal identifié."),void e.revert();if(!t.end){const e=new Date(t.start),s=new Date(e);s.setHours(s.getHours()+2),t.setEnd(s)}const r={fieldId:o,sportId:s,startTime:this.formatTime(t.start),endTime:this.formatTime(t.end)},a=await $.post(`/tourneys/${this.tourneyId}/sports-fields`,r);t.setProp("id",a.data.id),t.setExtendedProp("fieldId",o),t.setExtendedProp("sportId",s),t.setProp("backgroundColor",t.backgroundColor)}catch(s){console.error("Erreur lors du traitement de l'événement :",s),e.revert()}},async handleEventDrop(e){if(!this.isEditable)return void e.revert();const t=e.event;try{const s=t.id,o=t.getResources()[0]?.id;if(!s||!o)return console.error("Problème d'ID : Terrain ou événement mal identifié."),void e.revert();const r={fieldId:o,startTime:this.formatTime(t.start),endTime:this.formatTime(t.end)};await $.put(`/tourneys/${this.tourneyId}/sports-fields/${s}`,r),t.setExtendedProp("fieldId",o)}catch(s){console.error("Erreur lors du déplacement de l'événement :",s),e.revert()}},async handleEventResize(e){if(!this.isEditable)return void e.revert();const t=e.event;try{const s=t.id,o=t.extendedProps.fieldId;if(!s||!o)return console.error("Problème d'ID : Terrain ou événement mal identifié."),void e.revert();const r={startTime:this.formatTime(t.start),endTime:this.formatTime(t.end)};await $.put(`/tourneys/${this.tourneyId}/sports-fields/${s}`,r)}catch(s){console.error("Erreur lors du redimensionnement de l'événement :",s),e.revert()}},formatDisplayTime(e){const t=new Date(e),s=t.getHours().toString().padStart(2,"0"),o=t.getMinutes().toString().padStart(2,"0");return`${s}:${o}`},async deleteEvent(e){if(this.isEditable)try{await $.delete(`/tourneys/${this.tourneyId}/sports-fields/${e.id}`),e.remove()}catch(t){console.error("Erreur lors de la suppression du sport :",t)}},formatTime(e){const t=new Date(e),s=t.getHours().toString().padStart(2,"0"),o=t.getMinutes().toString().padStart(2,"0"),r=t.getSeconds().toString().padStart(2,"0");return`${s}:${o}:${r}`},adjustTerrainsPerPage(){const e=window.innerWidth;this.terrainsPerPage=e>=1200?10:e>=1e3?8:e>=800?7:e>=600?5:3}},async mounted(){await this.fetchTourneySportsFields(),await this.fetchSports(),this.initializeExternalEvents(),this.adjustTerrainsPerPage(),window.addEventListener("resize",this.adjustTerrainsPerPage)}};const Ha=(0,E.A)(za,[["render",Xa],["__scopeId","data-v-08d0af18"]]);var Ka=Ha;const Ja={class:"p-6"},Ya={class:"flex items-center mb-8 justify-between"},Za={class:"flex items-center"},en={class:"flex items-center ml-auto"},tn={key:2,class:"flex items-center space-x-2 ml-4"},sn={class:"flex justify-between items-center mb-4"},on={class:"flex items-center"},rn={key:0,class:"mb-4"},an={class:"space-y-2"},nn={class:"flex-1"},ln={class:"flex items-center"},dn=["value"],un={class:"text-light-form-text dark:text-dark-form-text"},cn={class:"flex flex-col items-end"},mn={class:"flex mt-4"},hn={key:1,class:"mt-4"},pn={key:2},gn={class:"flex flex-col md:flex-row items-start md:items-center justify-between space-y-4 md:space-y-0"},fn={class:"flex items-center space-x-2 w-full md:w-auto"},yn={key:0},vn={class:"flex flex-wrap justify-end space-x-6 text-right w-full md:w-auto"},bn={class:"text-sm"},kn={class:"text-sm"},Tn={class:"mt-4"},Cn={key:0},xn={key:1},wn={key:0,class:"text-sm text-gray-600"},En={class:"grid grid-cols-2 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-6 gap-4 mt-6"},In={class:"grid grid-cols-2 gap-2 mt-2"},Sn={class:"truncate"},Fn={key:0,class:"text-sm text-gray-500"},Pn={key:0,class:"text-sm mb-4"};function An(e,t,s,n,i,l){const d=(0,r.g2)("TourneySubMenu"),u=(0,r.g2)("TitleComponent"),c=(0,r.g2)("ButtonComponent"),m=(0,r.g2)("FormComponent"),h=(0,r.g2)("font-awesome-icon"),p=(0,r.g2)("ModalComponent"),g=(0,r.g2)("StatusSelectorComponent"),f=(0,r.g2)("ErrorMessageComponent"),y=(0,r.g2)("FilterComponent"),v=(0,r.g2)("CardAddComponent"),b=(0,r.g2)("CardEditComponent"),k=(0,r.g2)("ConfirmationModal"),T=(0,r.g2)("DeleteConfirmationModal");return(0,r.uX)(),(0,r.CE)("div",null,[(0,r.bF)(d,{tourneyId:i.tourneyId},null,8,["tourneyId"]),(0,r.Lk)("div",Ja,[(0,r.Lk)("div",Ya,[(0,r.Lk)("div",Za,[(0,r.bF)(u,{title:"Gestion des équipes"}),!l.isRegistrationActive&&l.isEditable?((0,r.uX)(),(0,r.Wv)(c,{key:0,fontAwesomeIcon:"cog",onClick:l.openTeamSetupModal,variant:"secondary"},{default:(0,r.k6)((()=>t[9]||(t[9]=[(0,r.Lk)("span",{class:"hidden sm:md:inline"},"Config Equipes",-1)]))),_:1},8,["onClick"])):(0,r.Q3)("",!0),!l.isRegistrationActive&&l.isEditable&&i.teamSetupConfigured&&l.playerTeams.length<i.teamSetup.maxTeamNumber?((0,r.uX)(),(0,r.Wv)(c,{key:1,onClick:l.openGenerateConfirmationModal,variant:"algo",fontAwesomeIcon:"people-group",class:"ml-2"},{default:(0,r.k6)((()=>t[10]||(t[10]=[(0,r.Lk)("span",{class:"hidden sm:md:inline"},"Générer équipes",-1)]))),_:1},8,["onClick"])):(0,r.Q3)("",!0)]),(0,r.Lk)("div",en,[l.isEditable&&l.invalidTeams.length>0&&!l.isRegistrationActive&&"invalid"===i.filters[0].value?((0,r.uX)(),(0,r.Wv)(c,{key:0,onClick:l.openDeleteInvalidTeamsModal,variant:"danger",fontAwesomeIcon:"trash",class:"ml-2"},{default:(0,r.k6)((()=>t[11]||(t[11]=[(0,r.Lk)("span",{class:"hidden sm:inline"},"Supprimer les équipes invalides",-1)]))),_:1},8,["onClick"])):(0,r.Q3)("",!0),l.isEditable&&l.playerTeams.length>0&&!l.isRegistrationActive&&"invalid"!==i.filters[0].value?((0,r.uX)(),(0,r.Wv)(c,{key:1,onClick:l.openModalResetTeams,variant:"danger",fontAwesomeIcon:"trash"},{default:(0,r.k6)((()=>t[12]||(t[12]=[(0,r.Lk)("span",{class:"hidden sm:inline mr-auto"},"Toutes les équipes",-1)]))),_:1},8,["onClick"])):(0,r.Q3)("",!0),l.isRegistrationActive?((0,r.uX)(),(0,r.CE)("div",tn,[(0,r.bF)(c,{onClick:l.openInviteTokenModal,variant:"success",fontAwesomeIcon:"link"},{default:(0,r.k6)((()=>t[13]||(t[13]=[(0,r.eW)(" Lien d'invitation ")]))),_:1},8,["onClick"])])):(0,r.Q3)("",!0),(0,r.bF)(p,{isVisible:i.showInviteTokenModal,title:"Gestion des liens d'invitation",onClose:l.closeInviteTokenModal},{content:(0,r.k6)((()=>[(0,r.Lk)("div",sn,[(0,r.Lk)("label",on,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=e=>i.showValidOnly=e),class:"form-checkbox"},null,512),[[o.lH,i.showValidOnly]]),t[14]||(t[14]=(0,r.Lk)("span",{class:"ml-2"},"Afficher liens valides",-1))]),(0,r.bF)(c,{onClick:t[1]||(t[1]=e=>i.showAddTokenForm=!i.showAddTokenForm),variant:"primary",fontAwesomeIcon:"plus"},{default:(0,r.k6)((()=>t[15]||(t[15]=[(0,r.eW)(" Générer un lien ")]))),_:1})]),i.showAddTokenForm?((0,r.uX)(),(0,r.CE)("div",rn,[(0,r.bF)(m,{modelValue:i.inviteTokenForm,"onUpdate:modelValue":t[2]||(t[2]=e=>i.inviteTokenForm=e),fields:i.inviteTokenFields,onFormSubmit:l.handleGenerateInviteToken,onFormCancel:t[3]||(t[3]=e=>i.showAddTokenForm=!1)},null,8,["modelValue","fields","onFormSubmit"])])):(0,r.Q3)("",!0),(0,r.Lk)("ul",an,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.filteredSortedInviteTokens,(e=>((0,r.uX)(),(0,r.CE)("li",{key:e.id,class:(0,a.C4)(["p-4 border rounded-md flex justify-between items-center",{"bg-light-token-valid dark:bg-dark-token-valid":e.isValid&&new Date(e.expiresAt)>new Date(Date.now()+2592e5),"bg-light-token-expiring dark:bg-dark-token-expiring":e.isValid&&new Date(e.expiresAt)<=new Date(Date.now()+2592e5),"bg-light-token-invalid dark:bg-dark-token-invalid":!e.isValid||new Date(e.expiresAt)<=new Date}])},[(0,r.Lk)("div",nn,[t[17]||(t[17]=(0,r.Lk)("label",{class:"font-semibold"},"Lien d'invitation :",-1)),(0,r.bF)(h,{icon:"copy",class:"ml-2 cursor-pointer text-gray-600 hover:text-gray-800 dark:text-gray-300 dark:hover:text-gray-200",onClick:t=>l.copyToClipboard(e.token),title:"Copier le lien"},null,8,["onClick"]),(0,r.Lk)("div",ln,[(0,r.Lk)("input",{type:"text",value:`${i.BASE_URL}/register?inviteToken=${e.token}`,readonly:"",class:"w-full p-1 border text-gray-800 dark:text-gray-200 bg-white dark:bg-gray-800 rounded-md overflow-x-auto",style:{"max-width":"100%"}},null,8,dn)]),(0,r.Lk)("p",un," Expire le : "+(0,a.v_)(new Date(e.expiresAt).toLocaleDateString()),1),(0,r.Lk)("p",null,[t[16]||(t[16]=(0,r.eW)(" Statut : ")),(0,r.Lk)("span",{class:(0,a.C4)({"text-green-600 dark:text-green-300":e.isValid,"text-red-600 dark:text-red-300":!e.isValid})},(0,a.v_)(e.isValid?"Valide":"Invalide"),3)])]),(0,r.Lk)("div",cn,[e.isValid?((0,r.uX)(),(0,r.Wv)(c,{key:0,onClick:t=>l.invalidateToken(e.id),variant:"danger"},{default:(0,r.k6)((()=>t[18]||(t[18]=[(0,r.eW)(" Invalider ")]))),_:2},1032,["onClick"])):((0,r.uX)(),(0,r.Wv)(c,{key:1,onClick:t=>l.validateToken(e.id),variant:"success"},{default:(0,r.k6)((()=>t[19]||(t[19]=[(0,r.eW)(" Valider ")]))),_:2},1032,["onClick"]))])],2)))),128))])])),footer:(0,r.k6)((()=>[(0,r.Lk)("div",mn,[(0,r.bF)(c,{onClick:l.closeInviteTokenModal,variant:"secondary"},{default:(0,r.k6)((()=>t[20]||(t[20]=[(0,r.eW)(" Fermer ")]))),_:1},8,["onClick"])])])),_:1},8,["isVisible","onClose"]),(0,r.bF)(g,{tourneyId:i.tourneyId,label:"Inscriptions:",statusKey:"registrationStatus",statusOptions:i.registrationStatusOptions,modelValue:l.currentStatus,"onUpdate:modelValue":t[4]||(t[4]=e=>l.currentStatus=e)},null,8,["tourneyId","statusOptions","modelValue"])])]),i.teamSetupConfigured?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.Wv)(f,{key:0,message:i.fieldCount>0?"Aucune configuration d'équipe n'est définie. Cliquez sur <Config Equipes> pour configurer les équipes. Recommandation : Nombre max d'équipes: "+4*i.fieldCount+" équipes pour "+i.fieldCount+" terrains.":"Aucune configuration d'équipe n'est définie. Veuillez cliquer sur <Config Equipes> pour configurer les équipes."},null,8,["message"])),i.teamSetupConfigured&&0===l.playerTeams.length?((0,r.uX)(),(0,r.CE)("div",hn,[(0,r.bF)(f,{class:"text-sm",message:"Aucune équipe n'a été créée. Veuillez créer des équipes pour assigner les utilisateurs."})])):(0,r.Q3)("",!0),i.teamSetupConfigured?((0,r.uX)(),(0,r.CE)("div",pn,[(0,r.Lk)("div",gn,[(0,r.Lk)("div",fn,[(0,r.bF)(y,{filters:i.filters,onFilterChange:l.handleFilterChange},null,8,["filters","onFilterChange"]),l.allDisplayedTeams.length>0?((0,r.uX)(),(0,r.CE)("div",yn,[(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>i.searchQuery=e),type:"text",placeholder:"Rechercher par nom ou mail",class:"border border-light-form-border dark:border-dark-form-border rounded-md p-2 w-full sm:w-64 bg-light-form-background dark:bg-dark-form-background text-light-form-text dark:text-dark-form-text"},null,512),[[o.Jo,i.searchQuery]])])):(0,r.Q3)("",!0),i.unassignedUsers.length>0?((0,r.uX)(),(0,r.Wv)(c,{key:1,onClick:l.navigateToUnassignedUsers,variant:"primary",class:"flex items-left space-x-2",fontAwesomeIcon:"user"},{default:(0,r.k6)((()=>[(0,r.Lk)("span",null,"Joueurs sans groupe ("+(0,a.v_)(i.unassignedUsers.length)+")",1)])),_:1},8,["onClick"])):(0,r.Q3)("",!0),i.allUsers.length>0?((0,r.uX)(),(0,r.Wv)(c,{key:2,variant:"info",fontAwesomeIcon:"envelope",onClick:l.sendEmailToAll,disabled:0===i.allUsers.length},{default:(0,r.k6)((()=>t[21]||(t[21]=[(0,r.Lk)("span",{class:"hidden sm:inline"},null,-1)]))),_:1},8,["onClick","disabled"])):(0,r.Q3)("",!0)]),(0,r.Lk)("div",vn,[(0,r.Lk)("div",bn,[t[22]||(t[22]=(0,r.Lk)("strong",null,"Inscrits :",-1)),(0,r.eW)(" "+(0,a.v_)(i.allUsers.length),1)]),(0,r.Lk)("div",kn,[t[23]||(t[23]=(0,r.Lk)("strong",null,"Equipes affichées :",-1)),(0,r.eW)(" "+(0,a.v_)(l.allDisplayedTeams.length),1)])])]),(0,r.Lk)("div",Tn,[0===i.allUsers.length?((0,r.uX)(),(0,r.CE)("div",Cn,t[24]||(t[24]=[(0,r.Lk)("span",{class:"text-sm text-gray-600"}," Pas d'utilisateurs inscrits au tournoi. ",-1)]))):((0,r.uX)(),(0,r.CE)("div",xn,[0===i.unassignedUsers.length?((0,r.uX)(),(0,r.CE)("span",wn," Tous les utilisateurs inscrits sont dans des équipes. ")):(0,r.Q3)("",!0)]))]),(0,r.Lk)("div",En,[l.isEditable&&l.playerTeams.length<i.teamSetup.maxTeamNumber?((0,r.uX)(),(0,r.Wv)(v,{key:0,title:"Equipe",onOpenAddElementModal:l.openAddTeamModal},null,8,["onOpenAddElementModal"])):(0,r.Q3)("",!0),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.allDisplayedTeams,(e=>((0,r.uX)(),(0,r.Wv)(b,{key:e.id,title:e.teamName||"Nom manquant",cornerCount:"assistant"===e.type?`${e.usersTourneys.length}`:`${e.usersTourneys.length}/${i.teamSetup.playerPerTeam}`,titleColor:l.getStatusColor(e),showDeleteButton:l.isEditable,showEditButton:l.isEditable,onDelete:t=>l.confirmDeleteTeam(e.id),onEdit:t=>l.editTeam(e),onClick:t=>l.openTeamDetails(e)},{"user-list":(0,r.k6)((()=>[(0,r.Lk)("ul",In,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.usersTourneys.slice(0,4),(e=>((0,r.uX)(),(0,r.CE)("li",{key:e.userId,class:"flex items-center text-sm text-light-form-text dark:text-dark-form-text truncate"},[(0,r.bF)(h,{icon:"user",class:"mr-2 text-gray-500"}),(0,r.Lk)("span",Sn,(0,a.v_)(e.user.name),1)])))),128)),e.usersTourneys.length>4?((0,r.uX)(),(0,r.CE)("li",Fn," + "+(0,a.v_)(e.usersTourneys.length-4)+" autres ",1)):(0,r.Q3)("",!0)])])),_:2},1032,["title","cornerCount","titleColor","showDeleteButton","showEditButton","onDelete","onEdit","onClick"])))),128))])])):(0,r.Q3)("",!0),l.isEditable?((0,r.uX)(),(0,r.Wv)(p,{key:3,isVisible:i.showTeamSetupModal,title:i.teamSetup?"Modifier la configuration des équipes":"Configurer les équipes",onClose:l.closeTeamSetupModal},{content:(0,r.k6)((()=>[i.fieldCount>0?((0,r.uX)(),(0,r.CE)("p",Pn," Il y a actuellement "+(0,a.v_)(i.fieldCount)+" terrain(s). Nous recommandons de créer environ "+(0,a.v_)(4*i.fieldCount)+" équipes (soit 4 équipes par terrain). ",1)):(0,r.Q3)("",!0),(0,r.bF)(m,{modelValue:i.localTeamSetup,"onUpdate:modelValue":t[6]||(t[6]=e=>i.localTeamSetup=e),fields:i.teamSetupFields,isEditing:!!i.teamSetup,onFormSubmit:l.handleTeamSetupSubmit,onFormCancel:l.closeTeamSetupModal,customValidation:l.customTeamSetupValidation},null,8,["modelValue","fields","isEditing","onFormSubmit","onFormCancel","customValidation"])])),_:1},8,["isVisible","title","onClose"])):(0,r.Q3)("",!0),(0,r.bF)(p,{isVisible:i.showModal,title:i.editingTeamId?"Modifier équipe":"Ajouter une nouvelle équipe",onClose:l.closeModal},{content:(0,r.k6)((()=>[(0,r.bF)(m,{modelValue:i.newTeam,"onUpdate:modelValue":t[7]||(t[7]=e=>i.newTeam=e),fields:l.formFields,isEditing:!!i.editingTeamId,onFormSubmit:l.handleFormSubmit,onFormCancel:l.closeModal},null,8,["modelValue","fields","isEditing","onFormSubmit","onFormCancel"])])),_:1},8,["isVisible","title","onClose"]),(0,r.bF)(k,{isVisible:i.showGenerateConfirmationModal,title:"Confirmer la Génération des Équipes",message:"Êtes-vous sûr de vouloir générer les équipes automatiquement ?",onCancel:l.closeGenerateConfirmationModal,onConfirm:l.confirmGenerateTeams},null,8,["isVisible","onCancel","onConfirm"]),(0,r.bF)(T,{isVisible:i.showDeleteConfirmation,isHardDelete:!1,onFormCancel:l.closeDeleteConfirmation,onConfirm:t[8]||(t[8]=e=>l.deleteTeam(i.confirmedDeleteTeamId))},null,8,["isVisible","onFormCancel"]),l.isEditable?((0,r.uX)(),(0,r.Wv)(T,{key:4,isVisible:i.showModalResetTeams,onFormCancel:l.closeModalResetTeams,onConfirm:l.handleResetAllTeamsSubmit,isHardDelete:!0,hardDeleteMessage:"Toutes les équipes seront supprimées et les utilisateurs n'auront plus d'équipe (reset complet). Il ne sera pas possible de revenir en arrière. Êtes-vous sûr de vouloir continuer ?"},null,8,["isVisible","onFormCancel","onConfirm"])):(0,r.Q3)("",!0),(0,r.bF)(T,{isVisible:i.showDeleteInvalidTeamsModal,onFormCancel:l.closeDeleteInvalidTeamsModal,onConfirm:l.deleteInvalidTeams,isHardDelete:!1,message:"Êtes-vous sûr de vouloir supprimer toutes les équipes invalides ? Cette action est irréversible."},null,8,["isVisible","onFormCancel","onConfirm"])])])}const Ln={class:"bg-light-modal-content dark:bg-dark-modal-content p-8 rounded-lg w-full max-w-md"},Dn={class:"text-2xl font-bold mb-4 text-light-title dark:text-dark-title"},Mn={class:"mb-6 text-light-form-text dark:text-dark-form-text"},$n={class:"flex justify-end space-x-4"};function Un(e,t,s,n,i,l){const d=(0,r.g2)("ButtonComponent");return s.isVisible?((0,r.uX)(),(0,r.CE)("div",{key:0,class:"fixed inset-0 bg-light-modal-background z-50 dark:bg-dark-modal-background flex items-center justify-center",tabindex:"0",onKeydown:t[0]||(t[0]=(0,o.jR)(((...e)=>l.handleConfirm&&l.handleConfirm(...e)),["enter"]))},[(0,r.Lk)("div",Ln,[(0,r.Lk)("h2",Dn,(0,a.v_)(s.title),1),(0,r.Lk)("p",Mn,(0,a.v_)(s.message),1),(0,r.Lk)("div",$n,[(0,r.bF)(d,{variant:"secondary",onClick:l.handleCancel},{default:(0,r.k6)((()=>t[1]||(t[1]=[(0,r.eW)(" Annuler ")]))),_:1},8,["onClick"]),(0,r.bF)(d,{variant:"success",onClick:l.handleConfirm},{default:(0,r.k6)((()=>t[2]||(t[2]=[(0,r.eW)(" Confirmer ")]))),_:1},8,["onClick"])])])],32)):(0,r.Q3)("",!0)}var Rn={components:{ButtonComponent:ke},props:{isVisible:{type:Boolean,required:!0},title:{type:String,default:"Confirmation"},message:{type:String,default:"Êtes-vous sûr de vouloir effectuer cette action ?"}},methods:{handleCancel(){this.$emit("cancel")},handleConfirm(){this.$emit("confirm")}}};const Vn=(0,E.A)(Rn,[["render",Un],["__scopeId","data-v-421ab410"]]);var _n=Vn,Xn={components:{ModalComponent:mt,ButtonComponent:ke,DeleteConfirmationModal:Gt,ConfirmationModal:_n,TourneySubMenu:mo,CardAddComponent:Yt,CardEditComponent:vs,FormComponent:jt,FilterComponent:Ss,TitleComponent:Ls,ErrorMessageComponent:Ga,StatusSelectorComponent:ko},data(){return{BASE_URL:D,tourneyId:this.$route.params.tourneyId,teams:[],unassignedUsers:[],allUsers:[],inviteLink:"",fieldCount:0,showUnassignedModal:!1,showModal:!1,showDeleteConfirmation:!1,showGenerateConfirmationModal:!1,showTeamSetupModal:!1,showModalResetTeams:!1,confirmedDeleteTeamId:null,showDeleteInvalidTeamsModal:!1,newTeam:{teamName:"",type:"player",tourneyId:this.$route.params.tourneyId},editingTeamId:null,isSubmitting:!1,teamSetupConfigured:!1,filters:[{label:"Equipes",value:"",options:[{label:"Toutes les équipes",value:""},{label:"Valides",value:"valid"},{label:"Non valides",value:"invalid"},{label:"Sans pool",value:"noPool"}]}],teamSetup:null,localTeamSetup:null,teamSetupFields:[{name:"maxTeamNumber",label:"Nombre maximum d'équipes",type:"number",required:!0},{name:"playerPerTeam",label:"Nombre de joueurs par équipe",type:"number",required:!0},{name:"minPlayerPerTeam",label:"Nombre minimum de joueurs par équipe",type:"number",required:!0}],registrationStatusOptions:[{value:"draft",label:"Fermées"},{value:"active",label:"Ouvertes"},{value:"completed",label:"Terminées"}],showInviteTokenModal:!1,inviteTokens:[],showValidOnly:!0,showAddTokenForm:!1,inviteTokenForm:{expiresInDays:7},inviteTokenFields:[{name:"expiresInDays",label:"Durée de validité (jours)",type:"number",required:!0,min:1}],searchQuery:""}},computed:{...(0,x.aH)("tourney",{statuses:e=>e.statuses}),currentStatus:{get(){return this.statuses.registrationStatus},set(e){this.$store.dispatch("tourney/updateStatus",{tourneyId:this.tourneyId,key:"registrationStatus",value:e})}},isEditable(){return"completed"!==this.statuses.registrationStatus},isRegistrationActive(){return"active"===this.statuses.registrationStatus},playerTeams(){return this.teams.filter((e=>"player"===e.type))},assistantTeams(){return this.teams.filter((e=>"assistant"===e.type))},invalidTeams(){return this.teamSetupConfigured?this.playerTeams.filter((e=>e.usersTourneys.length<this.teamSetup.minPlayerPerTeam)):[]},filteredPlayerTeams(){if(!this.teamSetupConfigured)return[];let e=this.playerTeams.filter((e=>{const t=this.teamSetup.minPlayerPerTeam;return"valid"===this.filters[0].value?e.usersTourneys.length>=t:"invalid"===this.filters[0].value?e.usersTourneys.length<t:"noPool"!==this.filters[0].value||null===e.poolId}));if(this.searchQuery){const t=this.searchQuery.toLowerCase();e=e.filter((e=>e.usersTourneys.some((e=>e.user.name.toLowerCase().includes(t)||e.user.email&&e.user.email.toLowerCase().includes(t)))))}return e},allDisplayedTeams(){return[...this.assistantTeams,...this.filteredPlayerTeams]},formFields(){return[{name:"teamName",label:"Nom de l'équipe",type:"text",required:!0},{name:"type",label:"Type d'équipe",type:"select",options:[{label:"Assistant",value:"assistant"},{label:"Player",value:"player"}],required:!0}]},filteredSortedInviteTokens(){let e=this.inviteTokens;return this.showValidOnly&&(e=e.filter((e=>e.isValid&&new Date(e.expiresAt)>new Date))),e.sort(((e,t)=>{const s=e.isValid&&new Date(e.expiresAt)>new Date,o=t.isValid&&new Date(t.expiresAt)>new Date;return o-s}))}},methods:{...(0,x.i0)("tourney",["fetchTourneyStatuses","setTournamentName"]),async fetchTourneyDetails(){try{this.fetchTourneyStatuses(this.tourneyId);const e=await $.get(`/tourneys/${this.tourneyId}/teams-details`),{teamSetup:t,teams:s,unassignedUsers:o,allUsers:r,fieldCount:a}=e.data;this.fieldCount=a||0,t&&null!==t.maxTeamNumber&&null!==t.playerPerTeam&&null!==t.minPlayerPerTeam?(this.teamSetup=t,this.teamSetupConfigured=!0):(this.teamSetup=null,this.teamSetupConfigured=!1),this.teams=s,this.unassignedUsers=o,this.allUsers=r}catch(e){console.error("Erreur lors de la récupération des détails du tournoi:",e),we.oR.error("Erreur lors de la récupération des détails du tournoi.")}},async generateTeams(){try{await $.post(`/tourneys/${this.tourneyId}/teams/generate-teams`),we.oR.success("Les équipes manquantes ont été générées avec succès !"),this.fetchTourneyDetails()}catch(e){we.oR.error("Erreur lors de la génération des équipes.")}},async resetTeams(){try{await $.delete(`/tourneys/${this.tourneyId}/teams/reset`),we.oR.success("Les équipes ont été réinitialisées avec succès !"),this.fetchTourneyDetails()}catch(e){we.oR.error("Erreur lors de la réinitialisation des équipes.")}},openInviteTokenModal(){this.showInviteTokenModal=!0},closeInviteTokenModal(){this.showInviteTokenModal=!1,this.showAddTokenForm=!1},async handleGenerateInviteToken(){try{const e=await $.post(`/tourneys/${this.tourneyId}/invite-token`,{expiresInDays:this.inviteTokenForm.expiresInDays});this.inviteLink=`${D}/register?inviteToken=${e.data.token}`,we.oR.success("Lien d'invitation généré avec succès !"),this.showAddTokenForm=!1,this.inviteTokenForm.expiresInDays=7,this.fetchInviteTokens()}catch(e){console.error("Erreur lors de la génération du token:",e),we.oR.error("Erreur lors de la génération du token.")}},async invalidateToken(e){try{await $.patch(`/tourneys/${this.tourneyId}/invite-token/${e}/invalidate`),we.oR.success("Token invalidé avec succès."),this.fetchInviteTokens()}catch(t){console.error("Erreur lors de l'invalidation du token:",t),we.oR.error("Erreur lors de l'invalidation du token.")}},async validateToken(e){try{await $.patch(`/tourneys/${this.tourneyId}/invite-token/${e}/validate`),we.oR.success("Token validé avec succès."),this.fetchInviteTokens()}catch(t){console.error("Erreur lors de la validation du token:",t),we.oR.error("Erreur lors de la validation du token.")}},async fetchInviteTokens(){try{const e=await $.get(`/tourneys/${this.tourneyId}/invite-token`);this.inviteTokens=e.data.inviteTokens}catch(e){console.error("Erreur lors de la récupération des tokens:",e),we.oR.error("Erreur lors de la récupération des tokens.")}},copyToClipboard(e){navigator.clipboard.writeText(`${D}/register?inviteToken=${e}`),we.oR.success("Lien copié dans le presse-papiers !")},toggleValidOnly(){this.showValidOnly=!this.showValidOnly},handleFilterChange(e){this.filters[0].value=e.value},getStatusColor(e){if(!this.teamSetupConfigured)return"gray";const t=this.teamSetup.playerPerTeam||e.maxPlayers,s=this.teamSetup.minPlayerPerTeam;return e.usersTourneys.length>t&&"assistant"!==e.type?"red":"assistant"===e.type?"purple":e.usersTourneys.length>=s?"green":e.usersTourneys.length>0?"orange":"gray"},navigateToUnassignedUsers(){this.$router.push(`/admin/tourneys/${this.tourneyId}/unassigned-users`)},openAddTeamModal(){this.editingTeamId=null,this.newTeam={teamName:"",type:"player",tourneyId:this.tourneyId},this.showModal=!0},editTeam(e){this.editingTeamId=e.id,this.newTeam={...e},this.showModal=!0},openTeamDetails(e){this.$router.push(`/admin/tourneys/${this.tourneyId}/teams/${e.id}/users`)},confirmDeleteTeam(e){this.confirmedDeleteTeamId=e,this.showDeleteConfirmation=!0},async deleteTeam(e){try{await $.delete(`/tourneys/${this.tourneyId}/teams/${e}`),we.oR.success("Equipe supprimée avec succès !"),this.fetchTourneyDetails(),this.closeDeleteConfirmation()}catch(t){we.oR.error("Erreur lors de la suppression de l'équipe.")}},openModalResetTeams(){this.showModalResetTeams=!0},closeModalResetTeams(){this.showModalResetTeams=!1},openDeleteInvalidTeamsModal(){this.showDeleteInvalidTeamsModal=!0},closeDeleteInvalidTeamsModal(){this.showDeleteInvalidTeamsModal=!1},async deleteInvalidTeams(){try{await $.delete(`/tourneys/${this.tourneyId}/teams/invalid`),we.oR.success("Les équipes invalides ont été supprimées avec succès !"),this.fetchTourneyDetails(),this.closeDeleteInvalidTeamsModal()}catch(e){console.error("Erreur lors de la suppression des équipes invalides:",e),we.oR.error("Erreur lors de la suppression des équipes invalides."),this.closeDeleteInvalidTeamsModal()}},async handleResetAllTeamsSubmit(){await this.resetTeams(),this.closeModalResetTeams()},customTeamSetupValidation(){const e={},{minPlayerPerTeam:t,playerPerTeam:s}=this.localTeamSetup;return"number"===typeof t&&"number"===typeof s?t>s&&(e.minPlayerPerTeam="Le nombre minimum de joueurs par équipe doit être inférieur ou égal au nombre de joueurs par équipe."):t>s&&(e.minPlayerPerTeam="Veuillez entrer des nombres valides pour les joueurs par équipe."),e},async handleTeamSetupSubmit(){const e=this.teamSetupConfigured,t={...this.localTeamSetup};try{e?await $.put(`/tourneys/${this.tourneyId}/team-setup`,t):await $.post(`/tourneys/${this.tourneyId}/team-setup`,t),this.teamSetup={...t},this.teamSetupConfigured=!0,we.oR.success("Configuration des équipes enregistrée avec succès !"),this.closeTeamSetupModal(),this.fetchTourneyDetails()}catch(s){console.error("Erreur lors de la configuration des équipes:",s),we.oR.error("Erreur lors de la configuration des équipes.")}},sendEmailToAll(){const e=this.allUsers.map((e=>e.user.email)).filter((e=>e));if(0===e.length)return void we.oR.error("Il n'y a aucun utilisateur pour envoyer un email.");const t=`mailto:${e.join(",")}`;window.location.href=t},closeDeleteConfirmation(){this.showDeleteConfirmation=!1,this.confirmedDeleteTeamId=null},closeModal(){this.showModal=!1,this.editingTeamId=null},openTeamSetupModal(){this.teamSetupConfigured&&this.teamSetup?this.localTeamSetup={...this.teamSetup}:this.localTeamSetup={maxTeamNumber:4*this.fieldCount||1,playerPerTeam:4,minPlayerPerTeam:3},this.showTeamSetupModal=!0},closeTeamSetupModal(){this.showTeamSetupModal=!1},async handleFormSubmit(){if(!this.isSubmitting){this.isSubmitting=!0;try{const e={teamName:this.newTeam.teamName,type:this.newTeam.type,tourneyId:this.tourneyId};this.editingTeamId?await $.put(`/tourneys/${this.tourneyId}/teams/${this.editingTeamId}`,e):await $.post(`/tourneys/${this.tourneyId}/teams`,e),we.oR.success(`Equipe ${this.editingTeamId?"modifiée":"ajoutée"} avec succès !`),this.fetchTourneyDetails()}catch(e){console.error("Erreur lors de l'enregistrement de l'équipe:",e),we.oR.error("Erreur lors de l'enregistrement de l'équipe.")}finally{this.isSubmitting=!1,this.closeModal()}}},openGenerateConfirmationModal(){this.showGenerateConfirmationModal=!0},closeGenerateConfirmationModal(){this.showGenerateConfirmationModal=!1},async confirmGenerateTeams(){this.showGenerateConfirmationModal=!1,await this.generateTeams()}},mounted(){this.fetchTourneyDetails(),this.fetchInviteTokens()}};const qn=(0,E.A)(Xn,[["render",An],["__scopeId","data-v-235de7f1"]]);var Nn=qn;const Bn={class:"mx-auto p-4"},Wn={class:"hidden sm:inline"};function jn(e,t,s,o,n,i){const l=(0,r.g2)("ButtonComponent"),d=(0,r.g2)("ListUsersTable");return(0,r.uX)(),(0,r.CE)("div",Bn,[(0,r.bF)(d,{title:"Utilisateurs sans groupe",users:n.unassignedUsers,teams:n.teams,"team-setup":n.teamSetup,"enable-assign-team":!0,"allow-assign-to-other-teams":!0,"selected-team-ids":n.selectedTeamIds,"available-teams":i.availableTeams,"onUpdate:selectedTeamIds":t[1]||(t[1]=e=>n.selectedTeamIds=e),onAssignTeam:i.handleAssignTeam,onDeleteUser:i.handleDeleteUser,onGoBack:i.goBackToTeams},{"header-buttons":(0,r.k6)((()=>[i.hasAvailableTeams&&n.unassignedUsers.length>0?((0,r.uX)(),(0,r.Wv)(l,{key:0,variant:(n.isAutoFilled,"algo"),fontAwesomeIcon:"cog",onClick:t[0]||(t[0]=e=>n.isAutoFilled?i.handleValidateAssignments():i.autoFillGroups())},{default:(0,r.k6)((()=>[(0,r.Lk)("span",Wn,(0,a.v_)(n.isAutoFilled?"Valider":"Assignation Automatique"),1)])),_:1},8,["variant"])):(0,r.Q3)("",!0),n.isAutoFilled?((0,r.uX)(),(0,r.Wv)(l,{key:1,variant:"secondary",onClick:i.cancelAutoFill},{default:(0,r.k6)((()=>t[2]||(t[2]=[(0,r.Lk)("span",{class:"hidden sm:inline"},"Annuler",-1)]))),_:1},8,["onClick"])):(0,r.Q3)("",!0)])),_:1},8,["users","teams","team-setup","selected-team-ids","available-teams","onAssignTeam","onDeleteUser","onGoBack"])])}var Qn={components:{ListUsersTable:Dr,ButtonComponent:ke},data(){return{unassignedUsers:[],teams:[],teamSetup:null,isAutoFilled:!1,initialSelectedTeamIds:{},selectedTeamIds:{}}},computed:{hasAvailableTeams(){return this.availableTeams.length>0},availableTeams(){if(!this.teamSetup)return[];const e=this.unassignedUsers.map((e=>e.teamId)).filter((e=>null!=e));return this.teams.filter((t=>{const s=e.includes(t.id),o=(t.usersTourneys?t.usersTourneys.length:0)<this.getTeamCapacity(t);return s||o}))}},async created(){await this.fetchData()},methods:{getTeamCapacity(e){return"assistant"===e.type?this.teamSetup.playerPerTeam*this.teamSetup.maxTeamNumber:this.teamSetup.playerPerTeam},async fetchData(){const e=this.$route.params.tourneyId;try{const t=await $.get(`/tourneys/${e}/teams-details`),s=t.data;this.unassignedUsers=s.unassignedUsers.map((e=>e.user)),this.teams=s.teams,this.teamSetup=s.teamSetup,this.selectedTeamIds={},this.unassignedUsers.forEach((e=>{e.teamId&&(this.selectedTeamIds[e.id]=e.teamId)}))}catch(t){console.error("Erreur lors de la récupération des détails du tournoi:",t)}},async handleAssignTeam({userId:e,teamId:t}){const s=this.$route.params.tourneyId;try{await $.post(`/tourneys/${s}/users/${e}/teams`,{teamId:t}),await this.fetchData(),we.oR.success("Utilisateur assigné avec succès à l'équipe.")}catch(o){console.error("Erreur lors de l'assignation de l'équipe:",o),we.oR.error("Une erreur est survenue lors de l'assignation de l'équipe.")}},async handleDeleteUser(e){const t=this.$route.params.tourneyId;try{await $.delete(`/tourneys/${t}/users/${e}`),await this.fetchData(),we.oR.success("Utilisateur supprimé avec succès.")}catch(s){console.error("Erreur lors de la suppression de l'utilisateur:",s),we.oR.error("Une erreur est survenue lors de la suppression de l'utilisateur.")}},goBackToTeams(){this.$router.push(`/admin/tourneys/${this.$route.params.tourneyId}/teams`)},async handleValidateAssignments(){const e=Object.entries(this.selectedTeamIds).filter((([,e])=>null!==e&&void 0!==e)).map((([e,t])=>({userId:Number(e),teamId:t}))),t=this.$route.params.tourneyId;try{await $.post(`/tourneys/${t}/teams/auto-fill`,{assignments:e}),await this.fetchData(),we.oR.success("Affectations validées avec succès."),this.isAutoFilled=!1,this.initialSelectedTeamIds={}}catch(s){console.error("Erreur lors de la validation des affectations:",s),we.oR.error("Une erreur est survenue lors de la validation des affectations.")}},autoFillGroups(){this.initialSelectedTeamIds={...this.selectedTeamIds};let e=[...this.unassignedUsers],t=null,s=[];this.teams.forEach((e=>{"assistant"===e.type?t={...e,assignedUsers:e.usersTourneys?[...e.usersTourneys]:[]}:s.push({...e,assignedUsers:e.usersTourneys?[...e.usersTourneys]:[]})}));const o=(t,s)=>{const o=e.splice(0,s);t.assignedUsers.push(...o),o.forEach((e=>{this.selectedTeamIds={...this.selectedTeamIds,[e.id]:t.id}}))};s.filter((e=>e.assignedUsers.length>0&&e.assignedUsers.length<this.teamSetup.minPlayerPerTeam)).forEach((t=>{const s=this.teamSetup.minPlayerPerTeam-t.assignedUsers.length;o(t,Math.min(s,e.length))}));const r=s.filter((e=>0===e.assignedUsers.length)),a=Math.floor(e.length/this.teamSetup.minPlayerPerTeam),n=r.slice(0,a);n.forEach((e=>{o(e,this.teamSetup.minPlayerPerTeam)}));let i=!0;while(e.length>0&&i){i=!1;for(const t of s)if(t.assignedUsers.length>=this.teamSetup.minPlayerPerTeam&&t.assignedUsers.length<this.teamSetup.playerPerTeam&&e.length>0&&(o(t,1),i=!0,0===e.length))break}if(e.length>0){if(!t)return void we.oR.error("Aucune équipe 'assistant' disponible pour les utilisateurs restants.");o(t,e.length)}this.isAutoFilled=!0},cancelAutoFill(){this.selectedTeamIds={...this.initialSelectedTeamIds},this.isAutoFilled=!1}}};const On=(0,E.A)(Qn,[["render",jn]]);var Gn=On;const zn={key:0,class:"mx-auto p-4"},Hn={key:0,class:"mt-4"},Kn={class:"flex items-center space-x-2"};function Jn(e,t,s,o,a,n){const i=(0,r.g2)("ListUsersTable"),l=(0,r.g2)("v-select"),d=(0,r.g2)("ButtonComponent"),u=(0,r.g2)("ErrorMessageComponent");return a.team?((0,r.uX)(),(0,r.CE)("div",zn,[(0,r.bF)(i,{title:`${a.team.teamName} - ${a.teamUsers.length}/${n.getTeamCapacity(a.team)}${"assistant"!==a.team.type?` (min: ${a.teamSetup.minPlayerPerTeam})`:""}`,users:a.teamUsers,teams:a.teams,"team-setup":a.teamSetup,isAssigned:!0,"enable-auto-fill":!1,"enable-assign-team":n.isEditable,"allow-assign-to-other-teams":n.isEditable,"enable-remove-user":n.isEditable,"back-button-text":"Retour aux équipes","delete-modal-title":"Confirmer le retrait","delete-modal-message":"Êtes-vous sûr de vouloir retirer cet utilisateur de la team ?","selected-team-ids":a.selectedTeamIds,"onUpdate:selectedTeamIds":t[0]||(t[0]=e=>a.selectedTeamIds=e),onAssignTeam:n.handleAssignTeam,onDeleteUser:n.handleRemoveUser,onGoBack:n.goBackToTeams},null,8,["title","users","teams","team-setup","enable-assign-team","allow-assign-to-other-teams","enable-remove-user","selected-team-ids","onAssignTeam","onDeleteUser","onGoBack"]),n.teamNotFull&&a.unassignedUsers.length>0?((0,r.uX)(),(0,r.CE)("div",Hn,[(0,r.Lk)("div",Kn,[(0,r.bF)(l,{modelValue:a.selectedUnassignedUserId,"onUpdate:modelValue":t[1]||(t[1]=e=>a.selectedUnassignedUserId=e),options:a.unassignedUsers,reduce:e=>e.id,label:"name",placeholder:"Ajouter un utilisateur",class:"w-64",appendToBody:""},null,8,["modelValue","options","reduce"]),(0,r.bF)(d,{variant:"primary",size:"sm",onClick:n.assignUnassignedUserToTeam,disabled:!a.selectedUnassignedUserId},{default:(0,r.k6)((()=>t[2]||(t[2]=[(0,r.Lk)("span",{class:"hidden sm:inline"},"Ajouter",-1)]))),_:1},8,["onClick","disabled"])])])):(0,r.Q3)("",!0),n.isTeamValid||n.hasUnassignedUsers||"assistant"===a.team.type?!n.isTeamValid&&n.hasUnassignedUsers&&"assistant"!==a.team.type?((0,r.uX)(),(0,r.Wv)(u,{key:2,message:"L'équipe n'est pas valide. Veuillez ajouter des utilisateurs à l'équipe."})):(0,r.Q3)("",!0):((0,r.uX)(),(0,r.Wv)(u,{key:1,message:"L'équipe n'est pas valide et il n'y a pas d'utilisateurs à assigner. Veuillez créer de nouveaux utilisateurs ou réassigner des utilisateurs d'autres équipes."}))])):(0,r.Q3)("",!0)}var Yn={components:{ListUsersTable:Dr,ButtonComponent:ke,ErrorMessageComponent:Ga},data(){return{team:null,teamUsers:[],teams:[],teamSetup:null,unassignedUsers:[],selectedUnassignedUserId:null,selectedTeamIds:{},isAutoFilled:!1,initialSelectedTeamIds:{}}},computed:{...(0,x.aH)("tourney",{statuses:e=>e.statuses}),currentStatus:{get(){return this.statuses.registrationStatus},set(e){this.$store.dispatch("tourney/updateStatus",{tourneyId:this.tourneyId,key:"registrationStatus",value:e})}},isEditable(){return"completed"!==this.statuses.registrationStatus},teamNotFull(){return!!this.team&&this.teamUsers.length<this.getTeamCapacity(this.team)},isTeamValid(){if(!this.teamSetup||!this.team)return!1;const e=this.teamSetup.minPlayerPerTeam;return this.teamUsers.length>=e},hasUnassignedUsers(){return this.unassignedUsers.length>0},hasAvailableTeams(){return this.availableTeams.length>0},availableTeams(){if(!this.teamSetup)return[];const e=this.unassignedUsers.map((e=>e.teamId)).filter((e=>null!=e));return this.teams.filter((t=>{const s=e.includes(t.id),o=(t.usersTourneys?t.usersTourneys.length:0)<this.getTeamCapacity(t);return s||o}))},teamOptions(){return this.availableTeams.map((e=>{const t=this.getTeamCapacity(e);return{id:e.id,teamName:`${e.teamName} (${e.usersTourneys.length}/${t})`}}))}},async created(){await this.fetchData()},methods:{async fetchData(){const e=this.$route.params.tourneyId,t=this.$route.params.teamId;try{const s=await $.get(`/tourneys/${e}/teams-details`),o=s.data;if(this.teamSetup=o.teamSetup,this.teams=o.teams,this.unassignedUsers=o.unassignedUsers.filter((e=>1!==e.user.role.id)).map((e=>e.user)),this.team=this.teams.find((e=>e.id===parseInt(t))),!this.team)return we.oR.error("Équipe introuvable."),void this.goBackToTeams();this.team.usersTourneys&&Array.isArray(this.team.usersTourneys)?this.teamUsers=this.team.usersTourneys.map((e=>e.user)).filter((e=>null!=e)):this.teamUsers=[],this.selectedTeamIds={},this.teamUsers.forEach((e=>{e.teamId&&(this.selectedTeamIds[e.id]=e.teamId)}))}catch(s){console.error("Erreur lors de la récupération des détails du tournoi:",s),we.oR.error("Une erreur est survenue lors de la récupération des données."),this.goBackToTeams()}},getTeamCapacity(e){return"assistant"===e.type?this.teamSetup.playerPerTeam*this.teamSetup.maxTeamNumber:this.teamSetup.playerPerTeam},async handleAssignTeam({userId:e,teamId:t}){const s=this.$route.params.tourneyId;try{await $.post(`/tourneys/${s}/users/${e}/teams`,{teamId:t}),await this.fetchData(),we.oR.success("Utilisateur assigné avec succès à l'équipe.")}catch(o){console.error("Erreur lors de l'assignation de l'équipe:",o),we.oR.error("Une erreur est survenue lors de l'assignation de l'équipe.")}},async handleRemoveUser(e){const t=this.$route.params.tourneyId,s=this.$route.params.teamId;try{await $.delete(`/tourneys/${t}/teams/${s}/users/${e}`),await this.fetchData(),we.oR.success("Utilisateur retiré de l'équipe avec succès.")}catch(o){console.error("Erreur lors du retrait de l'utilisateur de l'équipe:",o),we.oR.error("Une erreur est survenue lors du retrait de l'utilisateur de l'équipe.")}},async assignUnassignedUserToTeam(){const e=this.$route.params.tourneyId,t=this.$route.params.teamId,s=this.selectedUnassignedUserId;try{await $.post(`/tourneys/${e}/users/${s}/teams`,{teamId:t}),await this.fetchData(),this.selectedUnassignedUserId=null,we.oR.success("Utilisateur ajouté à l'équipe avec succès.")}catch(o){console.error("Erreur lors de l'ajout de l'utilisateur à l'équipe:",o),we.oR.error("Une erreur est survenue lors de l'ajout de l'utilisateur à l'équipe.")}},goBackToTeams(){this.$router.push(`/admin/tourneys/${this.$route.params.tourneyId}/teams`)}}};const Zn=(0,E.A)(Yn,[["render",Jn]]);var ei=Zn;const ti={class:"p-6"},si={class:"flex items-center mb-8 justify-between"},oi={class:"flex items-center"},ri={class:"flex justify-end"},ai={class:"flex items-center"},ni={key:0,class:"mb-4 p-3 bg-blue-100 border border-blue-300 rounded-lg text-blue-800 dark:bg-blue-900 dark:border-blue-700 dark:text-blue-300"},ii={class:"flex justify-between items-center"},li={class:"mt-2 space-y-2"},di={class:"font-semibold"},ui={class:"block mt-1 text-light-form-text dark:text-dark-form-text"},ci={class:"flex items-center space-x-2 w-full md:w-auto"},mi={class:"hidden sm:inline"},hi={class:"grid grid-cols-2 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-6 gap-4 mt-6"},pi={class:"grid grid-cols-1 gap-2 mt-2"},gi={class:"truncate"},fi={key:0,class:"text-sm text-light-pool-text dark:text-dark-pool-text"},yi={class:"mt-2 text-sm text-light-pool-text dark:text-dark-pool-text"};function vi(e,t,s,o,n,i){const l=(0,r.g2)("TourneySubMenu"),d=(0,r.g2)("TitleComponent"),u=(0,r.g2)("ButtonComponent"),c=(0,r.g2)("StatusSelectorComponent"),m=(0,r.g2)("FilterComponent"),h=(0,r.g2)("CardAddComponent"),p=(0,r.g2)("font-awesome-icon"),g=(0,r.g2)("CardEditComponent"),f=(0,r.g2)("FormComponent"),y=(0,r.g2)("ModalComponent"),v=(0,r.g2)("DeleteConfirmationModal"),b=(0,r.g2)("ConfirmationModal"),k=(0,r.g2)("StrategyPoolGeneratorComponent");return(0,r.uX)(),(0,r.CE)("div",null,[(0,r.bF)(l,{tourneyId:n.tourneyId},null,8,["tourneyId"]),(0,r.Lk)("div",ti,[(0,r.Lk)("div",si,[(0,r.Lk)("div",oi,[(0,r.bF)(d,{title:"Gestion des Pools"}),i.isEditable?((0,r.uX)(),(0,r.Wv)(u,{key:0,fontAwesomeIcon:"cog",onClick:i.openPoolSetupModal,variant:"secondary",class:"ml-2"},{default:(0,r.k6)((()=>t[5]||(t[5]=[(0,r.Lk)("span",{class:"hidden sm:inline"},"Global Config Pools",-1)]))),_:1},8,["onClick"])):(0,r.Q3)("",!0),(0,r.Lk)("div",ri,[i.isEditable?((0,r.uX)(),(0,r.Wv)(u,{key:0,variant:"algo",fontAwesomeIcon:"cog",onClick:i.openGeneratePoolsModal},{default:(0,r.k6)((()=>t[6]||(t[6]=[(0,r.Lk)("span",{class:"hidden sm:inline"}," Générer Pools auto. ",-1)]))),_:1},8,["onClick"])):(0,r.Q3)("",!0)]),i.isEditable&&n.pools.length>0?((0,r.uX)(),(0,r.Wv)(u,{key:1,variant:"danger",fontAwesomeIcon:"trash",onClick:i.confirmDeleteAllPools},{default:(0,r.k6)((()=>t[7]||(t[7]=[(0,r.Lk)("span",{class:"hidden sm:inline"}," Supprimer les Pools ",-1)]))),_:1},8,["onClick"])):(0,r.Q3)("",!0)]),(0,r.Lk)("div",ai,[(0,r.bF)(c,{tourneyId:n.tourneyId,label:"Pools:",statusKey:"poolStatus",statusOptions:n.poolStatusOptions,modelValue:i.currentStatus,"onUpdate:modelValue":t[0]||(t[0]=e=>i.currentStatus=e)},null,8,["tourneyId","statusOptions","modelValue"])])]),n.showWarnings&&i.warningMessages.length>0?((0,r.uX)(),(0,r.CE)("div",ni,[(0,r.Lk)("div",ii,[t[8]||(t[8]=(0,r.Lk)("span",{class:"font-bold text-lg"},"Informations importantes",-1)),(0,r.Lk)("button",{class:"text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-200",onClick:t[1]||(t[1]=(...e)=>i.dismissWarnings&&i.dismissWarnings(...e))}," Fermer ")]),(0,r.Lk)("ul",li,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.warningMessages,(e=>((0,r.uX)(),(0,r.CE)("li",{key:e.id,class:"flex items-start space-x-2 text-sm"},[(0,r.Lk)("span",{class:(0,a.C4)({"text-red-600":"error"===e.type,"text-yellow-600":"warning"===e.type,"text-green-600":"info"===e.type})}," • ",2),(0,r.Lk)("div",null,[(0,r.Lk)("span",di,(0,a.v_)(e.title)+" :",1),(0,r.Lk)("span",null,(0,a.v_)(e.description),1),(0,r.Lk)("span",ui,(0,a.v_)(e.recommendation),1)])])))),128))])])):(0,r.Q3)("",!0),(0,r.Lk)("div",ci,[(0,r.bF)(m,{filters:n.filters,onFilterChange:i.handleFilterChange},null,8,["filters","onFilterChange"]),i.isEditable&&i.unassignedTeams.length>0?((0,r.uX)(),(0,r.Wv)(u,{key:0,onClick:i.navigateToAssignTeams,variant:"primary",fontAwesomeIcon:"users",class:"ml-2"},{default:(0,r.k6)((()=>[(0,r.Lk)("span",mi," Assigner Équipes ("+(0,a.v_)(i.unassignedTeams.length)+") ",1)])),_:1},8,["onClick"])):(0,r.Q3)("",!0),i.isEditable&&i.canAddMorePools?((0,r.uX)(),(0,r.Wv)(u,{key:1,onClick:i.generateMissingPools,variant:"algo",fontAwesomeIcon:"plus",class:"ml-2"},{default:(0,r.k6)((()=>t[9]||(t[9]=[(0,r.Lk)("span",{class:"hidden sm:inline"},"Générer Pools manquantes",-1)]))),_:1},8,["onClick"])):(0,r.Q3)("",!0),i.isEditable&&i.unassignedTeams.length>0?((0,r.uX)(),(0,r.Wv)(u,{key:2,onClick:i.openConfirmationModal,variant:"algo",fontAwesomeIcon:"users",class:"ml-2",disabled:i.allPoolsComplete||0===i.unassignedTeams.length},{default:(0,r.k6)((()=>t[10]||(t[10]=[(0,r.Lk)("span",{class:"hidden sm:inline"},"Peupler Pools Auto.",-1)]))),_:1},8,["onClick","disabled"])):(0,r.Q3)("",!0),i.isEditable&&i.teamsAssignedToPools.length>0?((0,r.uX)(),(0,r.Wv)(u,{key:3,onClick:i.confirmRemoveAllTeamsFromPools,variant:"danger",fontAwesomeIcon:"users-slash",class:"ml-2"},{default:(0,r.k6)((()=>t[11]||(t[11]=[(0,r.Lk)("span",{class:"hidden sm:inline"},"Retirer toutes les équipes des Pools",-1)]))),_:1},8,["onClick"])):(0,r.Q3)("",!0)]),(0,r.Lk)("div",hi,[i.isEditable&&i.canAddMorePools?((0,r.uX)(),(0,r.Wv)(h,{key:0,title:"Pool",onOpenAddElementModal:i.openAddPoolModal},null,8,["onOpenAddElementModal"])):(0,r.Q3)("",!0),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.filteredPools,(e=>((0,r.uX)(),(0,r.Wv)(g,{key:e.id,title:e.name,cornerCount:`${e.teams.length}/${e.maxTeamPerPool||n.tourneySetup.defaultMaxTeamPerPool||"∞"} Équipes`,titleColor:i.getPoolStatusColor(e),showDeleteButton:i.isEditable,showEditButton:i.isEditable,onDelete:t=>i.confirmDeletePool(e.id),onEdit:t=>i.editPool(e),onClick:t=>i.openPoolDetails(e)},{"user-list":(0,r.k6)((()=>[(0,r.Lk)("ul",pi,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.teams.slice(0,4),(e=>((0,r.uX)(),(0,r.CE)("li",{key:e.id,class:"flex items-center text-sm text-light-form-text dark:text-dark-form-text truncate"},[(0,r.bF)(p,{icon:"users",class:"mr-2 text-light-pool-text dark:text-dark-pool-text"}),(0,r.Lk)("span",gi,(0,a.v_)(e.teamName),1)])))),128)),e.teams.length>4?((0,r.uX)(),(0,r.CE)("li",fi," + "+(0,a.v_)(e.teams.length-4)+" autres ",1)):(0,r.Q3)("",!0)]),(0,r.Lk)("div",yi," Sessions programmées : "+(0,a.v_)(e.schedulesCount||0),1)])),_:2},1032,["title","cornerCount","titleColor","showDeleteButton","showEditButton","onDelete","onEdit","onClick"])))),128))]),(0,r.bF)(y,{isVisible:n.showModal,title:n.editingPoolId?"Modifier Pool":"Ajouter une nouvelle Pool",onClose:i.closeModal},{content:(0,r.k6)((()=>[(0,r.bF)(f,{modelValue:n.newPool,"onUpdate:modelValue":t[2]||(t[2]=e=>n.newPool=e),fields:n.formFields,isEditing:!!n.editingPoolId,onFormSubmit:i.handleFormSubmit,onFormCancel:i.closeModal},null,8,["modelValue","fields","isEditing","onFormSubmit","onFormCancel"])])),_:1},8,["isVisible","title","onClose"]),(0,r.bF)(v,{isVisible:n.showDeleteConfirmation,isHardDelete:!1,title:"Supprimer Pool",message:"Êtes-vous sûr de vouloir supprimer cette pool ?",onFormCancel:i.closeDeleteConfirmation,onConfirm:t[3]||(t[3]=e=>i.deletePool(n.confirmedDeletePoolId))},null,8,["isVisible","onFormCancel"]),(0,r.bF)(y,{isVisible:n.showPoolSetupModal,title:"Réglages des Pools",onClose:i.closePoolSetupModal},{content:(0,r.k6)((()=>[(0,r.bF)(f,{modelValue:n.localPoolSetup,"onUpdate:modelValue":t[4]||(t[4]=e=>n.localPoolSetup=e),fields:n.poolSetupFields,isEditing:!0,onFormSubmit:i.handlePoolSetupSubmit,onFormCancel:i.closePoolSetupModal,customValidation:i.customPoolSetupValidation},null,8,["modelValue","fields","onFormSubmit","onFormCancel","customValidation"])])),_:1},8,["isVisible","onClose"]),(0,r.bF)(b,{isVisible:n.showConfirmationModal,title:"Confirmation de Peuplement",message:"Êtes-vous sûr de vouloir peupler automatiquement les pools avec les équipes non assignées ?",onConfirm:i.populatePoolsWithUnassignedTeams,onCancel:i.closeConfirmationModal},null,8,["isVisible","onConfirm","onCancel"]),(0,r.bF)(v,{isVisible:n.showRemoveTeamsConfirmation,isHardDelete:!1,title:"Retirer toutes les équipes des Pools",message:"Êtes-vous sûr de vouloir retirer toutes les équipes des pools ?",onFormCancel:i.closeRemoveTeamsConfirmation,onConfirm:i.removeAllTeamsFromPools},null,8,["isVisible","onFormCancel","onConfirm"]),n.showGeneratePoolsModal?((0,r.uX)(),(0,r.Wv)(k,{key:1,tourneyId:n.tourneyId,tourneyType:e.tourneyType,teams:n.teams,pools:n.pools,availableFields:n.availableFields,onPoolsGenerated:i.handlePoolsGenerated,onClose:i.closeGeneratePoolsModal},null,8,["tourneyId","tourneyType","teams","pools","availableFields","onPoolsGenerated","onClose"])):(0,r.Q3)("",!0),(0,r.bF)(v,{isVisible:n.showDeleteAllConfirmation,isHardDelete:!0,title:"Supprimer toutes les Pools",message:"Êtes-vous sûr de vouloir supprimer toutes les pools ? Cette action est irréversible.",onFormCancel:i.closeDeleteAllConfirmation,onConfirm:i.deleteAllPools},{message:(0,r.k6)((()=>t[12]||(t[12]=[(0,r.eW)(" Êtes-vous sûr de vouloir supprimer toutes les pools ? Cette action est irréversible. ")]))),_:1},8,["isVisible","onFormCancel","onConfirm"])])])}function bi(e,t,s,o,a,n){const i=(0,r.g2)("ButtonComponent"),l=(0,r.g2)("ModalComponent");return(0,r.uX)(),(0,r.Wv)(l,{isVisible:s.isVisible,title:"Générer des Pools",onClose:n.handleClose},{content:(0,r.k6)((()=>[((0,r.uX)(),(0,r.Wv)((0,r.$y)(n.currentStrategyComponent),{ref:"strategyComponent",tourneyId:s.tourneyId,teams:s.teams,pools:s.pools,availableFields:s.availableFields},null,8,["tourneyId","teams","pools","availableFields"]))])),footer:(0,r.k6)((()=>[(0,r.bF)(i,{variant:"secondary",onClick:n.handleClose},{default:(0,r.k6)((()=>t[0]||(t[0]=[(0,r.eW)(" Annuler ")]))),_:1},8,["onClick"]),(0,r.bF)(i,{variant:"primary",onClick:n.generatePools},{default:(0,r.k6)((()=>t[1]||(t[1]=[(0,r.eW)(" Générer ")]))),_:1},8,["onClick"])])),_:1},8,["isVisible","onClose"])}function ki(e,t,s,o,a,n){return(0,r.uX)(),(0,r.CE)("div",null,t[0]||(t[0]=[(0,r.Lk)("p",{class:"mb-4 text-light-form-text dark:text-dark-form-text"},[(0,r.Lk)("span",{class:"text-light-form-error dark:text-dark-form-error font-bold"},[(0,r.Lk)("strong",null,"Attention :"),(0,r.eW)(" Les pools existantes et les plannings associés seront supprimés. Il est préférable d'effectuer cette action une fois les inscriptions terminées. ")]),(0,r.Lk)("br"),(0,r.eW)(" Cet algorithme (custom round robin) va générer des pools et assigner les équipes du tournoi aux pools de manière optimisée, en prenant en compte le nombre de terrains disponibles ainsi que les réglages. "),(0,r.Lk)("strong",null,"Il ne va jamais générer plus de Pools qu'il n'y a de terrains"),(0,r.eW)("."),(0,r.Lk)("br")],-1)]))}var Ti={props:{tourneyId:{type:String,required:!0},teams:{type:Array,required:!0},pools:{type:Array,required:!0},availableFields:{type:Number,required:!0}},methods:{async generatePools(){try{const e=await $.post(`/tourneys/${this.tourneyId}/pools/generate`),{pools:t,teamsWithoutPool:s}=e.data,o=t.length,r=s.length;return we.oR.success(`Pools générées avec succès ! ${o} pools ont été créées.`,{autoClose:3e3}),r>0&&we.oR.warning(`${r} équipes n'ont pas pu être assignées aux Pools.`,{autoClose:4e3}),!0}catch(e){console.error("Erreur lors de la génération des pools :",e);const t=e.response?.data?.message||"Erreur lors de la génération des pools.";return we.oR.error(t),!1}}}};const Ci=(0,E.A)(Ti,[["render",ki]]);var xi=Ci,wi={components:{CustomRoundRobinStrategy:xi,ModalComponent:mt,ButtonComponent:ke},props:{tourneyId:{type:String,required:!0},tourneyType:{type:String,required:!1},teams:{type:Array,required:!1},pools:{type:Array,required:!1},availableFields:{type:Number,required:!1},isVisible:{type:Boolean,default:!0}},computed:{currentStrategyComponent(){switch(this.tourneyType){case"customRoundRobin":return"CustomRoundRobinStrategy";default:return"CustomRoundRobinStrategy"}}},methods:{handleClose(){this.$emit("close")},async generatePools(){const e=await this.$refs.strategyComponent.generatePools();e&&(this.$emit("poolsGenerated"),this.handleClose())}}};const Ei=(0,E.A)(wi,[["render",bi]]);var Ii=Ei,Si={components:{ModalComponent:mt,ButtonComponent:ke,DeleteConfirmationModal:Gt,TourneySubMenu:mo,CardAddComponent:Yt,CardEditComponent:vs,FormComponent:jt,TitleComponent:Ls,StatusSelectorComponent:ko,FilterComponent:Ss,StrategyPoolGeneratorComponent:Ii,ConfirmationModal:_n},data(){return{tourneyId:this.$route.params.tourneyId,pools:[],teams:[],showModal:!1,showConfirmationModal:!1,showDeleteConfirmation:!1,showDeleteAllConfirmation:!1,showPoolSetupModal:!1,confirmedDeletePoolId:null,newPool:{name:"",tourneyId:this.$route.params.tourneyId},editingPoolId:null,isSubmitting:!1,localPoolSetup:{minTeamPerPool:null,maxTeamPerPool:null},showGeneratePoolsModal:!1,showRemoveTeamsConfirmation:!1,availableFields:0,desiredPoolCount:null,tourneySetup:{maxNumberOfPools:0,defaultMinTeamPerPool:0,defaultMaxTeamPerPool:0},formFields:[{name:"name",label:"Nom de la Pool",type:"text",required:!0},{name:"stage",label:"Stade",placeholder:"Demi-finale, Finale, etc.",type:"text",required:!1},{name:"maxTeamPerPool",label:"Nombre maximum d'équipes par pool",type:"number",required:!1},{name:"minTeamPerPool",label:"Nombre minimum d'équipes par pool",type:"number",required:!1}],poolSetupFields:[{name:"maxNumberOfPools",label:"Nombre maximum de pools",type:"number",required:!0},{name:"defaultMinTeamPerPool",label:"Nombre min. d'équipes par pool",type:"number",required:!0},{name:"defaultMaxTeamPerPool",label:"Nombre max. d'équipes par pool",type:"number",required:!0}],poolStatusOptions:[{value:"draft",label:"Edition"},{value:"completed",label:"Terminé"}],filters:[{label:"Pools",value:"",options:[{label:"Toutes les Pools",value:""},{label:"Valides",value:"valid"},{label:"Invalides",value:"partial"},{label:"Vides",value:"empty"},{label:"Non planifiées",value:"unscheduled"}]}],showWarnings:!0}},computed:{...(0,x.aH)("tourney",{statuses:e=>e.statuses,tourneyType:e=>e.tourneyType}),currentStatus:{get(){return this.statuses.poolStatus},set(e){this.$store.dispatch("tourney/updateStatus",{tourneyId:this.tourneyId,key:"poolStatus",value:e})}},isEditable(){return"completed"!==this.statuses.poolStatus},allPoolsComplete(){return this.pools.every((e=>{const t=e.maxTeamPerPool||this.tourneySetup.defaultMaxTeamPerPool||0;return e.teams.length>=t}))},invalidPools(){return this.pools.filter((e=>{const t=e.minTeamPerPool||this.tourneySetup?.defaultMinTeamPerPool||0,s=e.maxTeamPerPool||this.tourneySetup?.defaultMaxTeamPerPool||1/0;return e.teams.length<t||e.teams.length>s}))},unassignedTeams(){return this.teams.filter((e=>!e.poolId))},recommendedPools(){return this.availableFields},isPoolCountExceedingFields(){return this.pools.length>this.availableFields},shouldShowFieldWarning(){const e=this.tourneySetup?.maxNumberOfPools||0;return this.availableFields>e},canAddMorePools(){const e=this.tourneySetup?.maxNumberOfPools||0;return this.pools.length<e},teamsAssignedToPools(){return this.teams.filter((e=>e.poolId))},filteredPools(){return this.pools.filter((e=>{const t=e.minTeamPerPool||this.tourneySetup?.defaultMinTeamPerPool||0;return"valid"===this.filters[0].value?e.teams.length>=t:"partial"===this.filters[0].value?e.teams.length>0&&e.teams.length<t:"empty"===this.filters[0].value?0===e.teams.length:"unscheduled"!==this.filters[0].value||!e.isScheduled}))},warningMessages(){const e=[];return this.invalidPools.length>0&&e.push({id:1,type:"warning",title:"Pools invalides",description:`Il y a ${this.invalidPools.length} pools invalides.`,recommendation:"Veuillez vérifier les pools et corriger les erreurs."}),this.unassignedTeams.length>0&&e.push({id:2,type:"info",title:"Équipes non assignées",description:`Il y a ${this.unassignedTeams.length} équipes non assignées.`,recommendation:"Veuillez assigner les équipes aux pools."}),this.isPoolCountExceedingFields&&e.push({id:3,type:"warning",title:"Nombre de pools excède les terrains disponibles",description:` ${this.pools.length} Pools pour ${this.availableFields} terrains. Risque de temps d'attente élevée pour les joueurs.`,recommendation:"Veuillez ajouter des terrains pour garantir un tournus fluide."}),this.shouldShowFieldWarning&&e.push({id:4,type:"info",title:"Terrains disponibles",description:` Vous avez plus de terrains disponibles (${this.availableFields}) que le nombre maximum de pools (${this.tourneySetup.maxNumberOfPools}).`,recommendation:"Vous pouvez augmenter le nombre de pools pour optimiser l’utilisation des terrains."}),this.pools.length<this.availableFields&&e.push({id:6,type:"info",title:"Nombre de Pools recommandés",description:` Nous vous recommandons de créer autant de pools que de terrains disponibles (${this.availableFields}).`}),e}},methods:{...(0,x.i0)("tourney",["fetchTourneyStatuses"]),async fetchTourneyPoolsDetails(){try{const e=await $.get(`/tourneys/${this.tourneyId}/pools-details`),{pools:t,teams:s,tourneySetup:o}=e.data;this.pools=t.map((e=>({...e,schedulesCount:e.schedules?e.schedules.length:0,isScheduled:e.schedules&&e.schedules.length>0}))),this.teams=s,this.tourneySetup=o}catch(e){console.error("Erreur lors de la récupération des détails des pools:",e),we.oR.error("Erreur lors de la récupération des détails des pools.")}},async fetchAvailableFields(){try{const e=await $.get(`/tourneys/${this.tourneyId}/fields`),t=e.data;this.availableFields=t.length}catch(e){console.error("Erreur lors de la récupération des terrains:",e),we.oR.error("Erreur lors de la récupération des terrains.")}},async generateMissingPools(){try{const e=await $.post(`/tourneys/${this.tourneyId}/pools/generate-missing`),{newPools:t}=e.data;we.oR.success(`${t.length} Pools manquantes générées avec succès !`),this.fetchTourneyPoolsDetails()}catch(e){console.error("Erreur lors de la génération des pools manquantes :",e),we.oR.error("Erreur lors de la génération des pools manquantes.")}},openConfirmationModal(){this.showConfirmationModal=!0},closeConfirmationModal(){this.showConfirmationModal=!1},async populatePoolsWithUnassignedTeams(){this.showConfirmationModal=!1;try{const e=await $.post(`/tourneys/${this.tourneyId}/pools/populate-missing`),{assignedTeams:t}=e.data;we.oR.success(`${t.length} équipes assignées aux pools avec succès !`),this.fetchTourneyPoolsDetails()}catch(e){console.error("Erreur lors du peuplement des pools manquantes :",e),we.oR.error("Erreur lors du peuplement des pools manquantes.")}},dismissWarnings(){this.showWarnings=!1},handleFilterChange(e){this.filters[0].value=e.value},openAddPoolModal(){this.editingPoolId=null,this.newPool={name:"",tourneyId:this.tourneyId},this.showModal=!0},editPool(e){this.editingPoolId=e.id,this.newPool={...e},this.showModal=!0},openPoolDetails(e){this.$router.push(`/admin/tourneys/${this.tourneyId}/pools/${e.id}`)},confirmDeletePool(e){this.confirmedDeletePoolId=e,this.showDeleteConfirmation=!0},closeDeleteConfirmation(){this.showDeleteConfirmation=!1,this.confirmedDeletePoolId=null},closeModal(){this.showModal=!1,this.editingPoolId=null},async deletePool(e){try{await $.delete(`/tourneys/${this.tourneyId}/pools/${e}`),we.oR.success("Pool supprimée avec succès !"),this.fetchTourneyPoolsDetails(),this.closeDeleteConfirmation()}catch(t){we.oR.error("Erreur lors de la suppression de la pool.")}},async handleFormSubmit(){if(!this.isSubmitting){this.isSubmitting=!0;try{const e={name:this.newPool.name,tourneyId:this.tourneyId,stage:this.newPool.stage,maxTeamPerPool:this.newPool.maxTeamPerPool,minTeamPerPool:this.newPool.minTeamPerPool};this.editingPoolId?await $.put(`/tourneys/${this.tourneyId}/pools/${this.editingPoolId}`,e):await $.post(`/tourneys/${this.tourneyId}/pools`,e),we.oR.success(`Pool ${this.editingPoolId?"modifiée":"ajoutée"} avec succès !`),this.fetchTourneyPoolsDetails()}catch(e){console.error("Erreur lors de l'enregistrement de la pool:",e),we.oR.error("Erreur lors de l'enregistrement de la pool.")}finally{this.isSubmitting=!1,this.closeModal()}}},confirmRemoveAllTeamsFromPools(){this.showRemoveTeamsConfirmation=!0},closeRemoveTeamsConfirmation(){this.showRemoveTeamsConfirmation=!1},async removeAllTeamsFromPools(){try{await $.delete(`/tourneys/${this.tourneyId}/pools/remove-teams`),we.oR.success("Toutes les équipes ont été retirées des pools avec succès !"),this.fetchTourneyPoolsDetails()}catch(e){console.error("Erreur lors du retrait des équipes des pools:",e),we.oR.error("Erreur lors du retrait des équipes des pools.")}finally{this.closeRemoveTeamsConfirmation()}},confirmDeleteAllPools(){this.showDeleteAllConfirmation=!0},closeDeleteAllConfirmation(){this.showDeleteAllConfirmation=!1},async deleteAllPools(){try{await $.delete(`/tourneys/${this.tourneyId}/pools/reset`),we.oR.success("Toutes les pools ont été supprimées avec succès !"),this.fetchTourneyPoolsDetails()}catch(e){we.oR.error("Erreur lors de la suppression des pools.")}finally{this.closeDeleteAllConfirmation()}},openPoolSetupModal(){this.localPoolSetup={maxNumberOfPools:this.tourneySetup.maxNumberOfPools||null,defaultMinTeamPerPool:this.tourneySetup.defaultMinTeamPerPool||null,defaultMaxTeamPerPool:this.tourneySetup.defaultMaxTeamPerPool||null},this.showPoolSetupModal=!0},closePoolSetupModal(){this.showPoolSetupModal=!1},async handlePoolSetupSubmit(){try{await $.put(`/tourneys/${this.tourneyId}`,this.localPoolSetup),this.tourneySetup={...this.tourneySetup,...this.localPoolSetup},we.oR.success("Réglages des pools mis à jour avec succès !"),this.closePoolSetupModal()}catch(e){console.error("Erreur lors de la mise à jour des réglages des pools:",e),we.oR.error("Erreur lors de la mise à jour des réglages des pools.")}},customPoolSetupValidation(){const e={},{defaultMinTeamPerPool:t,defaultMaxTeamPerPool:s}=this.localPoolSetup;return t>s&&(e.defaultMinTeamPerPool="Le nombre minimum doit être inférieur ou égal au nombre maximum."),e},navigateToAssignTeams(){this.$router.push(`/admin/tourneys/${this.tourneyId}/pools/unassigned-teams`)},getPoolStatusColor(e){const t=e.minTeamPerPool||this.tourneySetup?.defaultMinTeamPerPool||0;return e.teams.length>=t?"green":e.teams.length>0?"orange":"gray"},openGeneratePoolsModal(){this.showGeneratePoolsModal=!0},closeGeneratePoolsModal(){this.showGeneratePoolsModal=!1},async generatePools(){if(!this.desiredPoolCount||this.desiredPoolCount<1)return we.oR.error("Veuillez entrer un nombre valide de pools.");try{await $.post(`/tourneys/${this.tourneyId}/pools/generate`,{poolCount:this.desiredPoolCount}),we.oR.success("Pools générés avec succès !"),this.closeGeneratePoolsModal()}catch(e){console.error("Erreur lors de la génération des pools :",e),we.oR.error("Erreur lors de la génération des pools.")}},handlePoolsGenerated(){this.fetchTourneyPoolsDetails(),this.closeGeneratePoolsModal()}},mounted(){this.fetchTourneyStatuses(this.tourneyId),this.fetchTourneyPoolsDetails(),this.fetchAvailableFields()}};const Fi=(0,E.A)(Si,[["render",vi],["__scopeId","data-v-57cef24b"]]);var Pi=Fi;const Ai={key:0,class:"p-6"},Li={class:"flex items-center mb-4 relative"},Di={class:"mb-8"},Mi={class:(0,a.C4)(["text-lg","font-semibold","mb-2","text-light-poolDetails-text","dark:text-dark-poolDetails-text"])},$i={key:0},Ui={class:"overflow-x-auto"},Ri={class:(0,a.C4)(["min-w-full","bg-light-poolDetails-card","dark:bg-dark-poolDetails-card","rounded-lg","shadow-md"])},Vi={class:(0,a.C4)(["dark:bg-dark-menu","border-b","dark:hover:bg-dark-menu"])},_i={class:"px-4 py-3 text-left"},Xi={key:0,class:"px-4 py-3 text-left"},qi=["onClick"],Ni={class:"px-4 py-2"},Bi=["value"],Wi={class:"px-4 py-2"},ji={class:"px-4 py-2"},Qi={key:1},Oi={key:0,class:"relative"},Gi={class:"overflow-x-auto max-h-60 overflow-y-auto"},zi={class:(0,a.C4)(["min-w-full","bg-light-poolDetails-card","dark:bg-dark-poolDetails-card","rounded-lg","shadow-md"])},Hi={class:(0,a.C4)(["border-b","dark:bg-dark-menu","dark:hover:bg-dark-menu"])},Ki={class:"px-4 py-3 text-left"},Ji=["onClick"],Yi={class:"px-4 py-2"},Zi=["value"],el={class:"px-4 py-2"},tl={key:1};function sl(e,t,s,n,i,l){const d=(0,r.g2)("TitleComponent"),u=(0,r.g2)("ButtonComponent"),c=(0,r.g2)("router-link"),m=(0,r.g2)("SoftButtonComponent");return i.pool?((0,r.uX)(),(0,r.CE)("div",Ai,[(0,r.Lk)("div",Li,[(0,r.bF)(d,{title:`Détails : ${i.pool.name}`},null,8,["title"]),(0,r.bF)(u,{variant:"secondary",fontAwesomeIcon:"arrow-left",class:"absolute right-0",onClick:l.goBackToPools},{default:(0,r.k6)((()=>t[12]||(t[12]=[(0,r.Lk)("span",{class:"hidden sm:inline"},"Retour aux Pools",-1)]))),_:1},8,["onClick"])]),(0,r.Lk)("div",Di,[(0,r.Lk)("h2",Mi," Équipes dans cette Pool ("+(0,a.v_)(i.assignedTeams.length)+"/"+(0,a.v_)(this.pool.maxTeamPerPool)+") ",1),i.assignedTeams.length>0?((0,r.uX)(),(0,r.CE)("div",$i,[(0,r.Lk)("form",{onSubmit:t[5]||(t[5]=(0,o.D$)(((...e)=>l.removeSelectedTeams&&l.removeSelectedTeams(...e)),["prevent"]))},[(0,r.Lk)("div",Ui,[(0,r.Lk)("table",Ri,[(0,r.Lk)("thead",null,[(0,r.Lk)("tr",Vi,[(0,r.Lk)("th",_i,[l.isEditable?(0,r.bo)(((0,r.uX)(),(0,r.CE)("input",{key:0,type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=e=>i.selectAllAssigned=e),onChange:t[1]||(t[1]=(...e)=>l.toggleSelectAllAssigned&&l.toggleSelectAllAssigned(...e))},null,544)),[[o.lH,i.selectAllAssigned]]):(0,r.Q3)("",!0),t[13]||(t[13]=(0,r.Lk)("span",{class:"ml-2"},"All",-1))]),t[14]||(t[14]=(0,r.Lk)("th",{class:"px-4 py-3 text-left"},"Nom de l'équipe",-1)),l.isEditable?((0,r.uX)(),(0,r.CE)("th",Xi,"Actions")):(0,r.Q3)("",!0)])]),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.assignedTeams,(e=>((0,r.uX)(),(0,r.CE)("tr",{key:e.id,class:(0,a.C4)(["border-t","hover:bg-light-poolDetails-hover","dark:hover:bg-dark-poolDetails-hover","cursor-pointer",{"bg-light-poolDetails-selectedErase dark:bg-dark-poolDetails-selectedErase":i.selectedAssignedTeams.includes(e.id)}]),onClick:t=>l.isEditable?l.toggleRemoveTeamSelection(e.id):null},[(0,r.Lk)("td",Ni,[l.isEditable?(0,r.bo)(((0,r.uX)(),(0,r.CE)("input",{key:0,type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=e=>i.selectedAssignedTeams=e),value:e.id,onClick:t[3]||(t[3]=(0,o.D$)((()=>{}),["stop"]))},null,8,Bi)),[[o.lH,i.selectedAssignedTeams]]):(0,r.Q3)("",!0)]),(0,r.Lk)("td",Wi,[(0,r.bF)(c,{to:`/admin/tourneys/${i.tourneyId}/teams/${e.id}/users`,class:"text-blue-600 hover:underline dark:text-blue-400",onClick:t[4]||(t[4]=(0,o.D$)((()=>{}),["stop"]))},{default:(0,r.k6)((()=>[(0,r.eW)((0,a.v_)(e.teamName),1)])),_:2},1032,["to"])]),(0,r.Lk)("td",ji,[l.isEditable?((0,r.uX)(),(0,r.Wv)(m,{key:0,fontAwesomeIcon:"fa-trash",iconClass:"w-4 h-4 text-red-500 hover:text-red-700","aria-label":"Retirer du pool",onClick:t=>l.removeTeam(e.id)},null,8,["onClick"])):(0,r.Q3)("",!0)])],10,qi)))),128))])])]),l.isEditable?((0,r.uX)(),(0,r.Wv)(u,{key:0,type:"submit",variant:"danger",class:"mt-2",disabled:0===i.selectedAssignedTeams.length||!l.isEditable},{default:(0,r.k6)((()=>t[15]||(t[15]=[(0,r.eW)(" Retirer ")]))),_:1},8,["disabled"])):(0,r.Q3)("",!0)],32)])):((0,r.uX)(),(0,r.CE)("div",Qi,t[16]||(t[16]=[(0,r.Lk)("p",{class:(0,a.C4)(["text-light-poolDetails-text","dark:text-dark-poolDetails-text"])}," Aucune équipe dans cette Pool. ",-1)])))]),(0,r.Lk)("div",null,[t[21]||(t[21]=(0,r.Lk)("h2",{class:(0,a.C4)(["text-lg","font-semibold","mb-2","text-light-poolDetails-text","dark:text-dark-poolDetails-text"])}," Équipes non assignées ",-1)),i.unassignedTeams.length>0?((0,r.uX)(),(0,r.CE)("div",Oi,[(0,r.Lk)("form",{onSubmit:t[11]||(t[11]=(0,o.D$)(((...e)=>l.assignSelectedTeams&&l.assignSelectedTeams(...e)),["prevent"]))},[(0,r.Lk)("div",Gi,[(0,r.Lk)("table",zi,[(0,r.Lk)("thead",null,[(0,r.Lk)("tr",Hi,[(0,r.Lk)("th",Ki,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=e=>i.selectAllUnassigned=e),onChange:t[7]||(t[7]=(...e)=>l.toggleSelectAllUnassigned&&l.toggleSelectAllUnassigned(...e))},null,544),[[o.lH,i.selectAllUnassigned]]),t[17]||(t[17]=(0,r.Lk)("span",{class:"ml-2"},"All",-1))]),t[18]||(t[18]=(0,r.Lk)("th",{class:"px-4 py-3 text-left"},"Nom de l'équipe",-1))])]),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.unassignedTeams,(e=>((0,r.uX)(),(0,r.CE)("tr",{key:e.id,class:(0,a.C4)(["border-t","hover:bg-light-poolDetails-hover","dark:hover:bg-dark-poolDetails-hover","cursor-pointer",{"bg-light-poolDetails-selected dark:bg-dark-poolDetails-selected":i.selectedUnassignedTeams.includes(e.id)}]),onClick:t=>l.isEditable?l.toggleTeamSelection(e.id):null},[(0,r.Lk)("td",Yi,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=e=>i.selectedUnassignedTeams=e),value:e.id,onClick:t[9]||(t[9]=(0,o.D$)((()=>{}),["stop"]))},null,8,Zi),[[o.lH,i.selectedUnassignedTeams]])]),(0,r.Lk)("td",el,[(0,r.bF)(c,{to:`/admin/tourneys/${i.tourneyId}/teams/${e.id}/users`,class:"text-blue-600 hover:underline dark:text-blue-400",onClick:t[10]||(t[10]=(0,o.D$)((()=>{}),["stop"]))},{default:(0,r.k6)((()=>[(0,r.eW)((0,a.v_)(e.teamName),1)])),_:2},1032,["to"])])],10,Ji)))),128))])])]),(0,r.bF)(u,{type:"submit",variant:"primary",class:"mt-2",disabled:0===i.selectedUnassignedTeams.length},{default:(0,r.k6)((()=>t[19]||(t[19]=[(0,r.eW)(" Assigner ")]))),_:1},8,["disabled"])],32)])):((0,r.uX)(),(0,r.CE)("div",tl,t[20]||(t[20]=[(0,r.Lk)("p",{class:(0,a.C4)(["text-light-poolDetails-text","dark:text-dark-poolDetails-text"])}," Aucune équipe non assignée. ",-1)])))])])):(0,r.Q3)("",!0)}var ol={components:{TitleComponent:Ls,ButtonComponent:ke,SoftButtonComponent:Pr},data(){return{tourneyId:this.$route.params.tourneyId,poolId:this.$route.params.poolId,pool:null,teams:[],assignedTeams:[],unassignedTeams:[],selectedUnassignedTeams:[],selectedAssignedTeams:[],selectAllUnassigned:!1,selectAllAssigned:!1}},computed:{...(0,x.aH)("tourney",{statuses:e=>e.statuses}),currentStatus:{get(){return this.statuses.poolStatus},set(e){this.$store.dispatch("tourney/updateStatus",{tourneyId:this.tourneyId,key:"poolStatus",value:e})}},isEditable(){return"completed"!==this.statuses.poolStatus},maxTeamsPerPool(){return this.pool.maxTeamPerPool||this.pool.defaultMaxTeamPerPool||"∞"}},methods:{...(0,x.i0)("tourney",["fetchTourneyStatuses"]),async fetchPoolDetails(){try{const e=await $.get(`/tourneys/${this.tourneyId}/pools/${this.poolId}`);this.pool=e.data;const t=await $.get(`/tourneys/${this.tourneyId}/teams`),s=t.data;this.unassignedTeams=s.filter((e=>"player"===e.type&&!e.poolId)),this.assignedTeams=this.pool.teams}catch(e){console.error("Erreur lors de la récupération des détails de la Pool:",e),we.oR.error("Erreur lors de la récupération des détails de la Pool.")}},toggleSelectAllUnassigned(){this.selectAllUnassigned?this.selectedUnassignedTeams=this.unassignedTeams.map((e=>e.id)):this.selectedUnassignedTeams=[]},toggleSelectAllAssigned(){this.selectAllAssigned?this.selectedAssignedTeams=this.assignedTeams.map((e=>e.id)):this.selectedAssignedTeams=[]},async assignSelectedTeams(){try{const e=this.assignedTeams.length+this.selectedUnassignedTeams.length,t=this.pool.maxTeamPerPool||this.pool.defaultMaxTeamPerPool||Number.MAX_SAFE_INTEGER;if(t&&e>t)return void we.oR.error(`Impossible d'assigner les équipes : la pool atteindrait sa capacité maximale de ${t} équipes.`);await $.post(`/tourneys/${this.tourneyId}/pools/${this.poolId}/assign-teams`,{teamIds:this.selectedUnassignedTeams}),we.oR.success("Équipes assignées avec succès !"),this.selectedUnassignedTeams=[],this.selectAllUnassigned=!1,this.fetchPoolDetails()}catch(e){console.error("Erreur lors de l'assignation des équipes:",e),we.oR.error("Erreur lors de l'assignation des équipes.")}},async removeTeam(e){try{await $.post(`/tourneys/${this.tourneyId}/pools/${this.poolId}/remove-teams`,{teamIds:[e]}),we.oR.success("Équipe retirée avec succès !"),this.fetchPoolDetails()}catch(t){console.error("Erreur lors du retrait de l'équipe:",t),we.oR.error("Erreur lors du retrait de l'équipe.")}},async removeSelectedTeams(){try{await $.post(`/tourneys/${this.tourneyId}/pools/${this.poolId}/remove-teams`,{teamIds:this.selectedAssignedTeams}),we.oR.success("Équipes retirées avec succès !"),this.selectedAssignedTeams=[],this.selectAllAssigned=!1,this.fetchPoolDetails()}catch(e){console.error("Erreur lors du retrait des équipes:",e),we.oR.error("Erreur lors du retrait des équipes.")}},toggleTeamSelection(e){this.selectedUnassignedTeams.includes(e)?this.selectedUnassignedTeams=this.selectedUnassignedTeams.filter((t=>t!==e)):this.selectedUnassignedTeams.push(e)},toggleRemoveTeamSelection(e){this.selectedAssignedTeams.includes(e)?this.selectedAssignedTeams=this.selectedAssignedTeams.filter((t=>t!==e)):this.selectedAssignedTeams.push(e)},goBackToPools(){this.$router.push(`/admin/tourneys/${this.$route.params.tourneyId}/pools`)}},mounted(){this.fetchTourneyStatuses(this.tourneyId),this.fetchPoolDetails()}};const rl=(0,E.A)(ol,[["render",sl],["__scopeId","data-v-63ca6cdb"]]);var al=rl;const nl={class:"mx-auto p-4"},il={class:"p-4 bg-light-background dark:bg-dark-background rounded-md shadow-lg"},ll={class:"flex items-center justify-between mb-4"},dl={class:"flex items-center space-x-2"},ul={key:0,class:"text-light-errorMessage dark:text-dark-errorMessage mb-4 font-bold"},cl={class:"overflow-x-auto overflow-y-auto max-h-[70vh] mt-4"},ml={class:"min-w-full bg-light-card dark:bg-dark-card shadow rounded-lg"},hl={class:"px-4 py-2"},pl={class:"px-4 py-2 flex items-center space-x-2"};function gl(e,t,s,o,n,i){const l=(0,r.g2)("TitleComponent"),d=(0,r.g2)("ButtonComponent"),u=(0,r.g2)("router-link"),c=(0,r.g2)("v-select");return(0,r.uX)(),(0,r.CE)("div",nl,[(0,r.Lk)("div",il,[(0,r.Lk)("div",ll,[(0,r.Lk)("div",dl,[(0,r.bF)(l,{title:"Équipes sans Pool"})]),(0,r.bF)(d,{variant:"secondary",fontAwesomeIcon:"arrow-left",onClick:i.goBack},{default:(0,r.k6)((()=>t[0]||(t[0]=[(0,r.Lk)("span",{class:"hidden sm:inline"},"Retour",-1)]))),_:1},8,["onClick"])]),i.hasAvailablePools?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("p",ul," Aucune pool disponible. Veuillez en créer de nouvelles ou réassigner des équipes. ")),(0,r.Lk)("div",cl,[(0,r.Lk)("table",ml,[t[1]||(t[1]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",null,[(0,r.Lk)("th",{class:"px-4 py-2 text-left text-light-title dark:text-dark-title border-b border-light-subMenu-border dark:border-dark-subMenu-border"}," Nom de l'équipe "),(0,r.Lk)("th",{class:"px-4 py-2 text-left text-light-title dark:text-dark-title border-b border-light-subMenu-border dark:border-dark-subMenu-border"}," Assigner à une Pool ")])],-1)),(0,r.Lk)("tbody",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.unassignedTeams,(e=>((0,r.uX)(),(0,r.CE)("tr",{key:e.id,class:"hover:bg-light-subMenu-hoverBackground dark:hover:bg-dark-subMenu-hoverBackground"},[(0,r.Lk)("td",hl,[(0,r.bF)(u,{to:`/admin/tourneys/${n.tourneyId}/teams/${e.id}/users`,class:"text-blue-600 dark:text-blue-400 hover:underline"},{default:(0,r.k6)((()=>[(0,r.eW)((0,a.v_)(e.teamName||"N/A"),1)])),_:2},1032,["to"])]),(0,r.Lk)("td",pl,[(0,r.bF)(c,{modelValue:n.selectedPoolIds[e.id],"onUpdate:modelValue":t=>n.selectedPoolIds[e.id]=t,options:i.poolOptions,placeholder:"Sélectionner une Pool",label:"name",reduce:e=>e.id,appendToBody:"",clearable:"",class:"w-full sm:w-64",disabled:!i.hasAvailablePools},null,8,["modelValue","onUpdate:modelValue","options","reduce","disabled"]),(0,r.bF)(d,{variant:"primary",size:"sm",fontAwesomeIcon:"check",onClick:t=>i.handleAssignPool(e.id),disabled:!n.selectedPoolIds[e.id]||!i.hasAvailablePools},null,8,["onClick","disabled"])])])))),128))])])])])])}var fl={components:{ButtonComponent:ke,TitleComponent:Ls},data(){return{tourneyId:this.$route.params.tourneyId,unassignedTeams:[],pools:[],selectedPoolIds:{}}},computed:{hasAvailablePools(){return this.poolOptions.length>0},poolOptions(){return this.pools.filter((e=>{const t=e.maxTeamPerPool||1/0;return e.teams.length<t})).map((e=>({id:e.id,name:`${e.name} (${e.teams.length}/${e.maxTeamPerPool||"∞"})`})))}},async created(){await this.fetchData()},methods:{async fetchData(){try{const e=await $.get(`/tourneys/${this.tourneyId}/teams/unassigned`);this.unassignedTeams=e.data;const t=await $.get(`/tourneys/${this.tourneyId}/pools-details`);this.pools=t.data.pools,this.unassignedTeams.forEach((e=>{e.id in this.selectedPoolIds||(this.selectedPoolIds[e.id]=null)}))}catch(e){console.error("Erreur lors de la récupération des données:",e),we.oR.error("Erreur lors de la récupération des données.")}},async handleAssignPool(e){const t=this.selectedPoolIds[e];if(t)try{await $.post(`/tourneys/${this.tourneyId}/pools/${t}/assign-teams`,{teamIds:[e]}),we.oR.success("Équipe assignée à la pool avec succès."),this.unassignedTeams=this.unassignedTeams.filter((t=>t.id!==e)),delete this.selectedPoolIds[e];const s=this.pools.findIndex((e=>e.id===t));if(-1!==s){const o=this.pools[s];o.teams.push({id:e});const r=o.maxTeamPerPool||1/0;o.teams.length>=r?(this.pools.splice(s,1),Object.keys(this.selectedPoolIds).forEach((e=>{this.selectedPoolIds[e]===t&&(this.selectedPoolIds[e]=null)}))):this.pools.splice(s,1,o)}}catch(s){console.error("Erreur lors de l'assignation de la pool:",s),we.oR.error("Erreur lors de l'assignation de la pool.")}else we.oR.info("Veuillez sélectionner une pool.")},navigateToTeam(e){this.$router.push(`/admin/tourneys/${this.tourneyId}/teams/${e}/users`)},goBack(){this.$router.push(`/admin/tourneys/${this.tourneyId}/pools`)}}};const yl=(0,E.A)(fl,[["render",gl],["__scopeId","data-v-56564bf7"]]);var vl=yl;const bl={key:0,id:"external-events",class:"p-2 rounded-lg shadow-lg sticky top-0 z-50 overflow-x-auto flex items-center justify-between bg-white dark:bg-dark-background"},kl={class:"flex space-x-4"},Tl=["data-id","data-pool-name","data-sport-name"],Cl={key:0},xl={key:1},wl={key:2,class:"p-4 rounded mb-4 relative flex flex-col bg-light-warning-bg border border-light-warning-border text-light-warning-text dark:bg-dark-warning-bg dark:border-yellow-600 dark:text-dark-warning-text"},El={class:"list-disc list-inside"},Il={class:"flex flex-wrap gap-4 my-2 px-4"},Sl={class:"flex flex-wrap w-full items-center gap-2 sm:gap-4"},Fl={class:"flex flex-wrap items-center gap-2 sm:gap-4 flex-grow"},Pl={class:"flex items-center gap-2 order-last"},Al={class:"flex flex-wrap w-full items-center gap-2 sm:gap-4"},Ll={class:"flex items-center cursor-pointer flex-shrink-0"},Dl={class:"relative"},Ml={class:"ml-2 hidden md:block text-light-form-text dark:text-dark-form-text"},$l={class:"flex items-center justify-center mx-auto"},Ul={class:"flex items-center gap-2 ml-auto"},Rl=["value"],Vl={key:3};function _l(e,t,s,n,i,l){const d=(0,r.g2)("TourneySubMenu"),u=(0,r.g2)("ErrorMessageComponent"),c=(0,r.g2)("ButtonComponent"),m=(0,r.g2)("StatusSelectorComponent"),h=(0,r.g2)("v-select"),p=(0,r.g2)("PlanningViewSelector"),g=(0,r.g2)("StrategyPlanningGeneratorComponent"),f=(0,r.g2)("DeleteConfirmationModal"),y=(0,r.g2)("FullCalendar"),v=(0,r.g2)("FormComponent"),b=(0,r.g2)("ModalComponent");return(0,r.uX)(),(0,r.CE)("div",null,[(0,r.bF)(d,{tourneyId:i.tourneyId},null,8,["tourneyId"]),l.isEditable?((0,r.uX)(),(0,r.CE)("div",bl,[(0,r.Lk)("div",kl,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.pools,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,"data-id":e.id,"data-pool-name":e.name,"data-sport-name":e.sport?.name||"",class:(0,a.C4)(["pool-item","p-3","mb-3","external-event","rounded-lg","text-center","font-semibold","transform","transition","duration-100","w-28","shadow-md","flex","items-center","justify-center",l.isEditable?"cursor-pointer external-event hover:scale-110 active:scale-95":"opacity-50","bg-blue-500","text-white"])},[(0,r.eW)((0,a.v_)(e.name)+" ",1),e.sport?((0,r.uX)(),(0,r.CE)("span",Cl," - "+(0,a.v_)(e.sport.name),1)):(0,r.Q3)("",!0)],10,Tl)))),128))])])):(0,r.Q3)("",!0),i.fields.length?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",xl,[(0,r.bF)(u,{message:"Aucun terrain trouvé. Veuillez créer des terrains avant d'assigner des pools."})])),i.warnings.length&&i.showWarningsModal?((0,r.uX)(),(0,r.CE)("div",wl,[(0,r.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>l.closeWarningsModal&&l.closeWarningsModal(...e)),class:"absolute top-2 right-2 flex items-center text-light-warning-text hover:text-light-warning-closeText"},t[14]||(t[14]=[(0,r.eW)(" Fermer "),(0,r.Lk)("span",{class:"ml-1"},"✖",-1)])),t[15]||(t[15]=(0,r.Lk)("p",{class:"font-semibold mb-2"},"Avertissements de Validation :",-1)),(0,r.Lk)("ul",El,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.warnings,((e,t)=>((0,r.uX)(),(0,r.CE)("li",{key:t},[(0,r.Lk)("span",{class:(0,a.C4)(l.warningClass(e.type))},(0,a.v_)(e.message),3)])))),128))])])):(0,r.Q3)("",!0),(0,r.Lk)("div",Il,[(0,r.Lk)("div",Sl,[(0,r.Lk)("div",Fl,[l.isEditable?((0,r.uX)(),(0,r.Wv)(c,{key:0,fontAwesomeIcon:"cog",onClick:l.openScheduleConfigModal,variant:"secondary",class:"w-auto"},{default:(0,r.k6)((()=>t[16]||(t[16]=[(0,r.Lk)("span",{class:"hidden md:inline"},"Config Horaires",-1),(0,r.Lk)("span",{class:"md:hidden"},"Conf.",-1)]))),_:1},8,["onClick"])):(0,r.Q3)("",!0),l.isEditable?((0,r.uX)(),(0,r.Wv)(c,{key:1,fontAwesomeIcon:"cog",onClick:l.openGeneratePlanningModal,variant:"algo",disabled:!i.pools.length,class:"w-auto"},{default:(0,r.k6)((()=>t[17]||(t[17]=[(0,r.Lk)("span",{class:"hidden md:inline"},"Générer Planning Pools",-1),(0,r.Lk)("span",{class:"md:hidden"},"Gen.",-1)]))),_:1},8,["onClick","disabled"])):(0,r.Q3)("",!0),l.isEditable?((0,r.uX)(),(0,r.Wv)(c,{key:2,fontAwesomeIcon:"check",onClick:l.validatePlanning,variant:"primary",disabled:!l.hasPoolSchedules,class:"w-auto"},{default:(0,r.k6)((()=>t[18]||(t[18]=[(0,r.Lk)("span",{class:"hidden md:inline"},"Vérifier Planning Pools",-1),(0,r.Lk)("span",{class:"md:hidden"},"Check",-1)]))),_:1},8,["onClick","disabled"])):(0,r.Q3)("",!0),l.hasPoolSchedules&&l.isEditable?((0,r.uX)(),(0,r.Wv)(c,{key:3,fontAwesomeIcon:"trash",onClick:l.confirmClearPlanning,variant:"danger",disabled:!i.pools.length,class:"w-auto"},{default:(0,r.k6)((()=>t[19]||(t[19]=[(0,r.Lk)("span",{class:"hidden md:inline"},"Reset Pools",-1),(0,r.Lk)("span",{class:"md:hidden"},"Del",-1)]))),_:1},8,["onClick","disabled"])):(0,r.Q3)("",!0)]),l.isEditable?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.Wv)(c,{key:0,onClick:l.downloadExcel,label:"Télécharger Excel",variant:"success","font-awesome-icon":"file-excel"},{default:(0,r.k6)((()=>t[20]||(t[20]=[(0,r.eW)(" Download Planning Excel ")]))),_:1},8,["onClick"])),(0,r.Lk)("div",Pl,[(0,r.bF)(m,{tourneyId:i.tourneyId,label:"Etape",statusKey:"planningStatus",statusOptions:i.planningStatusOptions,modelValue:l.currentStatus,"onUpdate:modelValue":t[1]||(t[1]=e=>l.currentStatus=e),hideWhenNotStarted:!1},null,8,["tourneyId","statusOptions","modelValue"])])]),(0,r.Lk)("div",Al,[(0,r.bF)(h,{options:l.poolOptions,modelValue:i.selectedPoolId,"onUpdate:modelValue":t[2]||(t[2]=e=>i.selectedPoolId=e),placeholder:"All Pools",clearable:!0,searchable:!0,label:"name",reduce:e=>e.id,class:"w-36 flex-shrink-0"},null,8,["options","modelValue","reduce"]),(0,r.Lk)("label",Ll,[(0,r.Lk)("div",Dl,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=e=>i.useUnifiedColors=e),class:"sr-only"},null,512),[[o.lH,i.useUnifiedColors]]),(0,r.Lk)("div",{class:(0,a.C4)(["block w-14 h-8 rounded-full transition-colors duration-300",{"bg-light-menuActive dark:bg-dark-menuActive":i.useUnifiedColors,"bg-light-pool-infoText dark:bg-dark-pool-infoText":!i.useUnifiedColors}])},null,2),(0,r.Lk)("div",{class:(0,a.C4)(["dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-transform duration-300",{"translate-x-full":i.useUnifiedColors}])},null,2)]),(0,r.Lk)("span",Ml,(0,a.v_)(i.useUnifiedColors?"Color by Pool":"Color by Sport"),1)]),(0,r.Lk)("div",$l,[(0,r.bF)(p,{tourneyId:i.tourneyId},null,8,["tourneyId"])]),(0,r.Lk)("div",Ul,[i.currentPage>1?((0,r.uX)(),(0,r.CE)("button",{key:0,onClick:t[4]||(t[4]=e=>i.currentPage--),class:"text-2xl px-2 py-1 rounded navigation-button"}," < ")):(0,r.Q3)("",!0),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>i.currentPage=e),class:"bg-light-form-background dark:bg-dark-form-background text-light-form-text dark:text-dark-form-text border border-light-form-border-default dark:border-dark-form-border-default rounded-md px-2 py-1"},[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.totalPages,(e=>((0,r.uX)(),(0,r.CE)("option",{key:e,value:e}," Page "+(0,a.v_)(e)+" / "+(0,a.v_)(l.totalPages),9,Rl)))),128))],512),[[o.u1,i.currentPage]]),i.currentPage<l.totalPages?((0,r.uX)(),(0,r.CE)("button",{key:1,onClick:t[6]||(t[6]=e=>i.currentPage++),class:"text-2xl px-2 py-1 rounded navigation-button"}," > ")):(0,r.Q3)("",!0),(0,r.Lk)("button",{onClick:t[7]||(t[7]=e=>{i.showAllTerrains=!i.showAllTerrains,i.currentPage=1}),class:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600"},(0,a.v_)(i.showAllTerrains?"Reduce":"All Fields"),1)])])]),(0,r.bF)(g,{isVisible:i.showGeneratePlanningConfirmation,tourneyId:i.tourneyId,tourneyType:e.tourneyType,pools:i.pools,fields:i.fields,planningTourney:i.scheduleConfig,planningType:"pool",onClose:l.closeGeneratePlanningConfirmation,onPlanningGenerated:l.handlePlanningGenerated},null,8,["isVisible","tourneyId","tourneyType","pools","fields","planningTourney","onClose","onPlanningGenerated"]),(0,r.bF)(f,{isVisible:i.showClearPlanningConfirmation,isHardDelete:!1,title:"Suppression du Planning",message:"Êtes-vous sûr de vouloir supprimer le planning ?",onFormCancel:l.closeClearPlanningConfirmation,onConfirm:l.clearPlanning},null,8,["isVisible","onFormCancel","onConfirm"]),i.tourney.dateTourney&&i.fields.length?((0,r.uX)(),(0,r.CE)("div",Vl,[((0,r.uX)(),(0,r.Wv)(y,{ref:"fullCalendar",options:l.calendarOptions,key:i.tourney.dateTourney},null,8,["options"]))])):(0,r.Q3)("",!0),(0,r.bF)(b,{isVisible:i.showScheduleConfigModal,title:"Configurer le planning du tournoi",onClose:t[10]||(t[10]=e=>i.showScheduleConfigModal=!1),size:"lg"},{content:(0,r.k6)((()=>[(0,r.bF)(v,{modelValue:i.scheduleConfig,"onUpdate:modelValue":t[8]||(t[8]=e=>i.scheduleConfig=e),fields:i.scheduleFormFields,onFormSubmit:l.saveScheduleConfig,onFormCancel:t[9]||(t[9]=e=>i.showScheduleConfigModal=!1),columns:2,customValidation:l.validateForm,isEditing:!!this.scheduleConfig},null,8,["modelValue","fields","onFormSubmit","customValidation","isEditing"])])),_:1},8,["isVisible"]),(0,r.bF)(b,{isVisible:i.showEditModal,onClose:t[13]||(t[13]=e=>i.showEditModal=!1)},{title:(0,r.k6)((()=>t[21]||(t[21]=[(0,r.eW)("Modifier l'événement")]))),content:(0,r.k6)((()=>[(0,r.bF)(v,{modelValue:i.eventFormData,"onUpdate:modelValue":t[11]||(t[11]=e=>i.eventFormData=e),fields:i.eventFormFields,onFormSubmit:l.saveEventEdits,onFormCancel:t[12]||(t[12]=e=>i.showEditModal=!1)},null,8,["modelValue","fields","onFormSubmit"])])),_:1},8,["isVisible"])])}const Xl={class:"mb-4"},ql={class:"flex items-center space-x-2"};function Nl(e,t,s,n,i,l){const d=(0,r.g2)("ButtonComponent"),u=(0,r.g2)("ModalComponent");return(0,r.uX)(),(0,r.Wv)(u,{isVisible:s.isVisible,title:"Générer le Planning",onClose:l.handleClose},{content:(0,r.k6)((()=>[(0,r.Lk)("div",Xl,[(0,r.Lk)("label",ql,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=e=>i.localRandomMode=e),class:"form-checkbox h-5 w-5 text-blue-600"},null,512),[[o.lH,i.localRandomMode]]),t[1]||(t[1]=(0,r.Lk)("span",{class:"text-light-form-text dark:text-dark-form-text"}," Génération aléatoire (erreurs plus probables) ",-1))])]),(0,r.Lk)("p",null,[t[2]||(t[2]=(0,r.eW)(" Mode sélectionné : ")),(0,r.Lk)("strong",null,(0,a.v_)(i.localRandomMode?"Aléatoire":"Standard"),1)]),((0,r.uX)(),(0,r.Wv)((0,r.$y)(l.currentStrategyComponent),{ref:"strategyComponent",tourneyId:s.tourneyId,pools:s.pools,fields:s.fields,planningTourney:s.planningTourney,randomMode:i.localRandomMode},null,8,["tourneyId","pools","fields","planningTourney","randomMode"]))])),footer:(0,r.k6)((()=>[(0,r.bF)(d,{variant:"secondary",onClick:l.handleClose},{default:(0,r.k6)((()=>t[3]||(t[3]=[(0,r.eW)(" Annuler ")]))),_:1},8,["onClick"]),(0,r.bF)(d,{disabled:i.isGenerating,variant:"primary",onClick:l.generatePlanning},{default:(0,r.k6)((()=>[(0,r.eW)((0,a.v_)(i.isGenerating?"Génération...":"Générer"),1)])),_:1},8,["disabled","onClick"])])),_:1},8,["isVisible","onClose"])}function Bl(e,t,s,o,a,n){return(0,r.uX)(),(0,r.CE)("div",null,t[0]||(t[0]=[(0,r.Lk)("p",{class:"mb-4"},[(0,r.Lk)("span",{class:"text-red-500 dark:text-red-600 font-bold"},[(0,r.Lk)("strong",null,"Attention :"),(0,r.eW)(" Le planning des pools existantes sera supprimé et remplacé. ")]),(0,r.Lk)("br"),(0,r.Lk)("br"),(0,r.eW)(" L'algorithme 'Custom Round Robin' va répartir équitablement les équipes dans les pools selon les réglages définis dans le planning. Assurez-vous d'avoir suffisamment d'équipes et de créneaux horaires. ")],-1)]))}var Wl={props:{tourneyId:{type:String,required:!0},pools:{type:Array,required:!1},fields:{type:Array,required:!1},planningTourney:{type:Object,required:!1},randomMode:{type:Boolean,default:!1}},methods:{async generatePlanning(){try{return await $.post(`/tourneys/${this.tourneyId}/planning/pools/generate`,{},{params:{randomMode:this.randomMode}}),we.oR.success("Planning des pools généré avec succès !",{autoClose:3e3}),!0}catch(e){console.error("Erreur lors de la génération du planning des pools :",e);const t=e.response?.data?.message||"Erreur lors de la génération du planning des pools.";return we.oR.error(t),!1}}}};const jl=(0,E.A)(Wl,[["render",Bl]]);var Ql=jl;function Ol(e,t,s,o,a,n){return(0,r.uX)(),(0,r.CE)("div",null,t[0]||(t[0]=[(0,r.Lk)("p",{class:"mb-4"},[(0,r.Lk)("span",{class:"text-red-500 dark:text-red-600 font-bold"},[(0,r.Lk)("strong",null,"Attention :"),(0,r.eW)(" Le planning des matchs existants sera supprimé et remplacé. ")]),(0,r.Lk)("br"),(0,r.Lk)("br"),(0,r.eW)(" L'algorithme 'Custom Round Robin' va réorganiser les matchs au sein des pools existants selon les nouvelles contraintes définies dans le planning. ")],-1)]))}var Gl={props:{tourneyId:{type:String,required:!0},pools:{type:Array,required:!1},fields:{type:Array,required:!1},planningTourney:{type:Object,required:!1},randomMode:{type:Boolean,default:!1}},methods:{async generatePlanning(){try{return await $.post(`/tourneys/${this.tourneyId}/planning/games/generate`,{},{params:{randomMode:this.randomMode}}),we.oR.success("Planning des matchs généré avec succès !",{autoClose:3e3}),!0}catch(e){console.error("Erreur lors de la génération du planning des matchs :",e);const t=e.response?.data?.message||"Erreur lors de la génération du planning des matchs.";return we.oR.error(t),!1}}}};const zl=(0,E.A)(Gl,[["render",Ol]]);var Hl=zl,Kl={components:{CustomRoundRobinPoolPlanningStrategy:Ql,CustomRoundRobinGamePlanningStrategy:Hl,ModalComponent:mt,ButtonComponent:ke},props:{tourneyId:{type:String,required:!0},tourneyType:{type:String,required:!0},pools:{type:Array,required:!1},fields:{type:Array,required:!1},planningTourney:{type:Object,required:!1},isVisible:{type:Boolean,default:!0},randomMode:{type:Boolean,default:!1},planningType:{type:String,required:!0}},data(){return{localRandomMode:this.randomMode,isGenerating:!1}},computed:{currentStrategyComponent(){return"pool"===this.planningType?"CustomRoundRobinPoolPlanningStrategy":"game"===this.planningType?"CustomRoundRobinGamePlanningStrategy":"CustomRoundRobinPoolPlanningStrategy"}},methods:{handleClose(){this.$emit("close")},async generatePlanning(){if(!this.isGenerating){this.isGenerating=!0;try{this.handleClose();const e=await this.$refs.strategyComponent.generatePlanning();e&&this.$emit("planningGenerated")}catch(e){console.error("Erreur lors de la génération du planning :",e)}finally{this.isGenerating=!1}}}}};const Jl=(0,E.A)(Kl,[["render",Nl]]);var Yl=Jl,Zl=s(8936);const ed={class:"planning-view-selector my-4 flex items-center justify-center space-x-4"},td={class:"flex items-center cursor-pointer"},sd={class:"flex items-center cursor-pointer"};function od(e,t,s,a,n,i){return(0,r.uX)(),(0,r.CE)("div",ed,[t[6]||(t[6]=(0,r.Lk)("span",{class:"font-semibold text-light-form-text dark:text-dark-form-text hidden sm:inline"}," Planification des : ",-1)),(0,r.Lk)("label",td,[(0,r.bo)((0,r.Lk)("input",{type:"radio",name:"planningView",value:"pools","onUpdate:modelValue":t[0]||(t[0]=e=>n.currentView=e),onChange:t[1]||(t[1]=e=>i.navigateTo("pools")),class:"form-radio h-5 w-5 text-blue-600"},null,544),[[o.XL,n.currentView]]),t[4]||(t[4]=(0,r.Lk)("span",{class:"ml-2 text-gray-800 dark:text-gray-200"},"Pools",-1))]),(0,r.Lk)("label",sd,[(0,r.bo)((0,r.Lk)("input",{type:"radio",name:"planningView",value:"games","onUpdate:modelValue":t[2]||(t[2]=e=>n.currentView=e),onChange:t[3]||(t[3]=e=>i.navigateTo("games")),class:"form-radio h-5 w-5 text-blue-600"},null,544),[[o.XL,n.currentView]]),t[5]||(t[5]=(0,r.Lk)("span",{class:"ml-2 text-gray-800 dark:text-gray-200"},"Matchs",-1))])])}var rd={name:"PlanningViewSelector",props:{tourneyId:{type:[String,Number],required:!0}},data(){return{currentView:this.getCurrentView()}},methods:{getCurrentView(){return"AdminTourneyPlanningPools"===this.$route.name?"pools":"AdminTourneyPlanningGames"===this.$route.name?"games":"pools"},navigateTo(e){"pools"===e?this.$router.push(`/admin/tourneys/${this.tourneyId}/planning/pools`):"games"===e&&this.$router.push(`/admin/tourneys/${this.tourneyId}/planning/games`)}},watch:{"$route.name"(){this.currentView=this.getCurrentView()}}};const ad=(0,E.A)(rd,[["render",od],["__scopeId","data-v-d55708b0"]]);var nd=ad,id={components:{FullCalendar:qa.A,TourneySubMenu:mo,ErrorMessageComponent:Ga,StatusSelectorComponent:ko,ButtonComponent:ke,ModalComponent:mt,FormComponent:jt,DeleteConfirmationModal:Gt,StrategyPlanningGeneratorComponent:Yl,vSelect:Zl.A,PlanningViewSelector:nd},data(){return{tourneyId:this.$route.params.tourneyId,tourney:{},fields:[],pools:[],poolSchedules:[],formErrors:{},selectedPoolId:null,planningStatusOptions:[{value:"draft",label:"Edition"},{value:"completed",label:"Terminé"}],warnings:[],externalDraggableInstance:null,showScheduleConfigModal:!1,showWarningsModal:!1,isSmallScreen:!1,currentPage:1,terrainsPerPage:10,showAllTerrains:!1,breakpoints:{large:1150,medium:640},scheduleConfig:{startTime:"07:30:00",endTime:"17:30:00",poolDuration:105,gameDuration:15,transitionPoolTime:15,transitionGameTime:0,introStart:"07:30:00",introEnd:"08:00:00",lunchStart:"12:00:00",lunchEnd:"13:00:00",outroStart:"17:00:00",outroEnd:"17:30:00"},scheduleFormFields:[{name:"startTime",type:"time",label:"Heure de début",required:!0},{name:"endTime",type:"time",label:"Heure de fin",required:!0},{name:"introStart",type:"time",label:"Début de l'introduction"},{name:"introEnd",type:"time",label:"Fin de l'introduction"},{name:"lunchStart",type:"time",label:"Début du déjeuner"},{name:"lunchEnd",type:"time",label:"Fin du déjeuner"},{name:"outroStart",type:"time",label:"Début de la conclusion"},{name:"outroEnd",type:"time",label:"Fin de la conclusion"},{name:"poolDuration",type:"number",label:"Durée d’une pool (en minutes)",required:!0},{name:"transitionPoolTime",type:"number",label:"Transition entre les pools (en minutes)",required:!0},{name:"gameDuration",type:"number",label:"Durée d’un match (en minutes)",required:!0},{name:"transitionGameTime",type:"number",label:"Transition entre les matchs (en minutes)",required:!0}],showEditModal:!1,eventToEdit:null,eventFormData:{},eventFormFields:[{name:"startTime",type:"time",label:"Heure de début",required:!0},{name:"endTime",type:"time",label:"Heure de fin",required:!0}],showGeneratePlanningConfirmation:!1,showClearPlanningConfirmation:!1,useUnifiedColors:!0,colorMap:{}}},computed:{...(0,x.aH)("tourney",{statuses:e=>e.statuses,tourneyType:e=>e.tourneyType}),currentStatus:{get(){return this.statuses.planningStatus},set(e){this.$store.dispatch("tourney/updateStatus",{tourneyId:this.tourneyId,key:"planningStatus",value:e})}},totalPages(){return this.showAllTerrains?1:Math.ceil(this.fields.length/this.terrainsPerPage)},paginatedFields(){if(this.showAllTerrains)return this.fields;const e=(this.currentPage-1)*this.terrainsPerPage,t=e+this.terrainsPerPage;return this.fields.slice(e,t)},isEditable(){return"completed"!==this.statuses.planningStatus},hasPoolSchedules(){return this.poolSchedules.length>0},generateUniqueColor(){return e=>{if(this.colorMap[e])return this.colorMap[e];const t=137.508*e%360,s=`hsl(${t}, 70%, 60%)`;return this.colorMap[e]=s,s}},sortedFields(){return[...this.fields].sort(((e,t)=>{const s=parseInt(e.name),o=parseInt(t.name);return isNaN(s)||isNaN(o)?e.name.localeCompare(t.name):s-o}))},poolOptions(){return[{id:null,name:"All Pools"},...this.pools]},calendarOptions(){if(!this.tourney.dateTourney)return console.error("La date du tournoi n’est pas disponible"),{};const e=[];return this.poolSchedules.forEach((t=>{this.selectedPoolId&&t.pool.id!==this.selectedPoolId||e.push({id:t.id.toString(),title:t.pool.name+(t.sport?` - ${t.sport.name}`:""),start:`${t.date}T${t.startTime}`,end:`${t.date}T${t.endTime}`,resourceId:t.field.id.toString(),backgroundColor:this.useUnifiedColors?this.generateUniqueColor(t.pool.id):t.sport?.color||"#3B82F6",textColor:"#FFFFFF",extendedProps:{sport:t.sport,poolId:t.pool.id}})})),this.fields.forEach((t=>{t.sportsFields&&t.sportsFields.length>0&&t.sportsFields.forEach((s=>{e.push({id:`bg-${t.id}-${s.sport.id}-${s.startTime}-${s.endTime}`,title:s.sport.name,start:`${this.tourney.dateTourney}T${s.startTime}`,end:`${this.tourney.dateTourney}T${s.endTime}`,resourceId:t.id.toString(),backgroundColor:s.sport.color||"#cccccc",display:"background"})}))})),{plugins:[Na.A,Ba.Ay,Wa.A],schedulerLicenseKey:"CC-Attribution-NonCommercial-NoDerivatives",initialView:"resourceTimeGridDay",timeZone:"local",initialDate:this.tourney.dateTourney,editable:this.isEditable,droppable:!0,height:"auto",slotMinTime:this.adjustedSlotMinTime,slotMaxTime:this.adjustedSlotMaxTime,allDaySlot:!1,resources:this.paginatedFields.map((e=>({id:e.id.toString(),title:e.name}))),customButtons:{prevPage:{text:"Précédent",click:()=>{this.currentPage>1&&this.currentPage--}},nextPage:{text:"Suivant",click:()=>{this.currentPage<this.totalPages&&this.currentPage++}}},events:e,resourceAreaHeaderContent:"Terrains",slotLabelFormat:{hour:"2-digit",minute:"2-digit",hour12:!1},headerToolbar:!1,eventReceive:this.handleEventReceive,eventDrop:this.handleEventDrop,eventResize:this.handleEventResize,eventContent:this.renderEventContent}},adjustedSlotMinTime(){const e=this.scheduleConfig.startTime||"07:00:00";return this.subtractOneHour(e)},adjustedSlotMaxTime(){const e=this.scheduleConfig.endTime||"23:00:00";return this.addOneHour(e)}},watch:{useUnifiedColors(){this.$refs.fullCalendar&&this.$refs.fullCalendar.getApi().refetchEvents()},currentPage(){if(this.$refs.fullCalendar){const e=this.$refs.fullCalendar.getApi();e.refetchResources()}}},beforeUnmount(){this.externalDraggableInstance&&this.externalDraggableInstance.destroy()},methods:{...(0,x.i0)("tourney",["fetchTourneyStatuses","setTournamentName","clearTournamentName"]),async fetchPlanningDetails(){try{await this.fetchTourneyStatuses(this.tourneyId);const e=await $.get(`/tourneys/${this.tourneyId}/planning/details`),t=e.data;this.fields=t.fields||[],this.pools=t.pools||[],this.sports=t.sports||[],this.scheduleConfig=t.scheduleTourney||this.scheduleConfig;const s=await $.get(`/tourneys/${this.tourneyId}`);this.tourney=s.data,this.tourney.dateTourney||console.warn("La date du tournoi n'est pas définie."),this.poolSchedules=[],t.pools.forEach((e=>{e.schedules&&e.schedules.length>0&&e.schedules.forEach((t=>{this.poolSchedules.push({id:t.id,date:t.date,startTime:t.startTime,endTime:t.endTime,field:t.field,pool:{id:e.id,name:e.name},sport:t.sport})}))})),this.fields.length||console.warn("Aucun terrain trouvé"),this.pools.length||console.warn("Aucune pool trouvée"),this.poolSchedules.length||console.warn("Aucun planning de pool trouvé")}catch(e){console.error("Erreur lors de la récupération des détails du planning:",e)}},refreshCalendarEvents(){if(this.$refs.fullCalendar){const e=this.$refs.fullCalendar.getApi();e.refetchEvents()}},initializeExternalEvents(){if(!this.isEditable)return;this.externalDraggableInstance&&(this.externalDraggableInstance.destroy(),this.externalDraggableInstance=null);const e=document.getElementById("external-events");this.externalDraggableInstance=new Ba.sx(e,{itemSelector:".external-event",eventData(e){return{title:e.dataset.poolName,duration:"01:00",create:!0,extendedProps:{poolId:e.dataset.id,poolName:e.dataset.poolName,sportName:e.dataset.sportName}}}})},renderEventContent(e){const t=document.createElement("div");t.classList.add("flex","flex-col","space-y-1");const s=document.createElement("div");s.classList.add("flex","justify-between","items-center");const o=document.createElement("span");if(o.innerText=e.event.title,o.classList.add("font-semibold","text-white"),s.appendChild(o),"background"===e.event.display)return t.appendChild(s),{domNodes:[t]};if(this.isEditable){const t=document.createElement("span");t.innerHTML="&#9998;",t.classList.add("edit-icon"),t.style.color="yellow",t.style.cursor="pointer",t.style.padding="0 5px",t.addEventListener("click",(t=>{t.stopPropagation(),this.openEditModal(e.event)}));const o=document.createElement("span");let r;o.innerHTML="&#10060;",o.classList.add("delete-icon"),o.style.color="white",o.style.cursor="pointer",o.style.padding="0 5px",o.addEventListener("dblclick",(t=>{t.stopPropagation(),this.deleteEvent(e.event)})),s.appendChild(t),o.addEventListener("touchstart",(t=>{t.stopPropagation(),r=setTimeout((()=>{this.deleteEvent(e.event)}),600)})),o.addEventListener("touchend",(()=>{clearTimeout(r)})),s.appendChild(o)}const r=this.formatDisplayTime(e.event.start),a=this.formatDisplayTime(e.event.end),n=document.createElement("div");return n.innerText=`${r} - ${a}`,n.classList.add("text-sm","text-white"),t.appendChild(s),t.appendChild(n),{domNodes:[t]}},async downloadExcel(){let e;try{e=we.oR.info("Téléchargement du fichier en cours...",{autoClose:!1});const t=await $.get(`/tourneys/${this.tourneyId}/export-data/excel`,{responseType:"blob"}),s=t.data,o=window.URL.createObjectURL(s),r=document.createElement("a");r.href=o,r.download=`tournament_${this.tourneyId}.xlsx`,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(o),we.oR.update(e,{render:"Téléchargement terminé avec succès !",type:we.oR.TYPE.SUCCESS,autoClose:2e3})}catch(t){we.oR.update(e,{render:t.message||"Une erreur s'est produite lors du téléchargement.",type:we.oR.TYPE.ERROR,autoClose:2e3}),console.error("Erreur lors du téléchargement Excel :",t)}},warningClass(e){switch(e){case"grave":return"text-red-600 font-bold";case"moyenne":return"text-orange-600 font-semibold";case"faible":return"text-yellow-600";default:return""}},isSchedule(){return!!this.scheduleConfig},async handleEventReceive(e){if(!this.isEditable)return void e.revert();const t=e.event;try{const s=t.extendedProps.poolId,o=t.getResources()[0]?.id;if(!o)return console.error("Problème d'ID : Terrain mal identifié."),void e.revert();const r=parseInt(this.scheduleConfig.poolDuration)||60,a=new Date(t.start),n=new Date(a.getTime()+6e4*r);t.setEnd(n);const i={fieldId:o,startTime:this.formatTime(t.start),endTime:this.formatTime(t.end),date:this.tourney.dateTourney},l=await $.post(`/tourneys/${this.tourneyId}/pools/schedule/${s}`,i);t.setProp("id",l.data.poolSchedule.id),t.setExtendedProp("sport",l.data.poolSchedule.sport);const d=l.data.poolSchedule.sport?` - ${l.data.poolSchedule.sport.name}`:"";t.setProp("title",`${t.extendedProps.poolName}${d}`);const u=this.useUnifiedColors?this.generateUniqueColor(s):l.data.poolSchedule.sport?.color||"#3B82F6";t.setProp("backgroundColor",u),this.poolSchedules.push({id:l.data.poolSchedule.id,date:i.date,startTime:i.startTime,endTime:i.endTime,field:{id:i.fieldId},pool:{id:Number(s),name:t.extendedProps.poolName},sport:l.data.poolSchedule.sport}),we.oR.success("Événement ajouté avec succès !")}catch(s){we.oR.error(s.message||"Une erreur s'est produite lors de l'ajout."),console.error("Erreur lors du traitement de l'événement :",s),e.revert()}},async handleEventDrop(e){if(!this.isEditable)return void e.revert();const t=e.event;try{const s=t.id,o=t.getResources()[0]?.id;if(!s||!o)return console.error("Problème d'ID : Terrain ou événement mal identifié."),void e.revert();const r={fieldId:o,startTime:this.formatTime(t.start),endTime:this.formatTime(t.end),date:this.tourney.dateTourney},a=await $.put(`/tourneys/${this.tourneyId}/pools/schedule/${s}`,r),n=this.poolSchedules.findIndex((e=>e.id.toString()===s.toString()));-1!==n&&(this.poolSchedules[n].field.id=r.fieldId,this.poolSchedules[n].startTime=r.startTime,this.poolSchedules[n].endTime=r.endTime,this.poolSchedules[n].sport=a.data.poolSchedule.sport),t.setExtendedProp("sport",a.data.poolSchedule.sport);const i=a.data.poolSchedule.sport?` - ${a.data.poolSchedule.sport.name}`:"";t.setProp("title",`${t.title.split(" - ")[0]}${i}`);const l=this.useUnifiedColors?this.generateUniqueColor(t.extendedProps.poolId):a.data.poolSchedule.sport?.color||"#3B82F6";t.setProp("backgroundColor",l)}catch(s){console.error("Erreur lors du déplacement de l'événement :",s),e.revert()}},async handleEventResize(e){if(!this.isEditable)return void e.revert();const t=e.event;try{const s=t.id,o=t.getResources()[0]?.id;if(!s||!o)return console.error("Problème d'ID : Terrain ou événement mal identifié."),void e.revert();const r={fieldId:o,startTime:this.formatTime(t.start),endTime:this.formatTime(t.end),date:this.tourney.dateTourney},a=await $.put(`/tourneys/${this.tourneyId}/pools/schedule/${s}`,r),n=this.poolSchedules.findIndex((e=>e.id.toString()===s.toString()));-1!==n&&(this.poolSchedules[n].startTime=r.startTime,this.poolSchedules[n].endTime=r.endTime,this.poolSchedules[n].field.id=o,this.poolSchedules[n].sport=a.data.poolSchedule.sport),t.setExtendedProp("sport",a.data.poolSchedule.sport);const i=a.data.poolSchedule.sport?` - ${a.data.poolSchedule.sport.name}`:"";t.setProp("title",`${t.title.split(" - ")[0]}${i}`);const l=this.useUnifiedColors?this.generateUniqueColor(t.extendedProps.poolId):a.data.poolSchedule.sport?.color||"#3B82F6";t.setProp("backgroundColor",l)}catch(s){console.error("Erreur lors du redimensionnement de l'événement :",s),e.revert()}},async saveEventEdits(){try{const e={startTime:this.eventFormData.startTime,endTime:this.eventFormData.endTime,date:this.tourney.dateTourney,fieldId:this.eventToEdit.getResources()[0]?.id},t=await $.put(`/tourneys/${this.tourneyId}/pools/schedule/${this.eventToEdit.id}`,e),s=this.poolSchedules.findIndex((e=>e.id.toString()===this.eventToEdit.id.toString()));-1!==s&&(this.poolSchedules[s].startTime=e.startTime,this.poolSchedules[s].endTime=e.endTime,this.poolSchedules[s].sport=t.data.poolSchedule.sport);const o=this.eventToEdit;o.setExtendedProp("sport",t.data.poolSchedule.sport);const r=t.data.poolSchedule.sport?` - ${t.data.poolSchedule.sport.name}`:"";o.setProp("title",`${o.title.split(" - ")[0]}${r}`);const a=this.useUnifiedColors?this.generateUniqueColor(o.extendedProps.poolId):t.data.poolSchedule.sport?.color||"#3B82F6";o.setProp("backgroundColor",a),this.showEditModal=!1}catch(e){console.error("Erreur lors de la sauvegarde des modifications :",e)}},async deleteEvent(e){if(this.isEditable)try{await $.delete(`/tourneys/${this.tourneyId}/pools/schedule/${e.id}`),e.remove(),this.poolSchedules=this.poolSchedules.filter((t=>t.id.toString()!==e.id.toString())),we.oR.success("Événement supprimé avec succès !")}catch(t){we.oR.error("Erreur lors de la suppression de l’événement."),console.error("Erreur lors de la suppression du pool :",t)}},formatDisplayTime(e){const t=new Date(e),s=t.getHours().toString().padStart(2,"0"),o=t.getMinutes().toString().padStart(2,"0");return`${s}:${o}`},formatTime(e){const t=new Date(e),s=t.getHours().toString().padStart(2,"0"),o=t.getMinutes().toString().padStart(2,"0"),r=t.getSeconds().toString().padStart(2,"0");return`${s}:${o}:${r}`},openScheduleConfigModal(){this.showScheduleConfigModal=!0,this.loadScheduleConfig()},openEditModal(e){this.eventToEdit=e,this.eventFormData={startTime:this.formatTime(e.start),endTime:this.formatTime(e.end)},this.showEditModal=!0},async loadScheduleConfig(){try{const e=await $.get(`/tourneys/${this.tourneyId}/schedule`);e.data&&(this.scheduleConfig=e.data)}catch(e){e.response&&404===e.response.status?console.warn("Aucune configuration existante du planning trouvée. Utilisation des valeurs par défaut."):console.error("Erreur lors de la récupération de la configuration du planning :",e)}},openGeneratePlanningModal(){this.showGeneratePlanningConfirmation=!0},closeGeneratePlanningConfirmation(){this.showGeneratePlanningConfirmation=!1},confirmClearPlanning(){this.showClearPlanningConfirmation=!0},closeClearPlanningConfirmation(){this.showClearPlanningConfirmation=!1},async handlePlanningGenerated(){await this.fetchPlanningDetails(),this.closeGeneratePlanningConfirmation(),this.validatePlanning()},async clearPlanning(){try{await $.delete(`/tourneys/${this.tourneyId}/planning/pools/reset`),we.oR.success("Planning supprimé avec succès !"),this.showClearPlanningConfirmation=!1,await this.fetchPlanningDetails()}catch(e){console.error("Erreur lors de la suppression du planning :",e),we.oR.error("Erreur lors de la suppression du planning.")}},async validatePlanning(){try{const e=await $.post(`/tourneys/${this.tourneyId}/planning/pools/validate`),t=e.data.validation;if(t.hasErrors){const e=[];t.errors.high.length>0&&t.errors.high.forEach((t=>{e.push({type:"grave",message:t})})),t.errors.mid.length>0&&t.errors.mid.forEach((t=>{e.push({type:"moyenne",message:t})})),t.errors.low.length>0&&t.errors.low.forEach((t=>{e.push({type:"faible",message:t})})),this.warnings=e,this.showWarningsModal=!0}else we.oR.success("Le planning est valide sans erreurs."),this.warnings=[],this.showWarningsModal=!1}catch(e){console.error("Erreur lors de la validation du planning :",e),we.oR.error("Erreur lors de la validation du planning.")}},async saveScheduleConfig(){try{let e="";this.scheduleConfig.id?(await $.put(`/tourneys/${this.tourneyId}/schedule/${this.scheduleConfig.id}`,this.scheduleConfig),e="Configuration du planning mise à jour avec succès !"):(await $.post(`/tourneys/${this.tourneyId}/schedule`,this.scheduleConfig),e="Configuration du planning enregistrée avec succès !"),this.showScheduleConfigModal=!1,await this.fetchPlanningDetails(),this.initializeExternalEvents(),we.oR.success(e)}catch(e){console.error("Erreur lors de la sauvegarde de la configuration du planning :",e),we.oR.error("Erreur lors de la sauvegarde de la configuration du planning.")}},closeWarningsModal(){this.showWarningsModal=!1,this.warnings=[]},subtractOneHour(e){let[t]=e.split(":").map(Number);return t<0&&(t=0),`${t.toString().padStart(2,"0")}:00:00`},addOneHour(e){let[t,s,o]=e.split(":").map(Number);return(s>0||o>0)&&(t+=1),t>=24&&(t=23),s=0,o=0,`${t.toString().padStart(2,"0")}:00:00`},checkWarnings(){this.warnings=[],this.pools.length>this.fields.length?(this.warnings.push({type:"faible",message:"Le nombre de pools est supérieur au nombre de terrains disponibles. Cela peut entraîner des temps d'attente pour certaines pools."}),this.showWarningsModal=!0):this.showWarningsModal=!1},validateForm(){const e={},t=this.scheduleConfig,{startTime:s,endTime:o,introStart:r,introEnd:a,lunchStart:n,lunchEnd:i,outroStart:l,outroEnd:d}=t,u=e=>{const[t,s,o]=e.split(":").map(Number);return 3600*t+60*s+(o||0)},c=u(s),m=u(o);c>=m&&(e.startTime="L'heure de début doit être inférieure à l'heure de fin.",e.endTime="L'heure de fin doit être supérieure à l'heure de début.");const h=[{start:r,end:a,label:"Introduction",startField:"introStart",endField:"introEnd"},{start:n,end:i,label:"Déjeuner",startField:"lunchStart",endField:"lunchEnd"},{start:l,end:d,label:"Conclusion",startField:"outroStart",endField:"outroEnd"}];for(const p of h)if(p.start&&p.end){const t=u(p.start),r=u(p.end);t>=r&&(e[p.startField]=`L'heure de début doit être inférieure à l'heure de fin pour la section ${p.label}.`,e[p.endField]=`L'heure de fin doit être supérieure à l'heure de début pour la section ${p.label}.`),(t<c||r>m)&&(e[p.startField]=`Les heures de ${p.label} doivent être comprises entre le début (${s}) et la fin (${o}) du planning global.`,e[p.endField]=`Les heures de ${p.label} doivent être comprises entre le début (${s}) et la fin (${o}) du planning global.`)}else(p.start&&!p.end||!p.start&&p.end)&&(e[p.startField]=`Veuillez fournir à la fois l'heure de début et de fin pour la section ${p.label}.`,e[p.endField]=`Veuillez fournir à la fois l'heure de début et de fin pour la section ${p.label}.`);return e},adjustTerrainsPerPage(){const e=window.innerWidth;this.terrainsPerPage=e>=1200?10:e>=1e3?8:e>=800?7:e>=600?5:3}},async mounted(){this.adjustTerrainsPerPage(),window.addEventListener("resize",this.adjustTerrainsPerPage),await this.fetchPlanningDetails(),this.initializeExternalEvents(),this.checkWarnings()}};const ld=(0,E.A)(id,[["render",_l],["__scopeId","data-v-78664dd0"]]);var dd=ld;const ud={key:0},cd={key:1,class:"p-4 rounded mb-4 relative flex flex-col bg-light-warning-bg border border-light-warning-border text-light-warning-text dark:bg-dark-warning-bg dark:border-yellow-600 dark:text-dark-warning-text"},md={class:"list-disc list-inside"},hd={class:"flex flex-wrap gap-4 my-2 px-4"},pd={class:"flex flex-wrap w-full items-center gap-2 sm:gap-4"},gd={class:"flex flex-wrap items-center gap-2 sm:gap-4 flex-grow"},fd={class:"flex items-center gap-2 order-last"},yd={class:"flex flex-wrap w-full items-center gap-2 sm:gap-4"},vd={class:"flex items-center cursor-pointer flex-shrink-0"},bd={class:"relative"},kd={class:"ml-2 hidden md:block text-light-form-text dark:text-dark-form-text"},Td={class:"flex items-center justify-center mx-auto"},Cd={class:"flex items-center gap-2 ml-auto"},xd=["value"],wd={key:2};function Ed(e,t,s,n,i,l){const d=(0,r.g2)("TourneySubMenu"),u=(0,r.g2)("ErrorMessageComponent"),c=(0,r.g2)("ButtonComponent"),m=(0,r.g2)("StatusSelectorComponent"),h=(0,r.g2)("v-select"),p=(0,r.g2)("PlanningViewSelector"),g=(0,r.g2)("StrategyPlanningGeneratorComponent"),f=(0,r.g2)("DeleteConfirmationModal"),y=(0,r.g2)("FullCalendar"),v=(0,r.g2)("FormComponent"),b=(0,r.g2)("ModalComponent");return(0,r.uX)(),(0,r.CE)("div",null,[(0,r.bF)(d,{tourneyId:i.tourneyId},null,8,["tourneyId"]),i.fields.length?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",ud,[(0,r.bF)(u,{message:"Aucun terrain trouvé. Veuillez créer des terrains avant d'assigner des matchs."})])),i.warnings.length&&i.showWarningsModal?((0,r.uX)(),(0,r.CE)("div",cd,[(0,r.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>l.closeWarningsModal&&l.closeWarningsModal(...e)),class:"absolute top-2 right-2 flex items-center text-light-warning-text hover:text-light-warning-closeText"},t[17]||(t[17]=[(0,r.eW)(" Fermer "),(0,r.Lk)("span",{class:"ml-1"},"✖",-1)])),t[18]||(t[18]=(0,r.Lk)("p",{class:"font-semibold mb-2"},"Avertissements de Validation :",-1)),(0,r.Lk)("ul",md,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.warnings,((e,t)=>((0,r.uX)(),(0,r.CE)("li",{key:t},[(0,r.Lk)("span",{class:(0,a.C4)(l.warningClass(e.type))},(0,a.v_)(e.message),3)])))),128))])])):(0,r.Q3)("",!0),(0,r.Lk)("div",hd,[(0,r.Lk)("div",pd,[(0,r.Lk)("div",gd,[l.isEditable?((0,r.uX)(),(0,r.Wv)(c,{key:0,fontAwesomeIcon:"cog",onClick:l.openScheduleConfigModal,variant:"secondary",class:"w-auto"},{default:(0,r.k6)((()=>t[19]||(t[19]=[(0,r.Lk)("span",{class:"hidden md:inline"},"Config Horaires",-1),(0,r.Lk)("span",{class:"md:hidden"},"Conf.",-1)]))),_:1},8,["onClick"])):(0,r.Q3)("",!0),l.isEditable?((0,r.uX)(),(0,r.Wv)(c,{key:1,fontAwesomeIcon:"cog",onClick:l.openGeneratePlanningModal,variant:"algo",class:"w-auto"},{default:(0,r.k6)((()=>t[20]||(t[20]=[(0,r.Lk)("span",{class:"hidden md:inline"},"Générer Planning Matchs",-1),(0,r.Lk)("span",{class:"md:hidden"},"Gen.",-1)]))),_:1},8,["onClick"])):(0,r.Q3)("",!0),l.isEditable?((0,r.uX)(),(0,r.Wv)(c,{key:2,fontAwesomeIcon:"check",onClick:l.validatePlanning,variant:"primary",disabled:!l.hasGames,class:"w-auto"},{default:(0,r.k6)((()=>t[21]||(t[21]=[(0,r.Lk)("span",{class:"hidden md:inline"},"Vérifier Planning Matchs",-1),(0,r.Lk)("span",{class:"md:hidden"},"Check",-1)]))),_:1},8,["onClick","disabled"])):(0,r.Q3)("",!0),l.hasGames&&l.isEditable?((0,r.uX)(),(0,r.Wv)(c,{key:3,fontAwesomeIcon:"trash",onClick:l.confirmClearPlanning,variant:"danger",disabled:!i.games.length,class:"w-auto"},{default:(0,r.k6)((()=>t[22]||(t[22]=[(0,r.Lk)("span",{class:"hidden md:inline"},"Reset Matchs",-1),(0,r.Lk)("span",{class:"md:hidden"},"Del",-1)]))),_:1},8,["onClick","disabled"])):(0,r.Q3)("",!0)]),l.isEditable?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.Wv)(c,{key:0,onClick:l.downloadExcel,label:"Télécharger Excel",variant:"success","font-awesome-icon":"file-excel"},{default:(0,r.k6)((()=>t[23]||(t[23]=[(0,r.eW)(" Download Planning Excel ")]))),_:1},8,["onClick"])),(0,r.Lk)("div",fd,[(0,r.bF)(m,{tourneyId:i.tourneyId,statusKey:"planningStatus",statusOptions:i.planningStatusOptions,modelValue:l.currentStatus,"onUpdate:modelValue":t[1]||(t[1]=e=>l.currentStatus=e),label:"Étape",hideWhenNotStarted:!1},null,8,["tourneyId","statusOptions","modelValue"])])]),(0,r.Lk)("div",yd,[(0,r.bF)(h,{options:l.poolOptions,modelValue:i.selectedPoolId,"onUpdate:modelValue":t[2]||(t[2]=e=>i.selectedPoolId=e),placeholder:"All Pools",clearable:!0,searchable:!0,label:"name",reduce:e=>e.id,class:"w-36 flex-shrink-0"},null,8,["options","modelValue","reduce"]),(0,r.Lk)("label",vd,[(0,r.Lk)("div",bd,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=e=>i.useUnifiedColors=e),class:"sr-only"},null,512),[[o.lH,i.useUnifiedColors]]),(0,r.Lk)("div",{class:(0,a.C4)(["block w-14 h-8 rounded-full transition-colors duration-300",{"bg-light-menuActive dark:bg-dark-menuActive":i.useUnifiedColors,"bg-light-pool-infoText dark:bg-dark-pool-infoText":!i.useUnifiedColors}])},null,2),(0,r.Lk)("div",{class:(0,a.C4)(["dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-transform duration-300",{"translate-x-full":i.useUnifiedColors}])},null,2)]),(0,r.Lk)("span",kd,(0,a.v_)(i.useUnifiedColors?"Color by Pool":"Color by Sport"),1)]),(0,r.Lk)("div",Td,[(0,r.bF)(p,{tourneyId:i.tourneyId},null,8,["tourneyId"])]),(0,r.Lk)("div",Cd,[i.currentPage>1?((0,r.uX)(),(0,r.CE)("button",{key:0,onClick:t[4]||(t[4]=e=>i.currentPage--),class:"text-2xl px-2 py-1 rounded navigation-button"}," < ")):(0,r.Q3)("",!0),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>i.currentPage=e),class:"bg-light-form-background dark:bg-dark-form-background text-light-form-text dark:text-dark-form-text border border-light-form-border-default dark:border-dark-form-border-default rounded-md px-2 py-1"},[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.totalPages,(e=>((0,r.uX)(),(0,r.CE)("option",{key:e,value:e}," Page "+(0,a.v_)(e)+" / "+(0,a.v_)(l.totalPages),9,xd)))),128))],512),[[o.u1,i.currentPage]]),i.currentPage<l.totalPages?((0,r.uX)(),(0,r.CE)("button",{key:1,onClick:t[6]||(t[6]=e=>i.currentPage++),class:"text-2xl px-2 py-1 rounded navigation-button"}," > ")):(0,r.Q3)("",!0),(0,r.Lk)("button",{onClick:t[7]||(t[7]=e=>{i.showAllTerrains=!i.showAllTerrains,i.currentPage=1}),class:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600"},(0,a.v_)(i.showAllTerrains?"Reduce":"All Fields"),1)])])]),(0,r.bF)(g,{isVisible:i.showGeneratePlanningConfirmation,tourneyId:i.tourneyId,tourneyType:e.tourneyType,pools:i.pools,fields:i.fields,planningTourney:i.scheduleConfig,planningType:"game",onClose:l.closeGeneratePlanningConfirmation,onPlanningGenerated:l.handlePlanningGenerated},null,8,["isVisible","tourneyId","tourneyType","pools","fields","planningTourney","onClose","onPlanningGenerated"]),(0,r.bF)(f,{isVisible:i.showClearPlanningConfirmation,isHardDelete:!1,title:"Suppression du Planning des Matchs",message:"Êtes-vous sûr de vouloir supprimer le planning des matchs ?",onFormCancel:l.closeClearPlanningConfirmation,onConfirm:l.clearPlanning},null,8,["isVisible","onFormCancel","onConfirm"]),i.tourney.dateTourney&&i.fields.length?((0,r.uX)(),(0,r.CE)("div",wd,[((0,r.uX)(),(0,r.Wv)(y,{ref:"fullCalendar",options:l.calendarOptions,key:i.tourney.dateTourney},null,8,["options"]))])):(0,r.Q3)("",!0),(0,r.bF)(b,{isVisible:i.showScheduleConfigModal,title:"Configurer le planning des matchs",onClose:t[10]||(t[10]=e=>i.showScheduleConfigModal=!1),size:"lg"},{content:(0,r.k6)((()=>[(0,r.bF)(v,{modelValue:i.scheduleConfig,"onUpdate:modelValue":t[8]||(t[8]=e=>i.scheduleConfig=e),fields:i.scheduleFormFields,onFormSubmit:l.saveScheduleConfig,onFormCancel:t[9]||(t[9]=e=>i.showScheduleConfigModal=!1),columns:2,customValidation:l.validateForm,isEditing:!!this.scheduleConfig},null,8,["modelValue","fields","onFormSubmit","customValidation","isEditing"])])),_:1},8,["isVisible"]),(0,r.bF)(b,{title:l.createModalTitle,isVisible:i.showCreateModal,onClose:t[13]||(t[13]=e=>i.showCreateModal=!1)},{content:(0,r.k6)((()=>[(0,r.bF)(v,{modelValue:i.createFormData,"onUpdate:modelValue":t[11]||(t[11]=e=>i.createFormData=e),fields:l.createFormFields,onFormSubmit:l.saveNewEvent,onFormCancel:t[12]||(t[12]=e=>i.showCreateModal=!1),customValidation:l.validateForm},null,8,["modelValue","fields","onFormSubmit","customValidation"])])),_:1},8,["title","isVisible"]),(0,r.bF)(b,{isVisible:i.showEditModal,onClose:t[16]||(t[16]=e=>i.showEditModal=!1),title:"Modifier le match"},{content:(0,r.k6)((()=>[(0,r.bF)(v,{modelValue:i.eventFormData,"onUpdate:modelValue":t[14]||(t[14]=e=>i.eventFormData=e),fields:l.eventFormFields,onFormSubmit:l.saveEventEdits,onFormCancel:t[15]||(t[15]=e=>i.showEditModal=!1),customValidation:l.validateForm},null,8,["modelValue","fields","onFormSubmit","customValidation"])])),_:1},8,["isVisible"])])}s(7642),s(8004),s(3853),s(5876),s(2475),s(5024),s(1698);var Id={components:{FullCalendar:qa.A,TourneySubMenu:mo,ErrorMessageComponent:Ga,StatusSelectorComponent:ko,ButtonComponent:ke,ModalComponent:mt,FormComponent:jt,DeleteConfirmationModal:Gt,StrategyPlanningGeneratorComponent:Yl,vSelect:Zl.A,PlanningViewSelector:nd},data(){return{tourneyId:this.$route.params.tourneyId,tourney:{},fields:[],teams:[],games:[],pools:[],sports:[],scheduleConfig:{},formErrors:{},selectedPoolId:null,planningStatusOptions:[{value:"draft",label:"Edition"},{value:"completed",label:"Terminé"}],scheduleFormFields:[{name:"gameDuration",type:"number",label:"Durée d’un match (en minutes)",required:!0},{name:"transitionGameTime",type:"number",label:"Transition entre les matchs (en minutes)",required:!0}],warnings:[],showScheduleConfigModal:!1,showWarningsModal:!1,isSmallScreen:!1,currentPage:1,terrainsPerPage:6,showAllTerrains:!1,showEditModal:!1,eventToEdit:null,eventFormData:{},showGeneratePlanningConfirmation:!1,showClearPlanningConfirmation:!1,useUnifiedColors:!0,colorMap:{},showCreateModal:!1,createFormData:{startTime:"",endTime:"",poolScheduleId:null,fieldId:"",sportId:"",teamAId:null,teamBId:null}}},computed:{...(0,x.aH)("tourney",{statuses:e=>e.statuses,tourneyType:e=>e.tourneyType}),currentStatus:{get(){return this.statuses.planningStatus},set(e){this.$store.dispatch("tourney/updateStatus",{tourneyId:this.tourneyId,key:"planningStatus",value:e})}},pages(){if(this.showAllTerrains)return[this.filteredFields];const e=this.filteredFields.length,t=this.terrainsPerPage,s=Math.ceil(e/t),o=Math.floor(e/s);let r=e%s;const a=[];let n=0;for(let i=0;i<s;i++){let e=o;r>0&&(e+=1,r-=1);const t=n+e;a.push(this.filteredFields.slice(n,t)),n=t}return a},totalPages(){return this.pages.length},paginatedFields(){return this.pages[this.currentPage-1]},filteredFields(){if(this.selectedPoolId){const e=new Set,t=this.pools.find((e=>e.id===this.selectedPoolId));return t&&t.schedules&&t.schedules.forEach((t=>{e.add(t.fieldId)})),this.fields.filter((t=>e.has(t.id)))}return this.fields},editTeamOptions(){if(this.eventToEdit&&this.eventToEdit.extendedProps.game.pool){const e=this.eventToEdit.extendedProps.game.pool.id;return this.teams.filter((t=>t.poolId===e)).map((e=>({value:e.id,label:e.teamName})))}return this.teamOptions},isEditable(){return"completed"!==this.statuses.planningStatus},hasGames(){return this.games.length>0},generateUniqueColor(){return e=>{if(!e)return"#888888";if(this.colorMap[e])return this.colorMap[e];const t=137.508*e%360,s=`hsl(${t}, 70%, 60%)`;return this.colorMap[e]=s,s}},poolOptions(){return[{id:null,name:"All Pools"},...this.pools]},teamOptions(){return this.teams.map((e=>({value:e.id,label:e.teamName})))},fieldOptions(){return this.fields.map((e=>({value:e.id,label:e.name})))},sportOptions(){return this.sports.map((e=>({value:e.id,label:e.name})))},filteredTeams(){return this.selectedPoolId?this.teams.filter((e=>e.poolId===this.selectedPoolId)):this.teams},calendarOptions(){if(!this.tourney.dateTourney)return console.error("La date du tournoi n’est pas disponible"),{};const e=[];return this.games.forEach((t=>{if(this.selectedPoolId&&t.pool?.id!==this.selectedPoolId)return;if(!t.field)return void console.warn(`Game with ID ${t.id} has no field assigned.`);const s=t.teamA?.teamName||"Équipe A",o=t.teamB?.teamName||"Équipe B";e.push({id:t.id.toString(),resourceId:t.field.id.toString(),title:`${s} vs ${o}`,start:new Date(t.startTime).toISOString(),end:new Date(t.endTime).toISOString(),backgroundColor:this.useUnifiedColors?this.generateUniqueColor(t.pool?.id):t.sport?.color||"#3B82F6",textColor:"#FFFFFF",extendedProps:{game:t}})})),this.pools.forEach((t=>{t.schedules&&t.schedules.length>0&&t.schedules.forEach((s=>{this.selectedPoolId&&t.id!==this.selectedPoolId||e.push({id:`pool-${t.id}-schedule-${s.id}`,start:`${s.date}T${s.startTime}`,end:`${s.date}T${s.endTime}`,resourceId:s.fieldId.toString(),display:"background",backgroundColor:this.generateUniqueColor(t.id)})}))})),{plugins:[Na.A,Ba.Ay,Wa.A],schedulerLicenseKey:"CC-Attribution-NonCommercial-NoDerivatives",initialView:"resourceTimeGridDay",timeZone:"UTC",initialDate:this.tourney.dateTourney,editable:this.isEditable,droppable:!0,eventStartEditable:!0,eventDurationEditable:!0,selectable:this.isEditable,select:this.handleSelect,eventOverlap:!0,height:"auto",slotMinTime:this.adjustedSlotMinTime,slotMaxTime:this.adjustedSlotMaxTime,slotDuration:"00:05:00",slotLabelInterval:"00:15:00",allDaySlot:!1,resources:this.paginatedFields.map((e=>({id:e.id.toString(),title:e.name}))),events:e,resourceAreaHeaderContent:"Terrains",slotLabelFormat:{hour:"2-digit",minute:"2-digit",hour12:!1,timeZone:"local"},headerToolbar:!1,eventDrop:this.handleEventDrop,eventResize:this.handleEventResize,eventContent:this.renderEventContent}},adjustedSlotMinTime(){const e=this.scheduleConfig.startTime||"07:00:00";return e},adjustedSlotMaxTime(){const e=this.scheduleConfig.endTime||"23:00:00";return e},eventFormFields(){return[{name:"teamAId",type:"select",label:"Équipe A",options:this.editTeamOptions,required:!0},{name:"teamBId",type:"select",label:"Équipe B",options:this.editTeamOptions,required:!0},{name:"startTime",type:"datetime-local",label:"Heure de début",required:!0},{name:"endTime",type:"datetime-local",label:"Heure de fin",required:!0}]},createFormFields(){const e=[{name:"teamAId",type:"select",label:"Équipe A",options:this.createTeamOptions,required:!0},{name:"teamBId",type:"select",label:"Équipe B",options:this.createTeamOptions,required:!0},{name:"startTime",type:"datetime-local",label:"Heure de début",required:!0},{name:"endTime",type:"datetime-local",label:"Heure de fin",required:!0}];return this.createFormData.poolScheduleId||e.push({name:"fieldId",type:"select",label:"Terrain",options:this.fieldOptions,required:!0},{name:"sportId",type:"select",label:"Sport",options:this.sportOptions,required:!0}),e},autoCalculateEndTime(){return!!this.createFormData.poolScheduleId},createTeamOptions(){if(this.createFormData.poolScheduleId){const e=this.findPoolByScheduleId(this.createFormData.poolScheduleId);if(e)return e.teams.map((e=>({value:e.id,label:e.teamName})))}return this.teamOptions},createModalTitle(){if(this.createFormData.poolScheduleId){const e=this.findPoolByScheduleId(this.createFormData.poolScheduleId);if(e){const t=e.schedules.find((e=>e.id===this.createFormData.poolScheduleId)),s=t.sport?t.sport.name:"Sport";return`${e.name} - ${s}`}}return"Créer un Match"}},watch:{useUnifiedColors(){this.$refs.fullCalendar&&this.$refs.fullCalendar.getApi().refetchEvents()},currentPage(){if(this.$refs.fullCalendar){const e=this.$refs.fullCalendar.getApi();e.refetchResources()}}},methods:{...(0,x.i0)("tourney",["fetchTourneyStatuses","setTournamentName","clearTournamentName"]),async fetchPlanningDetails(){try{await this.fetchTourneyStatuses(this.tourneyId);const e=await $.get(`/tourneys/${this.tourneyId}/planning/details`),t=e.data;this.fields=t.fields||[],this.pools=t.pools||[],this.games=t.games||[],this.sports=t.sports||[],this.scheduleConfig=t.scheduleTourney||this.scheduleConfig;const s=await $.get(`/tourneys/${this.tourneyId}`);this.tourney=s.data;const o=await $.get(`/tourneys/${this.tourneyId}/teams`);this.teams=o.data,this.tourney.dateTourney||console.warn("La date du tournoi n'est pas définie.")}catch(e){console.error("Erreur lors de la récupération des détails du planning:",e)}},refreshCalendarEvents(){if(this.$refs.fullCalendar){const e=this.$refs.fullCalendar.getApi();e.refetchEvents()}},renderEventContent(e){const t=document.createElement("div");t.classList.add("flex","flex-col","space-y-1");const s=document.createElement("div");s.classList.add("flex","justify-between","items-center");const o=document.createElement("span");if(o.innerText=e.event.title,o.classList.add("font-semibold","text-white"),s.appendChild(o),this.isEditable&&"background"!==e.event.display){const t=document.createElement("span");t.innerHTML="&#9998;",t.classList.add("edit-icon"),t.style.color="yellow",t.style.cursor="pointer",t.style.padding="0 5px",t.addEventListener("click",(t=>{t.stopPropagation(),this.openEditModal(e.event)}));const o=document.createElement("span");let r;o.innerHTML="&#10060;",o.classList.add("delete-icon"),o.style.color="white",o.style.cursor="pointer",o.style.padding="0 5px",o.addEventListener("dblclick",(t=>{t.stopPropagation(),this.deleteEvent(e.event)})),s.appendChild(t),o.addEventListener("touchstart",(t=>{t.stopPropagation(),r=setTimeout((()=>{this.deleteEvent(e.event)}),600)})),o.addEventListener("touchend",(()=>{clearTimeout(r)})),s.appendChild(o)}const r=e.event.start?this.formatDisplayTime(e.event.start):"",a=e.event.end?this.formatDisplayTime(e.event.end):"",n=document.createElement("div");r&&a&&(n.innerText=`${r} - ${a}`,n.classList.add("text-sm","text-white"));const i=e.event.extendedProps.game;if(i){const e=document.createElement("div"),o=i.pool?i.pool.name:"",r=i.sport?i.sport.name:"";e.innerText=`${o} - ${r}`,e.classList.add("text-xs","text-white"),t.appendChild(s),t.appendChild(n),t.appendChild(e)}else t.appendChild(s),r&&a&&t.appendChild(n);return{domNodes:[t]}},async downloadExcel(){try{const e=we.oR.info("Téléchargement du fichier en cours...",{autoClose:!1}),t=await $.get(`/tourneys/${this.tourneyId}/export-data/excel`,{responseType:"blob"}),s=t.data,o=window.URL.createObjectURL(s),r=document.createElement("a");r.href=o,r.download=`tournament_${this.tourneyId}.xlsx`,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(o),we.oR.update(e,{render:"Téléchargement terminé avec succès !",type:we.oR.TYPE.SUCCESS,autoClose:2e3})}catch(e){console.error("Erreur lors du téléchargement Excel :",e),we.oR.error(e.message||"Une erreur s'est produite lors du téléchargement.")}},warningClass(e){switch(e){case"grave":return"text-red-600 font-bold";case"moyenne":return"text-orange-600 font-semibold";case"faible":return"text-yellow-600";default:return""}},handleSelect(e){if(!this.isEditable)return;const t=this.findPoolScheduleForSelection(e);this.createFormData=t?{startTime:this.formatDateTime(e.start),endTime:this.calculateEndTime(e.start,this.scheduleConfig.gameDuration),poolScheduleId:t.id,teamAId:null,teamBId:null,fieldId:null,sportId:null}:{startTime:this.formatDateTime(e.start),endTime:this.calculateEndTime(e.start,this.scheduleConfig.gameDuration),poolScheduleId:null,fieldId:e.resource.id,sportId:null,teamAId:null,teamBId:null},this.showCreateModal=!0},findPoolScheduleForSelection(e){const t=e.start,s=e.end,o=e.resource.id;for(const r of this.pools)for(const e of r.schedules)if(e.fieldId.toString()===o){const o=new Date(`${e.date}T${e.startTime}`),r=new Date(`${e.date}T${e.endTime}`);if(t>=o&&s<=r)return e}return null},findPoolByScheduleId(e){for(const t of this.pools)if(t.schedules.some((t=>t.id===e)))return t;return null},formatDateTime(e){const t=new Date(e);return isNaN(t.getTime())?null:t.toISOString().slice(0,16)},calculateEndTime(e,t){const s=new Date(e.getTime()+6e4*t);return this.formatDateTime(s)},async saveNewEvent(){try{const e={teamAId:this.createFormData.teamAId,teamBId:this.createFormData.teamBId,startTime:this.createFormData.startTime.replace("T"," ")+":00",endTime:this.createFormData.endTime.replace("T"," ")+":00"};this.createFormData.poolScheduleId?e.poolScheduleId=this.createFormData.poolScheduleId:(e.fieldId=Number(this.createFormData.fieldId),e.sportId=this.createFormData.sportId);const t=await $.post(`/tourneys/${this.tourneyId}/games`,e),s=t.data;if(!s.field&&e.fieldId){const t=this.fields.find((t=>t.id===e.fieldId));t?s.field=t:console.warn(`Field with ID ${e.fieldId} not found.`)}if(!s.sport&&e.sportId){const t=this.sports.find((t=>t.id===e.sportId));t?s.sport=t:console.warn(`Sport with ID ${e.sportId} not found.`)}this.games.push(s),this.refreshCalendarEvents(),this.showCreateModal=!1}catch(e){console.error("Erreur lors de la création du match :",e),we.oR.error("Erreur lors de la création du match.")}},findPoolScheduleAtPosition(e,t,s){for(const o of this.pools)for(const r of o.schedules)if(r.fieldId.toString()===s){const s=new Date(`${r.date}T${r.startTime}`),o=new Date(`${r.date}T${r.endTime}`);if(e>=s&&t<=o)return r}return null},async handleEventDrop(e){if(!this.isEditable)return void e.revert();const t=e.event,s=t.id,o=t.getResources()[0]?.id,r=t.start,a=t.end,n=t.extendedProps.game;try{const i=this.findPoolScheduleAtPosition(r,a,o);let l={startTime:this.formatTime(r),endTime:this.formatTime(a),fieldId:o,poolScheduleId:n.poolScheduleId||null};if(n.poolScheduleId){if(!i||i.id!==n.poolScheduleId)return we.oR.warning("Vous ne pouvez pas déplacer ce match en dehors de son pool schedule."),void e.revert();if(i.id!==n.poolScheduleId){if(i.sportId!==n.sport.id)return we.oR.warning("Vous ne pouvez pas déplacer ce match vers un pool schedule avec un sport différent."),void e.revert();l.poolScheduleId=i.id}l.poolScheduleId=n.poolScheduleId}else{if(i)return we.oR.warning("Vous ne pouvez pas déplacer ce match dans un créneau de pool."),void e.revert();l.poolScheduleId=null}const d=await $.put(`/tourneys/${this.tourneyId}/games/${s}`,l),u=this.games.findIndex((e=>e.id.toString()===t.id));-1!==u&&(this.games[u]=d.data),t.setExtendedProp("game",d.data)}catch(i){console.error("Erreur lors du déplacement de l'événement :",i),e.revert()}},findPoolScheduleForEvent(e){const t=e.start,s=e.end,o=e.getResources()[0]?.id;for(const r of this.pools)for(const e of r.schedules)if(e.fieldId.toString()===o){const o=new Date(`${e.date}T${e.startTime}`),r=new Date(`${e.date}T${e.endTime}`);if(t>=o&&s<=r)return e}return null},async handleEventResize(e){if(!this.isEditable)return void e.revert();const t=e.event;try{const s=t.id,o=t.getResources()[0]?.id;if(!s||!o)return console.error("Problème d'ID : Terrain ou événement mal identifié."),void e.revert();const r={fieldId:o,startTime:this.formatTime(t.start),endTime:this.formatTime(t.end),date:this.tourney.dateTourney},a=this.findPoolScheduleForEvent(t);if(t.extendedProps.game.poolScheduleId&&!a||a&&t.extendedProps.game.poolScheduleId!==a.id)return we.oR.error("Vous ne pouvez pas redimensionner ce match en dehors de son pool schedule."),void e.revert();a&&(r.poolScheduleId=a.id);const n=await $.put(`/tourneys/${this.tourneyId}/games/${s}`,r),i=this.games.findIndex((e=>e.id.toString()===s.toString()));-1!==i&&(this.games[i]=n.data),t.setExtendedProp("game",n.data)}catch(s){console.error("Erreur lors du redimensionnement de l'événement :",s),e.revert()}},async saveEventEdits(){try{const e={teamAId:this.eventFormData.teamAId,teamBId:this.eventFormData.teamBId,startTime:this.eventFormData.startTime.replace("T"," ")+":00",endTime:this.eventFormData.endTime.replace("T"," ")+":00",fieldId:this.eventFormData.fieldId},t=await $.put(`/tourneys/${this.tourneyId}/games/${this.eventToEdit.id}`,e),s=this.games.findIndex((e=>e.id.toString()===this.eventToEdit.id.toString()));-1!==s&&(this.games[s]=t.data);const o=this.eventToEdit;o.setExtendedProp("game",t.data),this.refreshCalendarEvents(),this.showEditModal=!1}catch(e){console.error("Erreur lors de la sauvegarde des modifications :",e),we.oR.error("Erreur lors de la sauvegarde des modifications.")}},async deleteEvent(e){if(this.isEditable)try{await $.delete(`/tourneys/${this.tourneyId}/games/${e.id}`),e.remove(),this.games=this.games.filter((t=>t.id.toString()!==e.id.toString()))}catch(t){console.error("Erreur lors de la suppression du match :",t),we.oR.error("Erreur lors de la suppression du match.")}},formatDisplayTime(e){const t=new Date(e);if(isNaN(t.getTime()))return"";const s=t.getUTCHours().toString().padStart(2,"0"),o=t.getUTCMinutes().toString().padStart(2,"0");return`${s}:${o}`},formatTime(e){const t=new Date(e);if(isNaN(t.getTime()))return null;const s=t.getFullYear().toString().padStart(4,"0"),o=(t.getMonth()+1).toString().padStart(2,"0"),r=t.getDate().toString().padStart(2,"0"),a=t.getHours().toString().padStart(2,"0"),n=t.getMinutes().toString().padStart(2,"0"),i=t.getSeconds().toString().padStart(2,"0");return`${s}-${o}-${r} ${a}:${n}:${i}`},openScheduleConfigModal(){this.showScheduleConfigModal=!0,this.loadScheduleConfig()},openEditModal(e){this.eventToEdit=e;const t=e.extendedProps.game;this.eventFormData={teamAId:t.teamA.id,teamBId:t.teamB.id,startTime:this.formatDateTime(e.start),endTime:this.formatDateTime(e.end),fieldId:e.getResources()[0]?.id},this.showEditModal=!0},async loadScheduleConfig(){try{const e=await $.get(`/tourneys/${this.tourneyId}/schedule`);e.data&&(this.scheduleConfig=e.data)}catch(e){e.response&&404===e.response.status?console.warn("Aucune configuration existante du planning trouvée. Utilisation des valeurs par défaut."):console.error("Erreur lors de la récupération de la configuration du planning :",e)}},openGeneratePlanningModal(){this.showGeneratePlanningConfirmation=!0},closeGeneratePlanningConfirmation(){this.showGeneratePlanningConfirmation=!1},confirmClearPlanning(){this.showClearPlanningConfirmation=!0},closeClearPlanningConfirmation(){this.showClearPlanningConfirmation=!1},async handlePlanningGenerated(){await this.fetchPlanningDetails(),this.closeGeneratePlanningConfirmation(),this.validatePlanning()},validateEventDrop(e,t){const s=e.extendedProps.game,o=this.poolSchedules.find((e=>e.id===s.poolScheduleId&&e.field.id.toString()===t));return!!o},async clearPlanning(){try{await $.delete(`/tourneys/${this.tourneyId}/planning/games/reset`),we.oR.success("Planning des matchs supprimé avec succès !"),this.showClearPlanningConfirmation=!1,await this.fetchPlanningDetails()}catch(e){console.error("Erreur lors de la suppression du planning :",e),we.oR.error("Erreur lors de la suppression du planning.")}},async validatePlanning(){try{const e=await $.post(`/tourneys/${this.tourneyId}/planning/games/validate`),t=e.data.validation;if(t.hasErrors){const e=[];t.errors.high.length>0&&t.errors.high.forEach((t=>{e.push({type:"grave",message:t})})),t.errors.mid.length>0&&t.errors.mid.forEach((t=>{e.push({type:"moyenne",message:t})})),t.errors.low.length>0&&t.errors.low.forEach((t=>{e.push({type:"faible",message:t})})),this.warnings=e,this.showWarningsModal=!0}else we.oR.success("Le planning des matchs est valide sans erreurs."),this.warnings=[],this.showWarningsModal=!1}catch(e){console.error("Erreur lors de la validation du planning :",e),we.oR.error("Erreur lors de la validation du planning.")}},async saveScheduleConfig(){try{let e="";this.scheduleConfig.id?(await $.put(`/tourneys/${this.tourneyId}/schedule/${this.scheduleConfig.id}`,this.scheduleConfig),e="Configuration du planning des matchs mise à jour avec succès !"):(await $.post(`/tourneys/${this.tourneyId}/schedule`,this.scheduleConfig),e="Configuration du planning des matchs enregistrée avec succès !"),this.showScheduleConfigModal=!1,await this.fetchPlanningDetails(),we.oR.success(e)}catch(e){console.error("Erreur lors de la sauvegarde de la configuration du planning :",e),we.oR.error("Erreur lors de la sauvegarde de la configuration du planning.")}},closeWarningsModal(){this.showWarningsModal=!1,this.warnings=[]},validateForm(){let e,t="";this.showCreateModal?(e=this.createFormData,t="create"):this.showEditModal?(e=this.eventFormData,t="edit"):this.showScheduleConfigModal?(e=this.scheduleConfig,t="schedule"):e={};const s={};if("create"!==t&&"edit"!==t||(e.teamAId||(s.teamAId="Veuillez sélectionner l'équipe A."),e.teamBId||(s.teamBId="Veuillez sélectionner l'équipe B."),e.teamAId&&e.teamBId&&e.teamAId===e.teamBId&&(s.teamBId="L'équipe B doit être différente de l'équipe A."),e.poolScheduleId||(e.fieldId||(s.fieldId="Veuillez sélectionner un terrain."),e.sportId||(s.sportId="Veuillez sélectionner un sport."))),"schedule"===t){const{startTime:t,endTime:o,introStart:r,introEnd:a,lunchStart:n,lunchEnd:i,outroStart:l,outroEnd:d}=e,u=e=>{const[t,s,o]=e.split(":").map(Number);return 3600*t+60*s+(o||0)},c=u(t),m=u(o);c>=m&&(s.startTime="L'heure de début doit être inférieure à l'heure de fin.",s.endTime="L'heure de fin doit être supérieure à l'heure de début.");const h=[{start:r,end:a,label:"Introduction",startField:"introStart",endField:"introEnd"},{start:n,end:i,label:"Déjeuner",startField:"lunchStart",endField:"lunchEnd"},{start:l,end:d,label:"Conclusion",startField:"outroStart",endField:"outroEnd"}];for(const e of h)if(e.start&&e.end){const r=u(e.start),a=u(e.end);r>=a&&(s[e.startField]=`L'heure de début doit être inférieure à l'heure de fin pour la section ${e.label}.`,s[e.endField]=`L'heure de fin doit être supérieure à l'heure de début pour la section ${e.label}.`),(r<c||a>m)&&(s[e.startField]=`Les heures de ${e.label} doivent être comprises entre le début (${t}) et la fin (${o}) du planning global.`,s[e.endField]=`Les heures de ${e.label} doivent être comprises entre le début (${t}) et la fin (${o}) du planning global.`)}else(e.start&&!e.end||!e.start&&e.end)&&(s[e.startField]=`Veuillez fournir à la fois l'heure de début et de fin pour la section ${e.label}.`,s[e.endField]=`Veuillez fournir à la fois l'heure de début et de fin pour la section ${e.label}.`)}return s},checkScreenSize(){this.isSmallScreen=window.innerWidth<768,this.terrainsPerPage=this.isSmallScreen?2:10},adjustTerrainsPerPage(){const e=window.innerWidth;this.terrainsPerPage=e>=1200?6:e>=1e3?4:e>=800?3:2}},async mounted(){this.adjustTerrainsPerPage(),window.addEventListener("resize",this.adjustTerrainsPerPage),await this.fetchPlanningDetails()}};const Sd=(0,E.A)(Id,[["render",Ed],["__scopeId","data-v-423963d9"]]);var Fd=Sd,Pd=[{path:"/admin",name:"Admin",component:et,meta:{requiresAuth:!0,permission:"viewAdminPage"}},{path:"/admin/tourneys",name:"AdminTourneysList",component:$s,meta:{requiresAuth:!0,permission:"viewAdminPage"}},{path:"/admin/tourneys/:tourneyId",name:"AdminTourneyDetails",component:Wo,meta:{requiresAuth:!0,permission:"viewAdminPage"}},{path:"/admin/sports",name:"AdminSportsManagement",component:Ko,meta:{requiresAuth:!0,permission:"viewAdminPage"}},{path:"/admin/users",name:"AdminUsersList",component:Ur,meta:{requiresAuth:!0,permission:"viewAdminPage"}},{path:"/admin/users/:userId",name:"AdminUserProfile",component:Ta,meta:{requiresAuth:!0,permission:"viewAdminPage"}},{path:"/admin/tourneys/:tourneyId/fields",name:"AdminTourneyFieldsManagement",component:Pa,meta:{requiresAuth:!0,permission:"viewAdminPage"}},{path:"/admin/tourneys/:tourneyId/sports-fields",name:"AdminTourneySportsFields",component:Ka,meta:{requiresAuth:!0,permission:"viewAdminPage"}},{path:"/admin/tourneys/:tourneyId/teams",name:"AdminTourneyTeams",component:Nn,meta:{requiresAuth:!0,permission:"viewAdminPage"}},{path:"/admin/tourneys/:tourneyId/teams/:teamId/users",name:"AdminTourneyTeamUsers",component:ei,meta:{requiresAuth:!0,permission:"viewAdminPage"}},{path:"/admin/tourneys/:tourneyId/unassigned-users",name:"AdminTourneyUnassignedUsers",component:Gn,meta:{requiresAuth:!0,permission:"viewAdminPage"}},{path:"/admin/tourneys/:tourneyId/pools",name:"AdminTourneyPools",component:Pi,meta:{requiresAuth:!0,permission:"viewAdminPage"}},{path:"/admin/tourneys/:tourneyId/pools/:poolId",name:"AdminTourneyPoolDetails",component:al,meta:{requiresAuth:!0,permission:"viewAdminPage"}},{path:"/admin/tourneys/:tourneyId/pools/unassigned-teams",name:"AdminTourneyPoolsUnassignedTeams",component:vl,meta:{requiresAuth:!0,permission:"viewAdminPage"}},{path:"/admin/tourneys/:tourneyId/planning/pools",name:"AdminTourneyPlanningPools",component:dd,meta:{requiresAuth:!0,permission:"viewAdminPage"}},{path:"/admin/tourneys/:tourneyId/planning/games",name:"AdminTourneyPlanningGames",component:Fd,meta:{requiresAuth:!0,permission:"viewAdminPage"}}];function Ad(e,t,s,o,n,i){return(0,r.uX)(),(0,r.CE)("div",null,[(0,r.Lk)("h1",null,"Bienvenue Utilisateur "+(0,a.v_)(e.userName),1),t[0]||(t[0]=(0,r.Lk)("p",null,"Voici votre tableau de bord.",-1))])}var Ld={name:"UserPage",computed:{...(0,x.aH)({userName:e=>e.user?.name})}};const Dd=(0,E.A)(Ld,[["render",Ad],["__scopeId","data-v-2801b338"]]);var Md=Dd;const $d={key:0},Ud={key:1};function Rd(e,t,s,o,a,n){const i=(0,r.g2)("ProfilePageComponent");return null!==n.userId?((0,r.uX)(),(0,r.CE)("div",$d,[(0,r.bF)(i,{userId:n.userId,isAdmin:n.isAdmin},null,8,["userId","isAdmin"])])):((0,r.uX)(),(0,r.CE)("div",Ud,t[0]||(t[0]=[(0,r.Lk)("p",null,"Vous avez été déconnecté.",-1)])))}var Vd={components:{ProfilePageComponent:va},computed:{userId(){return this.$store.state.user?this.$store.state.user.id:null},isAdmin(){return this.$store.state?.user&&1===this.$store.state.user?.roleId}},watch:{userId(e){null===e&&this.$router.push("/login")}}};const _d=(0,E.A)(Vd,[["render",Rd]]);var Xd=_d;const qd={class:"p-6"},Nd={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-8"},Bd={class:"flex flex-wrap items-center gap-4 sm:gap-8 mt-4 sm:mt-0"},Wd={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"};function jd(e,t,s,a,n,i){const l=(0,r.g2)("TitleComponent"),d=(0,r.g2)("FilterComponent"),u=(0,r.g2)("ButtonComponent"),c=(0,r.g2)("CardEditComponent");return(0,r.uX)(),(0,r.CE)("div",qd,[(0,r.Lk)("div",Nd,[(0,r.bF)(l,{title:"Mes tournois"}),(0,r.Lk)("div",Bd,[(0,r.bF)(d,{filters:n.filters,onFilterChange:i.handleFilterChange},null,8,["filters","onFilterChange"])])]),(0,r.Lk)("div",Wd,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.filteredTourneys,(e=>((0,r.uX)(),(0,r.Wv)(c,{key:e.id,title:e.name,location:e.location,date:e.dateTourney,status:e.status,"registration-status":e.registrationStatus,"title-color":i.getTitleColor(e),onClick:t=>i.viewTourneyDetails(e)},{"button-actions":(0,r.k6)((()=>["draft"!==e.status?((0,r.uX)(),(0,r.Wv)(u,{key:0,variant:"primary",fontAwesomeIcon:"info-circle",onClick:(0,o.D$)((t=>i.goToInfo(e)),["stop"])},{default:(0,r.k6)((()=>t[0]||(t[0]=[(0,r.eW)(" Infos ")]))),_:2},1032,["onClick"])):(0,r.Q3)("",!0)])),_:2},1032,["title","location","date","status","registration-status","title-color","onClick"])))),128))])])}var Qd={components:{CardEditComponent:vs,TitleComponent:Ls,FilterComponent:Ss,ButtonComponent:ke},data(){return{userTourneys:[],filterStatus:"",filterDate:"",filters:[{label:"Filtrer par statut",value:this.filterStatus||"",placeholder:"Tous les statuts",options:[{label:"Tous les statuts",value:""},{label:"Brouillon",value:"draft"},{label:"Prêt",value:"ready"},{label:"En cours",value:"active"},{label:"Terminé",value:"completed"}]},{label:"Filtrer par date",value:this.filterDate||"",options:[{label:"Toutes les dates",value:""},{label:"À venir",value:"upcoming"},{label:"Passés",value:"past"}]}]}},computed:{filteredTourneys(){return this.userTourneys.filter((e=>{const t=!this.filterStatus||e.status===this.filterStatus,s="upcoming"===this.filterDate?new Date(e.dateTourney)>=new Date:"past"!==this.filterDate||new Date(e.dateTourney)<new Date;return t&&s}))}},methods:{async fetchUserTourneys(){const e=this.$store.state.user.id;try{let t;t=this.isAdmin()?await $.get("/tourneys"):await $.get(`/users/${e}/tourneys`),this.userTourneys=t.data,localStorage.setItem("userTourneys",JSON.stringify(this.userTourneys))}catch(t){if(console.error("Erreur lors de la récupération des tournois:",t),we.oR.error("Erreur lors de la récupération des tournois!"),!navigator.onLine){const e=localStorage.getItem("userTourneys");e?this.userTourneys=JSON.parse(e):console.warn("Aucun tournoi trouvé en cache local.")}}},isAdmin(){return 1===this.$store.state.user?.roleId},handleFilterChange(e){"Filtrer par statut"===e.label?this.filterStatus=e.value:"Filtrer par date"===e.label&&(this.filterDate=e.value)},getTitleColor(e){return"active"===e.status?"#48bb78":"completed"===e.status?"#a0aec0":"active"===e.registrationStatus?"#ed8936":"notStarted"===e.registrationStatus||"completed"===e.registrationStatus?"#f56565":"#4299e1"},goToInfo(e){this.$router.push(`/tourneys/${e.id}/infos`)},viewTourneyDetails(e){if(this.isCardClickable(e))if("active"===e.status||"completed"===e.status||this.isAdmin())this.$router.push(`/tourneys/${e.id}/planning`);else{if("active"!==e.registrationStatus&&"completed"!==e.registrationStatus)return;this.$router.push(`/tourneys/${e.id}/join-team`)}},isCardClickable(e){return!!this.isAdmin()||("draft"!==e.registrationStatus&&"notStarted"!==e.registrationStatus||"active"===e.status||"completed"===e.status)}},mounted(){this.fetchUserTourneys()}};const Od=(0,E.A)(Qd,[["render",jd],["__scopeId","data-v-08faebea"]]);var Gd=Od;const zd={class:"p-6"},Hd={class:"flex items-center mb-2 justify-between"},Kd={key:0},Jd={class:"p-2"},Yd={key:0,class:"text-green-600"},Zd={key:1,class:"text-yellow-600"},eu={key:2,class:"text-red-600"},tu={key:0,class:"mb-8"},su={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},ou={class:"grid grid-cols-2 gap-2 mt-2"},ru={class:"truncate"},au={class:"mb-4 flex items-center space-x-4"},nu={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"},iu={class:"grid grid-cols-2 gap-2 mt-2"},lu={class:"truncate"},du={key:1,class:"mt-4"};function uu(e,t,s,n,i,l){const d=(0,r.g2)("TitleComponent"),u=(0,r.g2)("ButtonComponent"),c=(0,r.g2)("font-awesome-icon"),m=(0,r.g2)("CardEditComponent"),h=(0,r.g2)("DeleteConfirmationModal");return(0,r.uX)(),(0,r.CE)("div",null,[(0,r.Lk)("div",zd,[(0,r.Lk)("div",Hd,[(0,r.bF)(d,{title:"Equipes du tournoi"}),l.isRegistrationActive?((0,r.uX)(),(0,r.CE)("div",Kd,[(0,r.bF)(u,{variant:"danger",onClick:l.confirmQuitTournament},{default:(0,r.k6)((()=>t[3]||(t[3]=[(0,r.eW)(" Quitter Tournoi ")]))),_:1},8,["onClick"])])):(0,r.Q3)("",!0)]),(0,r.Lk)("div",Jd,[l.isRegistrationActive?((0,r.uX)(),(0,r.CE)("p",Yd," Les inscriptions sont ouvertes. Vous pouvez rejoindre ou quitter un groupe. ")):l.isRegistrationClosed?((0,r.uX)(),(0,r.CE)("p",Zd," Les inscriptions sont fermées. Vous ne pouvez pas rejoindre ou quitter un groupe. ")):l.isRegistrationCompleted?((0,r.uX)(),(0,r.CE)("p",eu," Les inscriptions sont terminées. Vous ne pouvez pas rejoindre ou quitter un groupe. ")):(0,r.Q3)("",!0)]),i.userTeam?((0,r.uX)(),(0,r.CE)("div",tu,[t[5]||(t[5]=(0,r.Lk)("h2",{class:"text-2xl font-semibold mb-4"},"Votre équipe",-1)),(0,r.Lk)("div",su,[(0,r.bF)(m,{title:i.userTeam.teamName||"Nom manquant",cornerCount:`${i.userTeam.usersTourneys?i.userTeam.usersTourneys.length:0}/${l.getTeamCapacity(i.userTeam)}`,titleColor:l.getStatusColor(i.userTeam),onClick:t[0]||(t[0]=e=>l.openTeamDetails(i.userTeam))},{"button-actions":(0,r.k6)((()=>[l.isRegistrationActive?((0,r.uX)(),(0,r.Wv)(u,{key:0,onClick:(0,o.D$)(l.confirmLeaveTeam,["stop"]),variant:"danger"},{default:(0,r.k6)((()=>t[4]||(t[4]=[(0,r.eW)(" Quitter ")]))),_:1},8,["onClick"])):(0,r.Q3)("",!0)])),"user-list":(0,r.k6)((()=>[(0,r.Lk)("ul",ou,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.userTeam.usersTourneys||[],(e=>((0,r.uX)(),(0,r.CE)("li",{key:e.userId,class:"flex items-center text-sm text-light-form-text dark:text-dark-form-text truncate"},[(0,r.bF)(c,{icon:"user",class:"mr-2 text-gray-500"}),(0,r.Lk)("span",ru,(0,a.v_)(e.user.name),1)])))),128))])])),_:1},8,["title","cornerCount","titleColor"]),(0,r.bF)(h,{title:"Quitter le groupe",message:"Êtes-vous sûr de vouloir quitter le groupe ?",isVisible:i.showDeleteConfirmation,textButton:"Quitter",onFormCancel:l.closeDeleteConfirmation,onConfirm:l.leaveTeam},null,8,["isVisible","onFormCancel","onConfirm"])])])):(0,r.Q3)("",!0),t[9]||(t[9]=(0,r.Lk)("h2",{class:"text-2xl font-semibold mt-8 mb-4"},"Toutes les équipes",-1)),(0,r.Lk)("div",au,[(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>i.searchQuery=e),type:"text",placeholder:"Rechercher un groupe ou un utilisateur",class:"border p-2 rounded w-full md:w-1/3 dark:bg-dark-menu"},null,512),[[o.Jo,i.searchQuery]]),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>i.selectedFilter=e),class:"border p-2 rounded dark:bg-dark-menu"},t[6]||(t[6]=[(0,r.Lk)("option",{value:""},"Tous les groupes",-1),(0,r.Lk)("option",{value:"non-full"},"Groupes partiels",-1),(0,r.Lk)("option",{value:"full"},"Groupes pleins",-1),(0,r.Lk)("option",{value:"empty"},"Groupes vides",-1)]),512),[[o.u1,i.selectedFilter]])]),(0,r.Lk)("div",nu,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.filteredTeams,(e=>((0,r.uX)(),(0,r.Wv)(m,{key:e.id,title:e.teamName||"Nom manquant",cornerCount:`${e.usersTourneys.length}/${l.getTeamCapacity(e)}`,titleColor:l.getStatusColor(e),isEditable:l.isRegistrationActive,onClick:t=>l.openTeamDetails(e)},{"button-actions":(0,r.k6)((()=>[!i.userTeam&&l.isRegistrationActive?((0,r.uX)(),(0,r.Wv)(u,{key:0,disabled:e.usersTourneys.length>=l.getTeamCapacity(e),onClick:(0,o.D$)((t=>l.joinTeam(e.id)),["stop"]),variant:"primary"},{default:(0,r.k6)((()=>t[7]||(t[7]=[(0,r.eW)(" Rejoindre ")]))),_:2},1032,["disabled","onClick"])):(0,r.Q3)("",!0)])),"user-list":(0,r.k6)((()=>[(0,r.Lk)("ul",iu,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.usersTourneys,(e=>((0,r.uX)(),(0,r.CE)("li",{key:e.userId,class:"flex items-center text-sm text-light-form-text dark:text-dark-form-text truncate"},[(0,r.bF)(c,{icon:"user",class:"mr-2 text-gray-500"}),(0,r.Lk)("span",lu,(0,a.v_)(e.user.name),1)])))),128))])])),_:2},1032,["title","cornerCount","titleColor","isEditable","onClick"])))),128))]),i.userTeam||l.isRegistrationActive?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",du,t[8]||(t[8]=[(0,r.Lk)("p",null," Les inscriptions sont fermées ou terminées. Vous ne pouvez pas rejoindre un groupe. ",-1)]))),(0,r.bF)(h,{title:"Quitter le Tournoi",message:"Quitter le tournoi vous supprimera de votre équipe. Avertissez vos coéquipiers afin que leur équipe reste valide.",hardDeleteMessage:"Cette action est définitive. Vous pourrez rejoindre le tournoi à nouveau avec un token d'invitation tant que les inscriptions sont ouvertes.",isVisible:i.showQuitConfirmation,isHardDelete:!0,textButton:"Quitter",onFormCancel:l.closeQuitConfirmation,onConfirm:l.leaveTournament},null,8,["isVisible","onFormCancel","onConfirm"])])])}var cu={components:{TitleComponent:Ls,CardEditComponent:vs,ButtonComponent:ke,DeleteConfirmationModal:Gt},data(){return{tourneyId:this.$route.params.tourneyId,teams:[],userTeam:null,teamSetup:null,registrationStatus:null,searchQuery:"",selectedFilter:"",showDeleteConfirmation:!1,hardDeleteMessage:"Êtes-vous sûr de vouloir quitter le tournoi ? Cette action est irréversible. Vous pourrez le rejoindre à nouveau avec un token invit tant que les inscriptions sont ouvertes.",showQuitConfirmation:!1}},computed:{isRegistrationActive(){return"active"===this.registrationStatus},isRegistrationClosed(){return"draft"===this.registrationStatus},isRegistrationCompleted(){return"completed"===this.registrationStatus},currentUserId(){return this.$store.state.user?this.$store.state.user.id:null},otherTeams(){return this.userTeam?this.teams.filter((e=>e.id!==this.userTeam.id)):this.teams},filteredTeams(){let e=this.otherTeams;if("non-full"===this.selectedFilter?e=e.filter((e=>e.usersTourneys.length<this.getTeamCapacity(e)&&e.usersTourneys.length>0&&"player"===e.type)):"full"===this.selectedFilter?e=e.filter((e=>e.usersTourneys.length>=this.getTeamCapacity(e)&&"player"===e.type)):"empty"===this.selectedFilter&&(e=e.filter((e=>0===e.usersTourneys.length&&"player"===e.type))),this.searchQuery){const t=this.searchQuery.toLowerCase();e=e.filter((e=>{const s=!!e.teamName&&e.teamName.toLowerCase().includes(t),o=e.usersTourneys.some((e=>e.user.name.toLowerCase().includes(t)));return s||o}))}return e}},methods:{...(0,x.i0)("tourney",["fetchTourneyStatuses"]),async fetchData(){try{await this.fetchTourneyStatuses(this.tourneyId);const e=await $.get(`/tourneys/${this.tourneyId}/teams-details`);this.teamSetup=e.data.teamSetup,this.teams=e.data.teams,this.unassignedUsers=e.data.unassignedUsers;const t=this.currentUserId,s=e.data.allUsers.find((e=>e.userId===t&&e.team));this.userTeam=s?this.teams.find((e=>e.id===s.teamId)):null,await this.fetchRegistrationStatus()}catch(e){console.error("Erreur lors de la récupération des données:",e),we.oR.error("Erreur lors de la récupération des données.")}},async fetchRegistrationStatus(){try{const e=await $.get(`/tourneys/${this.tourneyId}/registration-status`);this.registrationStatus=e.data.registrationStatus}catch(e){console.error("Erreur lors de la récupération du statut d'inscription:",e),we.oR.error("Erreur lors de la récupération du statut d'inscription.")}},getTeamCapacity(e){return"assistant"===e.type?this.teamSetup.playerPerTeam*this.teamSetup.maxTeamNumber||"Infinity":this.teamSetup?this.teamSetup.playerPerTeam:0},getStatusColor(e){const t=e.usersTourneys?e.usersTourneys.length:0,s=this.teamSetup?this.teamSetup.minPlayerPerTeam:0,o=this.getTeamCapacity(e);return t>=o?"red":t>=s?"green":t>0?"orange":"gray"},async joinTeam(e){this.showDeleteConfirmation=!1;try{if(this.userTeam)return void we.oR.error("Vous êtes déjà dans un groupe. Veuillez quitter votre groupe avant de rejoindre un autre.");const t=this.currentUserId;await $.post(`/tourneys/${this.tourneyId}/teams/${e}/users`,{userId:t}),we.oR.success("Vous avez rejoint le groupe avec succès."),this.fetchData()}catch(t){console.error("Erreur lors de la tentative de rejoindre le groupe:",t),t.response&&t.response.data&&t.response.data.message?we.oR.error(t.response.data.message):we.oR.error("Erreur lors de la tentative de rejoindre le groupe.")}},confirmLeaveTeam(){this.showDeleteConfirmation=!0},closeDeleteConfirmation(){this.showDeleteConfirmation=!1},async leaveTeam(){try{if(!this.userTeam)return void we.oR.error("Vous n'êtes pas dans un groupe.");await $.delete(`/tourneys/${this.tourneyId}/teams/${this.userTeam.id}/users/${this.currentUserId}`),we.oR.success("Vous avez quitté le groupe avec succès."),this.fetchData()}catch(e){console.error("Erreur lors de la tentative de quitter le groupe:",e),we.oR.error("Erreur lors de la tentative de quitter le groupe.")}},openTeamDetails(e){this.$router.push(`/tourneys/${this.tourneyId}/teams/${e.id}/details`)},confirmQuitTournament(){this.showQuitConfirmation=!0},closeQuitConfirmation(){this.showQuitConfirmation=!1},async leaveTournament(){try{await $.delete(`/tourneys/${this.tourneyId}/users/${this.currentUserId}`),this.$router.push("/tourneys")}catch(e){console.error("Erreur lors de la tentative de quitter le tournoi:",e),e.response&&e.response.data&&e.response.data.message?we.oR.error(e.response.data.message):we.oR.error("Erreur lors de la tentative de quitter le tournoi.")}finally{this.closeQuitConfirmation()}}},mounted(){this.fetchData()}};const mu=(0,E.A)(cu,[["render",uu],["__scopeId","data-v-0473a5b8"]]);var hu=mu;const pu={class:"p-6"},gu={key:0},fu={class:"mt-4"},yu={class:"mt-2"},vu={class:"font-medium"},bu={class:"text-sm"};function ku(e,t,s,o,n,i){const l=(0,r.g2)("TitleComponent"),d=(0,r.g2)("ButtonComponent");return(0,r.uX)(),(0,r.CE)("div",pu,[n.team?((0,r.uX)(),(0,r.CE)("div",gu,[(0,r.bF)(l,{title:n.team.teamName},null,8,["title"]),(0,r.Lk)("div",fu,[t[0]||(t[0]=(0,r.Lk)("h2",{class:"text-xl font-semibold"},"Membres de l'équipe :",-1)),(0,r.Lk)("ul",yu,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.team.usersTourneys,(e=>((0,r.uX)(),(0,r.CE)("li",{key:e.userId,class:"flex items-center justify-between p-2 border-b"},[(0,r.Lk)("div",null,[(0,r.Lk)("p",vu,(0,a.v_)(e.user.name),1),(0,r.Lk)("p",bu,(0,a.v_)(e.user.email),1)])])))),128))])]),(0,r.bF)(d,{onClick:i.goBack,variant:"secondary",class:"mt-4"},{default:(0,r.k6)((()=>t[1]||(t[1]=[(0,r.eW)(" Retour ")]))),_:1},8,["onClick"])])):(0,r.Q3)("",!0)])}var Tu={components:{TitleComponent:Ls,ButtonComponent:ke},data(){return{tourneyId:this.$route.params.tourneyId,teamId:this.$route.params.teamId,team:null}},methods:{async fetchTeamDetails(){try{const e=await $.get(`/tourneys/${this.tourneyId}/teams/${this.teamId}`);this.team=e.data}catch(e){console.error("Erreur lors de la récupération des détails de l'équipe:",e),we.oR.error("Erreur lors de la récupération des détails de l'équipe.")}},goBack(){this.$router.go(-1)}},mounted(){this.fetchTeamDetails()}};const Cu=(0,E.A)(Tu,[["render",ku],["__scopeId","data-v-3d6a7e5d"]]);var xu=Cu;const wu={key:0,class:"text-2xl font-bold my-4 px-4"},Eu={key:0},Iu={key:1},Su={key:2},Fu={class:"flex flex-wrap items-center gap-4 my-2 px-4"},Pu={class:"flex items-center cursor-pointer flex-shrink-0"},Au={class:"relative"},Lu={class:"ml-2 hidden md:block text-light-form-text dark:text-dark-form-text"},Du={class:"flex flex-wrap w-full items-center gap-2 sm:gap-4"},Mu={key:0,class:"flex items-center gap-2"},$u=["value"],Uu={class:"ml-auto"},Ru={key:1},Vu={class:"list-disc pl-5"},_u={class:"font-semibold"},Xu={key:1},qu={key:2};function Nu(e,t,s,n,i,l){const d=(0,r.g2)("SubMenuComponent"),u=(0,r.g2)("v-select"),c=(0,r.g2)("ButtonComponent"),m=(0,r.g2)("CollapsibleBox"),h=(0,r.g2)("FullCalendar");return(0,r.uX)(),(0,r.CE)("div",null,[(0,r.bF)(d,{tourneyId:i.tourneyId},null,8,["tourneyId"]),l.isAdmin?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("h1",wu,[(0,r.eW)((0,a.v_)(i.tourney.name)+" ",1),"player"===l.userRoleInTourney?((0,r.uX)(),(0,r.CE)("span",Eu," - "+(0,a.v_)(i.userTeam?.teamName)+" - "+(0,a.v_)(i.userPool?.name),1)):(0,r.Q3)("",!0),"assistant"===l.userRoleInTourney?((0,r.uX)(),(0,r.CE)("span",Iu," - Arbitrage des matchs ")):(0,r.Q3)("",!0),"guest"===l.userRoleInTourney?((0,r.uX)(),(0,r.CE)("span",Su," (Vous êtes invité - accès en lecture seule) ")):(0,r.Q3)("",!0)])),(0,r.Lk)("div",Fu,[(0,r.bF)(u,{options:l.poolOptions,modelValue:l.selectedPoolId,"onUpdate:modelValue":t[0]||(t[0]=e=>l.selectedPoolId=e),placeholder:"All Pools",clearable:!0,searchable:!0,label:"name",reduce:e=>e.id,class:"w-40 flex-shrink-0",style:{"min-width":"150px"}},null,8,["options","modelValue","reduce"]),(0,r.bF)(u,{options:l.fieldOptions,modelValue:l.selectedFieldId,"onUpdate:modelValue":t[1]||(t[1]=e=>l.selectedFieldId=e),placeholder:"All Terrains",clearable:!0,searchable:!0,label:"name",reduce:e=>e.id,class:"w-40 flex-shrink-0",style:{"min-width":"150px"}},null,8,["options","modelValue","reduce"]),(0,r.bF)(u,{options:l.gameOptions,modelValue:l.selectedGameId,"onUpdate:modelValue":t[2]||(t[2]=e=>l.selectedGameId=e),placeholder:"All Games",clearable:!0,searchable:!0,label:"name",reduce:e=>e.id,class:"w-40 flex-shrink-0",style:{"min-width":"150px"}},null,8,["options","modelValue","reduce"]),(0,r.Lk)("label",Pu,[(0,r.Lk)("div",Au,[(0,r.bo)((0,r.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=e=>i.useUnifiedColors=e),class:"sr-only"},null,512),[[o.lH,i.useUnifiedColors]]),(0,r.Lk)("div",{class:(0,a.C4)(["block w-14 h-8 rounded-full transition-colors duration-300",{"bg-light-menuActive dark:bg-dark-menuActive":i.useUnifiedColors,"bg-light-pool-infoText dark:bg-dark-pool-infoText":!i.useUnifiedColors}])},null,2),(0,r.Lk)("div",{class:(0,a.C4)(["dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-transform duration-300",{"translate-x-full":i.useUnifiedColors}])},null,2)]),(0,r.Lk)("span",Lu,(0,a.v_)(i.useUnifiedColors?"Couleur par Poule":"Couleur par Sport"),1)]),(0,r.bF)(c,{onClick:l.toggleDisplayMode,variant:"'secondary'",fontAwesomeIcon:"games"===i.displayMode?"th":"futbol"},{default:(0,r.k6)((()=>[(0,r.eW)(" Show "+(0,a.v_)("games"===i.displayMode?"Pools":"Matchs"),1)])),_:1},8,["onClick","fontAwesomeIcon"]),(0,r.Lk)("div",Du,[!i.showAllTerrains&&l.totalPages>1?((0,r.uX)(),(0,r.CE)("div",Mu,[i.currentPage>1?((0,r.uX)(),(0,r.CE)("button",{key:0,onClick:t[4]||(t[4]=e=>i.currentPage--),class:"text-2xl px-2 py-1 rounded navigation-button"}," < ")):(0,r.Q3)("",!0),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>i.currentPage=e),class:"bg-light-form-background dark:bg-dark-form-background text-light-form-text dark:text-dark-form-text border border-light-form-border-default dark:border-dark-form-border-default rounded-md px-2 py-1"},[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.totalPages,(e=>((0,r.uX)(),(0,r.CE)("option",{key:e,value:e}," Page "+(0,a.v_)(e)+" / "+(0,a.v_)(l.totalPages),9,$u)))),128))],512),[[o.u1,i.currentPage]]),i.currentPage<l.totalPages?((0,r.uX)(),(0,r.CE)("button",{key:1,onClick:t[6]||(t[6]=e=>i.currentPage++),class:"text-2xl px-2 py-1 rounded navigation-button"}," > ")):(0,r.Q3)("",!0)])):(0,r.Q3)("",!0),(0,r.Lk)("div",Uu,[i.fields.length>i.terrainsPerPage?((0,r.uX)(),(0,r.CE)("button",{key:0,onClick:t[7]||(t[7]=(...e)=>l.toggleShowAllTerrains&&l.toggleShowAllTerrains(...e)),class:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600"},(0,a.v_)(i.showAllTerrains?"Reduce":"All Fields"),1)):(0,r.Q3)("",!0)])])]),i.fields.length&&i.pools.length&&i.games.length?((0,r.uX)(),(0,r.CE)("div",Ru,["admin"!==l.userRoleInTourney&&"guest"!==l.userRoleInTourney&&i.userNextGames.length?((0,r.uX)(),(0,r.Wv)(m,{key:0,title:"Mes prochains matchs :"},{default:(0,r.k6)((()=>[(0,r.Lk)("ul",Vu,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.userNextGames,(e=>((0,r.uX)(),(0,r.CE)("li",{key:e.id},[(0,r.Lk)("span",_u,(0,a.v_)(l.formatDateTimeDisplay(e.startTime))+" : ",1),(0,r.eW)(" Team: "+(0,a.v_)(e.teamANumber)+" vs "+(0,a.v_)(e.teamBNumber)+" sur le terrain "+(0,a.v_)(e.field.name),1)])))),128))])])),_:1})):(0,r.Q3)("",!0),i.tourney.dateTourney&&l.paginatedFilteredFields.length?((0,r.uX)(),(0,r.CE)("div",Xu,[((0,r.uX)(),(0,r.Wv)(h,{ref:"fullCalendar",options:l.calendarOptions,key:i.calendarKey},null,8,["options"]))])):(0,r.Q3)("",!0)])):((0,r.uX)(),(0,r.CE)("div",qu,t[8]||(t[8]=[(0,r.Lk)("p",null," Aucune donnée hors ligne. Veuillez accéder à cette page une première fois en ligne. ",-1)])))])}function Bu(e,t,s,o,n,i){const l=(0,r.g2)("font-awesome-icon"),d=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",{class:(0,a.C4)([["tourney-nav",n.isNavVisible?"visible":"hidden"],"tourney-nav w-full z-50 bg-light-subMenu-background dark:bg-dark-subMenu-background shadow-lg border-b border-light-subMenu-border dark:border-dark-subMenu-border"])},[(0,r.bF)(d,{to:`/tourneys/${s.tourneyId}/planning`,class:(0,a.C4)(["tourney-nav-item text-light-subMenu-text dark:text-dark-subMenu-text hover:bg-light-subMenu-hoverBackground dark:hover:bg-dark-subMenu-hoverBackground hover:text-light-subMenu-hoverText dark:hover:text-dark-subMenu-hoverText",{active:"UserTourneyPlanning"===e.$route.name}])},{default:(0,r.k6)((()=>[(0,r.bF)(l,{icon:["fas","calendar-alt"]}),t[0]||(t[0]=(0,r.Lk)("span",{class:"hidden sm:inline"}," Planning",-1))])),_:1},8,["to","class"]),(0,r.bF)(d,{to:`/tourneys/${s.tourneyId}/scores`,class:(0,a.C4)(["tourney-nav-item text-light-subMenu-text dark:text-dark-subMenu-text hover:bg-light-subMenu-hoverBackground dark:hover:bg-dark-subMenu-hoverBackground hover:text-light-subMenu-hoverText dark:hover:text-dark-subMenu-hoverText",{active:"UserTourneyScores"===e.$route.name}])},{default:(0,r.k6)((()=>[(0,r.bF)(l,{icon:["fas","list-ol"]}),t[1]||(t[1]=(0,r.Lk)("span",{class:"hidden sm:inline"}," Scores",-1))])),_:1},8,["to","class"]),(0,r.bF)(d,{to:`/tourneys/${s.tourneyId}/details`,class:(0,a.C4)(["tourney-nav-item text-light-subMenu-text dark:text-dark-subMenu-text hover:bg-light-subMenu-hoverBackground dark:hover:bg-dark-subMenu-hoverBackground hover:text-light-subMenu-hoverText dark:hover:text-dark-subMenu-hoverText",{active:"UserTourneyDetails"===e.$route.name}])},{default:(0,r.k6)((()=>[(0,r.bF)(l,{icon:["fas","info-circle"]}),t[2]||(t[2]=(0,r.Lk)("span",{class:"hidden sm:inline"}," Infos",-1))])),_:1},8,["to","class"])],2)}var Wu={data(){return{activeTab:"planning",isNavVisible:!0}},methods:{selectTab(e){this.activeTab=e}},props:{tourneyId:{type:String,required:!0}}};const ju=(0,E.A)(Wu,[["render",Bu],["__scopeId","data-v-7ecaf748"]]);var Qu=ju;const Ou={class:"mb-4"},Gu={key:0},zu={key:1},Hu={class:"mt-2 p-4 border rounded"};function Ku(e,t,s,n,i,l){return(0,r.uX)(),(0,r.CE)("div",Ou,[(0,r.Lk)("button",{onClick:t[0]||(t[0]=e=>i.isOpen=!i.isOpen),class:"w-full flex justify-between items-center bg-blue-500 text-white px-4 py-2 rounded"},[(0,r.Lk)("span",null,(0,a.v_)(s.title),1),i.isOpen?((0,r.uX)(),(0,r.CE)("span",Gu,"-")):((0,r.uX)(),(0,r.CE)("span",zu,"+"))]),(0,r.bo)((0,r.Lk)("div",Hu,[(0,r.RG)(e.$slots,"default")],512),[[o.aG,i.isOpen]])])}var Ju={props:{title:{type:String,required:!0}},data(){return{isOpen:!0}}};const Yu=(0,E.A)(Ju,[["render",Ku]]);var Zu=Yu;function ec(e,t="Unknown"){if(!e||"string"!==typeof e)return t;const s=e.split(" ");return s.length>1&&!isNaN(s[1])?s[1]:t}var tc={components:{FullCalendar:qa.A,SubMenuComponent:Qu,vSelect:Zl.A,ButtonComponent:ke,CollapsibleBox:Zu},data(){return{tourneyId:this.$route.params.tourneyId,tourney:{},fields:[],teams:[],games:[],pools:[],sports:[],userNextGames:[],scheduleConfig:{},useUnifiedColors:!0,colorMap:{},displayMode:"games",currentPage:1,terrainsPerPage:10,showAllTerrains:!1,assistantMessage:"",userTeam:null,userPool:null,calendarKey:0}},computed:{...(0,x.aH)("tourney",{statuses:e=>e.statuses,tourneyType:e=>e.tourneyType}),...(0,x.aH)("userTourney",{_selectedPoolId:e=>e.selectedPoolId,_selectedFieldId:e=>e.selectedFieldId,_selectedGameId:e=>e.selectedGameId}),selectedPoolId:{get(){return this._selectedPoolId},set(e){this.setSelectedPool(null===e?null:parseInt(e,10))}},selectedFieldId:{get(){return this._selectedFieldId},set(e){this.setSelectedField(null===e?null:parseInt(e,10))}},selectedGameId:{get(){return this._selectedGameId},set(e){this.setSelectedGame(null===e?null:parseInt(e,10))}},isAdmin(){return this.$store.state?.user&&1===this.$store.state.user?.roleId},generateUniqueColor(){return e=>{if(!e)return"#888888";if(this.colorMap[e])return this.colorMap[e];const t=137.508*e%360,s=`hsl(${t}, 70%, 60%)`;return this.colorMap[e]=s,s}},poolOptions(){return[{id:null,name:"All Pools"},...this.pools]},fieldOptions(){return[{id:null,name:"All Terrains"},...this.fields]},gameOptions(){return[{id:null,name:"All Games"},...this.games.map((e=>({id:e.id,name:`Game ${e.id} - ${e.teamA?.teamName} vs ${e.teamB?.teamName}`})))]},filteredGames(){return this.games.filter((e=>(!this.selectedPoolId||e.pool?.id===this.selectedPoolId)&&((!this.selectedFieldId||e.field?.id===this.selectedFieldId)&&(!this.selectedGameId||e.id===this.selectedGameId))))},filteredFields(){const e=new Set;return this.filteredGames.forEach((t=>{t.field&&t.field.id&&e.add(t.field.id)})),this.pools.forEach((t=>{this.selectedPoolId&&t.id!==this.selectedPoolId||t.schedules.forEach((t=>{this.selectedFieldId&&t.fieldId!==this.selectedFieldId||e.add(t.fieldId)}))})),this.showAllTerrains?this.fields:this.fields.filter((t=>e.has(t.id)))},paginatedFilteredFields(){if(this.showAllTerrains)return this.sortedFields;const e=this.filteredFields;return e.slice((this.currentPage-1)*this.terrainsPerPage,this.currentPage*this.terrainsPerPage)},totalPages(){return this.showAllTerrains?1:Math.ceil(this.filteredFields.length/this.terrainsPerPage)},paginatedFields(){return this.paginatedFilteredFields},userRoleInTourney(){const e=this.isAdmin,t=this.$store.getters["userTourney/isAssistant"];return e?"admin":t?"assistant":this.userTeam&&"player"===this.userTeam.type?"player":"guest"},calendarOptions(){if(!this.tourney.dateTourney)return console.error("La date du tournoi n’est pas disponible"),{};const e=[];return this.addBreakTimes(e),"games"===this.displayMode?this.addGamesToEvents(e):this.addPoolSchedulesToEvents(e),this.addPoolTransitions(e),{plugins:[Na.A,Ba.Ay,Wa.A],schedulerLicenseKey:"CC-Attribution-NonCommercial-NoDerivatives",initialView:"resourceTimeGridDay",timeZone:"UTC",initialDate:this.tourney.dateTourney,editable:!1,droppable:!1,eventStartEditable:!1,eventDurationEditable:!1,selectable:!1,height:800,slotMinTime:this.adjustedSlotMinTime(),slotMaxTime:this.adjustedSlotMaxTime(),slotDuration:"games"===this.displayMode?"00:05:00":"00:15:00",slotLabelInterval:"games"===this.displayMode?"00:15:00":"01:00:00",allDaySlot:!1,resources:this.paginatedFilteredFields.map((e=>({id:e.id.toString(),title:e.name}))),events:e,resourceAreaHeaderContent:"Terrains",slotLabelFormat:{hour:"2-digit",minute:"2-digit",hour12:!1},headerToolbar:!1,eventClick:this.handleEventClick,eventContent:this.renderEventContent}},sortedFields(){return[...this.fields].sort(((e,t)=>{const s=parseInt(e.name),o=parseInt(t.name);return isNaN(s)||isNaN(o)?e.name.localeCompare(t.name):s-o}))}},watch:{showAllTerrains(){this.$refs.fullCalendar&&(this.$refs.fullCalendar.getApi().refetchResources(),this.$refs.fullCalendar.getApi().refetchEvents())},currentPage(){this.$refs.fullCalendar&&(this.$refs.fullCalendar.getApi().refetchResources(),this.$refs.fullCalendar.getApi().refetchEvents())},selectedPoolId(){this.currentPage=1,this.calendarKey+=1,this.updateQueryParams()},selectedFieldId(){this.currentPage=1,this.calendarKey+=1,this.updateQueryParams()},selectedGameId(){this.currentPage=1,this.calendarKey+=1,this.updateQueryParams()},"$route.query"(){this.loadFiltersFromQuery()},useUnifiedColors(){this.$refs.fullCalendar&&this.$refs.fullCalendar.getApi().refetchEvents()}},methods:{...(0,x.i0)("tourney",["fetchTourneyStatuses","setTournamentName","clearTournamentName"]),...(0,x.i0)("userTourney",["setSelectedPool","setSelectedField","setSelectedGame"]),updateQueryParams(){this.$router.replace({path:this.$route.path,query:{...this.$route.query,pool:this.selectedPoolId,field:this.selectedFieldId,game:this.selectedGameId}})},toggleShowAllTerrains(){this.showAllTerrains=!this.showAllTerrains,this.currentPage=1,this.$refs.fullCalendar&&(this.$refs.fullCalendar.getApi().refetchResources(),this.$refs.fullCalendar.getApi().refetchEvents())},loadFiltersFromQuery(){const{pool:e,field:t,game:s}=this.$route.query;if(void 0!==e&&"null"!==e){const t=parseInt(e,10);this.setSelectedPool(isNaN(t)?null:t)}else this.setSelectedPool(null);if(void 0!==t&&"null"!==t){const e=parseInt(t,10);this.setSelectedField(isNaN(e)?null:e)}else this.setSelectedField(null);if(void 0!==s&&"null"!==s){const e=parseInt(s,10);this.setSelectedGame(isNaN(e)?null:e)}else this.setSelectedGame(null)},async fetchAllData(){try{await this.fetchPlanningDetails(),await this.fetchUserTeamAndPool(),await this.fetchUserNextGames(),this.saveAllToLocalStorage()}catch(e){console.error("Erreur lors de la récupération des données :",e),this.loadAllFromLocalStorage()}},async fetchPlanningDetails(){try{await this.fetchTourneyStatuses(this.tourneyId);const e=await $.get(`/tourneys/${this.tourneyId}/planning/details`),t=e.data;this.fields=t.fields||[],this.pools=t.pools||[],this.games=t.games||[],this.sports=t.sports||[],this.scheduleConfig=t.scheduleTourney||{};const s=await $.get(`/tourneys/${this.tourneyId}`);this.tourney=s.data;const o=await $.get(`/tourneys/${this.tourneyId}/teams`);this.teams=o.data,this.tourney.dateTourney||console.warn("La date du tournoi n'est pas définie.")}catch(e){console.error("Erreur lors de la récupération des détails du planning:",e)}},saveAllToLocalStorage(){localStorage.setItem(`planning-${this.tourneyId}`,JSON.stringify({fields:this.fields,pools:this.pools,games:this.games,scheduleConfig:this.scheduleConfig,userTeam:this.userTeam,userPool:this.userPool,userNextGames:this.userNextGames,tourney:this.tourney}))},loadAllFromLocalStorage(){const e=localStorage.getItem(`planning-${this.tourneyId}`);if(e){const t=JSON.parse(e);this.fields=t.fields||[],this.pools=t.pools||[],this.games=t.games||[],this.scheduleConfig=t.scheduleConfig||{},this.userTeam=t.userTeam||{},this.userPool=t.userPool||null,this.userNextGames=t.userNextGames||[],this.tourney=t.tourney||{}}else console.warn("Aucune donnée sauvegardée trouvée dans le localStorage.")},async completeAllMatches(){try{const e=await $.put(`/tourneys/${this.tourneyId}/games/complete-all-games`);200===e.status&&(we.oR.success(e.data.message),await this.fetchPlanningDetails(),this.calendarKey+=1)}catch(e){console.error("Erreur lors de la mise à jour des matchs :",e),we.oR.error("Erreur lors de la mise à jour des matchs.")}},async fetchUserNextGames(){if("admin"!==this.userRoleInTourney&&"guest"!==this.userRoleInTourney)try{const e=await $.get(`/tourneys/${this.tourneyId}/games/next`);Array.isArray(e.data)?this.userNextGames=e.data.map((e=>{const t=this.teams.find((t=>t.id===e.teamAId)),s=this.teams.find((t=>t.id===e.teamBId));return{...e,teamANumber:t?.teamName?ec(t.teamName,"A"):"A",teamBNumber:s?.teamName?ec(s.teamName,"B"):"B"}})):e.data.message&&(this.assistantMessage=e.data.message)}catch(e){console.error("Erreur lors de la récupération des prochains matchs de l'utilisateur :",e)}},async fetchUserTeamAndPool(){if(!this.isAdmin)try{const e=this.$store.state.user.id,t=await $.get(`/tourneys/${this.tourneyId}/users/${e}`);this.userTeam=t.data.team||null,this.userPool=this.userTeam&&this.userTeam.pool?this.userTeam.pool:null}catch(e){console.error("Erreur lors de la récupération de l'équipe de l'utilisateur :",e)}},adjustTerrainsPerPage(){const e=window.innerWidth;this.terrainsPerPage=e>=1200?10:e>=1e3?8:e>=800?7:e>=600?5:3},handleEventClick(e){const t=e.event,s=t.extendedProps.game;s&&this.$router.push({name:"UserTourneyGameDetails",params:{tourneyId:this.tourneyId,gameId:s.id}})},toggleDisplayMode(){this.displayMode="games"===this.displayMode?"pools":"games",this.$refs.fullCalendar&&this.$refs.fullCalendar.getApi().refetchEvents(),this.calendarKey+=1},addGamesToEvents(e){const t=new Date(Date.now()-6e4*(new Date).getTimezoneOffset());this.filteredGames.forEach((s=>{if(!s.field)return void console.warn(`Le match avec l'ID ${s.id} n'a pas de terrain assigné.`);const o=new Date(s.startTime).toISOString(),r=new Date(s.endTime).toISOString(),a=t>=new Date(o)&&t<=new Date(r),n=s.teamA?.teamName||"Équipe A",i=s.teamB?.teamName||"Équipe B",l=n?ec(n,"A"):"A",d=i?ec(i,"B"):"B";e.push({id:s.id.toString(),resourceId:s.field.id.toString(),title:`${s.pool?.name||"Team"}: ${l} vs ${d}`,start:o,end:r,backgroundColor:a?"#FF0000":this.useUnifiedColors?this.generateUniqueColor(s.pool?.id):s.sport?.color||"#3B82F6",textColor:"#FFFFFF",extendedProps:{game:s}})}))},addPoolSchedulesToEvents(e){this.pools.forEach((t=>{this.selectedPoolId&&t.id!==this.selectedPoolId||t.schedules.forEach((s=>{this.selectedFieldId&&s.fieldId!==this.selectedFieldId||e.push({id:`pool-${t.id}-schedule-${s.id}`,resourceId:s.fieldId.toString(),title:`${t.name} - ${s.sport?.name}`,start:`${s.date}T${s.startTime}`,end:`${s.date}T${s.endTime}`,backgroundColor:this.useUnifiedColors?this.generateUniqueColor(t.id):s.sport?.color||"#3B82F6",textColor:"#FFFFFF",extendedProps:{poolSchedule:s}})}))}))},adjustedSlotMinTime(){const e=this.scheduleConfig.startTime||"07:00:00";return this.roundDownTime(e)},adjustedSlotMaxTime(){const e=this.scheduleConfig.endTime||"23:00:00";return this.roundUpTime(e)},roundDownTime(e){let[t,s,o]=e.split(":").map(Number);return(s>0||o>0)&&(t=Math.max(0,t)),`${t.toString().padStart(2,"0")}:00:00`},roundUpTime(e){let[t,s,o]=e.split(":").map(Number);return(s>0||o>0)&&(t+=1),t>=24&&(t=23),`${t.toString().padStart(2,"0")}:00:00`},formatDateTimeDisplay(e){const t=new Date(e),s=t.getDate().toString().padStart(2,"0"),o=(t.getMonth()+1).toString().padStart(2,"0"),r=t.getFullYear(),a=t.getHours().toString().padStart(2,"0"),n=t.getMinutes().toString().padStart(2,"0");return`${s}/${o}/${r} à ${a}h${n}`},addBreakTimes(e){const t=[{title:"Introduction",startTime:this.scheduleConfig.introStart,endTime:this.scheduleConfig.introEnd},{title:"Déjeuner",startTime:this.scheduleConfig.lunchStart,endTime:this.scheduleConfig.lunchEnd},{title:"Conclusion",startTime:this.scheduleConfig.outroStart,endTime:this.scheduleConfig.outroEnd}];t.forEach((t=>{t.startTime&&t.endTime&&e.push({id:`break-${t.title}`,resourceIds:this.paginatedFilteredFields.map((e=>e.id.toString())),title:t.title,start:`${this.tourney.dateTourney}T${t.startTime}`,end:`${this.tourney.dateTourney}T${t.endTime}`,backgroundColor:"#965612",textColor:"#000000",display:"background"})}))},addPoolTransitions(e){const t=parseInt(this.scheduleConfig.transitionPoolTime);t&&!isNaN(t)&&this.pools.forEach((s=>{this.selectedPoolId&&s.id!==this.selectedPoolId||s.schedules.forEach((o=>{const r=new Date(`${o.date}T${o.endTime}`),a=new Date(r.getTime()+6e4*t);this.selectedFieldId&&o.fieldId!==this.selectedFieldId||e.push({id:`transition-${s.id}-${o.id}`,resourceId:o.fieldId.toString(),title:"Transition",start:r,end:a,backgroundColor:"#808080",display:"background"})}))}))},renderEventContent(e){const t=document.createElement("div");t.classList.add("flex","flex-col","space-y-1","cursor-pointer","hover:invert");const s=document.createElement("div");s.classList.add("flex","justify-between","items-center");const o=document.createElement("span");o.innerText=e.event.title,o.classList.add("font-semibold","text-white"),s.appendChild(o),t.appendChild(s);const r=e.event.start?this.formatDisplayTime(e.event.start):"",a=e.event.end?this.formatDisplayTime(e.event.end):"";if(r&&a&&"Transition"!==e.event.title){const e=document.createElement("div");e.innerText=`${r} - ${a}`,e.classList.add("text-sm","text-white"),t.appendChild(e)}const n=e.event.extendedProps.game;if(n){const e=document.createElement("div"),s=n.pool?n.pool.name:"",o=n.sport?n.sport.name:"";e.innerText=`${s} - ${o}`,e.classList.add("text-xs","text-white"),t.appendChild(e)}return{domNodes:[t]}},formatDisplayTime(e){const t=new Date(e);if(isNaN(t.getTime()))return"";const s=t.getUTCHours().toString().padStart(2,"0"),o=t.getUTCMinutes().toString().padStart(2,"0");return`${s}:${o}`}},async mounted(){this.adjustTerrainsPerPage(),window.addEventListener("resize",this.adjustTerrainsPerPage),navigator.onLine?await this.fetchAllData():(this.loadAllFromLocalStorage(),console.warn("Vous êtes hors ligne. Chargement des données locales.")),this.loadFiltersFromQuery()}};const sc=(0,E.A)(tc,[["render",Nu],["__scopeId","data-v-847df1ca"]]);var oc=sc;const rc={key:0,class:"alert alert-warning"},ac={key:1,class:"p-4 relative"},nc={key:0,class:"relative"},ic={class:"grid grid-cols-3 items-center gap-4"},lc={class:"text-left"},dc={class:"text-lg"},uc={class:"ml-1"},cc={class:"text-lg"},mc={class:"ml-1"},hc={class:"text-center"},pc={class:"text-2xl font-bold"},gc={key:0,class:"text-lg"},fc={class:"text-lg"},yc={class:"text-right flex justify-start md:justify-end items-center"},vc={key:1},bc={class:"text-lg font-semibold"},kc={class:"flex flex-col items-center"},Tc={class:"flex items-center justify-center mb-4"},Cc={class:"flex flex-col items-center mr-4"},xc={class:"text-xl font-bold flex items-center"},wc={class:"player-list max-h-40 overflow-y-auto mt-2"},Ec={class:"flex flex-col items-center mx-8"},Ic={class:"flex items-center whitespace-nowrap"},Sc={key:0},Fc={key:1},Pc={class:"text-4xl font-bold"},Ac={class:"text-4xl font-bold"},Lc={class:"mt-2 text-lg font-semibold text-center"},Dc={key:0,class:"mt-2 flex items-center justify-center space-x-2 flex-wrap"},Mc={class:"flex flex-col items-center ml-4"},$c={class:"text-xl font-bold flex items-center"},Uc={class:"player-list max-h-40 overflow-y-auto mt-2"},Rc={key:0,class:"mt-4 text-lg font-semibold"},Vc={key:1,class:"flex flex-wrap justify-center mt-4 gap-4"},_c={class:"relative w-full max-w-2xl mx-auto mt-8"},Xc={class:"max-h-96 overflow-y-auto"},qc={class:"timeline w-full mx-auto relative"},Nc={class:"absolute left-1/2 transform -translate-x-1/2",style:{top:"0"}},Bc={class:"font-semibold"},Wc={key:0,class:"text-sm text-gray-700 dark:text-gray-400"},jc={class:"text-sm text-gray-500"},Qc={key:0},Oc={class:"flex justify-between mt-2"},Gc=["onClick"],zc=["onClick"],Hc=["value"],Kc=["value"],Jc={class:"flex justify-end space-x-2"};function Yc(e,t,s,n,i,l){const d=(0,r.g2)("ButtonComponent"),u=(0,r.g2)("font-awesome-icon"),c=(0,r.g2)("StatusSelectorComponent"),m=(0,r.g2)("DeleteConfirmationModal"),h=(0,r.g2)("FormComponent"),p=(0,r.g2)("ModalComponent");return(0,r.uX)(),(0,r.CE)(r.FK,null,[i.socketError?((0,r.uX)(),(0,r.CE)("div",rc,(0,a.v_)(i.socketError),1)):(0,r.Q3)("",!0),i.match?((0,r.uX)(),(0,r.CE)("div",ac,[i.match?((0,r.uX)(),(0,r.CE)("div",nc,[(0,r.Lk)("div",ic,[(0,r.Lk)("div",lc,[(0,r.bF)(d,{variant:"secondary",fontAwesomeIcon:"arrow-left",onClick:l.goBack,class:"mb-2"},{default:(0,r.k6)((()=>t[17]||(t[17]=[(0,r.Lk)("span",{class:""},"Retour",-1)]))),_:1},8,["onClick"]),(0,r.Lk)("p",dc,[(0,r.bF)(u,{icon:"gavel",class:"mr-2"}),t[18]||(t[18]=(0,r.Lk)("span",{class:"hidden sm:inline"},"Arbitre: ",-1)),(0,r.Lk)("span",uc,(0,a.v_)(i.assistantName?i.assistantName:"N/A"),1)]),(0,r.Lk)("p",cc,[(0,r.bF)(u,{icon:"eye",class:"mr-2"}),t[19]||(t[19]=(0,r.Lk)("span",{class:"hidden sm:inline"},"Spectateurs: ",-1)),(0,r.Lk)("span",mc,(0,a.v_)(i.spectatorCount),1)])]),(0,r.Lk)("div",hc,[(0,r.Lk)("h2",pc,(0,a.v_)(i.match.field.name)+" | "+(0,a.v_)(i.match.sport.name),1),i.match.pool?((0,r.uX)(),(0,r.CE)("p",gc,(0,a.v_)(i.match.pool.name)+" - ID: "+(0,a.v_)(i.match.id),1)):(0,r.Q3)("",!0),(0,r.Lk)("p",fc,[t[20]||(t[20]=(0,r.Lk)("span",{class:"hidden sm:inline"},"Heure: ",-1)),(0,r.eW)(" "+(0,a.v_)(l.formatTime(i.match.startTime))+" - "+(0,a.v_)(l.formatTime(i.match.endTime)),1)])]),(0,r.Lk)("div",yc,[l.canEdit?((0,r.uX)(),(0,r.Wv)(c,{key:0,tourneyId:i.tourneyId,statusKey:"matchStatus",statusOptions:i.gameStatusOptions,modelValue:i.match.status,label:"Statut: ",hideWhenNotStarted:!1,onStatusChange:l.onMatchStatusChange},null,8,["tourneyId","statusOptions","modelValue","onStatusChange"])):((0,r.uX)(),(0,r.CE)("div",vc,[(0,r.Lk)("p",bc,(0,a.v_)(l.getMatchStatusLabel(i.match.status,i.isPaused)),1)]))])])])):(0,r.Q3)("",!0),(0,r.Lk)("div",kc,[(0,r.Lk)("div",Tc,[(0,r.Lk)("div",Cc,[(0,r.Lk)("h2",xc,[(0,r.eW)((0,a.v_)(i.match.teamA.teamName)+" ",1),"winner"===l.teamAResult?((0,r.uX)(),(0,r.Wv)(u,{key:0,icon:"trophy",class:"text-green-500 ml-2"})):(0,r.Q3)("",!0),"loser"===l.teamAResult?((0,r.uX)(),(0,r.Wv)(u,{key:1,icon:"trophy",class:"text-red-500 ml-2"})):(0,r.Q3)("",!0)]),(0,r.Lk)("div",wc,[(0,r.Lk)("ul",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.teamAPlayers,(e=>((0,r.uX)(),(0,r.CE)("li",{key:e.id},[(0,r.bF)(u,{icon:"user",class:"mr-2"}),(0,r.eW)(" "+(0,a.v_)(e.name),1)])))),128))])])]),(0,r.Lk)("div",Ec,[(0,r.Lk)("div",Ic,[l.canEdit&&"in_progress"===i.match.status?((0,r.uX)(),(0,r.CE)("div",Sc,[(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>i.scoreTeamA=e),type:"number",class:"w-16 text-center text-4xl font-bold bg-transparent border-none",onInput:t[1]||(t[1]=(...e)=>l.updateScores&&l.updateScores(...e))},null,544),[[o.Jo,i.scoreTeamA,void 0,{number:!0}]]),t[21]||(t[21]=(0,r.Lk)("span",{class:"text-4xl font-bold mx-2"},"-",-1)),(0,r.bo)((0,r.Lk)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>i.scoreTeamB=e),type:"number",class:"w-16 text-center text-4xl font-bold bg-transparent border-none",onInput:t[3]||(t[3]=(...e)=>l.updateScores&&l.updateScores(...e))},null,544),[[o.Jo,i.scoreTeamB,void 0,{number:!0}]])])):((0,r.uX)(),(0,r.CE)("div",Fc,[(0,r.Lk)("span",Pc,(0,a.v_)(i.scoreTeamA||0),1),t[22]||(t[22]=(0,r.Lk)("span",{class:"text-4xl font-bold mx-2"},"-",-1)),(0,r.Lk)("span",Ac,(0,a.v_)(i.scoreTeamB||0),1)]))]),(0,r.Lk)("div",Lc,(0,a.v_)(l.formattedTime),1),l.canEdit&&"in_progress"===i.match.status?((0,r.uX)(),(0,r.CE)("div",Dc,[i.timerRunning||i.isPaused?i.timerRunning&&!i.isPaused?((0,r.uX)(),(0,r.CE)("button",{key:1,onClick:t[5]||(t[5]=(...e)=>l.pauseTimer&&l.pauseTimer(...e)),class:"px-4 py-2 bg-yellow-500 dark:bg-yellow-600 text-white rounded"}," Pause ")):i.isPaused?((0,r.uX)(),(0,r.CE)("button",{key:2,onClick:t[6]||(t[6]=(...e)=>l.startTimer&&l.startTimer(...e)),class:"px-4 py-2 bg-green-500 dark:bg-green-600 text-white rounded"}," Reprendre ")):(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("button",{key:0,onClick:t[4]||(t[4]=(...e)=>l.startTimer&&l.startTimer(...e)),class:"px-4 py-2 bg-green-500 dark:bg-green-600 text-white rounded"}," Démarrer ")),(0,r.Lk)("button",{onClick:t[7]||(t[7]=(...e)=>l.openResetConfirmation&&l.openResetConfirmation(...e)),class:"px-4 py-2 bg-red-500 dark:bg-red-600 text-white rounded ml-2"}," Réinitialiser ")])):(0,r.Q3)("",!0)]),(0,r.Lk)("div",Mc,[(0,r.Lk)("h2",$c,[(0,r.eW)((0,a.v_)(i.match.teamB.teamName)+" ",1),"winner"===l.teamBResult?((0,r.uX)(),(0,r.Wv)(u,{key:0,icon:"trophy",class:"text-green-500 ml-2"})):(0,r.Q3)("",!0),"loser"===l.teamBResult?((0,r.uX)(),(0,r.Wv)(u,{key:1,icon:"trophy",class:"text-red-500 ml-2"})):(0,r.Q3)("",!0)]),(0,r.Lk)("div",Uc,[(0,r.Lk)("ul",null,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.teamBPlayers,(e=>((0,r.uX)(),(0,r.CE)("li",{key:e.id},[(0,r.bF)(u,{icon:"user",class:"mr-2"}),(0,r.eW)(" "+(0,a.v_)(e.name),1)])))),128))])])])]),l.isDraw?((0,r.uX)(),(0,r.CE)("div",Rc,"Match Nul")):(0,r.Q3)("",!0),l.canEdit&&"in_progress"===i.match.status?((0,r.uX)(),(0,r.CE)("div",Vc,[(0,r.bF)(d,{onClick:t[8]||(t[8]=e=>l.openEventModal("goal")),variant:"primary",fontAwesomeIcon:"futbol"},{default:(0,r.k6)((()=>t[23]||(t[23]=[(0,r.eW)(" Score ")]))),_:1}),(0,r.bF)(d,{onClick:t[9]||(t[9]=e=>l.openEventModal("foul")),variant:"info",fontAwesomeIcon:"exclamation-circle"},{default:(0,r.k6)((()=>t[24]||(t[24]=[(0,r.eW)(" Faute ")]))),_:1}),(0,r.bF)(d,{onClick:t[10]||(t[10]=e=>l.openEventModal("yellow_card")),variant:"warning",fontAwesomeIcon:"square"},{default:(0,r.k6)((()=>t[25]||(t[25]=[(0,r.eW)(" Carton Jaune ")]))),_:1}),(0,r.bF)(d,{onClick:t[11]||(t[11]=e=>l.openEventModal("red_card")),variant:"danger",fontAwesomeIcon:"flag"},{default:(0,r.k6)((()=>t[26]||(t[26]=[(0,r.eW)(" Carton Rouge ")]))),_:1})])):(0,r.Q3)("",!0),(0,r.Lk)("div",_c,[(0,r.Lk)("div",Xc,[(0,r.Lk)("ul",qc,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.sortedGameEvents,(e=>((0,r.uX)(),(0,r.CE)("li",{key:e.id,class:"relative mb-6 flex items-center"},[(0,r.Lk)("div",Nc,[(0,r.Lk)("div",{class:(0,a.C4)([{"bg-yellow-500 dark:bg-yellow-600":"yellow_card"===e.type,"bg-red-500 dark:bg-yellow-700":"red_card"===e.type,"bg-green-600 dark:bg-green-700":"goal"===e.type,"bg-blue-500 dark:bg-blue-600":"foul"===e.type},"rounded-full w-10 h-10 flex items-center justify-center text-white text-lg shadow-md"])},[(0,r.bF)(u,{icon:l.getEventIcon(e.type)},null,8,["icon"])],2)]),(0,r.Lk)("div",{class:(0,a.C4)([l.getEventPositionClass(e),"timeline-box bg-gray-100 dark:bg-gray-800 p-2 rounded-lg shadow-md w-64"])},[(0,r.Lk)("p",Bc,(0,a.v_)(l.getEventDescription(e)),1),e.description?((0,r.uX)(),(0,r.CE)("p",Wc,(0,a.v_)(e.description),1)):(0,r.Q3)("",!0),(0,r.Lk)("p",jc,[(0,r.eW)((0,a.v_)(l.formatEventTime(e.createdAt))+" ",1),void 0!==e.matchTime?((0,r.uX)(),(0,r.CE)("span",Qc," - "+(0,a.v_)(l.formatElapsedTime(e.matchTime)),1)):(0,r.Q3)("",!0)]),(0,r.Lk)("div",Oc,[l.isAuthorized&&"in_progress"===i.match.status?((0,r.uX)(),(0,r.CE)("button",{key:0,onClick:t=>l.deleteEvent(e.id),class:"text-red-500 hover:text-red-700",title:"Supprimer l'événement"},[(0,r.bF)(u,{icon:"trash"})],8,Gc)):(0,r.Q3)("",!0),l.isAuthorized&&"in_progress"===i.match.status?((0,r.uX)(),(0,r.CE)("button",{key:1,onClick:t=>l.openEditEventModal(e),class:"text-yellow-500 hover:text-yellow-700",title:"Modifier l'événement"},[(0,r.bF)(u,{icon:"pen"})],8,zc)):(0,r.Q3)("",!0)])],2)])))),128))])])]),(0,r.bF)(m,{isVisible:i.showResetConfirmation,title:"Confirmer la Réinitialisation",message:"Êtes-vous sûr de vouloir réinitialiser les scores et les événements de ce match ? Cette action est irréversible.",textButton:"Réinitialiser",onFormCancel:l.closeResetConfirmation,onConfirm:l.handleResetConfirm},null,8,["isVisible","onFormCancel","onConfirm"])]),(0,r.bF)(p,{isVisible:i.showEventModal,title:l.getEventTitle(i.eventType),onClose:l.closeEventModal},{content:(0,r.k6)((()=>[(0,r.bF)(h,{modelValue:i.eventFormData,"onUpdate:modelValue":t[12]||(t[12]=e=>i.eventFormData=e),fields:l.eventFormFields,onFormSubmit:l.submitEvent,onFormCancel:l.closeEventModal,isEditable:!0},null,8,["modelValue","fields","onFormSubmit","onFormCancel"])])),_:1},8,["isVisible","title","onClose"]),(0,r.bF)(p,{isVisible:i.showEditEventModal,title:"Modifier l'Événement",onClose:l.closeEditEventModal},{content:(0,r.k6)((()=>[(0,r.Lk)("form",{onSubmit:t[16]||(t[16]=(0,o.D$)(((...e)=>l.submitEditEvent&&l.submitEditEvent(...e)),["prevent"])),class:"space-y-4"},[(0,r.Lk)("div",null,[t[27]||(t[27]=(0,r.Lk)("label",{class:"block mb-2 font-semibold"},"Équipe",-1)),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":t[13]||(t[13]=e=>i.editEventFormData.teamId=e),class:"w-full border border-gray-300 rounded px-2 py-1",required:""},[(0,r.Lk)("option",{value:i.match.teamA.id},(0,a.v_)(i.match.teamA.teamName),9,Hc),(0,r.Lk)("option",{value:i.match.teamB.id},(0,a.v_)(i.match.teamB.teamName),9,Kc)],512),[[o.u1,i.editEventFormData.teamId]])]),(0,r.Lk)("div",null,[t[29]||(t[29]=(0,r.Lk)("label",{class:"block mb-2 font-semibold"},"Type d'Événement",-1)),(0,r.bo)((0,r.Lk)("select",{"onUpdate:modelValue":t[14]||(t[14]=e=>i.editEventFormData.type=e),class:"w-full border border-gray-300 rounded px-2 py-1",required:""},t[28]||(t[28]=[(0,r.Lk)("option",{value:"goal"},"But",-1),(0,r.Lk)("option",{value:"foul"},"Faute",-1),(0,r.Lk)("option",{value:"yellow_card"},"Carton Jaune",-1),(0,r.Lk)("option",{value:"red_card"},"Carton Rouge",-1)]),512),[[o.u1,i.editEventFormData.type]])]),(0,r.Lk)("div",null,[t[30]||(t[30]=(0,r.Lk)("label",{class:"block mb-2 font-semibold"},"Description",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text","onUpdate:modelValue":t[15]||(t[15]=e=>i.editEventFormData.description=e),class:"w-full border border-gray-300 rounded px-2 py-1",placeholder:"Description de l'événement"},null,512),[[o.Jo,i.editEventFormData.description]])]),(0,r.Lk)("div",Jc,[(0,r.bF)(d,{variant:"secondary",onClick:l.closeEditEventModal},{default:(0,r.k6)((()=>t[31]||(t[31]=[(0,r.eW)(" Annuler ")]))),_:1},8,["onClick"]),(0,r.bF)(d,{variant:"primary",type:"submit"},{default:(0,r.k6)((()=>t[32]||(t[32]=[(0,r.eW)(" Enregistrer ")]))),_:1})])],32)])),_:1},8,["isVisible","onClose"])])):(0,r.Q3)("",!0)],64)}var Zc={components:{ModalComponent:mt,FormComponent:jt,StatusSelectorComponent:ko,ButtonComponent:ke,DeleteConfirmationModal:Gt},data(){return{tourneyId:this.$route.params.tourneyId,tourney:null,match:null,scoreTeamA:0,scoreTeamB:0,timer:null,timerRunning:!1,elapsedTime:0,totalPausedTime:0,pausedAt:null,actionInProgress:!1,isPaused:!1,teamAPlayers:[],teamBPlayers:[],gameEvents:[],showEventModal:!1,eventType:"",eventFormData:{teamId:null,description:""},socketError:null,gameStatusOptions:[{value:"scheduled",label:"Prévu"},{value:"in_progress",label:"En cours"},{value:"completed",label:"Terminé"}],spectatorCount:0,assistantName:"",showResetConfirmation:!1,showEditEventModal:!1,editEventFormData:{teamId:null,type:"",description:""},eventBeingEdited:null}},computed:{...(0,x.aH)("userTourney",{selectedPoolId:e=>e.selectedPoolId,selectedFieldId:e=>e.selectedFieldId,selectedGameId:e=>e.selectedGameId}),canEdit(){const e=1===this.$store.state.user?.roleId,t=this.$store.getters["userTourney/isAssistant"],s=this.tourney&&"active"===this.tourney.status;return!!e||!(!t||!s)},eventFormFields(){return this.match?[{name:"teamId",label:"Équipe",type:"select",options:[{value:this.match.teamA.id,label:this.match.teamA.teamName},{value:this.match.teamB.id,label:this.match.teamB.teamName}],required:!0},{name:"description",label:"Description",type:"text",required:!1}]:[]},isAdmin(){return 1===this.$store.state.user.roleId},isAuthorized(){const e=this.$store.getters["userTourney/isAssistant"],t=1===this.$store.state.user?.roleId;return e||t},sortedGameEvents(){return[...this.gameEvents].sort(((e,t)=>new Date(t.createdAt)-new Date(e.createdAt)))},formattedTime(){const e=Math.floor(this.elapsedTime/60).toString().padStart(2,"0"),t=(this.elapsedTime%60).toString().padStart(2,"0");return`${e}:${t}`},teamAResult(){return"completed"!==this.match.status?null:this.scoreTeamA>this.scoreTeamB?"winner":this.scoreTeamA<this.scoreTeamB?"loser":"draw"},teamBResult(){return"completed"!==this.match.status?null:this.scoreTeamB>this.scoreTeamA?"winner":this.scoreTeamB<this.scoreTeamA?"loser":"draw"},isDraw(){return"completed"===this.match.status&&this.scoreTeamA===this.scoreTeamB}},methods:{async fetchMatchDetails(){try{const{tourneyId:e,gameId:t}=this.$route.params,s=await $.get(`/tourneys/${e}/games/${t}`);this.match=s.data,this.scoreTeamA=this.match.scoreTeamA||0,this.scoreTeamB=this.match.scoreTeamB||0,this.teamAPlayers=this.match.teamA.players||[],this.teamBPlayers=this.match.teamB.players||[],this.assistantName=this.match.assistant?this.match.assistant.name:"N/A",this.match.realStartTime&&(this.timerRunning=!this.match.isPaused&&!this.match.realEndTime,this.totalPausedTime=parseInt(this.match.totalPausedTime,10)||0,this.pausedAt=this.match.pausedAt?new Date(this.match.pausedAt):null,this.isPaused=this.match.isPaused,this.calculateElapsedTime(),this.timerRunning&&!this.timer&&(this.timer=setInterval((()=>{this.calculateElapsedTime()}),1e3))),await this.fetchGameEvents(),this.setupSocket()}catch(e){console.error("Erreur lors de la récupération des détails du match :",e)}},async fetchTourneyStatus(){try{const e=await $.get(`/tourneys/${this.tourneyId}`);this.tourney=e.data}catch(e){console.error("Erreur lors de la récupération du statut du tournoi :",e)}},async fetchGameEvents(){try{const{tourneyId:e,gameId:t}=this.$route.params,s=await $.get(`/tourneys/${e}/games/${t}/events`);this.gameEvents=s.data}catch(e){console.error("Erreur lors de la récupération des événements du match :",e)}},calculateElapsedTime(){if(!this.match.realStartTime)return void(this.elapsedTime=0);let e=new Date;this.isPaused&&this.pausedAt?e=new Date(this.pausedAt):this.match.realEndTime&&(e=new Date(this.match.realEndTime));const t=new Date(this.match.realStartTime),s=parseInt(this.totalPausedTime,10)||0,o=e-t-s;isNaN(o)||o<0?(this.elapsedTime=0,console.error("Calcul du temps écoulé a échoué ou est négatif.")):this.elapsedTime=Math.floor(o/1e3)},startTimer(){if(!this.isAuthorized||this.actionInProgress)return;this.actionInProgress=!0;const e=q();this.match.realStartTime?this.isPaused&&e.emit("startMatchTimer",{matchId:this.match.id}):e.emit("startMatchTimer",{matchId:this.match.id})},pauseTimer(){if(!this.isAuthorized||this.actionInProgress)return;if(!this.timerRunning)return;this.actionInProgress=!0;const e=q();e.emit("pauseMatchTimer",{matchId:this.match.id})},resetTimer(){if(!this.isAuthorized)return;const e=q();e.emit("resetMatchTimer",{matchId:this.match.id})},stopTimer(){if(!this.timer)return;const e=q();e.emit("stopMatchTimer",{matchId:this.match.id})},async updateMatchStatus(e){if(("completed"===e||"scheduled"===e)&&this.timerRunning)return void we.oR.error("Le match est en cours, veuillez le terminer avant de changer le statut.");const t=q();try{t.emit("updateMatchStatus",{matchId:this.match.id,status:e}),"completed"!==e&&"scheduled"!==e||this.stopTimer()}catch(s){console.error("Erreur lors de la mise à jour du statut du match :",s),we.oR.error("Erreur lors de la mise à jour du statut du match.")}},goBack(){this.$router.push({path:`/tourneys/${this.tourneyId}/planning`,query:{pool:this.selectedPoolId,field:this.selectedFieldId,game:this.selectedGameId}})},setupSocket(){const e=q();e?(e.emit("joinGame",this.match.id),e.on("scoreUpdated",(e=>{this.scoreTeamA=e.scoreTeamA,this.scoreTeamB=e.scoreTeamB})),e.on("gameEvent",(e=>{this.gameEvents.push(e)})),e.on("gameEventUpdated",(e=>{const t=this.gameEvents.findIndex((t=>t.id===e.id));-1!==t&&this.gameEvents.splice(t,1,e)})),e.on("startMatchTimer",(e=>{e.matchId===this.match.id&&(this.match.realStartTime||(this.match.realStartTime=new Date(e.realStartTime)),this.totalPausedTime=parseInt(e.totalPausedTime,10)||0,this.pausedAt=e.pausedAt?new Date(e.pausedAt):null,this.isPaused=e.isPaused,this.timerRunning=!e.isPaused&&!this.match.realEndTime,this.assistantName=e.assistant?e.assistant:"N/A",this.timerRunning&&!this.timer&&(this.timer=setInterval((()=>{this.calculateElapsedTime()}),1e3)),this.actionInProgress=!1)})),e.on("pauseMatchTimer",(e=>{e.matchId===this.match.id&&(clearInterval(this.timer),this.timer=null,this.pausedAt=e.pausedAt?new Date(e.pausedAt):null,this.isPaused=e.isPaused,this.timerRunning=!1,this.calculateElapsedTime(),this.assistantName=e.assistant?e.assistant:"N/A",this.actionInProgress=!1)})),e.on("stopMatchTimer",(e=>{e.matchId===this.match.id&&(clearInterval(this.timer),this.timer=null,this.match.realEndTime=new Date(e.realEndTime),this.isPaused=!1,this.timerRunning=!1,this.calculateElapsedTime(),this.assistantName=e.assistant?e.assistant:"N/A")})),e.on("resetMatchTimer",(e=>{e.matchId===this.match.id&&(this.timerRunning=!1,this.elapsedTime=0,this.match.realStartTime=null,this.match.realEndTime=null,this.totalPausedTime=0,this.pausedAt=null,this.isPaused=!1,this.assistantName=e.assistant?e.assistant:"N/A",this.timer&&(clearInterval(this.timer),this.timer=null))})),e.on("matchStatusUpdated",(e=>{e.matchId===this.match.id&&(this.match.status=e.status,this.isPaused=e.isPaused,this.pausedAt=e.pausedAt?new Date(e.pausedAt):null,this.totalPausedTime=e.totalPausedTime||0,"completed"===e.status?this.stopTimer():"in_progress"===e.status&&(this.timerRunning=!this.isPaused&&!this.match.realEndTime,this.timerRunning&&!this.timer&&(this.timer=setInterval((()=>{this.calculateElapsedTime()}),1e3))))})),e.on("deleteGameEvent",(e=>{this.gameEvents=this.gameEvents.filter((t=>t.id!==e.eventId))})),e.on("spectatorCount",(e=>{this.spectatorCount=e.count})),e.on("deleteAllGameEvents",(e=>{e.gameId===this.match.id&&(this.gameEvents=[],this.scoreTeamA=0,this.scoreTeamB=0)}))):console.warn("Socket non disponible. L'utilisateur est peut-être déconnecté.")},submitEvent(){const{tourneyId:e}=this.$route.params,t={type:this.eventType,teamId:this.eventFormData.teamId,description:this.eventFormData.description,matchTime:this.elapsedTime},s=q();s.emit("gameEvent",{tourneyId:parseInt(e),gameId:this.match.id,event:t}),this.closeEventModal()},getEventTitle(e){switch(e){case"goal":return"Ajouter un But";case"foul":return"Ajouter une Faute";case"yellow_card":return"Ajouter un Carton Jaune";case"red_card":return"Ajouter un Carton Rouge";default:return"Ajouter un Événement"}},openEventModal(e){this.eventType=e,this.eventFormData={teamId:this.match.teamA.id,description:""},this.showEventModal=!0},closeEventModal(){this.eventFormData={teamId:null,description:""},this.showEventModal=!1},updateScores(){if(!this.isAuthorized)return;const{tourneyId:e}=this.$route.params,t=q();let s=parseInt(this.scoreTeamA,10),o=parseInt(this.scoreTeamB,10);isNaN(s)&&(s=0),isNaN(o)&&(o=0),this.scoreTeamA=s,this.scoreTeamB=o,t.emit("updateScore",{tourneyId:parseInt(e),gameId:this.match.id,scoreTeamA:this.scoreTeamA,scoreTeamB:this.scoreTeamB})},async deleteEvent(e){try{const{tourneyId:t,gameId:s}=this.$route.params;await $.delete(`/tourneys/${t}/games/${s}/events/${e}`),this.gameEvents=this.gameEvents.filter((t=>t.id!==e));const o=q();o.emit("deleteGameEvent",{tourneyId:parseInt(t),gameId:this.match.id,eventId:e})}catch(t){console.error("Erreur lors de la suppression de l'événement :",t)}},getEventPositionClass(e){return e.teamId===this.match.teamA.id?"mr-auto text-right pr-10":e.teamId===this.match.teamB.id?"ml-auto text-left pl-10":"mx-auto text-center"},getEventIcon(e){switch(e){case"goal":return["fas","futbol"];case"foul":return["fas","exclamation-circle"];case"yellow_card":return["fas","square"];case"red_card":return["fas","flag"];default:return["fas","question-circle"]}},getEventDescription(e){let t="Inconnu";switch(e.teamId===this.match.teamA.id?t=this.match.teamA.teamName:e.teamId===this.match.teamB.id&&(t=this.match.teamB.teamName),e.type){case"goal":return`${t} - Point marqué`;case"foul":return`${t} - Faute commise`;case"yellow_card":return`${t} - Carton Jaune`;case"red_card":return`${t} - Carton Rouge`;default:return`${t} - Événement`}},formatEventTime(e){const t=new Date(e),s=t.getHours().toString().padStart(2,"0"),o=t.getMinutes().toString().padStart(2,"0"),r=t.getSeconds().toString().padStart(2,"0");return`${s}:${o}:${r}`},formatTime(e){if(!e)return"N/A";const t=new Date(e),s=t.getUTCHours().toString().padStart(2,"0"),o=t.getUTCMinutes().toString().padStart(2,"0");return`${s}:${o}`},formatElapsedTime(e){const t=Math.floor(e/60).toString(),s=(e%60).toString().padStart(2,"0");return"0"===t?`${s}''`:`${t}'${s}''`},getMatchStatusLabel(e){switch(e){case"scheduled":return"Prévu";case"in_progress":return"En cours";case"completed":return"Terminé";default:return"Inconnu"}},onMatchStatusChange(e){this.updateMatchStatus(e)},openResetConfirmation(){this.showResetConfirmation=!0},closeResetConfirmation(){this.showResetConfirmation=!1},handleResetConfirm(){this.showResetConfirmation=!1,this.resetMatch()},openEditEventModal(e){this.eventBeingEdited=e,this.editEventFormData={teamId:e.teamId||this.match.teamA.id,type:e.type||"goal",description:e.description||""},this.showEditEventModal=!0},closeEditEventModal(){this.eventBeingEdited=null,this.editEventFormData={teamId:null,type:"",description:""},this.showEditEventModal=!1},async submitEditEvent(){if(this.eventBeingEdited)try{const{tourneyId:e,gameId:t}=this.$route.params;await $.put(`/tourneys/${e}/games/${t}/events/${this.eventBeingEdited.id}`,{teamId:this.editEventFormData.teamId,type:this.editEventFormData.type,description:this.editEventFormData.description});const s=this.gameEvents.findIndex((e=>e.id===this.eventBeingEdited.id));-1!==s&&(this.gameEvents[s].teamId=this.editEventFormData.teamId,this.gameEvents[s].type=this.editEventFormData.type,this.gameEvents[s].description=this.editEventFormData.description),this.closeEditEventModal(),we.oR.success("Événement mis à jour avec succès")}catch(e){console.error("Erreur lors de la mise à jour de l'événement :",e),we.oR.error("Erreur lors de la mise à jour de l'événement.")}},async resetMatch(){if(!this.isAuthorized)return;const e=q();try{e.emit("resetMatchTimer",{matchId:this.match.id}),await this.deleteAllEvents()}catch(t){console.error("Erreur lors de la réinitialisation du match :",t),we.oR.error("Erreur lors de la réinitialisation du match.")}},async deleteAllEvents(){try{const{tourneyId:e,gameId:t}=this.$route.params,s=await $.get(`/tourneys/${e}/games/${t}/events`),o=s.data,r=o.map((s=>$.delete(`/tourneys/${e}/games/${t}/events/${s.id}`)));await Promise.all(r);const a=q();a.emit("deleteAllGameEvents",{tourneyId:parseInt(e),gameId:this.match.id}),this.gameEvents=[],we.oR.success("Le match a été réinitialisé avec succès !")}catch(e){console.error("Erreur lors de la réinitialisation du match :",e),we.oR.error("Erreur lors de la réinitialisation du match.")}}},beforeUnmount(){const e=q();e&&(e.emit("leaveGame",this.match.id),e.off("scoreUpdated"),e.off("gameEvent"),e.off("startMatchTimer"),e.off("pauseMatchTimer"),e.off("resetMatchTimer"),e.off("stopMatchTimer"),e.off("deleteGameEvent"),e.off("matchStatusUpdated"),e.off("deleteAllGameEvents")),this.timer&&clearInterval(this.timer)},async mounted(){await this.fetchTourneyStatus(),await this.fetchMatchDetails()}};const em=(0,E.A)(Zc,[["render",Yc],["__scopeId","data-v-42a5d1b7"]]);var tm=em;const sm={class:"p-4 bg-light-background dark:bg-dark-background transition-colors duration-300"},om={class:"flex justify-between items-center mb-4"},rm={key:0,class:"text-center py-4"},am={key:1},nm={class:"text-xl font-semibold mb-4 text-center text-light-title dark:text-dark-title"},im={class:"w-full text-left border-collapse"},lm={class:"py-2 px-2 text-center"},dm={class:"py-2 px-2 font-semibold"},um={class:"py-2 px-2 text-center"},cm={class:"py-2 px-2 text-center"},mm={class:"py-2 px-2 text-center"},hm={class:"py-2 px-2 text-center"},pm={class:"py-2 px-2 text-center"},gm={class:"py-2 px-2 text-center"},fm={class:"py-2 px-2 text-center"},ym={class:"py-2 px-2 text-center"};function vm(e,t,s,n,i,l){const d=(0,r.g2)("SubMenuComponent"),u=(0,r.g2)("TitleComponent"),c=(0,r.g2)("ButtonComponent");return(0,r.uX)(),(0,r.CE)(r.FK,null,[(0,r.bF)(d,{tourneyId:i.tourneyId},null,8,["tourneyId"]),(0,r.Lk)("div",sm,[(0,r.Lk)("div",om,[(0,r.bF)(u,{title:"Classement du Tournoi"}),(0,r.bF)(c,{onClick:l.toggleView,class:"py-2 px-4"},{default:(0,r.k6)((()=>[(0,r.eW)((0,a.v_)(i.compactView?"Vue détaillée":"Vue compacte"),1)])),_:1},8,["onClick"])]),i.loading?((0,r.uX)(),(0,r.CE)("div",rm,"Chargement...")):((0,r.uX)(),(0,r.CE)("div",am,[(0,r.Lk)("div",{class:(0,a.C4)(["grid gap-4",i.compactView?"grid-cols-1 md:grid-cols-2 lg:grid-cols-3":"grid-cols-1"])},[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.results,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.poolId,class:"p-4 rounded shadow bg-light-card dark:bg-dark-card"},[(0,r.Lk)("h2",nm,(0,a.v_)(e.poolName),1),(0,r.Lk)("div",null,[(0,r.Lk)("table",im,[t[0]||(t[0]=(0,r.Lk)("thead",null,[(0,r.Lk)("tr",{class:"border-b bg-light-details.background dark:bg-dark-details.background"},[(0,r.Lk)("th",{class:"py-2 px-2 text-light-text dark:text-dark-text"}," Pos "),(0,r.Lk)("th",{class:"py-2 px-2 text-light-text dark:text-dark-text"}," Team "),(0,r.Lk)("th",{class:"py-2 px-2 text-light-text dark:text-dark-text"}," Pts "),(0,r.Lk)("th",{class:"py-2 px-2 text-light-text dark:text-dark-text"}," J "),(0,r.Lk)("th",{class:"py-2 px-2 text-light-text dark:text-dark-text"}," G "),(0,r.Lk)("th",{class:"py-2 px-2 text-light-text dark:text-dark-text"}," N "),(0,r.Lk)("th",{class:"py-2 px-2 text-light-text dark:text-dark-text"}," P "),(0,r.Lk)("th",{class:"py-2 px-2 text-light-text dark:text-dark-text"}," BM "),(0,r.Lk)("th",{class:"py-2 px-2 text-light-text dark:text-dark-text"}," BE "),(0,r.Lk)("th",{class:"py-2 px-2 text-light-text dark:text-dark-text"}," Diff ")])],-1)),(0,r.bF)(o.F,{tag:"tbody",name:"list",class:"transition-wrapper"},{default:(0,r.k6)((()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.sortedStandings(e.standings),((e,t)=>((0,r.uX)(),(0,r.CE)("tr",{key:e.teamId,class:(0,a.C4)(["border-b hover:bg-light-details.hover dark:hover:bg-dark-details.hover",i.compactView?"text-sm":"text-base"])},[(0,r.Lk)("td",lm,(0,a.v_)(t+1),1),(0,r.Lk)("td",dm,(0,a.v_)(e.teamName),1),(0,r.Lk)("td",um,(0,a.v_)(e.points),1),(0,r.Lk)("td",cm,(0,a.v_)(e.played),1),(0,r.Lk)("td",mm,(0,a.v_)(e.won),1),(0,r.Lk)("td",hm,(0,a.v_)(e.drawn),1),(0,r.Lk)("td",pm,(0,a.v_)(e.lost),1),(0,r.Lk)("td",gm,(0,a.v_)(e.goalsFor),1),(0,r.Lk)("td",fm,(0,a.v_)(e.goalsAgainst),1),(0,r.Lk)("td",ym,(0,a.v_)(e.goalDiff),1)],2)))),128))])),_:2},1024)])])])))),128))],2)]))])],64)}var bm={components:{TitleComponent:Ls,SubMenuComponent:Qu,ButtonComponent:ke},data(){return{tourneyId:this.$route.params.tourneyId,loading:!0,results:[],compactView:!1}},methods:{async fetchScores(e=!0){e&&(this.loading=!0);try{const e=await $.get(`/tourneys/${this.tourneyId}/scores`);this.results=e.data.results}catch(t){console.error("Erreur lors de la récupération des scores :",t)}finally{e&&(this.loading=!1)}},setupSocket(){const e=q();e?(e.emit("joinTourney",this.tourneyId),e.on("tourneyScoresUpdated",(()=>{this.fetchScores(!1)}))):console.warn("Socket non disponible. L'utilisateur est peut-être déconnecté.")},sortedStandings(e){return[...e].sort(((e,t)=>e.points!==t.points?t.points-e.points:e.played!==t.played?e.played-t.played:t.goalDiff-e.goalDiff))},toggleView(){this.compactView=!this.compactView}},async mounted(){await this.fetchScores(),this.setupSocket()},beforeUnmount(){const e=q();e&&(e.emit("leaveTourney",this.tourneyId),e.off("tourneyScoresUpdated"))}};const km=(0,E.A)(bm,[["render",vm],["__scopeId","data-v-5710e63c"]]);var Tm=km;const Cm={class:"grid grid-cols-1 gap-8 p-8 md:grid-cols-2 md:items-start"},xm={class:"bg-light-card dark:bg-dark-card rounded-lg shadow-lg p-8"},wm={class:"flex items-center justify-between mb-4"},Em={class:"text-3xl font-bold text-light-subMenu-activeText dark:text-dark-subMenu-activeText"},Im={class:"text-base text-light-form-text dark:text-dark-form-text mb-2"},Sm={class:"text-base text-light-form-text dark:text-dark-form-text mb-2"},Fm={class:"text-base text-light-form-text dark:text-dark-form-text mb-2"},Pm={class:"mt-6"},Am={class:"text-base text-light-form-text dark:text-dark-form-text mb-2"},Lm={class:"text-base text-light-form-text dark:text-dark-form-text mb-2"},Dm={class:"mt-2"},Mm={class:"list-disc list-inside mt-2"},$m={class:"bg-light-card dark:bg-dark-card rounded-lg shadow-lg p-4 sm:h-[50vh] h-[300px] mt-8 md:mt-0 relative"},Um={key:0,class:"text-sm text-red-500 mt-2 text-center z-20"},Rm={class:"absolute inset-0"},Vm={class:"mt-4 flex justify-end relative z-30"},_m={class:"bg-light-card dark:bg-dark-card rounded-lg shadow-lg p-8 mt-8"},Xm={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},qm={class:"flex items-center"},Nm={class:"text-base font-semibold text-light-form-text dark:text-dark-form-text"},Bm={key:0,class:"text-sm text-light-form-text dark:text-dark-form-text mt-1"},Wm={key:0},jm=["href"],Qm={key:1};function Om(e,t,s,o,n,i){const l=(0,r.g2)("SubMenuComponent"),d=(0,r.g2)("l-tile-layer"),u=(0,r.g2)("l-popup"),c=(0,r.g2)("l-marker"),m=(0,r.g2)("l-map"),h=(0,r.g2)("ButtonComponent");return(0,r.uX)(),(0,r.CE)("div",null,["UserTourneyInfos"!==e.$route.name?((0,r.uX)(),(0,r.Wv)(l,{key:0,tourneyId:n.tourneyId,onSelectTab:i.selectTab},null,8,["tourneyId","onSelectTab"])):(0,r.Q3)("",!0),(0,r.Lk)("div",Cm,[(0,r.Lk)("div",xm,[(0,r.Lk)("div",wm,[(0,r.Lk)("h2",Em,(0,a.v_)(n.tourney.name),1)]),(0,r.Lk)("p",Im,[t[0]||(t[0]=(0,r.Lk)("strong",null,"Lieu :",-1)),(0,r.eW)(" "+(0,a.v_)(n.tourney.location),1)]),(0,r.Lk)("p",Sm,[t[1]||(t[1]=(0,r.Lk)("strong",null,"Date :",-1)),(0,r.eW)(" "+(0,a.v_)(i.formatDate(n.tourney.dateTourney)),1)]),(0,r.Lk)("p",Fm,[t[2]||(t[2]=(0,r.Lk)("strong",null,"Durée d'une partie :",-1)),(0,r.eW)(" "+(0,a.v_)(i.gameDurationText),1)]),(0,r.Lk)("div",Pm,[t[6]||(t[6]=(0,r.Lk)("h3",{class:"text-2xl font-semibold mb-2 text-light-form-text dark:text-dark-form-text"}," Mon Équipe ",-1)),(0,r.Lk)("p",Am,[t[3]||(t[3]=(0,r.Lk)("strong",null,"Nom de l'équipe :",-1)),(0,r.eW)(" "+(0,a.v_)(n.userTeam.teamName),1)]),(0,r.Lk)("p",Lm,[t[4]||(t[4]=(0,r.Lk)("strong",null,"Matchs restants :",-1)),(0,r.eW)(" "+(0,a.v_)(n.userTeam.remainingMatches),1)]),(0,r.Lk)("div",Dm,[t[5]||(t[5]=(0,r.Lk)("h4",{class:"text-xl font-semibold text-light-form-text dark:text-dark-form-text"}," Membres : ",-1)),(0,r.Lk)("ul",Mm,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.userTeam.players,(e=>((0,r.uX)(),(0,r.CE)("li",{key:e.id,class:"text-base text-light-form-text dark:text-dark-form-text"},(0,a.v_)(e.name),1)))),128))])])])]),(0,r.Lk)("div",$m,[i.coordinatesAreValid?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",Um," Les coordonnées ne sont pas valides, la carte affiche un lieu par défaut (FR). ")),(0,r.Lk)("div",Rm,[n.mapIsReady?((0,r.uX)(),(0,r.Wv)(m,{key:0,ref:"map",zoom:12,center:[i.mapLatitude,i.mapLongitude],class:"h-full w-full"},{default:(0,r.k6)((()=>[(0,r.bF)(d,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png","layer-type":"base",name:"OpenStreetMap"}),(0,r.bF)(c,{"lat-lng":[i.mapLatitude,i.mapLongitude]},{default:(0,r.k6)((()=>[(0,r.bF)(u,null,{default:(0,r.k6)((()=>[(0,r.eW)((0,a.v_)(n.tourney.location||"Fribourg, Suisse"),1)])),_:1})])),_:1},8,["lat-lng"])])),_:1},8,["center"])):(0,r.Q3)("",!0),(0,r.Lk)("div",Vm,[(0,r.bF)(h,{variant:"primary",fontAwesomeIcon:"map-marker-alt",onClick:i.openGoogleMaps},{default:(0,r.k6)((()=>t[7]||(t[7]=[(0,r.eW)(" Itinéraire "),(0,r.Lk)("span",{class:"hidden sm:inline"}," Avec Google Maps",-1)]))),_:1},8,["onClick"])])])])]),(0,r.Lk)("div",_m,[t[9]||(t[9]=(0,r.Lk)("h3",{class:"text-2xl font-semibold mb-2 text-light-form-text dark:text-dark-form-text"}," Sports Joués ",-1)),(0,r.Lk)("div",Xm,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.sports,(e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"flex flex-col"},[(0,r.Lk)("div",qm,[(0,r.Lk)("span",{class:"w-4 h-4 rounded-full mr-2",style:(0,a.Tr)({backgroundColor:e.color})},null,4),(0,r.Lk)("span",Nm,(0,a.v_)(e.name),1)]),e.rules?((0,r.uX)(),(0,r.CE)("p",Bm,[t[8]||(t[8]=(0,r.Lk)("strong",null,"Règles: ",-1)),i.isValidURL(e.rules)?((0,r.uX)(),(0,r.CE)("span",Wm,[(0,r.Lk)("a",{href:e.rules,target:"_blank",rel:"noopener noreferrer",class:"text-blue-500 underline"},(0,a.v_)(e.rules),9,jm)])):((0,r.uX)(),(0,r.CE)("span",Qm,(0,a.v_)(e.rules),1))])):(0,r.Q3)("",!0)])))),128))])])])}var Gm={components:{LMap:io.Do,LTileLayer:io.a,LMarker:io.li,LPopup:io.nA,SubMenuComponent:Qu,ButtonComponent:ke},data(){return{tourneyId:this.$route.params.tourneyId,tourney:{},sports:[],userTeam:{teamName:"",players:[],remainingMatches:0},gameDuration:null,mapIsReady:!1}},computed:{coordinatesAreValid(){const e=this.tourney.latitude,t=this.tourney.longitude;return null!==e&&null!==t&&!isNaN(e)&&!isNaN(t)&&e>=-90&&e<=90&&t>=-180&&t<=180},mapLatitude(){return this.coordinatesAreValid?this.tourney.latitude:46.8065},mapLongitude(){return this.coordinatesAreValid?this.tourney.longitude:7.1619},googleMapsLink(){if(this.coordinatesAreValid){const e=this.tourney.latitude,t=this.tourney.longitude;return`https://www.google.com/maps/dir/?api=1&destination=${e},${t}`}return"https://www.google.com/maps/dir/?api=1&destination=46.8065,7.1619"},gameDurationText(){return null===this.gameDuration||void 0===this.gameDuration?"N/A":`${this.gameDuration} minutes`}},async mounted(){await this.fetchTourneyDetails(),this.mapIsReady=!0},methods:{selectTab(e){this.activeTab=e},async fetchTourneyDetails(){try{const e=await $.get(`/tourneys/${this.tourneyId}/details/user-view`),t=e.data;this.tourney=t.tourney,this.sports=t.sports,this.userTeam=t.userTeam,this.gameDuration=t.gameDuration}catch(e){console.error("Erreur lors de la récupération des détails du tournoi (vue utilisateur) :",e)}},isValidURL(e){try{return new URL(e),!0}catch(t){return!1}},formatDate(e){const t={year:"numeric",month:"long",day:"numeric"};return new Date(e).toLocaleDateString(void 0,t)},openGoogleMaps(){window.open(this.googleMapsLink,"_blank")}}};const zm=(0,E.A)(Gm,[["render",Om],["__scopeId","data-v-dfaf33ea"]]);var Hm=zm;async function Km(e,t,s){const o=!navigator.onLine,r=N.getters["auth/userRole"],a=e.params.tourneyId;if(O(r))return s();if(o){const e=localStorage.getItem(`planning-${a}`);return e?s():s("/tourneys")}try{const t=await $.get(`/users/me/tourneys/${a}/role`),o=t.data.tourneyRole;return o?(N.commit("userTourney/SET_TOURNEY_ROLE",o),s()):"/tourneys"===e.path?s():s("/tourneys")}catch(n){return console.error("Erreur lors de la vérification de l'accès au tournoi:",n),"/tourneys"===e.path?s():s("/tourneys")}}async function Jm(e,t,s){const o=!navigator.onLine,r=N.getters["auth/userRole"],a=e.params.tourneyId;if(O(r))return s();if(o){const e=localStorage.getItem(`planning-${a}`);return e?s():s("/tourneys")}try{const t=await N.dispatch("userTourney/fetchTourneyById",a);if(!t)return s("/tourneys");const o=["active","completed"].includes(t.status),r=["active","completed"].includes(t.registrationStatus);if(o)return s();if(["draft","ready"].includes(t.status)&&r){const t=[`/tourneys/${a}/join-team`,`/tourneys/${a}/teams/${e.params.teamId}/details`];return t.includes(e.path)?s():s("/tourneys")}return s("/tourneys")}catch(n){return console.error("Erreur lors de la vérification des règles du tournoi :",n),s("/tourneys")}}var Ym=[{path:"/user",name:"UserDashboard",component:Md,meta:{requiresAuth:!0,permission:"viewUserPage"}},{path:"/profile",name:"UserProfile",component:Xd,meta:{requiresAuth:!0,permission:"viewUserPage"}},{path:"/tourneys",name:"UserTourneys",component:Gd,meta:{requiresAuth:!0,permission:"viewUserPage"}},{path:"/tourneys/:tourneyId/join-team",name:"UserTourneyJoinTeam",component:hu,meta:{requiresAuth:!0,permission:"viewUserPage"},beforeEnter:[Km,Jm]},{path:"/tourneys/:tourneyId/teams/:teamId/details",name:"UserTourneyTeamDetails",component:xu,meta:{requiresAuth:!0,permission:"viewUserPage"},beforeEnter:[Km,Jm]},{path:"/tourneys/:tourneyId/planning",name:"UserTourneyPlanning",component:oc,meta:{requiresAuth:!0,permission:"viewUserPage"},beforeEnter:[Km,Jm]},{path:"/tourneys/:tourneyId/games/:gameId",name:"UserTourneyGameDetails",component:tm,meta:{requiresAuth:!0,permission:"viewUserPage"},beforeEnter:[Km,Jm]},{path:"/tourneys/:tourneyId/scores",name:"UserTourneyScores",component:Tm,meta:{requiresAuth:!0,permission:"viewUserPage"},beforeEnter:[Km,Jm]},{path:"/tourneys/:tourneyId/details",name:"UserTourneyDetails",component:Hm,meta:{requiresAuth:!0,permission:"viewUserPage"},beforeEnter:[Km,Jm]},{path:"/tourneys/:tourneyId/infos",name:"UserTourneyInfos",component:Hm,meta:{requiresAuth:!0,permission:"viewUserPage"},beforeEnter:[Km]}];const Zm=[...Ke,...Pd,...Ym],eh=(0,J.aE)({history:(0,J.LA)("/"),routes:Zm});eh.beforeEach((async(e,t,s)=>{const o=localStorage.getItem("token"),r=!!o,a=!navigator.onLine;if(e.query.inviteToken&&N.dispatch("saveInviteToken",e.query.inviteToken),!1===e.meta.requiresAuth){if(r){const e=(0,U.s)(o),t=e.roleId;return s(1===t?"/admin/tourneys":"/tourneys")}return s()}if(("Login"===e.name||"Register"===e.name)&&r){const e=(0,U.s)(o),t=e.roleId;return s(1===t?"/admin/tourneys":"/tourneys")}if(e.meta.requiresAuth){if(!r)return N.dispatch("logout"),s("/login");if(j())return Q(),s("/login");if(a)return e.path.startsWith("/tourneys")?(console.warn("Mode hors ligne : accès autorisé pour /tourneys."),s()):e.path.startsWith("/admin")&&r?(console.warn("Mode hors ligne : accès admin possible avec données en cache."),s()):(console.warn("Mode hors ligne : non admin ou non authentifié, redirection login."),s("/login"));try{const t=await G();localStorage.setItem("token",t),$.defaults.headers.common["Authorization"]=`Bearer ${t}`;const o=await $.get("/users/me"),r=o.data,a=(0,U.s)(t);N.commit("SET_AUTH",{isAuthenticated:!0,user:r,tokenExpiration:a.exp});const l=r.roleId;if(e.meta.permission&&!B(l,e.meta.permission))return s("/access-denied");const d=N.state.inviteToken;if(d){try{await $.post("/tourneys/join",{token:d});const e=(0,U.s)(d),t=e.tourneyId;return N.dispatch("clearInviteToken"),s(`/tourneys/${t}/join-team`)}catch(n){console.error("Erreur lors de la jonction au tournoi:",n)}return N.dispatch("clearInviteToken"),s()}const u=(e.path.startsWith("/tourneys/")||e.path.startsWith("/admin/tourneys/"))&&e.params.tourneyId;if(u)try{const t=e.params.tourneyId;await N.dispatch("tourney/fetchTourneyStatuses",t)}catch(i){if(console.error("Erreur lors de la récupération du tournoi:",i),i.response&&404===i.response.status)return s({name:"NotFoundPage"});await N.dispatch("tourney/clearTournamentName")}else N.dispatch("tourney/clearTournamentName");return s()}catch(i){return console.error("Erreur lors du rafraîchissement du token:",i),N.dispatch("logout"),s("/login")}}return s()}));var th=eh,sh=s(8347),oh=s(1273),rh=s(7107),ah=s(6188);function nh(){rh.Yv.add(ah.pnh,ah.s6x,ah.iHh,ah.WPY,ah.Nfw,ah.tUE,ah.UTC,ah.Tsj,ah.fny,ah.z1G,ah.$T_,ah.ckx,ah.jPR,ah.CQO,ah.e68,ah.G7W,ah.GRI,ah.y_8,ah.Dfk,ah.CeG,ah.QLR,ah.pS3,ah.gdJ,ah.hpd,ah.yLS,ah.GHC,ah.dB,ah.wRm,ah.Pcr,ah.okg,ah.BEE,ah.oMq,ah.PJS,ah.X46,ah.enb,ah.rhE,ah.iW_,ah.e5w,ah.U7U,ah.mRM)}nh();const ih=(0,o.Ef)(K);ih.component("font-awesome-icon",oh.gc),ih.component("v-select",Zl.A),N.dispatch("initializeAuth"),ih.use(sh.A),ih.use(N),ih.use(th),ih.use(we.Ay,{autoClose:2e3}),ih.mount("#app")}},t={};function s(o){var r=t[o];if(void 0!==r)return r.exports;var a=t[o]={exports:{}};return e[o].call(a.exports,a,a.exports,s),a.exports}s.m=e,function(){var e=[];s.O=function(t,o,r,a){if(!o){var n=1/0;for(u=0;u<e.length;u++){o=e[u][0],r=e[u][1],a=e[u][2];for(var i=!0,l=0;l<o.length;l++)(!1&a||n>=a)&&Object.keys(s.O).every((function(e){return s.O[e](o[l])}))?o.splice(l--,1):(i=!1,a<n&&(n=a));if(i){e.splice(u--,1);var d=r();void 0!==d&&(t=d)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[o,r,a]}}(),function(){var e,t=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__};s.t=function(o,r){if(1&r&&(o=this(o)),8&r)return o;if("object"===typeof o&&o){if(4&r&&o.__esModule)return o;if(16&r&&"function"===typeof o.then)return o}var a=Object.create(null);s.r(a);var n={};e=e||[null,t({}),t([]),t(t)];for(var i=2&r&&o;"object"==typeof i&&!~e.indexOf(i);i=t(i))Object.getOwnPropertyNames(i).forEach((function(e){n[e]=function(){return o[e]}}));return n["default"]=function(){return o},s.d(a,n),a}}(),function(){s.d=function(e,t){for(var o in t)s.o(t,o)&&!s.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){s.f={},s.e=function(e){return Promise.all(Object.keys(s.f).reduce((function(t,o){return s.f[o](e,t),t}),[]))}}(),function(){s.u=function(e){return"js/"+e+"."+{8:"02116c4a",24:"16f174f9",71:"bfd53214",249:"fba376ac",481:"12194024"}[e]+".js"}}(),function(){s.miniCssF=function(e){}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="frontend:";s.l=function(o,r,a,n){if(e[o])e[o].push(r);else{var i,l;if(void 0!==a)for(var d=document.getElementsByTagName("script"),u=0;u<d.length;u++){var c=d[u];if(c.getAttribute("src")==o||c.getAttribute("data-webpack")==t+a){i=c;break}}i||(l=!0,i=document.createElement("script"),i.charset="utf-8",i.timeout=120,s.nc&&i.setAttribute("nonce",s.nc),i.setAttribute("data-webpack",t+a),i.src=o),e[o]=[r];var m=function(t,s){i.onerror=i.onload=null,clearTimeout(h);var r=e[o];if(delete e[o],i.parentNode&&i.parentNode.removeChild(i),r&&r.forEach((function(e){return e(s)})),t)return t(s)},h=setTimeout(m.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=m.bind(null,i.onerror),i.onload=m.bind(null,i.onload),l&&document.head.appendChild(i)}}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){s.p="/"}(),function(){var e={524:0};s.f.j=function(t,o){var r=s.o(e,t)?e[t]:void 0;if(0!==r)if(r)o.push(r[2]);else{var a=new Promise((function(s,o){r=e[t]=[s,o]}));o.push(r[2]=a);var n=s.p+s.u(t),i=new Error,l=function(o){if(s.o(e,t)&&(r=e[t],0!==r&&(e[t]=void 0),r)){var a=o&&("load"===o.type?"missing":o.type),n=o&&o.target&&o.target.src;i.message="Loading chunk "+t+" failed.\n("+a+": "+n+")",i.name="ChunkLoadError",i.type=a,i.request=n,r[1](i)}};s.l(n,l,"chunk-"+t,t)}},s.O.j=function(t){return 0===e[t]};var t=function(t,o){var r,a,n=o[0],i=o[1],l=o[2],d=0;if(n.some((function(t){return 0!==e[t]}))){for(r in i)s.o(i,r)&&(s.m[r]=i[r]);if(l)var u=l(s)}for(t&&t(o);d<n.length;d++)a=n[d],s.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return s.O(u)},o=self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=s.O(void 0,[504],(function(){return s(6530)}));o=s.O(o)})();
//# sourceMappingURL=app.d9af9132.js.map